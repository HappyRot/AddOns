local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Pet;local i=f.Target;local j=d.Spell;local k=d.MultiSpell;local l=d.Item;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[6]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[12]local v=HeroRotationCharDB.Toggles[70]local w=HeroRotationCharDB.Toggles[71]local x=HeroRotationCharDB.Toggles[72]local y={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}local z=m.Commons.Everyone;local A={General=m.GUISettings.General,Commons=m.GUISettings.APL.Druid.Commons,Guardian=m.GUISettings.APL.Druid.Guardian,Guardian2=m.GUISettings.APL.Druid.Guardian2}local B=j.Druid.Guardian;local C=l.Druid.Guardian;local D={}local E=g:GetEquipment()local F=l(0)local G=l(0)if E[13]then F=l(E[13])end;if E[14]then G=l(E[14])end;local H;local I;local J;local K=0;local L=0;local M=0;local N;local O,P;local Q=g:HasLegendaryEquipped(58)local R=g:HasLegendaryEquipped(49)local S=g:HasLegendaryEquipped(48)local T=g:CovenantID()d:RegisterForEvent(function()T=g:CovenantID()end,"COVENANT_CHOSEN")d:RegisterForEvent(function()E=g:GetEquipment()F=l(0)G=l(0)if E[13]then F=l(E[13])end;if E[14]then G=l(E[14])end;Q=g:HasLegendaryEquipped(58)R=g:HasLegendaryEquipped(49)S=g:HasLegendaryEquipped(48)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()B.AdaptiveSwarm:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")B.AdaptiveSwarm:RegisterInFlight()local function U(V)if V then return 1 else return 0 end end;local function W(V)return V~=0 end;local function X(Y)local Z=0;for a0 in pairs(Y)do local a1=Y[a0]if a1:IsChanneling(j(240784))then Z=Z+1 end end;return Z end;local function a2(Y)local a3=0;for a0 in pairs(Y)do local a1=Y[a0]if a1:CastRemains()<=g:GCD()and a1:IsCasting(j(240784))then a3=a3+1 end end;return a3 end;local function a4(Y)local a5=0;for a0 in pairs(Y)do local a1=Y[a0]if a1:NPCID()==118044 then a5=a5+1 end end;return a5 end;local function a6(a7)if a7:DebuffRefreshable(B.MoonfireDebuff)and a7:TimeToDie()>12 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and a7:GUID()==f("mouseover"):GUID()and A.Guardian.TargetSwap=="Mouseover"and a7:NPCID()~=118044 then K=18921;return true elseif a7:DebuffRefreshable(B.MoonfireDebuff)and a7:TimeToDie()>12 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and A.Guardian.TargetSwap=="AutoSwap"and a7:GUID()~=i:GUID()and not u and a7:NPCID()~=118044 then K=9999;if K==999 then starttime=GetTime()endtime=starttime+0.25 elseif K>0 and endtime~=nil and GetTime()>endtime then K=0 end;return true elseif a7:DebuffRefreshable(B.MoonfireDebuff)and a7:TimeToDie()>12 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and a7:GUID()==i:GUID()and a7:NPCID()~=118044 then L=8921;return true elseif a7:DebuffRefreshable(B.MoonfireDebuff)and a7:TimeToDie()>12 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and a7:NPCID()~=118044 then return true end end;local function a8(a7)if a7:DebuffRefreshable(B.MoonfireDebuff)and a7:NPCID()==118032 and a7:GUID()==f("mouseover"):GUID()and a7:NPCID()~=118044 then K=18921;return true elseif a7:DebuffRefreshable(B.MoonfireDebuff)and a7:NPCID()==118032 and a7:GUID()==f("target"):GUID()and a7:NPCID()~=118044 then L=8921;return true elseif a7:DebuffRefreshable(B.MoonfireDebuff)and a7:NPCID()==118032 then return true end end;local function a9(a7)return a7:DebuffRefreshable(B.ThrashDebuff)or a7:DebuffStack(B.ThrashDebuff)<3 or a7:DebuffStack(B.ThrashDebuff)<4 and Q or P>=4 or g:BuffUp(B.BerserkBuff)and g:BuffRemains(B.BerserkBuff)<=g:GCD()+0.5 end;local function aa(a7)if a7:DebuffStack(B.ThrashDebuff)>2 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and a7:GUID()==f("mouseover"):GUID()and A.Guardian.TargetSwap=="Mouseover"then K=180313;return true elseif a7:DebuffStack(B.ThrashDebuff)>2 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and A.Guardian.TargetSwap=="AutoSwap"and a7:GUID()~=i:GUID()and not u then K=9999;if K==999 then starttime=GetTime()endtime=starttime+0.25 elseif K>0 and endtime~=nil and GetTime()>endtime then K=0 end;return true elseif a7:DebuffStack(B.ThrashDebuff)>2 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)and a7:GUID()==i:GUID()then L=80313;return true elseif a7:DebuffStack(B.ThrashDebuff)>2 and(a7:AffectingCombat()or a7:IsDummy()or a7:NPCID()==153285)then return true end;return a7:DebuffStack(B.ThrashDebuff)>2 end;local function ab()if g:HealthPercentage()<A.Guardian2.FrenziedRegenHP and B.FrenziedRegeneration:IsReady()and g:BuffDown(B.FrenziedRegenerationBuff)and not g:HealingAbsorbed()and g:BuffUp(B.BearForm)then if p(B.FrenziedRegeneration,nil,nil)then L=22842;return"frenzied_regeneration defensive 2"end end;if B.Ironfur:IsCastable()and g:BuffUp(B.BearForm)and(g:Rage()>=B.Ironfur:Cost()+1 and(I or i:IsDummy()or i:NPCID()==153285)and(g:BuffDown(B.IronfurBuff)or g:BuffStack(B.IronfurBuff)<2 and g:BuffRefreshable(B.Ironfur)or g:Rage()>=90))then if p(B.Ironfur,nil,nil)then L=192081;return"ironfur defensive 4"end end;if B.Barkskin:IsCastable()and(g:HealthPercentage()<A.Guardian2.BarkskinHP and g:BuffDown(B.IronfurBuff)or g:HealthPercentage()<A.Guardian2.BarkskinHP*0.75)then if p(B.Barkskin,nil,nil)then L=22812;return"barkskin defensive 6"end end;if B.SurvivalInstincts:IsCastable()and g:HealthPercentage()<A.Guardian2.SurvivalInstinctsHP then if p(B.SurvivalInstincts,nil,nil)then L=61336;return"survival_instincts defensive 8"end end;if B.BristlingFur:IsCastable()and g:Rage()<A.Guardian2.BristlingFurRage then if p(B.BristlingFur,nil,nil)then L=155835;return"bristling_fur defensive 10"end end;if g:HealthPercentage()<A.Guardian2.PhialHP and C.PhialofSerenity:IsReady()and C.PhialofSerenity:CooldownRemains()<=0 then if m.Cast(C.PhialofSerenity,nil)then L=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<A.Guardian2.HealthstoneHP and C.Healthstone:IsReady()and C.Healthstone:CooldownRemains()<=0 then if m.Cast(C.Healthstone,nil)then L=40;return"Healthstone HP"end end;if g:HealthPercentage()<A.Guardian2.HealPotHP and C.HealPot:IsReady()and C.HealPot:CooldownRemains()<=0 then if m.Cast(C.HealPot,nil)then L=41;return"HealPot HP"end end end;local function ac()if B.CatForm:IsCastable()and v and B.FeralAffinity:IsAvailable()and not g:BuffUp(B.CatForm)and not select(8,GetInstanceInfo())==1698 then if p(B.CatForm)then L=768;return"cat_form precombat 2"end end;if B.MoonkinForm:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and B.BalanceAffinity:IsAvailable()and not g:BuffUp(B.MoonkinForm)then if p(B.MoonkinForm)then L=197625;return"moonkin_form precombat 2"end end;if B.HeartoftheWild:IsCastable()and o()and i:IsInMeleeRange(8)and v and(B.BalanceAffinity:IsAvailable()or B.FeralAffinity:IsAvailable())and not select(8,GetInstanceInfo())==1698 then if p(B.HeartoftheWild,nil)then L=319454;return"heart_of_the_wild bear Precombat "end end;if B.Prowl:IsCastable()and v and B.FeralAffinity:IsAvailable()and g:BuffDown(B.Prowl)and not select(8,GetInstanceInfo())==1698 then if p(B.Prowl,nil)then L=5215;return"Prowl Precombat"end end;if B.BearForm:IsCastable()and g:BuffDown(B.BearForm)and(not v or not B.FeralAffinity:IsAvailable()and not B.BalanceAffinity:IsAvailable())and not select(8,GetInstanceInfo())==1698 then if p(B.BearForm)then L=5487;return"bear_form precombat 2"end end;if B.Wrath:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and g:BuffUp(B.MoonkinForm)and(T~=3 or select(8,GetInstanceInfo())==1698)then if p(B.Wrath)then L=5176;return"cat_form precombat 2"end end;if B.Starfire:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and g:BuffUp(B.MoonkinForm)and T==3 then if p(B.Starfire)then L=197628;return"cat_form precombat 2"end end;if B.Fleshcraft:IsCastable()and q and not g:IsMoving()and(B.PustuleEruption:SoulbindEnabled()or B.VolatileSolvent:SoulbindEnabled())then if p(B.Fleshcraft,nil,nil)then L=324631;return"fleshcraft precombat 3"end end;if B.WildCharge:IsCastable()and(i:IsInRange(25)and not i:IsInRange(8))and not select(8,GetInstanceInfo())==1698 then if p(B.WildCharge)then L=102401;return"wild_charge precombat 4"end end;if B.Rake:IsCastable()and g:BuffUp(B.Prowl)and not select(8,GetInstanceInfo())==1698 then if p(B.Rake)then L=1822;return"Rake cat 2"end end;if B.Mangle:IsCastable()and i:IsInMeleeRange(5)and g:BuffUp(B.BearForm)and not select(8,GetInstanceInfo())==1698 then if p(B.Mangle)then L=33917;return"mangle precombat 6"end end;if B.Thrash:IsCastable()and i:IsInMeleeRange(8)and g:BuffUp(B.BearForm)and not select(8,GetInstanceInfo())==1698 then if p(B.Thrash)then L=77758;return"thrash precombat 8"end end;if B.Moonfire:IsCastable()and i:NPCID()~=118044 and not select(8,GetInstanceInfo())==1698 then if p(B.Moonfire,nil,nil,not i:IsSpellInRange(B.Moonfire))then L=8921;return"moonfire precombat 10"end end end;local function ad()if B.MoonkinForm:IsCastable()and g:BuffDown(B.MoonkinForm)then if p(B.MoonkinForm)then L=197625;return"MoonkinForm lycara 2"end end end;local function ae()if B.CatForm:IsCastable()and g:BuffDown(B.CatForm)then if p(B.CatForm)then L=768;return"catform lycara 2"end end end;local function af()if B.MoonkinForm:IsCastable()and g:BuffDown(B.MoonkinForm)then if p(B.MoonkinForm)then L=197625;return"owl_form owl 2"end end;if B.HeartoftheWild:IsCastable()and o()and B.HeartoftheWild:IsAvailable()and g:BuffDown(B.HeartoftheWild)then if p(B.HeartoftheWild)then L=319454;return"HOTW owl 2"end end;if B.ConvoketheSpirits:IsCastable()and g:BuffUp(B.MoonkinForm)and q and(B.FirstStrike:SoulbindEnabled()and g:BuffUp(B.FirstStrike))then if p(B.ConvoketheSpirits)then L=323764;return"Convoke owl 2"end end;if B.ConvoketheSpirits:IsCastable()and g:BuffUp(B.MoonkinForm)and(B.HeartoftheWild:IsAvailable()and(g:BuffUp(B.HeartoftheWild)or B.HeartoftheWild:CooldownRemains()>15)or not B.HeartoftheWild:IsAvailable()or not o())then if p(B.ConvoketheSpirits)then L=323764;return"Convoke owlvoke 2"end end end;local function ag()if B.CatForm:IsCastable()and g:BuffDown(B.CatForm)then if p(B.CatForm)then L=768;return"catform catvoke 2"end end;if B.HeartoftheWild:IsCastable()and o()and B.HeartoftheWild:IsAvailable()and g:BuffDown(B.HeartoftheWild)then if p(B.HeartoftheWild)then L=319454;return"HOTW catvoke 2"end end;if B.ConvoketheSpirits:IsCastable()and g:BuffUp(B.CatForm)and(B.FirstStrike:SoulbindEnabled()and g:BuffUp(B.FirstStrikeBuff)or B.HeartoftheWild:IsAvailable()and(g:BuffUp(B.HeartoftheWild)or B.HeartoftheWild:CooldownRemains()>15)or not B.HeartoftheWild:IsAvailable()or not o())then if p(B.ConvoketheSpirits)then L=323764;return"Convoke catvoke 2"end end end;local function ah()if B.BearForm:IsCastable()and g:BuffDown(B.BearForm)then if p(B.BearForm)then L=5487;return"bear_form bear 2"end end;if B.HeartoftheWild:IsCastable()and o()and i:IsInMeleeRange(8)and(B.BalanceAffinity:IsAvailable()and T==2)then if p(B.HeartoftheWild,nil)then L=319454;return"heart_of_the_wild bear 3"end end;if B.Moonfire:IsReady()then if z.CastCycle(B.Moonfire,O,a6,not i:IsSpellInRange(B.Moonfire))then return"moonfire bear 4"end end;if B.RavenousFrenzy:IsCastable()and q and i:IsInMeleeRange(8)then if p(B.RavenousFrenzy,nil,nil)then L=323546;return"ravenous_frenzy bear 7"end end;if C.Jotungeirr:IsEquippedAndReady()and T==2 and i:IsInMeleeRange(8)then if p(C.Jotungeirr,nil,nil)then L=16;return"jotungeirr_destinys_call bear 8"end end;if T==2 and o()and i:IsInMeleeRange(8)then local ai=g:GetUseableTrinkets(D)if ai then if p(ai,nil,nil)then if ai:ID()==TopTrinketID then L=24;return"top trinket 1"elseif ai:ID()==BotTrinketID then L=30;return"top trinket 2"end end end end;if A.Commons.Enabled.Potions and t and i:IsInMeleeRange(8)and C.PotionofPhantomFire:IsReady()and(T==2 and g:BuffRemains(B.IncarnationBuff)>=23 and g:BuffRemains(B.IncarnationBuff)<=26)then if p(C.PotionofPhantomFire,nil,nil)then L=50;return"potion bear 11"end end;if B.ConvoketheSpirits:IsCastable()and q and i:IsInMeleeRange(8)then if p(B.ConvoketheSpirits,nil,nil,not i:IsInMeleeRange(5))then L=323764;return"convoke_the_spirits bear 12"end end;if B.Berserk:IsCastable()and not w and i:IsInMeleeRange(8)and o()and(I or i:IsDummy()or i:NPCID()==153285)and(g:BuffUp(B.RavenousFrenzyBuff)or T~=2)then if p(B.Berserk,nil)then L=50334;return"berserk bear 13"end end;if B.Incarnation:IsCastable()and not w and i:IsInMeleeRange(8)and o()and(I or i:IsDummy()or i:NPCID()==153285)and(g:BuffUp(B.RavenousFrenzyBuff)or T~=2)then if p(B.Incarnation,nil)then L=102558;return"incarnation bear 14"end end;if B.Berserking:IsCastable()and i:IsInMeleeRange(8)and(g:BuffUp(B.BerserkBuff)or g:BuffUp(B.IncarnationBuff))then if p(B.Berserking,nil)then L=26297;return"berserking bear 15"end end;if B.Barkskin:IsCastable()and(I or i:IsDummy()or i:NPCID()==153285)and not A.Guardian.UseBarkskinDefensively and B.Brambles:IsAvailable()then if p(B.Barkskin,nil,nil)then L=22812;return"barkskin bear 17"end end;if B.AdaptiveSwarm:IsCastable()and i:IsInMeleeRange(8)and q and(i:DebuffDown(B.AdaptiveSwarmDebuff)and not B.AdaptiveSwarm:InFlight()and(i:DebuffDown(B.AdaptiveSwarmDebuff)or g:BuffRemains(B.AdaptiveSwarmHeal)>3)or i:DebuffStack(B.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(B.AdaptiveSwarmDebuff)<5 and i:DebuffUp(B.AdaptiveSwarmDebuff))then if p(B.AdaptiveSwarm,nil,nil,not i:IsSpellInRange(B.AdaptiveSwarm))then L=325727;return"adaptive_swarm bear 18"end end;if B.Moonfire:IsReady()and(g:BuffUp(B.GalacticGuardianBuff)and P<3)then if p(B.Moonfire,nil,nil,not i:IsSpellInRange(B.Moonfire))then L=8921;return"moonfire bear 19"end end;if B.Thrash:IsCastable()and i:IsInMeleeRange(8)then if p(B.Thrash)then L=77758;return"thrash bear 20"end end;if B.Fleshcraft:IsCastable()and q and(B.PustuleEruption:SoulbindEnabled()and(B.Thrash:CooldownRemains()>0 and B.Mangle:CooldownRemains()>0 and i:DebuffRemains(B.MoonfireDebuff)>=3 and(g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and g:BuffDown(B.GalacticGuardianBuff)))or B.VolatileSolvent:SoulbindEnabled())then if p(B.Fleshcraft,nil,nil)then L=324631;return"fleshcraft bear 27"end end;if B.Swipe:IsCastable()and i:IsInMeleeRange(8)and(g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and P>=4)then if p(B.Swipe,nil,nil,not i:IsInMeleeRange(8))then L=213771;return"swipe bear 28"end end;if B.Maul:IsReady()and i:IsInMeleeRange(8)and J and(g:BuffUp(B.IncarnationBuff)and P<3 and g:BuffStack(B.ToothandClawBuff)>=2 or g:BuffUp(B.ToothandClawBuff)and g:BuffRemains(B.ToothandClawBuff)<1.5 or g:BuffStack(B.SavageCombatantBuff)>=3 or g:BuffUp(B.BerserkBuff)and P<3)then if p(B.Maul,nil,nil,not i:IsInMeleeRange(5))then L=6807;return"maul bear 30"end end;if B.Maul:IsReady()and i:IsInMeleeRange(8)and J and(g:BuffStack(B.SavageCombatantBuff)>=1 and g:BuffUp(B.ToothandClawBuff)and g:BuffUp(B.IncarnationBuff)and P==2)then if p(B.Maul,nil,nil,not i:IsInMeleeRange(5))then L=6807;return"maul bear 32"end end;if B.Mangle:IsCastable()and i:IsInMeleeRange(8)and(g:BuffUp(B.IncarnationBuff)and P<=3)then if p(B.Mangle,nil,nil,not i:IsInMeleeRange(5))then L=33917;return"mangle bear 34"end end;if B.Maul:IsReady()and i:IsInMeleeRange(8)and J and((g:BuffStack(B.ToothandClawBuff)>=2 or g:BuffUp(B.ToothandClawBuff)and g:BuffRemains(B.ToothandClawBuff)<1.5 or g:BuffStack(B.SavageCombatantBuff)>=3)and P<3)then if p(B.Maul,nil,nil,not i:IsInMeleeRange(5))then L=6807;return"maul bear 36"end end;if B.Thrash:IsCastable()and i:IsInMeleeRange(8)and P>1 then if p(B.Thrash,nil,nil,not i:IsInMeleeRange(8))then L=77758;return"thrash bear 38"end end;if B.Mangle:IsCastable()and i:IsInMeleeRange(8)and(g:Rage()<90 and P<3 or g:Rage()<85 and P<3 and B.SouloftheForest:IsAvailable())then if p(B.Mangle,nil,nil,not i:IsInMeleeRange(5))then L=33917;return"mangle bear 40"end end;if B.Pulverize:IsReady()and i:IsInMeleeRange(8)then if z.CastCycle(B.Pulverize,O,aa,not i:IsInMeleeRange(5))then return"pulverize bear 42"end end;if B.Thrash:IsCastable()and i:IsInMeleeRange(8)then if p(B.Thrash,nil,nil,not i:IsInMeleeRange(8))then L=77758;return"thrash bear 44"end end;if B.Maul:IsReady()and i:IsInMeleeRange(8)and J and P<3 then if p(B.Maul,nil,nil,not i:IsInMeleeRange(5))then L=6807;return"maul bear 46"end end;if B.Swipe:IsCastable()and i:IsInMeleeRange(8)then if p(B.Swipe,nil,nil,not i:IsInMeleeRange(8))then L=213771;return"swipe bear 48"end end end;local function aj()if B.CatForm:IsCastable()and g:BuffDown(B.CatForm)then if p(B.CatForm)then L=768;return"cat_form cat 2"end end;if B.Rake:IsCastable()and g:BuffUp(B.Prowl)then if p(B.Rake)then L=1822;return"Rake cat 2"end end;if B.HeartoftheWild:IsCastable()and B.HeartoftheWild:IsAvailable()and g:BuffDown(B.HeartoftheWild)and o()then if p(B.HeartoftheWild)then L=319454;return"HOTW cat 2"end end;if B.Rake:IsCastable()and(i:DebuffRefreshable(B.RakeDebuff)or g:Energy()<45)then if p(B.Rake)then L=1822;return"Rake cat 3"end end;if B.Rip:IsCastable()and i:DebuffRefreshable(B.Rip)and g:ComboPoints()>=1 then if p(B.Rip)then L=1079;return"Rip cat 2"end end;if B.ConvoketheSpirits:IsCastable()then if p(B.ConvoketheSpirits)then L=323764;return"Convoke cat 2"end end;if B.FerociousBite:IsCastable()and g:ComboPoints()>=4 and g:Energy()>50 then if p(B.FerociousBite)then L=22568;return"FB cat 2"end end;if B.AdaptiveSwarm:IsCastable()and q and(i:DebuffDown(B.AdaptiveSwarmDebuff)and not B.AdaptiveSwarm:InFlight()or i:DebuffStack(B.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(B.AdaptiveSwarmDebuff)<5 and i:DebuffUp(B.AdaptiveSwarmDebuff))then if p(B.AdaptiveSwarm)then L=325727;return"Adaptive Swarm cat 2"end end;if B.Fleshcraft:IsCastable()and q and not g:IsMoving()and(B.PustuleEruption:SoulbindEnabled()and g:Energy()<35 or B.VolatileSolvent:SoulbindEnabled())then if p(B.Fleshcraft,nil,nil)then L=324631;return"fleshcraft precombat 3"end end;if true then if p(B.Swipe)then L=213771;return"Swipe cat 2"end end end;local function ak()if B.MoonkinForm:IsCastable()and g:BuffDown(B.MoonkinForm)then if p(B.MoonkinForm)then L=197625;return"owl_form owl 2"end end;if B.HeartoftheWild:IsCastable()and o()and B.HeartoftheWild:IsAvailable()and g:BuffDown(B.HeartoftheWild)then if p(B.HeartoftheWild)then L=319454;return"HOTW owl 2"end end;if B.Starsurge:IsCastable()and not g:IsMoving()then if p(B.Starsurge)then L=197626;return"Starsurge owl 2"end end;if B.ConvoketheSpirits:IsCastable()and q and B.FirstStrike:SoulbindEnabled()then if p(B.ConvoketheSpirits)then L=323764;return"Convoke owl 2"end end;if B.AdaptiveSwarm:IsCastable()and q and(i:DebuffDown(B.AdaptiveSwarmDebuff)and not B.AdaptiveSwarm:InFlight()or i:DebuffStack(B.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(B.AdaptiveSwarmDebuff)<5 and i:DebuffUp(B.AdaptiveSwarmDebuff))then if p(B.AdaptiveSwarm)then L=325727;return"Adaptive Swarm cat 2"end end;if B.Sunfire:IsCastable()and i:DebuffRefreshable(B.SunfireDebuff)then if p(B.Sunfire)then L=197630;return"Sunfire owl 2"end end;if B.Moonfire:IsCastable()and(i:DebuffRefreshable(B.MoonfireDebuff)or g:BuffUp(B.GalacticGuardianBuff))then if p(B.Moonfire)then L=8921;return"Moonfire owl 2"end end;if B.Starfire:IsCastable()and EclipseAnyNext and T==3 and not g:IsMoving()then if p(B.Starfire)then L=197628;return"Starfire owl 2"end end;if B.Wrath:IsCastable()and EclipseAnyNext and T~=3 and not g:IsMoving()then if p(B.Wrath)then L=5176;return"Wrath owl 2"end end;if B.ConvoketheSpirits:IsCastable()and q and(g:BuffUp(B.EclipseLunar)or g:BuffUp(B.EclipseSolar))then if p(B.ConvoketheSpirits)then L=323764;return"Convoke owl 2"end end;if B.Starfire:IsCastable()and not g:IsMoving()and(EclipseInLunar or EclipseSolarNext or EclipseInLunar and g:BuffUp(B.EclipseLunar)and B.Starsurge:TimeSinceLastCast()<14)then if p(B.Starfire)then L=197628;return"Starfire owl 2"end end;if B.Wrath:IsCastable()and not g:IsMoving()then if p(B.Wrath)then L=5176;return"Wrath owl 2"end end;if B.Moonfire:IsCastable()and g:IsMoving()then if p(B.Moonfire)then L=8921;return"Moonfire owl 2"end end end;local function al()s=HeroRotationCharDB.Toggles[6]q=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[5]u=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[70]w=HeroRotationCharDB.Toggles[71]x=HeroRotationCharDB.Toggles[72]end;local function am()EclipseInAny=g:BuffUp(B.EclipseSolar)or g:BuffUp(B.EclipseLunar)EclipseInBoth=g:BuffUp(B.EclipseSolar)and g:BuffUp(B.EclipseLunar)EclipseInLunar=g:BuffUp(B.EclipseLunar)and g:BuffDown(B.EclipseSolar)EclipseInSolar=g:BuffUp(B.EclipseSolar)and g:BuffDown(B.EclipseLunar)EclipseLunarNext=not EclipseInAny and(B.Starfire:Count()==0 and B.Wrath:Count()>0 or g:IsCasting(B.Wrath))or EclipseInSolar;EclipseSolarNext=not EclipseInAny and(B.Wrath:Count()==0 and B.Starfire:Count()>0 or g:IsCasting(B.Starfire))or EclipseInLunar;EclipseAnyNext=not EclipseInAny and B.Wrath:Count()>0 and B.Starfire:Count()>0 end;local function an()if n()then O=g:GetEnemiesInMeleeRange(8)P=#O;N=g:GetEnemiesInMeleeRange(5)else O={}N={}P=1 end;TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)H=g:ActiveMitigationNeeded()I=g:IsTankingAoE(8)or g:IsTanking(i)UnitsCastinNetherStormCount=X(O)UnitsCastinNetherStormCount2=a2(O)UnitsCastinNetherStormCount3=a4(O)J=false;if not A.Guardian.UseRageDefensively or A.Guardian.UseRageDefensively and(not I or i:IsDummy()or i:NPCID()==153285 or g:RageDeficit()<=10)then J=true end;if not BotOn then K=0;L=0 end;if K>0 then K=0 end;if L>0 then L=0 end;ShouldReturn=al()am()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if g:IsChanneling(B.ConvoketheSpirits)then if p(B.Pool,nil)then L=99999;return"channeling 4"end end;if z.TargetIsValid()then if select(8,GetInstanceInfo())==1698 then if UnitsCastinNetherStormCount>0 and j(99):IsReady()and g:BuffUp(B.BearForm)then if p(j(99),nil)then L=99;return"Shout Interrupt MT 1"end end;if UnitsCastinNetherStormCount2>0 and j(99):IsReady()and g:BuffUp(B.BearForm)then if p(B.Pool,nil)then L=99999;return"Pool for Shout Interrupt MT 1"end end;if UnitsCastinNetherStormCount3>0 and B.Barkskin:IsReady()then if p(B.Barkskin,nil,nil)then L=22812;return"barkskin defensive MT 6"end end;if i:IsInRange(28)and not i:IsInRange(8)and B.WildCharge:IsReady()and g:BuffUp(B.BearForm)and f("target"):NPCID()~=117933 and f("target"):NPCID()~=118032 then if p(j(102401),nil)then L=102401;return"Wild Charge Back"end end;if true then local ShouldReturn=ab()if ShouldReturn then return ShouldReturn end end;if f("mouseover"):NPCID()==118065 and f("mouseover"):DebuffDown(j(339))and not g:IsMoving()then if p(j(339),nil)then K=1339;return"root MO MT"end end;if(select(8,UnitChannelInfo("boss1"))==234676 or select(9,UnitCastingInfo("boss1"))==234678)and f("boss1"):IsInRange(20)then if g:BuffUp(B.BearForm)or g:BuffUp(B.CatForm)then if p(j(106839),nil)then L=11106839;return"interrupt boss MT"end else if p(B.BearForm,nil)then L=5487;return"Bear for interrupt"end end end;if f("boss1"):NPCID()==117933 then if(select(8,UnitChannelInfo("boss1"))==234423 or select(9,UnitCastingInfo("boss1"))==234423)and f("boss1"):IsInRange(20)then if g:BuffUp(B.BearForm)or g:BuffUp(B.CatForm)then if p(j(106839),nil)then L=11106839;return"interrupt boss MT"end else if p(B.BearForm,nil)then L=5487;return"Bear for interrupt"end end end;if B.Moonfire:IsReady()then if z.CastCycle(B.Moonfire,g:GetEnemiesInMeleeRange(40),a8,not i:IsSpellInRange(B.Moonfire))then return"moonfire MT 4"end end;if P==0 then if g:BuffUp(B.MoonkinForm)then if(g:HealthPercentage()<A.Guardian2.MTRegrowth-20 and not g:IsCasting(j(8936))or g:HealthPercentage()<A.Guardian2.MTRegrowth-20)and j(8936):IsReady()and not g:IsMoving()then if p(j(8936),nil)then L=8936;return"Regrowth phase 1"end elseif true then local ShouldReturn=ak()if ShouldReturn then return ShouldReturn end end else if p(B.MoonkinForm,nil)then L=197625;return"Moonkin phase 1"end end else if UnitsCastinNetherStormCount>0 and j(99):IsCastable()and g:BuffUp(B.BearForm)then if p(j(99),nil)then L=99;return"Shout Interrupt MT 1"end elseif g:BuffUp(B.BearForm)then local ShouldReturn=ah()if ShouldReturn then return ShouldReturn end elseif g:BuffDown(B.BearForm)then if p(B.BearForm,nil)then L=5487;return"Bear for melee"end end end end;if f("boss1"):NPCID()==117198 then if(select(8,UnitChannelInfo("boss1"))==234676 or select(9,UnitCastingInfo("boss1"))==234678)and f("boss1"):IsInRange(20)then if g:BuffUp(B.BearForm)or g:BuffUp(B.CatForm)then if p(j(106839),nil)then L=11106839;return"interrupt boss MT"end else if p(B.BearForm,nil)then L=5487;return"Bear for interrupt"end end end;if(select(8,UnitChannelInfo("boss1"))==236572 or select(9,UnitCastingInfo("boss1"))==236572)and f("boss1"):IsInRange(8)and j(5211):IsAvailable()and j(5211):IsReady()then if p(j(5211),nil)then L=5211;return"interrupt boss bash MT"end end;if B.Moonfire:IsReady()then if z.CastCycle(B.Moonfire,g:GetEnemiesInMeleeRange(40),a8,not i:IsSpellInRange(B.Moonfire))then return"moonfire MT 4"end end;if P>=0 then if UnitsCastinNetherStormCount>0 and j(99):IsCastable()and g:BuffUp(B.BearForm)then if p(j(99),nil)then L=99;return"Shout Interrupt MT 1"end elseif g:BuffUp(B.BearForm)then local ShouldReturn=ah()if ShouldReturn then return ShouldReturn end elseif g:BuffDown(B.BearForm)then if p(B.BearForm,nil)then L=5487;return"Bear for melee"end end end end end;if not g:AffectingCombat()and s then local ShouldReturn=ac()if ShouldReturn then return ShouldReturn end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if B.Moonfire:IsCastable()then if p(B.Moonfire,nil)then K=18921;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if B.Moonfire:IsCastable()then if p(B.Moonfire,nil)then L=8921;return"explosive  SWD"end end end;y={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}if UnitExists("target")then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for ao=0,40 do local _,_,ap,aq,_,_,_,_,_,ar=UnitBuff("target",ao)for _,as in pairs(y)do if as==ar then if p(B.Soothe,nil)then L=2908;return"Southe Enrage"end end end end end end;if(I or i:IsDummy()or i:NPCID()==153285)and g:BuffUp(B.BearForm)then local ShouldReturn=ab()if ShouldReturn then return ShouldReturn end end;if C.Jotungeirr:IsEquippedAndReady()and T~=2 and o()then if p(C.Jotungeirr,nil,nil)then L=16;return"jotungeirr_destinys_call main"end end;if T~=2 and o()then local ai=g:GetUseableTrinkets(D)if ai then if p(ai,nil,nil)then if ai:ID()==TopTrinketID then L=24;return"top trinket 1"elseif ai:ID()==BotTrinketID then L=30;return"top trinket 2"end end end end;if A.Commons.Enabled.Potions and t and C.PotionofPhantomFire:IsReady()and(T~=2 and(g:BuffUp(B.BerserkBuff)or g:BuffUp(B.Incarnation)))then if p(C.PotionofPhantomFire,nil,nil)then L=50;return"potion main"end end;if v and B.FeralAffinity:IsAvailable()and T~=2 and g:BuffDown(B.IncarnationBuff)and(B.Thrash:CooldownRemains()>0 and B.Mangle:CooldownRemains()>0 and i:DebuffRemains(B.MoonfireDebuff)>=g:GCD()+0.5 and g:Rage()<40 and g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and g:BuffDown(B.GalacticGuardianBuff)or g:BuffUp(B.CatForm)and g:Energy()>25 or i:DebuffRefreshable(B.RakeDebuff)and i:DebuffRefreshable(B.Rip)or R and g:BuffDown(B.OathofElderDruidBuff)and(g:BuffUp(B.CatForm)and g:Energy()>20)and g:BuffRemins(B.HeartoftheWild)<=10 or T==1 and B.EmpowerBond:CooldownRemains()<=1 and P<2 or g:BuffUp(B.HeartoftheWild)and g:Energy()>90)then local ShouldReturn=aj()if ShouldReturn then return ShouldReturn end end;if v and B.FeralAffinity:IsAvailable()and T==2 and(B.Thrash:CooldownRemains()>0 and B.Mangle:CooldownRemains()>0 and i:DebuffRemains(B.MoonfireDebuff)>=g:GCD()+0.5 and g:Rage()<40 and g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and g:BuffDown(B.GalacticGuardianBuff)or g:BuffUp(B.CatForm)and g:Energy()>25 or i:DebuffRefreshable(B.RakeDebuff)and i:DebuffRefreshable(B.Rip)and g:Rage()<40 and g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and g:BuffDown(B.GalacticGuardianBuff))then local ShouldReturn=aj()if ShouldReturn then return ShouldReturn end end;if v and B.BalanceAffinity:IsAvailable()and(B.Thrash:CooldownRemains()>0 and B.Mangle:CooldownRemains()>0 and g:Rage()<15 and g:BuffDown(B.IncarnationBuff)and g:BuffDown(B.BerserkBuff)and g:BuffDown(B.GalacticGuardianBuff)or g:BuffUp(B.MoonkinForm)and i:DebuffRefreshable(B.SunfireDebuff)or g:BuffUp(B.MoonkinForm)and g:BuffUp(B.HeartoftheWild)or R and g:BuffDown(B.OathofElderDruidBuff)or T==3 and B.ConvoketheSpirits:CooldownRemains()<=1 or T==1 and B.EmpowerBond:CooldownRemains()<=1 and P<2)then local ShouldReturn=ak()if ShouldReturn then return ShouldReturn end end;if v and(S and B.BalanceAffinity:IsAvailable()and g:BuffUp(B.LycarasFleetingGlimpse)and g:BuffRemains(B.LycarasFleetingGlimpse)<=2)then local ShouldReturn=ad()if ShouldReturn then return ShouldReturn end end;if v and(S and B.FeralAffinity:IsAvailable()and g:BuffUp(B.LycarasFleetingGlimpse)and g:BuffRemains(B.LycarasFleetingGlimpse)<=2)then local ShouldReturn=ae()if ShouldReturn then return ShouldReturn end end;if A.Guardian.SwapForConvoke and q and(B.BalanceAffinity:IsAvailable()and not v and(T==3 and B.ConvoketheSpirits:CooldownRemains()<=1))then local ShouldReturn=af()if ShouldReturn then return ShouldReturn end end;if A.Guardian.SwapForConvoke and q and(B.FeralAffinity:IsAvailable()and not v and(T==3 and B.ConvoketheSpirits:CooldownRemains()<=1))then local ShouldReturn=ag()if ShouldReturn then return ShouldReturn end end;if true then local ShouldReturn=ah()if ShouldReturn then return ShouldReturn end end;if true then if m.CastAnnotated(B.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end end;local function at()end;function ReturnSpell()if L==0 then return 0 else return L end end;function ReturnSpellMO()if K==0 then return 0 else return K end end;m.SetAPL(104,an,at)