local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Pet;local i=f.Target;local j=d.Spell;local k=d.MultiSpell;local l=d.Item;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=HeroRotationCharDB.Toggles[4]and select(8,GetInstanceInfo())~=1698;local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[6]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[12]local v=HeroRotationCharDB.Toggles[70]local w=HeroRotationCharDB.Toggles[71]local x=HeroRotationCharDB.Toggles[72]local y=false;local z={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}local A={325552,326836,326092,334926,328395,330725,333299,323831,328494,322968,334496,334493,319603}local B=m.Commons.Everyone;local C={General=m.GUISettings.General,Commons=m.GUISettings.APL.Druid.Commons,Guardian=m.GUISettings.APL.Druid.Guardian,Guardian2=m.GUISettings.APL.Druid.Guardian2}local D=j.Druid.Guardian;local E=l.Druid.Guardian;local F={}local G=g:GetEquipment()local H=l(0)local I=l(0)if G[13]then H=l(G[13])end;if G[14]then I=l(G[14])end;local J;local K;local L;local M=0;local N=0;local O=0;local P;local Q,R;local S=g:HasLegendaryEquipped(58)local T=g:HasLegendaryEquipped(49)local U=g:HasLegendaryEquipped(48)local V=g:HasLegendaryEquipped(60)local W=g:CovenantID()d:RegisterForEvent(function()W=g:CovenantID()end,"COVENANT_CHOSEN")d:RegisterForEvent(function()G=g:GetEquipment()H=l(0)I=l(0)if G[13]then H=l(G[13])end;if G[14]then I=l(G[14])end;S=g:HasLegendaryEquipped(58)T=g:HasLegendaryEquipped(49)U=g:HasLegendaryEquipped(48)V=g:HasLegendaryEquipped(60)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()D.AdaptiveSwarm:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")D.AdaptiveSwarm:RegisterInFlight()local function X(Y)if Y then return 1 else return 0 end end;local function Z(Y)return Y~=0 end;local function a0(a1)local a2=0;for a3 in pairs(a1)do local a4=a1[a3]if a4:IsChanneling(j(240784))then a2=a2+1 end end;return a2 end;local function a5(a1)local a6=0;for a3 in pairs(a1)do local a4=a1[a3]if a4:CastRemains()<=g:GCD()+0.25 and a4:IsCasting(j(240784))then a6=a6+1 end end;return a6 end;local function a7(a1)local a8=0;for a3 in pairs(a1)do local a4=a1[a3]if a4:NPCID()==118044 then a8=a8+1 end end;return a8 end;local function a9(a1)local aa=0;for a3 in pairs(a1)do local a4=a1[a3]if a4:NPCID()==118065 or a4:NPCID()==118032 then aa=aa+1 end end;return aa end;local function ab(ac)if ac:DebuffRefreshable(D.MoonfireDebuff)and ac:TimeToDie()>12 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and ac:GUID()==f("mouseover"):GUID()and C.Guardian.TargetSwap=="Mouseover"and ac:NPCID()~=118044 then M=18921;return true elseif ac:DebuffRefreshable(D.MoonfireDebuff)and ac:TimeToDie()>12 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and C.Guardian.TargetSwap=="AutoSwap"and ac:GUID()~=i:GUID()and not u and ac:NPCID()~=118044 then M=9999;if M==999 then starttime=GetTime()endtime=starttime+0.25 elseif M>0 and endtime~=nil and GetTime()>endtime then M=0 end;return true elseif ac:DebuffRefreshable(D.MoonfireDebuff)and ac:TimeToDie()>12 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and ac:GUID()==i:GUID()and ac:NPCID()~=118044 then N=8921;return true elseif ac:DebuffRefreshable(D.MoonfireDebuff)and ac:TimeToDie()>12 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and ac:NPCID()~=118044 then return true end end;local function ad(ac)if ac:DebuffRefreshable(D.MoonfireDebuff)and(ac:NPCID()==118032 or ac:NPCID()==118065)and ac:GUID()==f("mouseover"):GUID()and ac:NPCID()~=118044 then M=18921;return true elseif ac:DebuffRefreshable(D.MoonfireDebuff)and(ac:NPCID()==118032 or ac:NPCID()==118065)and ac:GUID()==f("target"):GUID()and ac:NPCID()~=118044 then N=8921;return true elseif ac:DebuffRefreshable(D.MoonfireDebuff)and(ac:NPCID()==118032 or ac:NPCID()==118065)then return true end end;local function ae(ac)if ac:DebuffRefreshable(D.SunfireDebuff)and ac:NPCID()==118065 and ac:GUID()==f("mouseover"):GUID()and ac:NPCID()~=118044 then M=2197630;return true elseif ac:DebuffRefreshable(D.SunfireDebuff)and ac:NPCID()==118065 and ac:GUID()==f("target"):GUID()and ac:NPCID()~=118044 then N=197630;return true elseif ac:DebuffRefreshable(D.SunfireDebuff)and ac:NPCID()==118065 then return true end end;local function af(ac)return ac:DebuffRefreshable(D.ThrashDebuff)or ac:DebuffStack(D.ThrashDebuff)<3 or ac:DebuffStack(D.ThrashDebuff)<4 and S or R>=4 or g:BuffUp(D.BerserkBuff)and g:BuffRemains(D.BerserkBuff)<=g:GCD()+0.5 end;local function ag(ac)if ac:DebuffStack(D.ThrashDebuff)>2 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and ac:GUID()==f("mouseover"):GUID()and C.Guardian.TargetSwap=="Mouseover"then M=180313;return true elseif ac:DebuffStack(D.ThrashDebuff)>2 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and C.Guardian.TargetSwap=="AutoSwap"and ac:GUID()~=i:GUID()and not u then M=9999;if M==999 then starttime=GetTime()endtime=starttime+0.25 elseif M>0 and endtime~=nil and GetTime()>endtime then M=0 end;return true elseif ac:DebuffStack(D.ThrashDebuff)>2 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)and ac:GUID()==i:GUID()then N=80313;return true elseif ac:DebuffStack(D.ThrashDebuff)>2 and(ac:AffectingCombat()or ac:IsDummy()or ac:NPCID()==153285)then return true end;return ac:DebuffStack(D.ThrashDebuff)>2 end;local function ah()if g:HealthPercentage()<C.Guardian2.FrenziedRegenHP and D.FrenziedRegeneration:IsReady()and g:BuffDown(D.FrenziedRegenerationBuff)and not g:HealingAbsorbed()and g:BuffUp(D.BearForm)then if p(D.FrenziedRegeneration,nil,nil)then N=22842;return"frenzied_regeneration defensive 2"end end;if D.Ironfur:IsCastable()and not y and g:BuffUp(D.BearForm)and(g:Rage()>=D.Ironfur:Cost()+1 and(K or i:IsDummy()or i:NPCID()==153285)and(g:BuffDown(D.IronfurBuff)or g:BuffStack(D.IronfurBuff)<2 and g:BuffRefreshable(D.Ironfur)or g:Rage()>=90))then if p(D.Ironfur,nil,nil)then N=192081;return"ironfur defensive 4"end end;if D.Renewal:IsCastable()and g:HealthPercentage()<C.Guardian2.RenewalHP then if p(D.Renewal,nil,nil)then N=108238;return"Renewal defensive 4"end end;if D.Barkskin:IsCastable()and select(8,GetInstanceInfo())~=1698 and(g:HealthPercentage()<C.Guardian2.BarkskinHP and g:BuffDown(D.IronfurBuff)or g:HealthPercentage()<C.Guardian2.BarkskinHP*0.75)then if p(D.Barkskin,nil,nil)then N=22812;return"barkskin defensive 6"end end;if D.SurvivalInstincts:IsCastable()and g:HealthPercentage()<C.Guardian2.SurvivalInstinctsHP then if p(D.SurvivalInstincts,nil,nil)then N=61336;return"survival_instincts defensive 8"end end;if D.BristlingFur:IsCastable()and g:Rage()<C.Guardian2.BristlingFurRage then if p(D.BristlingFur,nil,nil)then N=155835;return"bristling_fur defensive 10"end end;if g:HealthPercentage()<C.Guardian2.PhialHP and E.PhialofSerenity:IsReady()and E.PhialofSerenity:CooldownRemains()<=0 then if m.Cast(E.PhialofSerenity,nil)then N=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<C.Guardian2.HealthstoneHP and E.Healthstone:IsReady()and E.Healthstone:CooldownRemains()<=0 then if m.Cast(E.Healthstone,nil)then N=40;return"Healthstone HP"end end;if g:HealthPercentage()<C.Guardian2.HealPotHP and E.HealPot:IsReady()and E.HealPot:CooldownRemains()<=0 then if m.Cast(E.HealPot,nil)then N=41;return"HealPot HP"end end end;local function ai()if D.CatForm:IsCastable()and v and D.FeralAffinity:IsAvailable()and not g:BuffUp(D.CatForm)and not select(8,GetInstanceInfo())==1698 then if p(D.CatForm)then N=768;return"cat_form precombat 2"end end;if D.MoonkinForm:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and D.BalanceAffinity:IsAvailable()and not g:BuffUp(D.MoonkinForm)then if p(D.MoonkinForm)then N=197625;return"moonkin_form precombat 2"end end;if D.HeartoftheWild:IsCastable()and o()and i:IsInMeleeRange(8)and v and(D.BalanceAffinity:IsAvailable()or D.FeralAffinity:IsAvailable())and not select(8,GetInstanceInfo())==1698 then if p(D.HeartoftheWild,nil)then N=319454;return"heart_of_the_wild bear Precombat "end end;if D.Prowl:IsCastable()and v and D.FeralAffinity:IsAvailable()and g:BuffDown(D.Prowl)and not select(8,GetInstanceInfo())==1698 then if p(D.Prowl,nil)then N=5215;return"Prowl Precombat"end end;if D.BearForm:IsCastable()and g:BuffDown(D.BearForm)and(not v or not D.FeralAffinity:IsAvailable()and not D.BalanceAffinity:IsAvailable())and not select(8,GetInstanceInfo())==1698 then if p(D.BearForm)then N=5487;return"bear_form precombat 2"end end;if D.Wrath:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and g:BuffUp(D.MoonkinForm)and(W~=3 or select(8,GetInstanceInfo())==1698)then if p(D.Wrath)then N=5176;return"cat_form precombat 2"end end;if D.Starfire:IsCastable()and(v or select(8,GetInstanceInfo())==1698)and g:BuffUp(D.MoonkinForm)and W==3 then if p(D.Starfire)then N=197628;return"cat_form precombat 2"end end;if D.Fleshcraft:IsCastable()and q and not g:IsMoving()and(D.PustuleEruption:SoulbindEnabled()or D.VolatileSolvent:SoulbindEnabled())then if p(D.Fleshcraft,nil,nil)then N=324631;return"fleshcraft precombat 3"end end;if D.WildCharge:IsCastable()and(i:IsInRange(25)and not i:IsInRange(8))and not select(8,GetInstanceInfo())==1698 then if p(D.WildCharge)then N=102401;return"wild_charge precombat 4"end end;if D.Rake:IsCastable()and g:BuffUp(D.Prowl)and not select(8,GetInstanceInfo())==1698 then if p(D.Rake)then N=1822;return"Rake cat 2"end end;if D.Mangle:IsCastable()and i:IsInMeleeRange(5)and g:BuffUp(D.BearForm)and not select(8,GetInstanceInfo())==1698 then if p(D.Mangle)then N=33917;return"mangle precombat 6"end end;if D.Thrash:IsCastable()and i:IsInMeleeRange(8)and g:BuffUp(D.BearForm)and not select(8,GetInstanceInfo())==1698 then if p(D.Thrash)then N=77758;return"thrash precombat 8"end end;if D.Moonfire:IsCastable()and i:NPCID()~=118044 and not select(8,GetInstanceInfo())==1698 then if p(D.Moonfire,nil,nil,not i:IsSpellInRange(D.Moonfire))then N=8921;return"moonfire precombat 10"end end end;local function aj()if D.MoonkinForm:IsCastable()and g:BuffDown(D.MoonkinForm)then if p(D.MoonkinForm)then N=197625;return"MoonkinForm lycara 2"end end end;local function ak()if D.CatForm:IsCastable()and g:BuffDown(D.CatForm)then if p(D.CatForm)then N=768;return"catform lycara 2"end end end;local function al()if D.MoonkinForm:IsCastable()and g:BuffDown(D.MoonkinForm)then if p(D.MoonkinForm)then N=197625;return"owl_form owl 2"end end;if D.HeartoftheWild:IsCastable()and o()and D.HeartoftheWild:IsAvailable()and g:BuffDown(D.HeartoftheWild)then if p(D.HeartoftheWild)then N=319454;return"HOTW owl 2"end end;if D.ConvoketheSpirits:IsCastable()and g:BuffUp(D.MoonkinForm)and q and(D.FirstStrike:SoulbindEnabled()and g:BuffUp(D.FirstStrike))then if p(D.ConvoketheSpirits)then N=323764;return"Convoke owl 2"end end;if D.ConvoketheSpirits:IsCastable()and g:BuffUp(D.MoonkinForm)and(D.HeartoftheWild:IsAvailable()and(g:BuffUp(D.HeartoftheWild)or D.HeartoftheWild:CooldownRemains()>15)or not D.HeartoftheWild:IsAvailable()or not o())then if p(D.ConvoketheSpirits)then N=323764;return"Convoke owlvoke 2"end end end;local function am()if D.CatForm:IsCastable()and g:BuffDown(D.CatForm)then if p(D.CatForm)then N=768;return"catform catvoke 2"end end;if D.HeartoftheWild:IsCastable()and o()and D.HeartoftheWild:IsAvailable()and g:BuffDown(D.HeartoftheWild)then if p(D.HeartoftheWild)then N=319454;return"HOTW catvoke 2"end end;if D.ConvoketheSpirits:IsCastable()and g:BuffUp(D.CatForm)and(D.FirstStrike:SoulbindEnabled()and g:BuffUp(D.FirstStrikeBuff)or D.HeartoftheWild:IsAvailable()and(g:BuffUp(D.HeartoftheWild)or D.HeartoftheWild:CooldownRemains()>15)or not D.HeartoftheWild:IsAvailable()or not o())then if p(D.ConvoketheSpirits)then N=323764;return"Convoke catvoke 2"end end end;local function an()if D.BearForm:IsCastable()and g:BuffDown(D.BearForm)then if p(D.BearForm)then N=5487;return"bear_form bear 2"end end;if D.HeartoftheWild:IsCastable()and o()and i:IsInMeleeRange(8)and(D.BalanceAffinity:IsAvailable()and W==2)then if p(D.HeartoftheWild,nil)then N=319454;return"heart_of_the_wild bear 3"end end;if D.Ironfur:IsCastable()and g:Rage()>=D.Ironfur:Cost()+1 and not L and(g:BuffUp(D.IncarnationBuff)or g:BuffUp(D.BerserkBuff))then if p(D.Ironfur,nil,nil)then N=192081;return"ironfur Zerk 1"end end;if D.Thrash:IsCastable()and i:IsInMeleeRange(8)and V and not select(8,GetInstanceInfo())==1698 then if p(D.Thrash)then N=77758;return"thrash bear 30"end end;if D.Moonfire:IsReady()then if B.CastCycle(D.Moonfire,Q,ab,not i:IsSpellInRange(D.Moonfire))then return"moonfire bear 4"end end;if D.RavenousFrenzy:IsCastable()and q and i:IsInMeleeRange(8)then if p(D.RavenousFrenzy,nil,nil)then N=323546;return"ravenous_frenzy bear 7"end end;if E.Jotungeirr:IsEquippedAndReady()and W==2 and i:IsInMeleeRange(8)then if p(E.Jotungeirr,nil,nil)then N=16;return"jotungeirr_destinys_call bear 8"end end;if W==2 and o()and i:IsInMeleeRange(8)then local ao=g:GetUseableTrinkets(F)if ao then if p(ao,nil,nil)then if ao:ID()==TopTrinketID and C.Commons.Enabled.TopTrinket then N=24;return"top trinket 1"elseif ao:ID()==BotTrinketID and C.Commons.Enabled.BotTrinket then N=30;return"top trinket 2"end end end end;if C.Commons.Enabled.Potions and t and i:IsInMeleeRange(8)and E.PotionofPhantomFire:IsReady()and(W==2 and g:BuffRemains(D.IncarnationBuff)>=23 and g:BuffRemains(D.IncarnationBuff)<=26)then if p(E.PotionofPhantomFire,nil,nil)then N=50;return"potion bear 11"end end;if D.ConvoketheSpirits:IsCastable()and q and i:IsInMeleeRange(8)then if p(D.ConvoketheSpirits,nil,nil,not i:IsInMeleeRange(5))then N=323764;return"convoke_the_spirits bear 12"end end;if D.Berserk:IsCastable()and not w and i:IsInMeleeRange(8)and o()and(K or i:IsDummy()or i:NPCID()==153285)and(g:BuffUp(D.RavenousFrenzyBuff)or W~=2)then if p(D.Berserk,nil)then N=50334;return"berserk bear 13"end end;if D.Incarnation:IsCastable()and not w and i:IsInMeleeRange(8)and o()and(K or i:IsDummy()or i:NPCID()==153285)and(g:BuffUp(D.RavenousFrenzyBuff)or W~=2)then if p(D.Incarnation,nil)then N=102558;return"incarnation bear 14"end end;if D.Berserking:IsCastable()and i:IsInMeleeRange(8)and(g:BuffUp(D.BerserkBuff)or g:BuffUp(D.IncarnationBuff))then if p(D.Berserking,nil)then N=26297;return"berserking bear 15"end end;if D.Barkskin:IsCastable()and(K or i:IsDummy()or i:NPCID()==153285)and not C.Guardian.UseBarkskinDefensively and D.Brambles:IsAvailable()and select(8,GetInstanceInfo())~=1698 then if p(D.Barkskin,nil,nil)then N=22812;return"barkskin bear 17"end end;if D.AdaptiveSwarm:IsCastable()and i:IsInMeleeRange(8)and q and(i:DebuffDown(D.AdaptiveSwarmDebuff)and not D.AdaptiveSwarm:InFlight()and(i:DebuffDown(D.AdaptiveSwarmDebuff)or g:BuffRemains(D.AdaptiveSwarmHeal)>3)or i:DebuffStack(D.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(D.AdaptiveSwarmDebuff)<5 and i:DebuffUp(D.AdaptiveSwarmDebuff))then if p(D.AdaptiveSwarm,nil,nil,not i:IsSpellInRange(D.AdaptiveSwarm))then N=325727;return"adaptive_swarm bear 18"end end;if D.Moonfire:IsCastable()and g:BuffUp(D.GalacticGuardianBuff)and select(8,GetInstanceInfo())==1698 and f("boss1"):NPCID()==117933 and f("boss1"):IsInRange(40)then if p(D.Moonfire)then N=118921;return"Moonfire owl Boss 2"end end;if D.Moonfire:IsReady()and(g:BuffUp(D.GalacticGuardianBuff)and R<3)then if p(D.Moonfire,nil,nil,not i:IsSpellInRange(D.Moonfire))then N=8921;return"moonfire bear 19"end end;if D.Thrash:IsCastable()and i:IsInMeleeRange(8)and(i:DebuffRefreshable(D.ThrashDebuff)or i:DebuffStack(D.ThrashDebuff)<3 or i:DebuffStack(D.ThrashDebuff)<4 and S or R<=4)then if p(D.Thrash)then N=77758;return"thrash bear 20"end end;if D.Fleshcraft:IsCastable()and q and(D.PustuleEruption:SoulbindEnabled()and(D.Thrash:CooldownRemains()>0 and D.Mangle:CooldownRemains()>0 and i:DebuffRemains(D.MoonfireDebuff)>=3 and(g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and g:BuffDown(D.GalacticGuardianBuff)))or D.VolatileSolvent:SoulbindEnabled())then if p(D.Fleshcraft,nil,nil)then N=324631;return"fleshcraft bear 27"end end;if D.Swipe:IsCastable()and i:IsInMeleeRange(8)and(g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and R>=4)then if p(D.Swipe,nil,nil,not i:IsInMeleeRange(8))then N=213771;return"swipe bear 28"end end;if D.Maul:IsReady()and i:IsInMeleeRange(8)and L and not y and(g:BuffUp(D.IncarnationBuff)and R<3 and g:BuffStack(D.ToothandClawBuff)>=2 or g:BuffUp(D.ToothandClawBuff)and g:BuffRemains(D.ToothandClawBuff)<1.5 or g:BuffStack(D.SavageCombatantBuff)>=3 or g:BuffUp(D.BerserkBuff)and R<3)then if p(D.Maul,nil,nil,not i:IsInMeleeRange(5))then N=6807;return"maul bear 30"end end;if D.Maul:IsReady()and i:IsInMeleeRange(8)and L and not y and(g:BuffStack(D.SavageCombatantBuff)>=1 and g:BuffUp(D.ToothandClawBuff)and g:BuffUp(D.IncarnationBuff)and R==2)then if p(D.Maul,nil,nil,not i:IsInMeleeRange(5))then N=6807;return"maul bear 32"end end;if D.Mangle:IsCastable()and i:IsInMeleeRange(8)and(g:BuffUp(D.IncarnationBuff)and R<=3)then if p(D.Mangle,nil,nil,not i:IsInMeleeRange(5))then N=33917;return"mangle bear 34"end end;if D.Maul:IsReady()and i:IsInMeleeRange(8)and L and not y and((g:BuffStack(D.ToothandClawBuff)>=2 or g:BuffUp(D.ToothandClawBuff)and g:BuffRemains(D.ToothandClawBuff)<1.5 or g:BuffStack(D.SavageCombatantBuff)>=3)and R<3)then if p(D.Maul,nil,nil,not i:IsInMeleeRange(5))then N=6807;return"maul bear 36"end end;if D.Thrash:IsCastable()and i:IsInMeleeRange(8)and R>1 then if p(D.Thrash,nil,nil,not i:IsInMeleeRange(8))then N=77758;return"thrash bear 38"end end;if D.Mangle:IsCastable()and i:IsInMeleeRange(8)and(g:Rage()<90 and R<3 or g:Rage()<85 and R<3 and D.SouloftheForest:IsAvailable())then if p(D.Mangle,nil,nil,not i:IsInMeleeRange(5))then N=33917;return"mangle bear 40"end end;if D.Pulverize:IsReady()and i:IsInMeleeRange(8)then if B.CastCycle(D.Pulverize,Q,ag,not i:IsInMeleeRange(5))then return"pulverize bear 42"end end;if D.Thrash:IsCastable()and i:IsInMeleeRange(8)then if p(D.Thrash,nil,nil,not i:IsInMeleeRange(8))then N=77758;return"thrash bear 44"end end;if D.Maul:IsReady()and i:IsInMeleeRange(8)and L and not y and R<3 then if p(D.Maul,nil,nil,not i:IsInMeleeRange(5))then N=6807;return"maul bear 46"end end;if D.Swipe:IsCastable()and i:IsInMeleeRange(8)then if p(D.Swipe,nil,nil,not i:IsInMeleeRange(8))then N=213771;return"swipe bear 48"end end end;local function ap()if D.CatForm:IsCastable()and g:BuffDown(D.CatForm)then if p(D.CatForm)then N=768;return"cat_form cat 2"end end;if D.Rake:IsCastable()and g:BuffUp(D.Prowl)then if p(D.Rake)then N=1822;return"Rake cat 2"end end;if D.HeartoftheWild:IsCastable()and D.HeartoftheWild:IsAvailable()and g:BuffDown(D.HeartoftheWild)and o()then if p(D.HeartoftheWild)then N=319454;return"HOTW cat 2"end end;if D.Rake:IsCastable()and(i:DebuffRefreshable(D.RakeDebuff)or g:Energy()<45)then if p(D.Rake)then N=1822;return"Rake cat 3"end end;if D.Rip:IsCastable()and i:DebuffRefreshable(D.Rip)and g:ComboPoints()>=1 then if p(D.Rip)then N=1079;return"Rip cat 2"end end;if D.ConvoketheSpirits:IsCastable()then if p(D.ConvoketheSpirits)then N=323764;return"Convoke cat 2"end end;if D.FerociousBite:IsCastable()and g:ComboPoints()>=4 and g:Energy()>50 then if p(D.FerociousBite)then N=22568;return"FB cat 2"end end;if D.AdaptiveSwarm:IsCastable()and q and(i:DebuffDown(D.AdaptiveSwarmDebuff)and not D.AdaptiveSwarm:InFlight()or i:DebuffStack(D.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(D.AdaptiveSwarmDebuff)<5 and i:DebuffUp(D.AdaptiveSwarmDebuff))then if p(D.AdaptiveSwarm)then N=325727;return"Adaptive Swarm cat 2"end end;if D.Fleshcraft:IsCastable()and q and not g:IsMoving()and(D.PustuleEruption:SoulbindEnabled()and g:Energy()<35 or D.VolatileSolvent:SoulbindEnabled())then if p(D.Fleshcraft,nil,nil)then N=324631;return"fleshcraft precombat 3"end end;if true then if p(D.Swipe)then N=213771;return"Swipe cat 2"end end end;local function aq()if D.MoonkinForm:IsCastable()and g:BuffDown(D.MoonkinForm)then if p(D.MoonkinForm)then N=197625;return"owl_form owl 2"end end;if D.HeartoftheWild:IsCastable()and o()and D.HeartoftheWild:IsAvailable()and g:BuffDown(D.HeartoftheWild)then if p(D.HeartoftheWild)then N=319454;return"HOTW owl 2"end end;if D.Starsurge:IsCastable()and not g:IsMoving()then if p(D.Starsurge)then N=197626;return"Starsurge owl 2"end end;if D.ConvoketheSpirits:IsCastable()and q and D.FirstStrike:SoulbindEnabled()then if p(D.ConvoketheSpirits)then N=323764;return"Convoke owl 2"end end;if D.AdaptiveSwarm:IsCastable()and q and(i:DebuffDown(D.AdaptiveSwarmDebuff)and not D.AdaptiveSwarm:InFlight()or i:DebuffStack(D.AdaptiveSwarmDebuff)<3 and i:DebuffRemains(D.AdaptiveSwarmDebuff)<5 and i:DebuffUp(D.AdaptiveSwarmDebuff))then if p(D.AdaptiveSwarm)then N=325727;return"Adaptive Swarm cat 2"end end;if D.Sunfire:IsCastable()and i:DebuffRefreshable(D.SunfireDebuff)then if p(D.Sunfire)then N=197630;return"Sunfire owl 2"end end;if D.Sunfire:IsCastable()then if B.CastCycle(D.Sunfire,Enemies40y,ae,not i:IsSpellInRange(D.Sunfire))then return"Sunfire Owl 3"end end;if D.Moonfire:IsCastable()and g:BuffUp(D.GalacticGuardianBuff)and select(8,GetInstanceInfo())==1698 and f("boss1"):NPCID()==117933 and f("boss1"):IsInRange(40)then if p(D.Moonfire)then N=118921;return"Moonfire owl Boss 2"end end;if D.Moonfire:IsCastable()and(i:DebuffRefreshable(D.MoonfireDebuff)or g:BuffUp(D.GalacticGuardianBuff))then if p(D.Moonfire)then N=8921;return"Moonfire owl 2"end end;if D.Starfire:IsCastable()and EclipseAnyNext and W==3 and not g:IsMoving()then if p(D.Starfire)then N=197628;return"Starfire owl 2"end end;if D.Wrath:IsCastable()and EclipseAnyNext and W~=3 and not g:IsMoving()then if p(D.Wrath)then N=5176;return"Wrath owl 2"end end;if D.ConvoketheSpirits:IsCastable()and q and(g:BuffUp(D.EclipseLunar)or g:BuffUp(D.EclipseSolar))then if p(D.ConvoketheSpirits)then N=323764;return"Convoke owl 2"end end;if D.Starfire:IsCastable()and not g:IsMoving()and(EclipseInLunar or EclipseSolarNext or EclipseInLunar and g:BuffUp(D.EclipseLunar)and D.Starsurge:TimeSinceLastCast()<14)then if p(D.Starfire)then N=197628;return"Starfire owl 2"end end;if D.Wrath:IsCastable()and not g:IsMoving()then if p(D.Wrath)then N=5176;return"Wrath owl 2"end end;if D.Moonfire:IsCastable()and g:IsMoving()then if p(D.Moonfire)then N=8921;return"Moonfire owl 2"end end end;local function ar()s=HeroRotationCharDB.Toggles[6]q=HeroRotationCharDB.Toggles[4]and select(8,GetInstanceInfo())~=1698;r=HeroRotationCharDB.Toggles[5]u=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[70]w=HeroRotationCharDB.Toggles[71]x=HeroRotationCharDB.Toggles[72]y=false end;local function as()EclipseInAny=g:BuffUp(D.EclipseSolar)or g:BuffUp(D.EclipseLunar)EclipseInBoth=g:BuffUp(D.EclipseSolar)and g:BuffUp(D.EclipseLunar)EclipseInLunar=g:BuffUp(D.EclipseLunar)and g:BuffDown(D.EclipseSolar)EclipseInSolar=g:BuffUp(D.EclipseSolar)and g:BuffDown(D.EclipseLunar)EclipseLunarNext=not EclipseInAny and(D.Starfire:Count()==0 and D.Wrath:Count()>0 or g:IsCasting(D.Wrath))or EclipseInSolar;EclipseSolarNext=not EclipseInAny and(D.Wrath:Count()==0 and D.Starfire:Count()>0 or g:IsCasting(D.Starfire))or EclipseInLunar;EclipseAnyNext=not EclipseInAny and D.Wrath:Count()>0 and D.Starfire:Count()>0 end;local function at()if n()then Q=g:GetEnemiesInMeleeRange(8)R=#Q;P=g:GetEnemiesInMeleeRange(5)Enemies40y=g:GetEnemiesInRange(40)else Q=g:GetEnemiesInMeleeRange(8)if#Q>=1 then R=1 else R=0 end;P=g:GetEnemiesInMeleeRange(5)end;TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)J=g:ActiveMitigationNeeded()K=g:IsTankingAoE(8)or g:IsTanking(i)UnitsCastinNetherStormCount=a0(Q)UnitsCastinNetherStormCount2=a5(Q)UnitsCastinNetherStormCount3=a7(Q)MTNegligableMeleeCount=a9(Q)if n()then if MTNegligableMeleeCount>0 then R=R-MTNegligableMeleeCount end end;L=false;if not C.Guardian.UseRageDefensively or C.Guardian.UseRageDefensively and(not K or i:IsDummy()or i:NPCID()==153285 or g:RageDeficit()<=10)then L=true end;if not BotOn then M=0;N=0 end;if M>0 then M=0 end;if N>0 then N=0 end;ShouldReturn=ar()as()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if g:IsChanneling(D.ConvoketheSpirits)then if p(D.Pool,nil)then N=99999;return"channeling 4"end end;if B.TargetIsValid()then if select(8,GetInstanceInfo())==1698 then if UnitsCastinNetherStormCount>0 and j(99):IsReady()then if p(j(99),nil)then N=99;return"Shout Interrupt MT 1"end end;if UnitsCastinNetherStormCount2>0 and j(99):IsReady()and g:BuffUp(D.BearForm)then if p(D.Pool,nil)then N=99999;return"Pool for Shout Interrupt MT 1"end end;if UnitsCastinNetherStormCount3>0 and D.Barkskin:IsReady()and f("boss1"):NPCID()==117933 and f("boss1"):TimeToDie()>60 then if p(D.Barkskin,nil,nil)then N=22812;return"barkskin defensive MT 6"end end;if i:IsInRange(28)and not i:IsInRange(8)and D.WildCharge:IsReady()and g:BuffUp(D.BearForm)and f("target"):NPCID()~=117933 and f("target"):NPCID()~=118032 then if p(j(102401),nil)then N=102401;return"Wild Charge Back"end end;if true then local ShouldReturn=ah()if ShouldReturn then return ShouldReturn end end;if(select(8,UnitChannelInfo("target"))==234676 or select(9,UnitCastingInfo("target"))==234676)and f("target"):IsInRange(20)then if g:BuffUp(D.BearForm)or g:BuffUp(D.CatForm)then if p(j(106839),nil)then N=11106839;return"interrupt boss MT"end else if p(D.BearForm,nil)then N=5487;return"Bear for interrupt"end end end;if f("boss1"):NPCID()==117933 then if(select(8,UnitChannelInfo("boss1"))==234423 or select(9,UnitCastingInfo("boss1"))==234423)and f("boss1"):IsInRange(20)then if g:BuffUp(D.MoonkinForm)and j(132469):CooldownRemains()<=0 and UnitsCastinNetherStormCount2==0 and UnitsCastinNetherStormCount==0 then if p(j(132469),nil)then N=132469;return"typhoon interrupt boss MT"end elseif g:BuffUp(D.BearForm)or g:BuffUp(D.CatForm)then if p(j(106839),nil)then N=11106839;return"interrupt boss MT"end elseif(not g:BuffUp(D.BearForm)or g:BuffUp(D.CatForm))and j(132469):CooldownRemains()>=0 then if p(D.BearForm,nil)then N=5487;return"Bear for interrupt"end end end;if D.Moonfire:IsReady()then if B.CastCycle(D.Moonfire,g:GetEnemiesInMeleeRange(40),ad,not i:IsSpellInRange(D.Moonfire))then return"moonfire MT 4"end end;if R==0 then if g:BuffUp(D.MoonkinForm)then if(g:HealthPercentage()<C.Guardian2.MTRegrowth-20 and not g:IsCasting(j(8936))or g:HealthPercentage()<C.Guardian2.MTRegrowth-20)and j(8936):IsReady()and not g:IsMoving()then if p(j(8936),nil)then N=8936;return"Regrowth phase 1"end elseif true then local ShouldReturn=aq()if ShouldReturn then return ShouldReturn end end else if p(D.MoonkinForm,nil)then N=197625;return"Moonkin phase 1"end end else if UnitsCastinNetherStormCount>0 and j(99):IsCastable()and g:BuffUp(D.BearForm)then if p(j(99),nil)then N=99;return"Shout Interrupt MT 1"end elseif g:BuffUp(D.BearForm)then local ShouldReturn=an()if ShouldReturn then return ShouldReturn end elseif g:BuffDown(D.BearForm)then if p(D.BearForm,nil)then N=5487;return"Bear for melee"end end end end;if f("boss1"):NPCID()==117198 then if(select(8,UnitChannelInfo("boss1"))==234676 or select(9,UnitCastingInfo("boss1"))==234676)and f("boss1"):IsInRange(20)then if(g:BuffUp(D.BearForm)or g:BuffUp(D.CatForm))and j(106839):CooldownRemains()<=0 then if p(j(106839),nil)then N=11106839;return"interrupt boss MT"end elseif g:BuffUp(D.BearForm)and j(132469):CooldownRemains()<=0 then if p(j(132469),nil)then N=132469;return"interrupt boss MT"end elseif not g:BuffUp(D.BearForm)then if p(D.BearForm,nil)then N=5487;return"Bear for interrupt"end end end;if(select(8,UnitChannelInfo("boss1"))==236572 or select(9,UnitCastingInfo("boss1"))==236572)and f("boss1"):IsInRange(8)and j(5211):IsAvailable()and j(5211):IsReady()then if p(j(5211),nil)then N=g:DebuffStack(j(236572))return"interrupt boss bash MT"end end;if(select(8,UnitChannelInfo("boss1"))==236572 or select(9,UnitCastingInfo("boss1"))==236572)and g:BuffUp(D.BearForm)then for au=1,40 do local _,_,av,_,_,_,_,_,_,aw,_,_,_,_,_,_=UnitDebuff("player",au)if aw~=nil and aw==236572 and av~=nil and av>=2 and D.SurvivalInstincts:IsCastable()then if p(D.SurvivalInstincts,nil,nil)then N=61336;return"survival_instincts defensive 8"end end;if aw~=nil and aw==236572 and av~=nil and av>=1 and D.Barkskin:IsCastable()then if p(D.Barkskin,nil,nil)then N=22812;return"barkskin defensive 6"end end;if aw~=nil and aw==236572 and av~=nil and av>=0 and D.Ironfur:IsCastable()and(g:Rage()>=D.Ironfur:Cost()+1 and(g:BuffDown(D.IronfurBuff)or g:BuffStack(D.IronfurBuff)<2 and g:BuffRefreshable(D.Ironfur)or g:Rage()>=90))then if p(D.Ironfur,nil,nil)then N=192081;return"ironfur defensive 4"end end end end;if D.Moonfire:IsReady()then if B.CastCycle(D.Moonfire,g:GetEnemiesInMeleeRange(40),ad,not i:IsSpellInRange(D.Moonfire))then return"moonfire MT 4"end end;if R>=0 then if UnitsCastinNetherStormCount>0 and j(99):IsCastable()and g:BuffUp(D.BearForm)then if p(j(99),nil)then N=99;return"Shout Interrupt MT 1"end elseif g:BuffUp(D.BearForm)then local ShouldReturn=an()if ShouldReturn then return ShouldReturn end elseif g:BuffDown(D.BearForm)then if p(D.BearForm,nil)then N=5487;return"Bear for melee"end end end end end;if not g:AffectingCombat()and s then local ShouldReturn=ai()if ShouldReturn then return ShouldReturn end end;if not UnitIsEnemy("player","mouseover")and UnitIsDead("mouseover")then if D.Rebirth:IsCastable()and(g:Rage()>=30 and g:BuffUp(D.BearForm)or g:BuffDown(D.BearForm)and not g:IsMoving())then if p(D.Rebirth,nil)then N=20484;return"Rebirth MO"end elseif D.Rebirth:CooldownRemains(BypassRecovery)<=0 and(g:Rage()<30 and g:BuffUp(D.BearForm))then y=true end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if D.Moonfire:IsCastable()then if p(D.Moonfire,nil)then M=18921;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if D.Moonfire:IsCastable()then if p(D.Moonfire,nil)then N=8921;return"explosive  SWD"end end end;z={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}if UnitExists("target")and D.Soothe:IsCastable()then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for au=0,40 do local _,_,ax,ay,_,_,_,_,_,az=UnitBuff("target",au)for _,aA in pairs(z)do if aA==az then if p(D.Soothe,nil)then N=2908;return"Southe Enrage"end end end end end end;if UnitExists("mouseover")and D.Soothe:IsCastable()then if UnitCanAttack("player","mouseover")and UnitAffectingCombat("mouseover")and UnitIsDead("mouseover")~=true then for au=0,40 do local _,_,ax,ay,_,_,_,_,_,az=UnitBuff("mouseover",au)for _,aA in pairs(z)do if aA==az then if p(D.Soothe,nil)then M=12908;return"Southe Enrage mouseover"end end end end end end;for au=0,40 do local _,_,ax,ay,_,_,_,_,_,az=UnitDebuff("mouseover",au)if D.RemoveCorruption:IsCastable()and UnitIsDead("mouseover")~=true and UnitCanAttack("player","mouseover")~=true and IsItemInRange(34471,"mouseover")and(ay=="Poison"or ay=="Curse")then if p(D.RemoveCorruption,nil)then N=2782;return"Remove Corruption MO"end end end;if(K or i:IsDummy()or i:NPCID()==153285)and g:BuffUp(D.BearForm)then local ShouldReturn=ah()if ShouldReturn then return ShouldReturn end end;if E.Jotungeirr:IsEquippedAndReady()and W~=2 and o()then if p(E.Jotungeirr,nil,nil)then N=16;return"jotungeirr_destinys_call main"end end;if W~=2 and o()then local ao=g:GetUseableTrinkets(F)if ao then if p(ao,nil,nil)then if ao:ID()==TopTrinketID and C.Commons.Enabled.TopTrinket then N=24;return"top trinket 1"elseif ao:ID()==BotTrinketID and C.Commons.Enabled.BotTrinket then N=30;return"top trinket 2"end end end end;if C.Commons.Enabled.Potions and t and E.PotionofPhantomFire:IsReady()and(W~=2 and(g:BuffUp(D.BerserkBuff)or g:BuffUp(D.Incarnation)))then if p(E.PotionofPhantomFire,nil,nil)then N=50;return"potion main"end end;if v and D.FeralAffinity:IsAvailable()and W~=2 and g:BuffDown(D.IncarnationBuff)and(D.Thrash:CooldownRemains()>0 and D.Mangle:CooldownRemains()>0 and i:DebuffRemains(D.MoonfireDebuff)>=g:GCD()+0.5 and g:Rage()<40 and g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and g:BuffDown(D.GalacticGuardianBuff)or g:BuffUp(D.CatForm)and g:Energy()>25 or i:DebuffRefreshable(D.RakeDebuff)and i:DebuffRefreshable(D.Rip)or T and g:BuffDown(D.OathofElderDruidBuff)and(g:BuffUp(D.CatForm)and g:Energy()>20)and g:BuffRemins(D.HeartoftheWild)<=10 or W==1 and D.EmpowerBond:CooldownRemains()<=1 and R<2 or g:BuffUp(D.HeartoftheWild)and g:Energy()>90)then local ShouldReturn=ap()if ShouldReturn then return ShouldReturn end end;if v and D.FeralAffinity:IsAvailable()and W==2 and(D.Thrash:CooldownRemains()>0 and D.Mangle:CooldownRemains()>0 and i:DebuffRemains(D.MoonfireDebuff)>=g:GCD()+0.5 and g:Rage()<40 and g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and g:BuffDown(D.GalacticGuardianBuff)or g:BuffUp(D.CatForm)and g:Energy()>25 or i:DebuffRefreshable(D.RakeDebuff)and i:DebuffRefreshable(D.Rip)and g:Rage()<40 and g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and g:BuffDown(D.GalacticGuardianBuff))then local ShouldReturn=ap()if ShouldReturn then return ShouldReturn end end;if v and D.BalanceAffinity:IsAvailable()and(D.Thrash:CooldownRemains()>0 and D.Mangle:CooldownRemains()>0 and g:Rage()<15 and g:BuffDown(D.IncarnationBuff)and g:BuffDown(D.BerserkBuff)and g:BuffDown(D.GalacticGuardianBuff)or g:BuffUp(D.MoonkinForm)and i:DebuffRefreshable(D.SunfireDebuff)or g:BuffUp(D.MoonkinForm)and g:BuffUp(D.HeartoftheWild)or T and g:BuffDown(D.OathofElderDruidBuff)or W==3 and D.ConvoketheSpirits:CooldownRemains()<=1 or W==1 and D.EmpowerBond:CooldownRemains()<=1 and R<2)then local ShouldReturn=aq()if ShouldReturn then return ShouldReturn end end;if v and(U and D.BalanceAffinity:IsAvailable()and g:BuffUp(D.LycarasFleetingGlimpse)and g:BuffRemains(D.LycarasFleetingGlimpse)<=2)then local ShouldReturn=aj()if ShouldReturn then return ShouldReturn end end;if v and(U and D.FeralAffinity:IsAvailable()and g:BuffUp(D.LycarasFleetingGlimpse)and g:BuffRemains(D.LycarasFleetingGlimpse)<=2)then local ShouldReturn=ak()if ShouldReturn then return ShouldReturn end end;if C.Guardian.SwapForConvoke and q and(D.BalanceAffinity:IsAvailable()and not v and(W==3 and D.ConvoketheSpirits:CooldownRemains()<=1))then local ShouldReturn=al()if ShouldReturn then return ShouldReturn end end;if C.Guardian.SwapForConvoke and q and(D.FeralAffinity:IsAvailable()and not v and(W==3 and D.ConvoketheSpirits:CooldownRemains()<=1))then local ShouldReturn=am()if ShouldReturn then return ShouldReturn end end;if true then local ShouldReturn=an()if ShouldReturn then return ShouldReturn end end;if true then if m.CastAnnotated(D.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end end;local function aB()end;function ReturnSpell()if N==0 then return 0 else return N end end;function ReturnSpellMO()if M==0 then return 0 else return M end end;m.SetAPL(104,at,aB)