local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=d.Action;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=m.CastSuggested;local r=HeroRotationCharDB.Toggles[4]local s=HeroRotationCharDB.Toggles[5]local t=HeroRotationCharDB.Toggles[6]local u=HeroRotationCharDB.Toggles[12]local v=HeroRotationCharDB.Toggles[15]local w=HeroRotationCharDB.Toggles[120]local x=HeroRotationCharDB.Toggles[121]local y=HeroRotationCharDB.Toggles[122]local z=HeroRotationCharDB.Toggles[123]local A=HeroRotationCharDB.Toggles[124]local B=HeroRotationCharDB.Toggles[125]local C;local D;local E;local F;local G={355782,333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,322433,334324,317936,327332,328288,343470,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133}local H=math.max;local _G,pairs,type,table,string,error=_G,pairs,type,table,string,error;local I=m.Commons.Everyone;local J=m.Commons.Hunter;local K={General=m.GUISettings.General,Commons=m.GUISettings.APL.Hunter.Commons,BeastMastery=m.GUISettings.APL.Hunter.BeastMastery}local L=j.Hunter.BeastMastery;local M={L.SummonPet,L.SummonPet2,L.SummonPet3,L.SummonPet4,L.SummonPet5}local N=k.Hunter.BeastMastery;local O={}local P;local Q=g:HasLegendaryEquipped(254)or g:HasUnity()and L.WildSpirits:IsAvailable()local R=g:HasLegendaryEquipped(67)local S=g:HasLegendaryEquipped(68)local T=g:HasLegendaryEquipped(72)local U=g:HasLegendaryEquipped(255)d:RegisterForEvent(function()Q=g:HasLegendaryEquipped(254)or g:HasUnity()and L.WildSpirits:IsAvailable()R=g:HasLegendaryEquipped(67)S=g:HasLegendaryEquipped(68)T=g:HasLegendaryEquipped(72)U=g:HasLegendaryEquipped(255)end,"PLAYER_EQUIPMENT_CHANGED")local V,W,X;local Y,Z;local _;local P;local a0;local a1=0;local a2=0;local a3={{L.Intimidation,"Cast Intimidation (Interrupt)",function()return true end}}local function a4()a0=g:GCD()+0.150;if g:BuffUp(L.AspectoftheWildBuff)then a0=H(0.75,a0-0.2/(1+g:HastePct()/100))end end;function AreaTTD(a5)local a6=0;local a7=0;local a8=40;if a5~=nil then for a9 in pairs(a5)do local aa=a5[a9]if aa:IsInRange(a8)and(aa:AffectingCombat()or aa:IsDummy()or aa:NPCID()==153285)then local ab=aa:TimeToDie()a7=a7+1;a6=ab+a6 end end end;if a7==0 then return 0 end;return a6/a7 end;local function ac(ad)return ad~=0 end;local function ae(a5)local ae=0;if a5~=nil then for a9 in pairs(a5)do local aa=a5[a9]if aa:IsInRange(40)and(aa:AffectingCombat()or aa:IsDummy()or aa:NPCID()==153285)and aa:DebuffUp(j(257284))then ae=ae+1 end end end;return ae end;local function af(ag)local ah=i:BuffRemains(ag)if ag==L.FrenzyPetBuff then if g:IsPrevCastPending()then ah=i:BuffRemains(L.FrenzyPetBuff)+GetTime()-g:GCDStartTime()end elseif ag==L.BeastCleavePetBuff then if g:IsPrevCastPending()then ah=H(i:BuffRemains(L.BeastCleavePetBuff),g:BuffRemains(L.BeastCleaveBuff))+GetTime()-g:GCDStartTime()end end;return ah end;local function ai(aj)return aj:DebuffRemains(L.BarbedShot)end;local function ak(aj)return h:GetEnemiesInSplashRangeCount(15)end;local function al(aj)if(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==f("mouseover"):GUID()then a2=12643;return true elseif(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and K.BeastMastery.TargetSwap=="AutoSwap"and aj:GUID()~=h:GUID()and not u then a2=999;return true elseif(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==h:GUID()then a1=2643;return true elseif aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285 then return true end end;local function am(aj)if(i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q)and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==f("mouseover"):GUID()then a2=1217200;return true elseif(i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q)and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and K.BeastMastery.TargetSwap=="AutoSwap"and aj:GUID()~=h:GUID()and not u then a2=999;return true elseif(i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q)and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==h:GUID()then a1=217200;return true elseif(i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q)and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)then return true end end;local function an(aj)if(L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or L.BestialWrath:CooldownRemains()<12+a0 and L.ScentOfBlood:IsAvailable())and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==f("mouseover"):GUID()then a2=1217200;return true elseif(L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or L.BestialWrath:CooldownRemains()<12+a0 and L.ScentOfBlood:IsAvailable())and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and K.BeastMastery.TargetSwap=="AutoSwap"and aj:GUID()~=h:GUID()and not u then a2=999;return true elseif(L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or L.BestialWrath:CooldownRemains()<12+a0 and L.ScentOfBlood:IsAvailable())and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==h:GUID()then a1=217200;return true elseif(L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or L.BestialWrath:CooldownRemains()<12+a0 and L.ScentOfBlood:IsAvailable())and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)then return true end end;local function ao(aj)if aj:TimeToDie()<9 and L.Bloodletting:ConduitEnabled()and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==f("mouseover"):GUID()then a2=1217200;return true elseif aj:TimeToDie()<9 and L.Bloodletting:ConduitEnabled()and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and K.BeastMastery.TargetSwap=="AutoSwap"and aj:GUID()~=h:GUID()and not u then a2=999;return true elseif aj:TimeToDie()<9 and L.Bloodletting:ConduitEnabled()and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:GUID()==h:GUID()then a1=217200;return true elseif aj:TimeToDie()<9 and L.Bloodletting:ConduitEnabled()and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)then return true end end;local function ap()if I.TargetIsValid()and Y then if j(257284):IsCastable()and j(339264):ConduitEnabled()and h:DebuffDown(j(257284))and ae(V)<=0 and(UnitName("target")=="Nalthor the Rimebinder"or UnitName("target")=="Tirnenn Villager"or UnitName("target")=="Drust Boughbreaker"or UnitName("target")=="Ingra Maloch"or UnitName("target")=="Mistveil Stalker"or UnitName("target")=="Mistcaller"or UnitName("target")=="Blightbone"or UnitName("target")=="Rotspew"or UnitName("target")=="Amarth"or UnitName("target")=="Surgeon Stitchflesh"or UnitName("target")=="Lubricator"or UnitName("target")=="Tred'ova"or UnitName("target")=="Azules"or UnitName("target")=="Ventunax"or UnitName("target")=="Oryphion"or UnitName("target")=="Astronos"or UnitName("target")=="Lakesis"or UnitName("target")=="Klotos"or UnitName("target")=="Devos"or UnitName("target")=="Halkias"or UnitName("target")=="High Adjudicator Aleez"or UnitName("target")=="Wo Drifter"or UnitName("target")=="Lord Chamberlain"or UnitName("target")=="Enraged Spirit"or UnitName("target")=="Hakkar The Soulflayer"or UnitName("target")=="Sentient Oil"or UnitName("target")=="Millhouse Manastorm"or UnitName("target")=="Millificent Manastorm"or UnitName("target")=="Dealer Xyâ€™exa"or UnitName("target")=="Mueh'zala"or UnitName("target")=="Fungi Stormer"or UnitName("target")=="Globgrog"or UnitName("target")=="Slime Tentacle"or UnitName("target")=="Virulax Blightweaver"or UnitName("target")=="Doctor Ickus"or UnitName("target")=="Domina Venomblade"or UnitName("target")=="Margrave Stradama"or UnitName("target")=="Dreadful Huntmaster"or UnitName("target")=="Insatiable Brute"or UnitName("target")=="Kryxis the Voracious"or UnitName("target")=="Grand Overseer"or UnitName("target")=="Research Scribe"or UnitName("target")=="Executor Tarvold"or UnitName("target")=="Grand Proctor Beryllia"or UnitName("target")=="General Kaal"or UnitName("target")=="Paceran the Virulent"or UnitName("target")=="Shard of Halkias"or UnitName("target")=="Shambling Arbalest"or UnitName("target")=="Nekthara the Mangler"or UnitName("target")=="Harugia the Bloodthirtsy"or UnitName("target")=="Heavin the Breaker"or UnitName("target")=="Echelon"or UnitName("target")=="Advent Nevermore"or UnitName("target")=="Xav the Unfallen"or UnitName("target")=="Portal Guardian"or UnitName("target")=="Kul'Tharok"or UnitName("target")=="Gorechop"or UnitName("target")=="Mordretha, the Endless Empress"or UnitName("target")=="Gatewarden Zo'mazz"or UnitName("target")=="Zophex"or UnitName("target")=="Alcruux"or UnitName("target")=="Achillite"or UnitName("target")=="Venza Goldfuse"or UnitName("target")=="Zo'gron"or UnitName("target")=="P.O.S.T Master"or UnitName("target")=="So'azmi"or UnitName("target")=="Portalmancer Zo'dahh"or IsInRaid()and UnitName("boss1")==UnitName("boss1"))then if p(L.HuntersMark,nil)then a1=257284;return"HuntersMark M+"end end;if L.BestialWrath:IsCastable()and E and UnitExists("pet")then if p(L.BestialWrath,nil)then a1=19574;return"Bestial Wrath (PreCombat)"end end;if L.BarbedShot:IsCastable()and L.BarbedShot:Charges()>=2 then if p(L.BarbedShot)then a1=217200;return"Barbed Shot (PreCombat)"end end;if L.KillShot:IsCastable()and(h:HealthPercentage()<=20 or g:BuffUp(L.FlayersMark))then if p(L.KillShot)then a1=53351;return"Kill Shot (PreCombat)"end end;if L.KillCommand:IsCastable()and UnitExists("pet")and _ then if p(L.KillCommand)then a1=34026;return"Kill Command (PreCombat)"end end;if X>1 then if L.MultiShot:IsCastable()then if p(L.MultiShot)then a1=2643;return"Multi-Shot (PreCombat)"end end else if L.CobraShot:IsCastable()then if p(L.CobraShot)then a1=193455;return"Cobra Shot (PreCombat)"end end end end end;local function aq()if L.AncestralCall:IsCastable()and o()and(L.BestialWrath:CooldownRemains()>30 or not E)then if p(L.AncestralCall,nil)then a1=274738;return"Ancestral Call"end end;if L.Fireblood:IsCastable()and o()and(L.BestialWrath:CooldownRemains()>30 or not E)then if p(L.Fireblood,nil)then a1=265221;return"Fireblood"end end;if L.Berserking:IsCastable()and o()and(g:BuffUp(L.AspectoftheWildBuff)and(h:TimeToDie()>180+L.BerserkingBuff:BaseDuration()or(h:HealthPercentage()<35 or not L.KillerInstinct:IsAvailable()))or h:TimeToDie()<13)then if p(L.Berserking,nil)then a1=26297;return"Berserking"end end;if L.BloodFury:IsCastable()and o()and(g:BuffUp(L.AspectoftheWildBuff)and(h:TimeToDie()>120+L.BloodFuryBuff:BaseDuration()or(h:HealthPercentage()<35 or not L.KillerInstinct:IsAvailable()))or h:TimeToDie()<16)then if p(L.BloodFury,nil)then a1=20572;return"Blood Fury"end end;if L.LightsJudgment:IsCastable()and o()and(af(L.FrenzyPetBuff)>a0 or i:BuffDown(L.FrenzyPetBuff))then if p(L.LightsJudgment,nil,nil,40)then a1=255647;return"Light's Judgment"end end;if K.Commons.Enabled.Potions and N.PotionOfSpectralAgility:IsReady()and v and((g:BuffUp(L.AspectoftheWildBuff)or h:TimeToDie()<26)and not m.GUISettings.General.HoldPotforBL or g:BloodlustUp()and m.GUISettings.General.HoldPotforBL)then if p(N.PotionOfSpectralAgility,nil)then a1=50;return"Potion of Spectral Agility"end end end;local function ar()if C and L.AspectoftheWild:IsCastable()and UnitExists("pet")and h:IsInMeleeRange(40)then if p(L.AspectoftheWild,nil)then a1=193530;return"Aspect of the Wild (Cleave)"end end;if L.BarbedShot:IsCastable()then if I.CastTargetIf(L.BarbedShot,V,"min",ai,am)then return"Barbed Shot (Cleave - 1)"end;if i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (Cleave - 1@Target)"end end end;if L.MultiShot:IsReady()and a0-af(L.BeastCleavePetBuff)>0.25 then if p(L.MultiShot,nil,nil,not Y)then a1=2643;return"Multi-Shot (Cleave - 1)"end end;if L.KillShot:IsCastable()and(h:HealthPercentage()<=20 or g:BuffUp(L.FlayersMark))and(U and g:BuffUp(L.FlayersMarkBuff))then if p(L.KillShot,nil,nil,not Y)then a1=53351;return"Kill Shot (Cleave) 8"end end;if L.FlayedShot:IsCastable()and r and U then if p(L.FlayedShot,nil,nil)then a1=324149;return"flayed_shot cleave 10"end end;if L.TarTrap:IsCastable()and(S and L.Flare:CooldownRemains()<g:GCD())then if p(L.TarTrap,nil,nil,not h:IsInRange(40))then a1=187698;return"tar_trap st 4"end end;if L.Flare:IsCastable()and not L.TarTrap:CooldownUp()and S then if p(L.Flare,nil)then a1=1543;return"flare st 5"end end;if r and L.DeathChakram:IsCastable()and g:Focus()+g:FocusCastRegen(L.DeathChakram:ExecuteTime())<g:FocusMax()then if p(L.DeathChakram,nil,nil)then a1=325028;return"death_chakram st"end end;if r and L.WildSpirits:IsCastable()then if p(L.WildSpirits,nil,nil)then a1=328231;return"wild_spirits st"end end;if L.BarbedShot:IsCastable()then if I.CastTargetIf(L.BarbedShot,V,"min",ai,an)then return"Barbed Shot (Cleave - 2)"end;if L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or L.BestialWrath:CooldownRemains()<12+a0 and L.ScentOfBlood:IsAvailable()then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (Cleave - 2@Target)"end end end;if L.BestialWrath:IsCastable()and UnitExists("pet")and E then if p(L.BestialWrath,nil)then a1=19574;return"Bestial Wrath (Cleave)"end end;if L.ResonatingArrow:IsCastable()and r then if p(L.ResonatingArrow,nil,nil)then a1=308491;return"resonating_arrow cleave"end end;if L.Stampede:IsCastable()and D and(g:BuffUp(L.AspectoftheWildBuff)or h:TimeToDie()<15 or not C)then if p(L.Stampede,nil,nil,not Z)then a1=201430;return"Stampede (Cleave)"end end;if L.WailingArrow:IsReady()and s and not g:IsMoving()and h:IsInMeleeRange(40)and i:BuffRemains(L.FrenzyPetBuff)>L.WailingArrow:ExecuteTime()then if p(L.WailingArrow,nil,nil,not Y)then a1=355589;return"Wailing Arrow (Cleave)"end end;if L.FlayedShot:IsCastable()and r then if p(L.FlayedShot,nil,nil)then a1=324149;return"flayed_shot cleave"end end;if L.KillShot:IsCastable()and(h:HealthPercentage()<=20 or g:BuffUp(L.FlayersMark))then if p(L.KillShot,nil,nil,not Y)then a1=53351;return"Kill Shot (Cleave)"end end;if L.ChimaeraShot:IsCastable()then if p(L.ChimaeraShot,nil,nil,not Y)then a1=53209;return"Chimaera Shot (Cleave)"end end;if F and L.Bloodshed:IsCastable()then if p(L.Bloodshed,nil)then a1=321530;return"Bloodshed (ST)"end end;if L.AMurderofCrows:IsReady()then if p(L.AMurderofCrows,nil,nil,not Y)then a1=131894;return"A Murder of Crows (Cleave)"end end;if L.Barrage:IsReady()and af(L.BeastCleavePetBuff)>L.Barrage:ExecuteTime()then if p(L.Barrage,nil,nil,not Y)then a1=120360;return"Barrage (Cleave)"end end;if L.KillCommand:IsReady()and UnitExists("pet")and _ and g:Focus()>L.KillCommand:Cost()+L.MultiShot:Cost()then if p(L.KillCommand)then a1=34026;return"Kill Command (Cleave)"end end;if L.BagofTricks:IsCastable()and(g:BuffDown(L.BestialWrathBuff)or h:TimeToDie()<5)then if p(L.BagofTricks,nil,nil,not Y)then a1=312411;return"Bag of Tricks (ST)"end end;if L.DireBeast:IsReady()then if p(L.DireBeast,nil,nil,not Y)then a1=120679;return"Dire Beast (Cleave)"end end;if L.BarbedShot:IsCastable()then if I.CastTargetIf(L.BarbedShot,V,"min",ai,ao)then return"Barbed Shot (Cleave - 3)"end;if h:TimeToDie()<9 and L.Bloodletting:ConduitEnabled()then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (Cleave - 3@Target)"end end end;if L.CobraShot:IsCastable()and g:FocusTimeToMaxPredicted()<a0 then if p(L.CobraShot)then a1=193455;return"Cobra-Shot (Cleave)"end end;if L.ArcaneTorrent:IsCastable()and o()and g:Focus()+g:FocusRegen()+30<g:FocusMax()then if p(L.ArcaneTorrent,nil,nil,not h:IsInRange(8))then a1=155145;return"arcane_torrent cleave 56"end end end;local function as()if C and L.AspectoftheWild:IsCastable()and UnitExists("pet")and h:IsInMeleeRange(40)then if p(L.AspectoftheWild,nil)then a1=193530;return"Aspect of the Wild (ST)"end end;if L.BarbedShot:IsCastable()and(i:BuffUp(L.FrenzyPetBuff)and i:BuffRemains(L.FrenzyPetBuff)<=a0 or g:BuffUp(L.WildSpiritsBuff)and L.BarbedShot:ChargesFractional()>1.4 and Q)then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (ST - 1)"end end;if L.TarTrap:IsCastable()and(S and h:BuffDown(L.SoulforgeEmbersDebuff)and L.Flare:CooldownRemains()<g:GCD())then if p(L.TarTrap,nil,nil,not h:IsInRange(40))then a1=187698;return"tar_trap st 4"end end;if L.Flare:IsCastable()and not L.TarTrap:CooldownUp()and S then if p(L.Flare,nil)then a1=1543;return"flare st 5"end end;if F and L.Bloodshed:IsCastable()then if p(L.Bloodshed,nil)then a1=321530;return"Bloodshed (ST)"end end;if s and not g:IsMoving()and h:IsInMeleeRange(40)and L.WailingArrow:IsReady()and g:Covenant()=="Night Fae"then if p(L.WailingArrow,nil,nil,not Y)then a1=355589;return"Wailing Arrow (ST)"end end;if r and L.WildSpirits:IsCastable()then if p(L.WildSpirits,nil,nil)then a1=328231;return"wild_spirits st"end end;if r and L.FlayedShot:IsCastable()then if p(L.FlayedShot,nil,nil)then a1=324149;return"flayed_shot st"end end;if L.KillShot:IsCastable()and(h:HealthPercentage()<=20 or g:BuffUp(L.FlayersMark))then if p(L.KillShot,nil,nil,not Y)then a1=53351;return"Kill Shot (ST)"end end;if s and not g:IsMoving()and h:IsInMeleeRange(40)and L.WailingArrow:IsReady()and(i:BuffRemains(L.FrenzyPetBuff)>L.WailingArrow:ExecuteTime()and(L.ResonatingArrow:CooldownRemains()<g:GCD()and(not L.ExplosiveShot:IsAvailable()or g:BloodlustUp())or CovenantID~=1)or h:TimeToDie()<5)then if p(L.WailingArrow,nil,nil,not Y)then a1=355589;return"Wailing Arrow (ST)"end end;if L.BarbedShot:IsCastable()and(L.BestialWrath:CooldownRemains()<12*L.BarbedShot:ChargesFractional()+a0 and L.ScentOfBlood:IsAvailable()or L.BarbedShot:FullRechargeTime()<a0 and ac(L.BestialWrath:CooldownRemains())or h:TimeToDie()<9)then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (ST - 1)"end end;if r and L.DeathChakram:IsCastable()and g:Focus()+g:FocusCastRegen(L.DeathChakram:ExecuteTime())<g:FocusMax()then if p(L.DeathChakram,nil,nil)then a1=325028;return"death_chakram st"end end;if L.Stampede:IsCastable()and D and((g:BuffUp(L.AspectoftheWildBuff)or not C)and(g:BuffUp(L.BestialWrathBuff)or not E)or h:TimeToDie()<15)then if p(L.Stampede,nil,nil,not Z)then a1=201430;return"Stampede (ST)"end end;if L.AMurderofCrows:IsReady()then if p(L.AMurderofCrows,nil,nil,not Y)then a1=131894;return"A Murder of Crows (ST)"end end;if r and L.ResonatingArrow:IsCastable()and(g:BuffUp(L.BestialWrathBuff)or not E or h:TimeToDie()<10)then if p(L.ResonatingArrow,nil,nil)then a1=308491;return"resonating_arrow st"end end;if E and UnitExists("pet")and L.BestialWrath:IsCastable()and(not L.WildSpirits:IsAvailable()or L.WildSpirits:CooldownRemains()>15 or CovenantID==1 and(L.ResonatingArrow:CooldownRemains()<5 or L.ResonatingArrow:CooldownRemains()>20)or h:TimeToDie()<15 or CovenantID~=3 and CovenantID~=1)then if p(L.BestialWrath,nil)then a1=19574;return"Bestial Wrath (ST)"end end;if L.ChimaeraShot:IsCastable()then if p(L.ChimaeraShot,nil,nil,not Y)then a1=53209;return"Chimaera Shot (ST)"end end;if L.KillCommand:IsReady()and UnitExists("pet")and _ then if p(L.KillCommand)then a1=34026;return"Kill Command (ST)"end end;if L.BagofTricks:IsCastable()and(g:BuffDown(L.BestialWrathBuff)or h:TimeToDie()<5)then if p(L.BagofTricks,nil,nil,not Y)then a1=312411;return"Bag of Tricks (ST)"end end;if L.DireBeast:IsReady()then if p(L.DireBeast,nil,nil,not Y)then a1=120679;return"Dire Beast (ST)"end end;if L.CobraShot:IsReady()and(g:Focus()-L.CobraShot:Cost()+g:FocusRegen()*(L.KillCommand:CooldownRemains()-1)>L.KillCommand:Cost()or L.KillCommand:CooldownRemains()>1+a0 or(g:BuffUp(L.BestialWrathBuff)or g:BuffUp(L.NesingwarysTrappingApparatusBuff))and not T or h:TimeToDie()<3)then if p(L.CobraShot,nil,nil,not Y)then a1=193455;return"Cobra Shot (ST)"end end;if L.BarbedShot:IsCastable()and(g:BuffUp(L.WildSpiritsBuff)or L.BarbedShot:ChargesFractional()>1.2 and L.Bloodletting:ConduitEnabled())then if p(L.BarbedShot,nil,nil,not Y)then a1=217200;return"Barbed Shot (ST - 3)"end end;if L.ArcaneTorrent:IsCastable()and o()and g:Focus()+g:FocusRegen()+15<g:FocusMax()then if p(L.ArcaneTorrent,nil,nil,not h:IsInRange(8))then a1=155145;return"arcane_torrent st 50"end end end;local function at()local au=g:GetUseableTrinkets(O)if au then if p(au,nil,nil)then if au:ID()==TopTrinketID and K.Commons.Enabled.TopTrinket then a1=24;return"Generic use_items for "..au:Name()elseif au:ID()==BotTrinketID and K.Commons.Enabled.BottomTrinket then a1=30;return"Generic use_items for "..au:Name()end end end end;local function av()t=HeroRotationCharDB.Toggles[6]r=HeroRotationCharDB.Toggles[4]s=HeroRotationCharDB.Toggles[5]or o()u=HeroRotationCharDB.Toggles[12]v=HeroRotationCharDB.Toggles[15]w=HeroRotationCharDB.Toggles[120]x=HeroRotationCharDB.Toggles[121]y=HeroRotationCharDB.Toggles[122]z=HeroRotationCharDB.Toggles[123]A=HeroRotationCharDB.Toggles[124]B=HeroRotationCharDB.Toggles[125]C=false;D=false;E=false;F=false;if K.BeastMastery.AspectoftheWild=="CDs"and o()or K.BeastMastery.AspectoftheWild=="Small CDs"and(o()or s)or K.BeastMastery.AspectoftheWild=="Always"then C=true end;if K.BeastMastery.Stampede=="CDs"and o()or K.BeastMastery.Stampede=="Small CDs"and(o()or s)or K.BeastMastery.Stampede=="Always"then D=true end;if(K.BeastMastery.BestialWrathCD=="CDs"and o()or K.BeastMastery.BestialWrathCD=="Small CDs"and(o()or s)or K.BeastMastery.BestialWrathCD=="Always")and(not g:IsInDungeonArea()or g:IsInDungeonArea()and AreaTTD(V)>=15)then E=true end;if K.BeastMastery.Bloodshed=="CDs"and o()or K.BeastMastery.Bloodshed=="Small CDs"and(o()or s)or K.BeastMastery.Bloodshed=="Always"then F=true end;TopTrinketID=GetInventoryItemID("player",13)BotTrinketID=GetInventoryItemID("player",14)if not K.Commons.Enabled.TopTrinket and not K.Commons.Enabled.BotTrinket then O={TopTrinketID,BotTrinketID}elseif not K.Commons.Enabled.TopTrinket then O={TopTrinketID}elseif not K.Commons.Enabled.BotTrinket then O={BotTrinketID}end end;local function aw()if L.Stomp:IsAvailable()then d.SplashEnemies.ChangeFriendTargetsTracking("Mine Only")else d.SplashEnemies.ChangeFriendTargetsTracking("All")end;local TopTrinketID,ax=GetInventoryItemID("player",13)local BotTrinketID,ax=GetInventoryItemID("player",14)a4()if a2>0 then a2=0 end;if a1>0 then a1=0 end;local ay=L.BloodBolt:IsPetKnown()and l.FindBySpellID(L.BloodBolt:ID())and L.BloodBolt or L.Bite:IsPetKnown()and l.FindBySpellID(L.Bite:ID())and L.Bite or L.Claw:IsPetKnown()and l.FindBySpellID(L.Claw:ID())and L.Claw or L.Smack:IsPetKnown()and l.FindBySpellID(L.Smack:ID())and L.Smack or nil;local az=L.Growl:IsPetKnown()and l.FindBySpellID(L.Growl:ID())and L.Growl or nil;if n()then V=g:GetEnemiesInRange(40)X=ay and#g:GetEnemiesInSpellActionRange(ay)or h:GetEnemiesInSplashRangeCount(8)else V={}X=0 end;Y=h:IsInRange(40)Z=h:IsInRange(30)_=az and h:IsSpellInActionRange(az)or h:IsInRange(30)av()if L.Exhilaration:IsCastable()and g:HealthPercentage()<=K.Commons.ExhilarationHP then if p(L.Exhilaration,nil)then a1=109304;return"Exhilaration"end end;if g:HealthPercentage()<K.Commons.HealthstoneHP and N.Healthstone:IsReady()and N.Healthstone:CooldownRemains()<=0 then if m.Cast(N.Healthstone,nil)then a1=40;return"Healthstone HP"end end;if g:HealthPercentage()<K.Commons.HealPotHP and N.CosmicHealPot:IsReady()and N.CosmicHealPot:CooldownRemains()<=0 then if m.Cast(N.CosmicHealPot,nil)then a1=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<K.Commons.HealPotHP and N.HealPot:IsReady()and N.HealPot:CooldownRemains()<=0 then if m.Cast(N.HealPot,nil)then a1=41;return"HealPot HP"end end;if L.AspectoftheTurtle:IsCastable()and g:HealthPercentage()<=K.Commons.TurtleHP then if p(L.AspectoftheTurtle,nil)then a1=186265;return"AspectoftheTurtle"end end;if g:BuffUp(j(5384))then return false end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if L.CobraShot:IsCastable()and Y then if p(L.CobraShot,nil)then a2=1193455;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if L.CobraShot:IsCastable()and Y then if p(L.CobraShot,nil)then a1=193455;return"explosive  SWD"end end end;G={333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,322433,334324,317936,327332,328288,195181,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133}if UnitExists("target")and L.TranqualizingShot:IsCastable()then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true and L.TranqualizingShot:IsCastable()and L.TranqualizingShot:CooldownRemains(BypassRecovery)<=0 then for aA=0,40 do local ax,ax,aB,type,ax,ax,ax,ax,ax,aC=UnitBuff("target",aA)for ax,aD in pairs(G)do if aD==aC then if m.Cast(L.TranqualizingShot,nil)then a1=19801;return"Tranq Enrage"end end end end end end;if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if w and L.Bindingshot:IsAvailable()and L.Bindingshot:CooldownRemains(BypassRecovery)<=0 then if m.Cast(L.Bindingshot,nil,nil,nil)then a1=109248;return"queue Binding Shot"end elseif(not L.Bindingshot:IsUsableP()or L.Bindingshot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[120]=not HeroRotationCharDB.Toggles[120]m.Print("Binding Shot Queue is now "..(HeroRotationCharDB.Toggles[120]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and L.FreezingTrap:IsAvailable()and L.FreezingTrap:CooldownRemains(BypassRecovery)<=0 then if m.Cast(L.FreezingTrap,nil,nil,nil)then a1=187650;return"queue Freezing Trap"end elseif(not L.FreezingTrap:IsUsableP()or L.FreezingTrap:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[121]=not HeroRotationCharDB.Toggles[121]m.Print("Freezing Trap Queue is now "..(HeroRotationCharDB.Toggles[121]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and L.Intimidation:IsAvailable()and L.Intimidation:CooldownRemains(BypassRecovery)<=0 then if m.Cast(L.Intimidation,nil,nil,nil)then a1=19577;return"queue Intimidation"end elseif(not L.Intimidation:IsUsableP()or L.Intimidation:CooldownRemains()>0)and y then HeroRotationCharDB.Toggles[122]=not HeroRotationCharDB.Toggles[122]m.Print("Intimidation Queue is now "..(HeroRotationCharDB.Toggles[122]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and L.Flare:IsAvailable()and L.Flare:CooldownRemains(BypassRecovery)<=0 then if m.Cast(L.Flare,nil,nil,nil)then a1=1543;return"queue Flare"end elseif(not L.Flare:IsUsableP()or L.Flare:CooldownRemains()>0)and z then HeroRotationCharDB.Toggles[123]=not HeroRotationCharDB.Toggles[123]m.Print("Flare Queue is now "..(HeroRotationCharDB.Toggles[123]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and L.TarTrap:IsAvailable()and L.TarTrap:CooldownRemains(BypassRecovery)<=0 then if m.Cast(L.TarTrap,nil,nil,nil)then a1=187698;return"queue TarTrap"end elseif(not L.TarTrap:IsUsableP()or L.TarTrap:CooldownRemains()>0)and A then HeroRotationCharDB.Toggles[124]=not HeroRotationCharDB.Toggles[124]m.Print("Tar Trap Queue is now "..(HeroRotationCharDB.Toggles[124]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if g:BuffUp(j(5384))then return false end;if g:IsCasting(L.RevivePet)then if p(L.PoolFocus)then a1=999999;return"Pooling Focus"end end;if L.SummonPet:IsCastable()and not i:IsActive()then if K.Commons.SummonPetSlot==1 and not g:PrevGCD(1,M[K.Commons.SummonPetSlot])then if p(M[K.Commons.SummonPetSlot],nil)then a1=883;return"Summon Pet"end elseif K.Commons.SummonPetSlot==2 and not g:PrevGCD(1,M[K.Commons.SummonPetSlot])then if p(M[K.Commons.SummonPetSlot],nil)then a1=83242;return"Summon Pet"end elseif K.Commons.SummonPetSlot==3 and not g:PrevGCD(1,M[K.Commons.SummonPetSlot])then if p(M[K.Commons.SummonPetSlot],nil)then a1=83243;return"Summon Pet"end elseif K.Commons.SummonPetSlot==4 and not g:PrevGCD(1,M[K.Commons.SummonPetSlot])then if p(M[K.Commons.SummonPetSlot],nil)then a1=83244;return"Summon Pet"end elseif K.Commons.SummonPetSlot==5 and not g:PrevGCD(1,M[K.Commons.SummonPetSlot])then if p(M[K.Commons.SummonPetSlot],nil)then a1=83245;return"Summon Pet"end end end;if(i:IsDeadOrGhost()or not UnitExists("pet"))and L.RevivePet:IsCastable()and not g:IsMoving()and K.Commons.SummonPetSlot~=0 then if p(L.RevivePet,nil)then a1=982;return"Revive Pet"end end;local aE,aF,ax=GetSpellCooldown(34477)if g:AffectingCombat()and K.Commons.AutoMisdirect and not B then if aE+aF-GetTime()<=0 and L.Misdirection:IsAvailable()and L.Misdirection:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus")or UnitIsUnit("focus","pet"))and IsItemInRange(32698,"focus")then if m.Cast(L.Misdirection)then a2=134477;return"MD Focus"end end end;if not i:IsDeadOrGhost()and UnitExists("pet")and L.MendPet:IsCastable()and i:HealthPercentage()<=K.Commons.MendPetHighHP and not g:PrevGCD(1,L.MendPet)then if p(L.MendPet)then a1=1982;return"Mend Pet High Priority"end end;if not g:AffectingCombat()and(t or K.BeastMastery.DBMSupport and(L.BestialWrath:IsCastable()and E and m.BossMods:GetPullTimer()<a0 and m.BossMods:GetPullTimer()>0 or m.BossMods:GetPullTimer()<0.5 and m.BossMods:GetPullTimer()>0))and I.TargetIsValid()then P=ap()if P then return P end end;if I.TargetIsValid()and(g:AffectingCombat()or t)then if j(257284):IsCastable()and j(339264):ConduitEnabled()and h:DebuffDown(j(257284))and(ae(V)<=0 or UnitName("target")=="Fleeting Manifestation")and(UnitName("target")=="Nalthor the Rimebinder"or UnitName("target")=="Tirnenn Villager"or UnitName("target")=="Drust Boughbreaker"or UnitName("target")=="Ingra Maloch"or UnitName("target")=="Mistveil Stalker"or UnitName("target")=="Mistcaller"or UnitName("target")=="Blightbone"or UnitName("target")=="Rotspew"or UnitName("target")=="Amarth"or UnitName("target")=="Surgeon Stitchflesh"or UnitName("target")=="Lubricator"or UnitName("target")=="Tred'ova"or UnitName("target")=="Azules"or UnitName("target")=="Ventunax"or UnitName("target")=="Oryphion"or UnitName("target")=="Astronos"or UnitName("target")=="Lakesis"or UnitName("target")=="Klotos"or UnitName("target")=="Devos"or UnitName("target")=="Halkias"or UnitName("target")=="High Adjudicator Aleez"or UnitName("target")=="Wo Drifter"or UnitName("target")=="Lord Chamberlain"or UnitName("target")=="Enraged Spirit"or UnitName("target")=="Hakkar The Soulflayer"or UnitName("target")=="Sentient Oil"or UnitName("target")=="Millhouse Manastorm"or UnitName("target")=="Millificent Manastorm"or UnitName("target")=="Dealer Xyâ€™exa"or UnitName("target")=="Mueh'zala"or UnitName("target")=="Fungi Stormer"or UnitName("target")=="Globgrog"or UnitName("target")=="Slime Tentacle"or UnitName("target")=="Virulax Blightweaver"or UnitName("target")=="Doctor Ickus"or UnitName("target")=="Domina Venomblade"or UnitName("target")=="Margrave Stradama"or UnitName("target")=="Dreadful Huntmaster"or UnitName("target")=="Insatiable Brute"or UnitName("target")=="Kryxis the Voracious"or UnitName("target")=="Grand Overseer"or UnitName("target")=="Research Scribe"or UnitName("target")=="Executor Tarvold"or UnitName("target")=="Grand Proctor Beryllia"or UnitName("target")=="General Kaal"or UnitName("target")=="Paceran the Virulent"or UnitName("target")=="Shard of Halkias"or UnitName("target")=="Shambling Arbalest"or UnitName("target")=="Nekthara the Mangler"or UnitName("target")=="Harugia the Bloodthirtsy"or UnitName("target")=="Heavin the Breaker"or UnitName("target")=="Echelon"or UnitName("target")=="Advent Nevermore"or UnitName("target")=="Xav the Unfallen"or UnitName("target")=="Portal Guardian"or UnitName("target")=="Kul'Tharok"or UnitName("target")=="Gorechop"or UnitName("target")=="Mordretha, the Endless Empress"or UnitName("target")=="Gatewarden Zo'mazz"or UnitName("target")=="Zophex"or UnitName("target")=="Alcruux"or UnitName("target")=="Achillite"or UnitName("target")=="Venza Goldfuse"or UnitName("target")=="Zo'gron"or UnitName("target")=="P.O.S.T Master"or UnitName("target")=="So'azmi"or UnitName("target")=="Portalmancer Zo'dahh"or UnitName("target")=="4.RF-4.RF"or UnitName("target")=="Inquisitor Sigar"or UnitName("target")=="Fleeting Manifestation"or UnitName("target")=="Corpse Harvester"or UnitName("target")=="Zolramus Necromancer"or UnitName("target")=="Nar'zudah"or UnitName("target")=="Raging Bloodhorn"or UnitName("target")=="Harugia the Bloodthirsty"or UnitName("target")=="Portalmancer Zo'honn"or UnitName("target")=="Enraged Direhorn"or UnitName("target")=="Coastwalker Goliath"or UnitName("target")=="Adorned Starseer"or UnitName("target")=="Wandering Pulsar"or IsInRaid()and UnitName("target")==UnitName("boss1"))then if p(L.HuntersMark,nil)then a1=257284;return"HuntersMark M+"end end;P=I.Interrupt(40,L.CounterShot,nil,a3)if P then a1=147362;return P end;if not h:AffectingCombat()and not h:IsDummy()and not h:NPCID()==153285 and X>=1 then a1=999 end;if not h:AffectingCombat()and not h:IsDummy()and not h:NPCID()==153285 then if p(L.PoolFocus)then a1=999999;return"Pooling Focus"end end;if(K.Commons.Enabled.TopTrinket or K.Commons.Enabled.BottomTrinket)and o()and(CovenantID==1 and L.AspectoftheWild:CooldownDown()and L.ResonatingArrow:CooldownDown()or CovenantID~=1 and L.AspectoftheWild:CooldownDown())then local P=at()if P then return P end end;if true then P=aq()if P then return P end end;if X<2 then local P=as()if P then return P end end;if X>1 then local P=ar()if P then return P end end;if not i:IsDeadOrGhost()and UnitExists("pet")and L.MendPet:IsCastable()and i:HealthPercentage()<=K.Commons.MendPetLowHP then if p(L.MendPet)then a1=1982;return"Mend Pet Low Priority (w/ Target)"end end;if p(L.PoolFocus)then a1=999999;return"Pooling Focus"end end;if not i:IsDeadOrGhost()and UnitExists("pet")and L.MendPet:IsCastable()and i:HealthPercentage()<=K.Commons.MendPetLowHP then if p(L.MendPet)then a1=1982;return"Mend Pet Low Priority (w/o Target)"end end;if not L.RocketBarrage:IsCastable()and UnitRace("player")=="Goblin"and h:IsInMeleeRange(30)then if p(L.RocketBarrage)then a1=69041;return"RocketBarrage"end end end;local function aG()d.Print("BeastMastery can use pet abilities to better determine AoE, makes sure you have Growl and Blood Bolt / Bite / Claw / Smack in your player action bars.")end;function ReturnSpell1()if a1==0 then return 0 else return a1 end end;function ReturnSpellMO1()if a2==0 then return 0 else return a2 end end;m.SetAPL(253,aw,aG)