local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=d.Action;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=m.CastSuggested;local r=math.max;local s=HeroRotationCharDB.Toggles[4]local t=HeroRotationCharDB.Toggles[5]local u=HeroRotationCharDB.Toggles[12]local v=not HeroRotationCharDB.Toggles[15]local w=HeroRotationCharDB.Toggles[120]local x=HeroRotationCharDB.Toggles[121]local y=HeroRotationCharDB.Toggles[122]local z=HeroRotationCharDB.Toggles[123]local A=HeroRotationCharDB.Toggles[124]local B=HeroRotationCharDB.Toggles[125]local C=HeroRotationCharDB.Toggles[142]local D=HeroRotationCharDB.Toggles[17]local E=HeroRotationCharDB.Toggles[170]local F;local G;local H;local I;local J;local K={355782,333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,322433,334324,317936,327332,328288,343470,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133,158337,164426,382555,257260}local L=m.Commons.Everyone;local M=m.Commons.Hunter;local N={General=m.GUISettings.General,Commons=m.GUISettings.APL.Hunter.Commons,BeastMastery=m.GUISettings.APL.Hunter.BeastMastery}local O=j.Hunter.BeastMastery;local P={O.SummonPet,O.SummonPet2,O.SummonPet3,O.SummonPet4,O.SummonPet5}local Q=k.Hunter.BeastMastery;local R={}local S=N.BeastMastery.DeathChakramAutomaticUsing;local T=g:GetEquipment()local U=T[11]and k(T[11])or k(0)local V=T[12]and k(T[12])or k(0)local W=k(0)local X=k(0)local Y=GetInventoryItemID("player",13)local Z=GetInventoryItemID("player",14)local _;local a0=11111;local a1=11111;d:RegisterForEvent(function()T=g:GetEquipment()U=T[11]and k(T[11])or k(0)V=T[12]and k(T[12])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()a0=11111;a1=11111 end,"PLAYER_REGEN_ENABLED")local a2,a3,a4;local a5;local a6,a7;local a8;local a9;local _;local aa=0;local ab=0;local ac={{O.Intimidation,"Cast Intimidation (Interrupt)",function()return true end}}local function ad(ae)if ae then return 1 else return 0 end end;local function af(ae)return ae~=0 end;local function ag(ah)local ag=0;if ah~=nil then for ai in pairs(ah)do local aj=ah[ai]if aj:IsInRange(40)and(aj:AffectingCombat()or aj:IsDummy()or aj:NPCID()==153285)and aj:DebuffUp(j(257284))then ag=ag+1 end end end;return ag end;local function ak(al)return al:DebuffRemains(O.BarbedShotDebuff)end;local function am(al)return al:DebuffStack(O.LatentPoisonDebuff)end;local function an(al)return al:DebuffRemains(O.SerpentStingDebuff)end;local function ao(al)if al:DebuffStack(O.LatentPoisonDebuff)>9 and(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function ap(al)if(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function aq(al)if al:DebuffStack(O.LatentPoisonDebuff)>9 and(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif al:DebuffStack(O.LatentPoisonDebuff)>9 and(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function ar(al)if(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or a1<9 or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function as(al)if al:DebuffRefreshable(O.SerpentStingDebuff)and al:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1271788;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and al:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and al:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=271788;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and al:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function at(al)if(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and i:BuffStack(O.FrenzyPetBuff)<3 and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and i:BuffStack(O.FrenzyPetBuff)<3 and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and i:BuffStack(O.FrenzyPetBuff)<3 and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif(i:BuffUp(O.FrenzyPetBuff)and i:BuffRemains(O.FrenzyPetBuff)<=_+0.25 or O.ScentofBlood:IsAvailable()and i:BuffStack(O.FrenzyPetBuff)<3 and(O.BestialWrath:CooldownRemains()>0 or not o()))and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function au(al)if(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8 or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o())or O.ScentofBlood:IsAvailable()and(O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()+_<8 and O.BestialWrath:CooldownRemains()<24+8-_+O.BarbedShot:FullRechargeTime()and o())or a1<9)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1217200;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8 or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o())or O.ScentofBlood:IsAvailable()and(O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()+_<8 and O.BestialWrath:CooldownRemains()<24+8-_+O.BarbedShot:FullRechargeTime()and o())or a1<9)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8 or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o())or O.ScentofBlood:IsAvailable()and(O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()+_<8 and O.BestialWrath:CooldownRemains()<24+8-_+O.BarbedShot:FullRechargeTime()and o())or a1<9)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=217200;return true elseif(O.WildInstincts:IsAvailable()and g:BuffUp(O.CalloftheWildBuff)or O.WildCall:IsAvailable()and O.BarbedShot:ChargesFractional()>1.8 or O.BarbedShot:FullRechargeTime()<_ and(O.BestialWrath:CooldownRemains()>0 or not o())or O.ScentofBlood:IsAvailable()and(O.BestialWrath:CooldownRemains()<12+_ and o()or O.BarbedShot:FullRechargeTime()+_<8 and O.BestialWrath:CooldownRemains()<24+8-_+O.BarbedShot:FullRechargeTime()and o())or a1<9)and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function av(al)if al:DebuffRefreshable(O.SerpentStingDebuff)and h:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==f("mouseover"):GUID()then ab=1271788;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and h:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and N.BeastMastery.TargetSwap=="AutoSwap"and al:GUID()~=h:GUID()and not u then ab=999;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and h:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)and al:GUID()==h:GUID()then aa=271788;return true elseif al:DebuffRefreshable(O.SerpentStingDebuff)and h:TimeToDie()>O.SerpentStingDebuff:BaseDuration()and(al:AffectingCombat()or al:IsDummy()or al:NPCID()==153285)then return true end end;local function aw()if L.TargetIsValid()and a6 then if O.BarbedShot:IsCastable()and O.BarbedShot:Charges()>=2 then if p(O.BarbedShot)then aa=217200;return"Barbed Shot (PreCombat)"end end;if O.KillShot:IsReady()then if p(O.KillShot)then aa=53351;return"Kill Shot (PreCombat)"end end;if O.KillCommand:IsReady()and UnitExists("pet")and a8 then if p(O.KillCommand)then aa=34026;return"Kill Command (PreCombat)"end end;if PetEnemiesMixedCount>1 then if O.MultiShot:IsReady()then if p(O.MultiShot)then aa=2643;return"Multi-Shot (PreCombat)"end end else if O.CobraShot:IsReady()then if p(O.CobraShot)then aa=193455;return"Cobra Shot (PreCombat)"end end end end end;local function ax()if O.Berserking:IsCastable()and(g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<13)then if p(O.Berserking,nil)then aa=26297;return"Berserking"end end;if o()and O.BloodFury:IsCastable()and(g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<16)then if p(O.BloodFury,nil)then aa=20572;return"Blood Fury"end end;if o()and O.AncestralCall:IsCastable()and(g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<16)then if p(O.AncestralCall,nil)then aa=274738;return"Ancestral Call"end end;if o()and O.Fireblood:IsCastable()and(g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<9)then if p(O.Fireblood,nil)then aa=265221;return"Fireblood"end end;if N.Commons.Enabled.Potions and o()and v and(g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<31)and not m.GUISettings.General.HoldPotforBL or m.GUISettings.General.HoldPotforBL and g:BloodlustUp()then local ay=L.PotionSelected()if ay and ay:IsReady()then if p(ay,nil,nil)then aa=50;return"potion cooldowns 2"end end end end;local function az()local aA=g:GetUseableTrinkets(R,13)if g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<31 then if aA then if aA:ID()==Y and N.Commons.Enabled.TopTrinket then if p(aA,nil,nil)then aa=24;return"Generic use_items for "..aA:Name()end end end end;local aB=g:GetUseableTrinkets(R,14)if g:BuffUp(O.CalloftheWildBuff)or not O.CalloftheWild:IsAvailable()and g:BuffUp(O.BestialWrathBuff)or a1<31 then if aB then if aB:ID()==Z and N.Commons.Enabled.BottomTrinket then if p(aB,nil,nil)then aa=30;return"Generic use_items for "..aB:Name()end end end end end;local function aC()if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"max",am,ao,not h:IsSpellInRange(O.BarbedShot))then return"barbed_shot cleave 2"end;if am(h)and ao(h)then if p(O.BarbedShot,nil,nil,not a6)then aa=217200;return"barbed_shot cleave 2"end end end;if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"min",ak,ap,not h:IsSpellInRange(O.BarbedShot))then return"barbed_shot cleave 4"end;if ak(h)and ap(h)then if p(O.BarbedShot,nil,nil,not a6)then aa=217200;return"barbed_shot cleave 4"end end end;if O.MultiShot:IsReady()and(i:BuffRemains(O.BeastCleavePetBuff)<0.25+_ and(not O.BloodyFrenzy:IsAvailable()or O.CalloftheWild:CooldownDown()))then if p(O.MultiShot,nil,nil,not a6)then aa=2643;return"Multi-Shot (Cleave - 1)"end end;if O.BestialWrath:IsCastable()and H and h:FilteredTimeToDie(">",11)then if p(O.BestialWrath,nil)then aa=19574;return"bestial_wrath cleave 8"end end;if O.KillCommand:IsReady()and(O.KillCommand:FullRechargeTime()<_ and O.AlphaPredator:IsAvailable()and O.KillCleave:IsAvailable())then if p(O.KillCommand)then aa=34026;return"Kill Command (Cleave)"end end;if O.CalloftheWild:IsCastable()and J and h:IsInMeleeRange(40)and h:FilteredTimeToDie(">",11)then if p(O.CalloftheWild,nil)then aa=359844;return"CalloftheWild (Cleave)"end end;if O.KillCommand:IsReady()and O.KillCleave:IsAvailable()then if p(O.KillCommand,nil,nil,not h:IsInRange(50))then aa=34026;return"kill_command cleave 12"end end;if O.ExplosiveShot:IsReady()and h:IsInMeleeRange(40)and s then if p(O.ExplosiveShot,nil,nil,not h:IsInRange(40))then aa=212431;return"ExplosiveShot cleave 4"end end;if O.Stampede:IsCastable()and G then if p(O.Stampede,nil,nil,not a7)then aa=201430;return"Stampede (Cleave)"end end;if O.Bloodshed:IsCastable()and I then if p(O.Bloodshed,nil)then aa=321530;return"Bloodshed (ST)"end end;if O.DeathChakram:IsCastable()and s and S then if p(O.DeathChakram,nil,nil)then aa=325028;return"death_chakram st"end end;if O.AMurderofCrows:IsReady()then if p(O.AMurderofCrows,nil,nil,not h:IsSpellInRange(O.AMurderofCrows))then aa=131894;return"a_murder_of_crows cleave 24"end end;if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"max",am,aq,not h:IsSpellInRange(O.BarbedShot))then aa=217200;return"barbed_shot cleave 26"end end;if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"min",ak,ar,not h:IsSpellInRange(O.BarbedShot))then aa=217200;return"barbed_shot cleave 28"end end;if O.KillCommand:IsReady()then if p(O.KillCommand,nil,nil,not h:IsSpellInRange(O.KillCommand))then aa=34026;return"kill_command cleave 30"end end;if O.DireBeast:IsCastable()then if p(O.DireBeast,nil,nil,not h:IsSpellInRange(O.DireBeast))then aa=120679;return"dire_beast cleave 32"end end;if O.SerpentSting:IsReady()then if L.CastTargetIf(O.SerpentSting,a2,"min",an,as,not h:IsSpellInRange(O.SerpentSting))then return"serpent_sting cleave 34"end end;if O.Barrage:IsReady()and i:BuffRemains(O.FrenzyPetBuff)>O.Barrage:ExecuteTime()then if p(O.Barrage,nil,nil,not h:IsSpellInRange(O.Barrage))then aa=120360;return"barrage cleave 36"end end;if O.MultiShot:IsReady()and i:BuffRemains(O.BeastCleavePetBuff)<g:GCD()*2 then if p(O.MultiShot,nil,nil,not h:IsSpellInRange(O.MultiShot))then aa=2643;return"multishot cleave 38"end end;if o()and O.LightsJudgment:IsCastable()and(g:BuffDown(O.BestialWrathBuff)or h:TimeToDie()<5)then if p(O.LightsJudgment,nil,nil,not h:IsInRange(5))then aa=255647;return"lights_judgment cleave 40"end end;if O.KillShot:IsReady()then if p(O.KillShot,nil,nil,not h:IsSpellInRange(O.KillShot))then return"kill_shot cleave 42"end end;if O.CobraShot:IsReady()and g:FocusTimeToMax()<_*2 then if p(O.CobraShot,nil,nil,not h:IsSpellInRange(O.CobraShot))then aa=193455;return"cobra_shot cleave 42"end end;if O.WailingArrow:IsReady()and(i:BuffRemains(O.FrenzyPetBuff)>O.WailingArrow:ExecuteTime()or a1<5)then if p(O.WailingArrow,nil,nil,not h:IsSpellInRange(O.WailingArrow))then aa=392060;return"wailing_arrow cleave 44"end end;if O.BagofTricks:IsCastable()and o()and(g:BuffDown(O.BestialWrathBuff)or a1<5)then if p(O.BagofTricks,nil)then aa=312411;return"bag_of_tricks cleave 46"end end;if O.ArcaneTorrent:IsCastable()and o()and g:Focus()+g:FocusRegen()+30<g:FocusMax()then if p(O.ArcaneTorrent,nil)then aa=155145;return"arcane_torrent cleave 48"end end end;local function aD()if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"min",ak,at,not h:IsSpellInRange(O.BarbedShot))then return"barbed_shot st 2"end;if ak(h)and at(h)then if p(O.BarbedShot,nil,nil,not a6)then aa=217200;return"barbed_shot st 2"end end end;if O.BarbedShot:IsCastable()and at(h)then if p(O.BarbedShot,nil,nil,not h:IsSpellInRange(O.BarbedShot))then aa=217200;return"barbed_shot st mt_backup 3"end end;if O.CalloftheWild:IsCastable()and J and h:FilteredTimeToDie(">",11)then if p(O.CalloftheWild,nil)then aa=359844;return"call_of_the_wild st 4"end end;if O.KillCommand:IsReady()and(O.KillCommand:FullRechargeTime()<_ and O.AlphaPredator:IsAvailable())then if p(O.KillCommand)then aa=34026;return"Kill Command (ST)"end end;if O.BestialWrath:IsCastable()and H and h:FilteredTimeToDie(">",11)then if p(O.BestialWrath,nil)then aa=19574;return"bestial_wrath st 8"end end;if O.Bloodshed:IsCastable()and I then if p(O.Bloodshed,nil)then aa=321530;return"Bloodshed (ST)"end end;if s and O.DeathChakram:IsCastable()and S then if p(O.DeathChakram,nil,nil,not h:IsSpellInRange(O.DeathChakram))then aa=325028;return"death_chakram st 12"end end;if O.KillCommand:IsReady()then if p(O.KillCommand,nil,nil,not h:IsSpellInRange(O.KillCommand))then aa=34026;return"kill_command st 14"end end;if O.AMurderofCrows:IsCastable()then if p(O.AMurderofCrows,nil,nil,not a6)then aa=131894;return"A Murder of Crows (ST)"end end;if O.ExplosiveShot:IsReady()and h:IsInMeleeRange(40)and s then if p(O.ExplosiveShot,nil,nil,not h:IsInRange(40))then aa=212431;return"ExplosiveShot cleave 4"end end;if O.KillCommand:IsReady()and UnitExists("pet")and a8 then if p(O.KillCommand)then aa=34026;return"Kill Command (ST)"end end;if O.BarbedShot:IsCastable()then if L.CastTargetIf(O.BarbedShot,a2,"min",ak,au,not h:IsSpellInRange(O.BarbedShot))then return"barbed_shot st 24"end;if ak(h)and au(h)then if p(O.BarbedShot,nil,nil,not a6)then aa=217200;return"barbed_shot st 24"end end end;if O.BarbedShot:IsCastable()and au(h)then if p(O.BarbedShot,nil,nil,not h:IsSpellInRange(O.BarbedShot))then return"barbed_shot st mt_backup 24"end end;if O.BarbedShot:IsCastable()and au(h)then if p(O.BarbedShot,nil,nil,not h:IsSpellInRange(O.BarbedShot))then aa=217200;return"barbed_shot st mt_backup 24"end end;if O.DireBeast:IsCastable()then if p(O.DireBeast,nil,nil,not a6)then aa=120679;return"Dire Beast (ST)"end end;if O.SerpentSting:IsReady()then if L.CastTargetIf(O.SerpentSting,a2,"min",an,av,not h:IsSpellInRange(O.SerpentSting))then return"serpent_sting st 28"end end;if O.KillShot:IsReady()then if p(O.KillShot,nil,nil,not a6)then aa=53351;return"Kill Shot (ST)"end end;if O.AspectoftheWild:IsCastable()and F and UnitExists("pet")and h:IsInMeleeRange(40)then if p(O.AspectoftheWild,nil)then aa=193530;return"Aspect of the Wild (Cleave)"end end;if O.CobraShot:IsReady()then if p(O.CobraShot,nil,nil,not a6)then aa=193455;return"Cobra Shot (ST)"end end;if O.WailingArrow:IsReady()and s and not D and not g:IsMoving()and h:IsInMeleeRange(40)and(i:BuffRemains(O.FrenzyPetBuff)>O.WailingArrow:ExecuteTime()or a1<5)then if p(O.WailingArrow,nil,nil,not a6)then aa=355589;return"Wailing Arrow (ST)"end end;if o()then if O.BagofTricks:IsCastable()and o()and(g:BuffDown(O.BestialWrathBuff)or a1<5)then if p(O.BagofTricks,nil,nil,not a6)then aa=312411;return"Bag of Tricks (ST)"end end;if O.ArcaneTorrent:IsCastable()and o()and g:Focus()+g:FocusRegen()+15<g:FocusMax()then if p(O.ArcaneTorrent,nil,nil,not h:IsInRange(8))then aa=155145;return"arcane_torrent st 50"end end end end;local function aE()t=HeroRotationCharDB.Toggles[5]s=HeroRotationCharDB.Toggles[4]u=HeroRotationCharDB.Toggles[12]v=not HeroRotationCharDB.Toggles[15]w=HeroRotationCharDB.Toggles[120]x=HeroRotationCharDB.Toggles[121]y=HeroRotationCharDB.Toggles[122]z=HeroRotationCharDB.Toggles[123]A=HeroRotationCharDB.Toggles[124]B=HeroRotationCharDB.Toggles[125]C=HeroRotationCharDB.Toggles[142]D=HeroRotationCharDB.Toggles[17]E=HeroRotationCharDB.Toggles[170]S=N.BeastMastery.DeathChakramAutomaticUsing;F=false;G=false;H=false;I=false;J=false;if N.BeastMastery.AspectoftheWild=="CDs"and o()or N.BeastMastery.AspectoftheWild=="Small CDs"and s or N.BeastMastery.AspectoftheWild=="Always"then F=true end;if N.BeastMastery.Stampede=="CDs"and o()or N.BeastMastery.Stampede=="Small CDs"and s or N.BeastMastery.Stampede=="Always"then G=true end;if N.BeastMastery.BestialWrathCD=="CDs"and o()or N.BeastMastery.BestialWrathCD=="Small CDs"and s or N.BeastMastery.BestialWrathCD=="Always"then H=true end;if N.BeastMastery.Bloodshed=="CDs"and o()or N.BeastMastery.Bloodshed=="Small CDs"and s or N.BeastMastery.Bloodshed=="Always"then I=true end;if N.BeastMastery.CalloftheWildCD=="CDs"and o()or N.BeastMastery.CalloftheWildCD=="Small CDs"and s or N.BeastMastery.CalloftheWildCD=="Always"then J=true end;Y=GetInventoryItemID("player",13)Z=GetInventoryItemID("player",14)end;local function aF()if O.Stomp:IsAvailable()then d.SplashEnemies.ChangeFriendTargetsTracking("Mine Only")else d.SplashEnemies.ChangeFriendTargetsTracking("All")end;local Y,aG=GetInventoryItemID("player",13)local Z,aG=GetInventoryItemID("player",14)local aH=O.BloodBolt:IsPetKnown()and l.FindBySpellID(O.BloodBolt:ID())and O.BloodBolt or O.Bite:IsPetKnown()and l.FindBySpellID(O.Bite:ID())and O.Bite or O.Claw:IsPetKnown()and l.FindBySpellID(O.Claw:ID())and O.Claw or O.Smack:IsPetKnown()and l.FindBySpellID(O.Smack:ID())and O.Smack or nil;local aI=O.Growl:IsPetKnown()and l.FindBySpellID(O.Growl:ID())and O.Growl or nil;if n()then a2=g:GetEnemiesInRange(40)PetEnemiesMixed=aH and g:GetEnemiesInSpellActionRange(aH)or h:GetEnemiesInSplashRange(8)PetEnemiesMixedCount=aH and#PetEnemiesMixed or h:GetEnemiesInSplashRangeCount(8)else a2={}PetEnemiesMixed=h or{}PetEnemiesMixedCount=0 end;a6=h:IsInRange(40)a7=h:IsInRange(30)a8=aI and h:IsSpellInActionRange(aI)or h:IsInRange(30)_=g:GCD()+0.150;if L.TargetIsValid()or g:AffectingCombat()then a0=d.BossFightRemains()a1=a0;if a1==11111 then a1=d.FightRemains(a2,false)end end;if ab>0 then ab=0 end;if aa>0 then aa=0 end;aE()if O.Exhilaration:IsCastable()and g:HealthPercentage()<=N.Commons.ExhilarationHP then if p(O.Exhilaration,nil)then aa=109304;return"Exhilaration"end end;if g:HealthPercentage()<N.Commons.HealthstoneHP and Q.Healthstone:IsReady()and Q.Healthstone:CooldownRemains()<=0 then if m.Cast(Q.Healthstone,nil)then aa=40;return"Healthstone HP"end end;if g:HealthPercentage()<N.Commons.HealPotHP and Q.CosmicHealPot:IsReady()and Q.CosmicHealPot:CooldownRemains()<=0 then if m.Cast(Q.CosmicHealPot,nil)then aa=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<N.Commons.HealPotHP and Q.HealPot:IsReady()and Q.HealPot:CooldownRemains()<=0 then if m.Cast(Q.HealPot,nil)then aa=41;return"HealPot HP"end end;if O.AspectoftheTurtle:IsCastable()and g:HealthPercentage()<=N.Commons.TurtleHP then if p(O.AspectoftheTurtle,nil)then aa=186265;return"AspectoftheTurtle"end end;if g:BuffUp(j(5384))then return false end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if O.CobraShot:IsCastable()and a6 then if p(O.CobraShot,nil)then ab=1193455;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if O.CobraShot:IsCastable()and a6 then if p(O.CobraShot,nil)then aa=193455;return"explosive  SWD"end end end;K={333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,322433,334324,317936,327332,328288,195181,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133,158337,164426,382555,412695,265368,8599,428291}if UnitExists("target")and O.TranqualizingShot:IsCastable()and not C then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true and O.TranqualizingShot:IsCastable()and O.TranqualizingShot:CooldownRemains(BypassRecovery)<=0 then for aJ=0,40 do local aG,aG,aK,aL,aG,aG,aG,aG,aG,aM=UnitBuff("target",aJ)for aG,aN in pairs(K)do if aN==aM then if m.Cast(O.TranqualizingShot,nil)then aa=19801;return"Tranq Enrage"end end end end end end;if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if m.QueuedCast()then aa=m.QueuedCast()return"Custom Queue "..j(aa):ID()end;if w and O.Bindingshot:IsAvailable()and O.Bindingshot:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.Bindingshot,nil,nil,nil)then aa=109248;return"queue Binding Shot"end elseif(not O.Bindingshot:IsUsableP()or O.Bindingshot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[120]=not HeroRotationCharDB.Toggles[120]m.Print("Binding Shot Queue is now "..(HeroRotationCharDB.Toggles[120]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and O.FreezingTrap:IsAvailable()and O.FreezingTrap:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.FreezingTrap,nil,nil,nil)then aa=187650;return"queue Freezing Trap"end elseif(not O.FreezingTrap:IsUsableP()or O.FreezingTrap:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[121]=not HeroRotationCharDB.Toggles[121]m.Print("Freezing Trap Queue is now "..(HeroRotationCharDB.Toggles[121]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and O.Intimidation:IsAvailable()and O.Intimidation:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.Intimidation,nil,nil,nil)then aa=19577;return"queue Intimidation"end elseif(not O.Intimidation:IsUsableP()or O.Intimidation:CooldownRemains()>0)and y then HeroRotationCharDB.Toggles[122]=not HeroRotationCharDB.Toggles[122]m.Print("Intimidation Queue is now "..(HeroRotationCharDB.Toggles[122]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and O.Flare:IsAvailable()and O.Flare:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.Flare,nil,nil,nil)then aa=1543;return"queue Flare"end elseif(not O.Flare:IsUsableP()or O.Flare:CooldownRemains()>0)and z then HeroRotationCharDB.Toggles[123]=not HeroRotationCharDB.Toggles[123]m.Print("Flare Queue is now "..(HeroRotationCharDB.Toggles[123]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and O.TarTrap:IsAvailable()and O.TarTrap:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.TarTrap,nil,nil,nil)then aa=187698;return"queue TarTrap"end elseif(not O.TarTrap:IsUsableP()or O.TarTrap:CooldownRemains()>0)and A then HeroRotationCharDB.Toggles[124]=not HeroRotationCharDB.Toggles[124]m.Print("Tar Trap Queue is now "..(HeroRotationCharDB.Toggles[124]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if E and O.WailingArrow:IsAvailable()and O.WailingArrow:CooldownRemains(BypassRecovery)<=0 then if m.Cast(O.WailingArrow,nil,nil,nil)then aa=392060;return"queue WailingArrow"end elseif(not O.WailingArrow:IsUsableP()or O.WailingArrow:CooldownRemains()>0)and E then HeroRotationCharDB.Toggles[170]=not HeroRotationCharDB.Toggles[170]m.Print("WailingArrow Queue is now "..(HeroRotationCharDB.Toggles[170]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if g:BuffUp(j(5384))then return false end;if g:IsCasting(O.RevivePet)then if p(O.PoolFocus)then aa=999999;return"Pooling Focus"end end;if i:IsActive()and select(2,GetStablePetInfo(N.Commons.SummonPetSlot))~=select(1,UnitName("pet"))and N.Commons.SummonPetSlot~=0 and not g:IsMoving()and not g:PrevGCD(1,O.DismissPet)and not g:IsCasting(O.DismissPet)then if p(O.DismissPet,nil)then aa=2641;return"Dismiss Pet"end end;if O.SummonPet:IsCastable()and not i:IsActive()and N.Commons.SummonPetSlot~=0 then if N.Commons.SummonPetSlot==1 and not g:PrevGCD(1,P[N.Commons.SummonPetSlot])then if p(P[N.Commons.SummonPetSlot],nil)then aa=883;return"Summon Pet"end elseif N.Commons.SummonPetSlot==2 and not g:PrevGCD(1,P[N.Commons.SummonPetSlot])then if p(P[N.Commons.SummonPetSlot],nil)then aa=83242;return"Summon Pet"end elseif N.Commons.SummonPetSlot==3 and not g:PrevGCD(1,P[N.Commons.SummonPetSlot])then if p(P[N.Commons.SummonPetSlot],nil)then aa=83243;return"Summon Pet"end elseif N.Commons.SummonPetSlot==4 and not g:PrevGCD(1,P[N.Commons.SummonPetSlot])then if p(P[N.Commons.SummonPetSlot],nil)then aa=83244;return"Summon Pet"end elseif N.Commons.SummonPetSlot==5 and not g:PrevGCD(1,P[N.Commons.SummonPetSlot])then if p(P[N.Commons.SummonPetSlot],nil)then aa=83245;return"Summon Pet"end end end;if(i:IsDeadOrGhost()or not UnitExists("pet"))and O.RevivePet:IsCastable()and not g:IsMoving()and N.Commons.SummonPetSlot~=0 then if p(O.RevivePet,nil)then aa=982;return"Revive Pet"end end;local aO,aP,aG=GetSpellCooldown(34477)if g:AffectingCombat()and N.Commons.AutoMisdirect and not B then if aO+aP-GetTime()<=0 and O.Misdirection:IsAvailable()and O.Misdirection:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus")or UnitIsUnit("focus","pet"))and IsItemInRange(32698,"focus")then if m.Cast(O.Misdirection)then ab=134477;return"MD Focus"end end end;if not i:IsDeadOrGhost()and UnitExists("pet")and O.MendPet:IsCastable()and i:HealthPercentage()<=N.Commons.MendPetHighHP and not g:PrevGCD(1,O.MendPet)then if p(O.MendPet)then aa=1982;return"Mend Pet High Priority"end end;if not g:AffectingCombat()and(t or N.BeastMastery.DBMSupport and(O.BestialWrath:IsCastable()and H and m.BossMods:GetPullTimer()<_ and m.BossMods:GetPullTimer()>0 or m.BossMods:GetPullTimer()<0.5 and m.BossMods:GetPullTimer()>0))and L.TargetIsValid()then a9=aw()if a9 then return a9 end end;if L.TargetIsValid()and(g:AffectingCombat()or t)then if not h:AffectingCombat()and not h:IsDummy()and not h:NPCID()==153285 and a4>=1 then aa=999 end;if not h:AffectingCombat()and not h:IsDummy()and not h:NPCID()==153285 then if p(O.PoolFocus)then aa=999999;return"Pooling Focus"end end;if true then a9=ax()if a9 then return a9 end end;if(N.Commons.Enabled.TopTrinket or N.Commons.Enabled.BottomTrinket)and o()then local a9=az()if a9 then return a9 end end;if PetEnemiesMixedCount<2 or not O.BeastCleave:IsAvailable()and PetEnemiesMixedCount<3 then local a9=aD()if a9 then return a9 end end;if PetEnemiesMixedCount>2 or O.BeastCleave:IsAvailable()and PetEnemiesMixedCount>1 then local a9=aC()if a9 then return a9 end end;if not i:IsDeadOrGhost()and UnitExists("pet")and O.MendPet:IsCastable()and i:HealthPercentage()<=N.Commons.MendPetLowHP then if p(O.MendPet)then aa=1982;return"Mend Pet Low Priority (w/ Target)"end end;if p(O.PoolFocus)then aa=999999;return"Pooling Focus"end end;if not i:IsDeadOrGhost()and UnitExists("pet")and O.MendPet:IsCastable()and i:HealthPercentage()<=N.Commons.MendPetLowHP then if p(O.MendPet)then aa=1982;return"Mend Pet Low Priority (w/o Target)"end end end;local function aQ()d.Print("BeastMastery can use pet abilities to better determine AoE, makes sure you have Growl and Blood Bolt / Bite / Claw / Smack in your player action bars.")if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]m.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell1()if aa==0 then return 0 else return aa end end;function ReturnSpellMO1()if ab==0 then return 0 else return ab end end;m.SetAPL(253,aF,aQ)