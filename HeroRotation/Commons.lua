local a,b=...local c=HeroLib;local d=b.Cast;local e,f=HeroCache,c.Utils;local g=c.Unit;local h=g.Player;local j=g.Target;local k=c.Spell;local l=c.Item;local pairs=pairs;local m=string.gsub;local UnitInParty=UnitInParty;local UnitInRaid=UnitInRaid;b.Commons={}local n={}b.Commons.Everyone=n;local o=b.GUISettings.General;local p=b.GUISettings.Abilities;function n.TargetIsValid()return j:Exists()and h:CanAttack(j)and not j:IsDeadOrGhost()end;function n.UnitIsCycleValid(g,q,r)return not g:IsFacingBlacklisted()and not g:IsUserCycleBlacklisted()and(not q or g:FilteredTimeToDie(">",q,r))end;function n.CanDoTUnit(g,s)return g:Health()>=s or g:IsDummy()end;local t={Buff={k(191941),k(204151),k(239932)},Debuff={348074,358988,347607,351180,353929},Cast={197810,197418,198079,214003,235751,193668,227493,228852,193211,200732,241635,241636,236494,239932,254919,244899,245458,248499,258039,346985,350828,350202,350475,351066,350422,352538,350732,348071},Channel={}}local u={Buff={},Debuff={},Cast={350732,355352,353603},Channel={}}function n.Interrupt(k,v,w)if o.InterruptEnabled and j:IsInterruptible()then if k:IsCastable(true)and j:IsSpellInRange(k)then if d(k,v)then return"Cast "..k:Name().." (Interrupt)"end elseif o.InterruptWithStun and j:CanBeStunned()then if w then for i=1,#w do if w[i][1]:IsCastable()and j:IsSpellInRange(w[i][1])and w[i][3]()then if d(w[i][1])then return w[i][2]end end end end end end end;function n.ActiveMitigationNeeded()if not h:IsTanking(j)then return false end;if t.Cast[j:CastSpellID()]then return true end;for _,x in pairs(t.Buff)do if j:BuffUp(x,true)then return true end end;for _,y in pairs(t.Debuff)do local _,_,z,_,_,_,_,_,_,A,_,_,_,_,_,_=UnitDebuff("player",y)if A~=nil then if y==A then return true end end end;return false end;function n.BigActiveMitigationNeeded()if not h:IsTanking(j)then return false end;if u.Cast[j:CastSpellID()]then return true end;for _,x in pairs(u.Buff)do if j:BuffUp(x,true)then return true end end;for _,y in pairs(u.Debuff)do local _,_,z,_,_,_,_,_,_,A,_,_,_,_,_,_=UnitDebuff("player",i)if A~=nil then if y==A then return true end end end;return false end;do local B={Debuff={k(243961)}}function h:HealingAbsorbed()for _,y in pairs(B.Debuff)do if h:DebuffUp(y,true)then return true end end;return false end end;function n.Interrupt(C,k,v,w)if o.InterruptEnabled and j:IsInterruptible()and j:IsInRange(C)then if k:IsCastable()then if b.Cast(k,v)then return"Cast "..k:Name().." (Interrupt)"end elseif o.InterruptWithStun and j:CanBeStunned()then if w then for i=1,#w do if w[i][1]:IsCastable()and w[i][3]()then if b.Cast(w[i][1])then return w[i][2]end end end end end end end;function n.IsSoloMode()return o.SoloMode and not h:IsInRaidArea()and not h:IsInDungeonArea()end;function n.CastCycle(D,E,F,G,H,I)if F(j)then return b.Cast(D,H,I,G)end;if b.AoEON()then local J=j:GUID()for _,K in pairs(E)do if K:GUID()~=J and not K:IsFacingBlacklisted()and not K:IsUserCycleBlacklisted()and F(K)then b.CastLeftNameplate(K,D)break end end end end;function n.CastTargetIf(D,E,L,M,F,G,H,I)local N=not F or F and F(j)if not b.AoEON()and N then return b.Cast(D,H,I,G)end;if b.AoEON()then local O,P=nil,nil;for _,K in pairs(E)do if not K:IsFacingBlacklisted()and not K:IsUserCycleBlacklisted()and(K:AffectingCombat()or K:IsDummy())and(not P or f.CompareThis(L,M(K),P))then O,P=K,M(K)end end;if O then if N and(O:GUID()==j:GUID()or P==M(j))then return b.Cast(D,H,I,G)elseif F and F(O)or not F then b.CastLeftNameplate(O,D)end end end end;function n.GroupBuffMissing(Q)local R=40;if Q:Name()=="Battle Shout"then R=100 end;local S;if UnitInRaid("player")then S=g.Raid elseif UnitInParty("player")then S=g.Party else return false end;for _,T in pairs(S)do if T:Exists()and T:IsInRange(R)and T:BuffDown(Q,true)then return true end end;return false end;function n.GetCurrentEmpowerData(U)local V=0;local W={}_,_,_,StartTimeMS,EndTimeMS,_,_,_,_,StageTotal=UnitChannelInfo("player")if StageTotal and StageTotal>0 then local X=0;for i=1,StageTotal do W[i]={Start=X,Finish=X+GetUnitEmpowerStageDuration("player",i-1)/1000}b.Print(" Start"..i..": "..W[i].Start)b.Print("Finish"..i..": "..W[i].Finish)X=W[i].Finish;if StartTimeMS/1000+X<=GetTime()then V=i end end end;if U then return V else return W end end;function n.PotionSelected()local Y={"Warrior","Paladin","Hunter","Rogue","Priest","DeathKnight","Shaman","Mage","Warlock","Monk","Druid","DemonHunter","Evoker"}local Z=e.Persistent.Player.Class[3]local a0=Y[Z]local a1={[250]="Blood",[251]="Frost",[252]="Unholy",[577]="Havoc",[581]="Vengeance",[102]="Balance",[103]="Feral",[104]="Guardian",[105]="Restoration",[1467]="Devastation",[1468]="Preservation",[1473]="Augmentation",[253]="BeastMastery",[254]="Marksmanship",[255]="Survival",[62]="Arcane",[63]="Fire",[64]="Frost",[268]="Brewmaster",[269]="Windwalker",[270]="Mistweaver",[65]="Holy",[66]="Protection",[70]="Retribution",[256]="Discipline",[257]="Holy",[258]="Shadow",[259]="Assassination",[260]="Outlaw",[261]="Subtlety",[262]="Elemental",[263]="Enhancement",[264]="Restoration",[265]="Affliction",[266]="Demonology",[267]="Destruction",[71]="Arms",[72]="Fury",[73]="Protection"}local a2=e.Persistent.Player.Spec[1]local a3=a1[a2]local a4=b.GUISettings.APL[a0][a3].PotionType.Selected;local a5={191914,191913,191912,191907,191906,191905,191383,191382,191381,191389,191388,191387}local a6={191365,191364,191363}local a7={191368,191367,191366}local a8={191401,191400,191399}if a4=="Power"then for _,a9 in ipairs(a5)do if l(a9):IsUsable()then return l(a9)end end elseif a4=="Frozen Focus"then for _,a9 in ipairs(a6)do if l(a9):IsUsable()then return l(a9)end end elseif a4=="Chilled Clarity"then for _,a9 in ipairs(a7)do if l(a9):IsUsable()then return l(a9)end end elseif a4=="Shocking Disclosure"then for _,a9 in ipairs(a8)do if l(a9):IsUsable()then return l(a9)end end else return nil end;local aa={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,158337,412695,355782,333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,257260,322433,334324,317936,327332,328288,343470,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133,158337,164426,382555}function n.getWhiteList()return aa end;function n.TriketGeneric(ab,ac,F)local ac=h:GetUseableTrinkets(ab)if ac and F then if ac then if b.Cast(ac,nil,nil)then if ac:ID()==GetInventoryItemID("player",13)and o.Commons.Enabled.TopTrinket then shouldcast=24;return"Generic use_items for "..ac:Name()elseif ac:ID()==GetInventoryItemID("player",14)and o.Commons.Enabled.BottomTrinket then shouldcast=25;return"Generic use_items for "..ac:Name()end end end end end;function n.TrinketSpecific(ad,ae,af,ag,ah,ai)if ad.TrinketName:IsEquippedAndReady()then if not af:ID()==ad.TrinketName:ID()and af:CooldownRemains()>10 or ag:CooldownRemains()>10 or c.BossFilteredFightRemains("<",20)or not ag:HasCooldown()or not af:HasCooldown()then if b.Cast(ad.TrinketName,nil,nil)then if ad.DragonfireBombDispenser:ID()==ah then shouldcast=24;return ae:Name().." top"elseif ad.TrinketName:ID()==ai then shouldcast=30;return ae:Name().." bot"end end end end end end