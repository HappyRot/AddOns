local a,b=...local c=HeroLib;local d,e=HeroCache,c.Utils;local f=c.Unit;local g=f.Player;local h=f.Target;local i=c.Spell;local j=c.Item;local k=math.min;local print=print;local select=select;local l=string.lower;local strsplit=strsplit;local tostring=tostring;local m=_G.DBM;local n=_G.BigWigsLoader;local o=false;local p="BoomK_Bait_File"local q="Register_Character_Info"local r="Thank_You_For_Your_Account"HeroRotation=b;b.BossMods={EngagedBosses={}}local s=b.BossMods.EngagedBosses;local t=false;local u=false;local v=false;local w=false;local x=false;local y=false;local z=false;if m then local A,B={},{}local C=0;o=true;DBM_TIMER_PULL=_G.DBM_CORE_L.TIMER_PULL;m:RegisterCallback("DBM_TimerStart",function(D,E,F,G,H,I,J,K,L,M,N,O,P)local Q;if type(G)=="string"then Q=toNum[G:match("%d+")]else Q=G end;if not A[E]then A[E]={text=F,start=GetTime(),duration=Q}else A[E].text=F;A[E].start=GetTime()A[E].duration=Q end;if J then A[E].spellid=J;B[J]=A[E]end end)m:RegisterCallback("DBM_SetStage",function(D,R,T,phase,U,V)C=phase end)m:RegisterCallback("DBM_TimerStop",function(D,E)if A[E]then end;if A[E]and A[E].spellid then B[A[E].spellid]=nil end;A[E]=nil end)DBM_GetTimeRemaining=function(F)if F then for E,W in pairs(A)do if W.text:match(F)then local X=W.start+W.duration;local Y=X-GetTime()if Y<0 then Y=0 end;return Y,X,C end end else error("Bad argument 'text' (nil value) for function DBM_GetTimeRemaining")end;return 0,0,0 end;DBM_GetTimeRemainingBySpellID=function(J)if B[J]then local X=B[J].start+B[J].duration;local Y=X-GetTime()if Y<0 then Y=0 end;return Y,X,C end;return 0,0,0 end;hooksecurefunc(m,"StartCombat",function(m,R,Z,_)if _~="TIMER_RECOVERY"then local a0=R.localization.general.name;local a1=R.id;if a0 then s[a0]=R;s[a0].AddonBaseName="DBM"end;if a1 then s[a1]=R;s[a1].AddonBaseName="DBM"end end end)hooksecurefunc(m,"EndCombat",function(m,R)local a0=R.localization.general.name or""local a1=R.id or""s[a0]=nil;s[a1]=nil end)end;function b.BossMods:HasAnyAddon()return o or HasBigWigs end;function b.BossMods:GetPullTimer()local Y,X=0,0;if self:HasAnyAddon()then local a2,a3=0,0;local a4,a5=0,0;if o then a2,a3=DBM_GetTimeRemaining(DBM_TIMER_PULL)end;if self.HasBigWigs then a4,a5=BigWigs_GetTimeRemaining(BIGWIGS_TIMER_PULL)end;if a2>a4 then Y=a2;X=a3 else Y=a4;X=a5 end end;return Y end;function b.BossMods:GetTimer(a6)local Y,X,C=0,0,0;if a6 and self:HasAnyAddon()then local a2,a3=0,0;local a4,a5=0,0;if o then if type(a6)=="string"then a2,a3,phase=DBM_GetTimeRemaining(a6)else a2,a3,phase=DBM_GetTimeRemainingBySpellID(a6)end end;if self.HasBigWigs then a4,a5=BigWigs_GetTimeRemaining(a6)end;if a2>a4 then Y=a2;X=a3 else Y=a4;X=a5 end end;return Y,X,phase end;function b.BossMods:IsEngage(a6)if self:HasAnyAddon()then local a7=a6 and a6;for a8,a9 in pairs(s)do if(not a7 or a8:match(a7))and(a9.AddonBaseName=="DBM"and a9.inCombat or a9.AddonBaseName=="BigWigs"and a9.isEngaged)then return true,a8 end end end end;function b.Sepulcher()if f("boss1"):NPCID()==180773 then local aa,ab,ac=b.BossMods:GetTimer(360412)if ac==1 then aa=100-UnitPower("boss1",3)ab=100-aa+GetTime()if aa<=1 and aa>0 and ab~=0 then CoreShieldExpire=ab+11 end;if aa>5 and aa<20 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=5 and aa~=0 then t=true elseif CoreShieldExpire and GetTime()>=CoreShieldExpire and GetTime()-1<CoreShieldExpire then v=true end end elseif f("boss1"):NPCID()==181395 then local aa,ab,ac=b.BossMods:GetTimer(359829)if aa<=1 and aa>0 and ab~=0 then DustFlailExpire=ab+8 end;if f("boss1"):IsCasting(i(359829))then DustFlailExpire=GetTime()+f("boss1"):CastRemains()end;if aa<=10 and aa>i(197995):CastTime()+0.5 then w=true elseif DustFlailExpire and GetTime()+i(197995):CastTime()>=DustFlailExpire and GetTime()+i(197995):CastTime()-3<DustFlailExpire then x=true end;local aa,ab,ac=b.BossMods:GetTimer(359770)if aa<=1 and aa>0 and ab~=0 then RaveningBurrowExpire=ab+8 end;if f("boss1"):IsCasting(i(359770))then RaveningBurrowExpire=GetTime()+f("boss1"):CastRemains()+1.5 end;if aa>3 and aa<18 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=3 and aa~=0 then t=true elseif RaveningBurrowExpire and GetTime()>=RaveningBurrowExpire and GetTime()-1<RaveningBurrowExpire then v=true end elseif f("boss1"):NPCID()==183501 then local aa,ab,ac=b.BossMods:GetTimer(362803)local ad,ae,af=b.BossMods:GetTimer(362801)if ad<=1 and ad>0 and ae~=0 then RelocationExpire=ae+6 end;for ag=1,GetNumGroupMembers()do if UnitGroupRolesAssigned("raid"..ag)=="TANK"and f("raid"..ag):DebuffUp(i(362801))then RelocationExpire=GetTime()+f("raid"..ag):DebuffRemains(i(362801))end end;if ad>9 and ad<24 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and ad<15)and ad~=0 then u=true end elseif ad<=9 and ad~=0 then t=true elseif RelocationExpire and GetTime()>=RelocationExpire and GetTime()-1<RelocationExpire then v=true end;if aa+6<=20 and aa>i(197995):CastTime()+0.5 then w=true elseif RelocationExpire and(GetTime()>=RelocationExpire or GetTime+i(197995):CastTime()<RelocationExpire and GetTime+i(197995):CastTime()>RelocationExpire+0.5)and GetTime()+i(197995):CastTime()-5<RelocationExpire then x=true end elseif f("boss1"):NPCID()==181224 then for ag=1,GetNumGroupMembers()do if UnitGroupRolesAssigned("raid"..ag)=="TANK"and f("raid"..ag):DebuffRemains(i(361966))>i(197995):CastTime()and UnitThreatSituation("raid"..ag,"boss1")~=nil and UnitThreatSituation("raid"..ag,"boss1")<2 then w=true elseif UnitGroupRolesAssigned("raid"..ag)=="TANK"and f("raid"..ag):DebuffRemains(i(361966))<i(197995):CastTime()and UnitThreatSituation("raid"..ag,"boss1")~=nil and UnitThreatSituation("raid"..ag,"boss1")<2 then x=true end end;local aa,ab,ac=b.BossMods:GetTimer(361643)if aa<=1 and aa>0 and not f("boss1"):IsCasting(i(361630))and not f("boss1"):IsCasting(i(361643))and ab~=0 then DominionExpire=ab+5 end;if f("boss1"):IsCasting(i(361643))then DominionExpire=f("boss1"):CastRemains()+6.5 end;if f("boss1"):IsCasting(i(361630))then DominionExpire=GetTime()+f("boss1"):CastRemains()+10 end;if aa>8 and aa<23 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=8 and aa~=0 then t=true;if DominionExpire then end elseif DominionExpire and GetTime()>=DominionExpire and GetTime()-1<DominionExpire then v=true end elseif f("boss1"):NPCID()==182169 then local aa,ab,ac=b.BossMods:GetTimer(363088)if aa<=1 and aa>0 and ab~=0 then CosmicShiftExpire=ab+3 end;if f("boss1"):IsCasting(i(363088))then CosmicShiftExpire=GetTime()+f("boss1"):CastRemains()end;if aa<=20 and aa>i(197995):CastTime()+0.5 then w=true elseif CosmicShiftExpire and GetTime()+i(197995):CastTime()>=CosmicShiftExpire and GetTime()+i(197995):CastTime()-1<CosmicShiftExpire then z=true;x=true end;local aa,ab,ac=b.BossMods:GetTimer(363130)if aa<=1 and aa>0 and ab~=0 then SynthesizeExpire=ab+20 end;if f("boss1"):IsCasting(i(363130))then SynthesizeExpire=GetTime()+f("boss1"):CastRemains()+20 end;if f("boss1"):IsChanneling(i(363130))then SynthesizeExpire=GetTime()+f("boss1"):ChannelRemains()end;if aa>10 and aa<25 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif f("boss1"):IsChanneling(i(363130))and f("boss1"):ChannelRemains()>10 and g:DebuffUp(i(363356))and aa~=0 then t=true elseif SynthesizeExpire and GetTime()>=SynthesizeExpire and GetTime()-1<SynthesizeExpire then v=true end elseif f("boss1"):NPCID()==180906 then local aa,ab,ac=b.BossMods:GetTimer(359236)if ac==2 then y=true end elseif f("boss1"):NPCID()==181954 then local aa,ab,ac=b.BossMods:GetTimer(361815)if aa<=1 and aa>0 and ab~=0 then HopeBreakerExpire=ab+2 end;if f("boss1"):IsCasting(i(361630))then HopeBreakerExpire=GetTime()+f("boss1"):CastRemains()end;if aa>13 and aa<28 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=13 and aa~=0 then t=true elseif HopeBreakerExpire and GetTime()>=HopeBreakerExpire and GetTime()-1<HopeBreakerExpire then v=true end;if aa<=20 and aa>i(197995):CastTime()+0.5 then w=true elseif HopeBreakerExpire and GetTime()+i(197995):CastTime()>=HopeBreakerExpire and GetTime()+i(197995):CastTime()-1<HopeBreakerExpire then x=true end;local aa,ab,ac=b.BossMods:GetTimer(365805)if aa<=1 and aa>0 and ab~=0 then EmpoweredHopeBreakerExpire=ab+2 end;if f("boss1"):IsCasting(i(365805))then EmpoweredHopeBreakerExpire=GetTime()+f("boss1"):CastRemains()end;if aa>13 and aa<28 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=13 and aa~=0 then t=true elseif EmpoweredHopeBreakerExpire and GetTime()>=EmpoweredHopeBreakerExpire and GetTime()-3<EmpoweredHopeBreakerExpire then v=true end;if aa<=20 and aa>i(197995):CastTime()+0.5 then w=true elseif EmpoweredHopeBreakerExpire and(aa>20 or aa==0)and GetTime()+i(197995):CastTime()>=EmpoweredHopeBreakerExpire and GetTime()+i(197995):CastTime()-5<EmpoweredHopeBreakerExpire then x=true end elseif f("boss1"):NPCID()==181398 or f("boss1"):NPCID()==181399 then local aa,ab,ac=b.BossMods:GetTimer(360300)local ad,ae,af=b.BossMods:GetTimer(360304)if aa<=1 and aa>0 and ab~=0 then SwarmExpire=ab+20 elseif ad<=1 and ad>0 and ae~=0 then SwarmExpire=ae+20 end;for ag=1,2 do if f("boss"..ag):IsCasting(360300)or f("boss"..ag):IsCasting(360304)then SwarmExpire=GetTime()+f("boss"..ag):CastRemains()+20 end end;if SwarmExpire and GetTime()<SwarmExpire-20 and GetTime()+15>=SwarmExpire-20 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif SwarmExpire and GetTime()>=SwarmExpire-20 and aa~=0 then t=true elseif SwarmExpire and GetTime()-1<SwarmExpire-2 then v=true end elseif f("boss1"):NPCID()==180990 then local aa,ab,ac=b.BossMods:GetTimer(360281)if ac==3 then if aa<=1 and aa>0 and ab~=0 then RuneExpire=ab+8 end;local ah=nil;for ag=1,GetNumGroupMembers()do if f("raid"..ag):DebuffUp(i(360281))then if ah==nil or ah<f("raid"..ag):DebuffRemains(i(360281))then ah=f("raid"..ag):DebuffRemains(360281)RuneExpire=GetTime()+ah end end end;if aa>5 and aa<20 then if(i(157153):Charges()<2 or i(157153):Charges()==2 and aa<15)and aa~=0 then u=true end elseif aa<=5 and aa~=0 then t=true;if RuneExpire then end elseif RuneExpire and GetTime()>=RuneExpire and GetTime()-1<RuneExpire and S.RecallCloudburstTotem:IsReady()then v=true end end end;return t,v,u,w,x,y,z end;function b.SpecSelection()local ai,aj=IsAddOnLoaded("HeroRotation_Shaman")if ai==true and aj==true then local S=i.Shaman.Restoration;t=false;u=false;v=false;w=false;x=false;y=false;z=false end end;function b.RaidDamageInc()local z=false;local CoreShieldExpire=nil;local RelocationExpire=nil;local RaveningBurrowExpire=nil;local DustFlailExpire=nil;local RuneExpire=nil;local SwarmExpire=nil;local HopeBreakerExpire=nil;local CosmicShiftExpire=nil;local SynthesizeExpire=nil;local EmpoweredHopeBreakerExpire=nil;local DominionExpire=nil;b.SpecSelection()local a6,ak,al,am,an,ao,ap,aq,ar,as=GetInstanceInfo()if aq==2481 then t,v,u,w,x,y,z=b.Sepulcher()return t,v,u,w,x,y,z end end