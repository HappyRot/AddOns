local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Pet;local i=f.Target;local j=d.Spell;local k=d.MultiSpell;local l=d.Item;local m=HeroRotation;local n=m.Cast;local o=m.AoEON;local p=m.CDsON;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[6]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[12]local v=HeroRotationCharDB.Toggles[60]local UnitPower=UnitPower;local w=Enum.PowerType.Maelstrom;local x=j.Shaman.Elemental;local y=l.Shaman.Elemental;local z={}local A=g:GetEquipment()local B=l(0)local C=l(0)local D,E=GetInventoryItemID("player",13)local F,E=GetInventoryItemID("player",14)local G;local H,I,J,K;local L,M;local N;local O;local P=0;local Q=0;local R=0;local S=m.Commons.Everyone;local T=m.Commons.Shaman;local U={General=m.GUISettings.General,Commons=m.GUISettings.APL.Shaman.Commons,Elemental=m.GUISettings.APL.Shaman.Elemental}local V=g:HasLegendaryEquipped(131)local W=g:HasLegendaryEquipped(134)local X=g:HasLegendaryEquipped(135)local Y=g:HasLegendaryEquipped(136)local Z=g:HasLegendaryEquipped(137)local _=x.CallOfFlame:ConduitEnabled()d:RegisterForEvent(function()V=g:HasLegendaryEquipped(131)W=g:HasLegendaryEquipped(134)X=g:HasLegendaryEquipped(135)Y=g:HasLegendaryEquipped(136)Z=g:HasLegendaryEquipped(137)_=x.CallOfFlame:ConduitEnabled()end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()x.PrimordialWave:RegisterInFlightEffect(327162)x.PrimordialWave:RegisterInFlight()x.LavaBurst:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")x.PrimordialWave:RegisterInFlightEffect(327162)x.PrimordialWave:RegisterInFlight()x.LavaBurst:RegisterInFlight()local function a0(a1)if a1 then return 1 else return 0 end end;local function a2(a1)return a1~=0 end;local a3;local a4;local a5;local a6;local a7;local a8;local a9;local aa;local ab;local ac;local function ad()a3=0;a4=0;a5=0;a6=0;a7=0;aa={}a8=nil;a9=nil;local ae=999;local af=0;if o()then for E,ag in pairs(g:GetEnemiesInRange(40))do if ag:AffectingCombat()or ag:IsDummy()or ag:NPCID()==153285 then a3=a3+1;local ah=ag:DebuffRemains(x.FlameShockDebuff)if ah>0 then a5=a5+1 end;if ah<5 then a6=a6+1 end;if ah<ae then ae=ah;a9=ag end;if ah==0 and ag:Health()>af then af=ag:Health()a9=ag end;local ai=ag:GetEnemiesInSplashRange(10)local aj={}for E,ak in pairs(ai)do local al=false;for E,am in pairs(aj)do if ak:GUID()==am:GUID()then al=true;break end end;if not al then table.insert(aj,ak)end end;aa[ag]=aj;if#aj>a4 then a4=#aj;a8=ag end;if not ag:TimeToDieIsNotValid()and not ag:IsUserCycleBlacklisted()then a7=math.max(a7,ag:TimeToDie())end end end else a3=1;local ah=i:DebuffRemains(x.FlameShockDebuff)if ah>0 then a5=1 end;if ah<5 then a6=1 end;a9=i;a4=1;a8=i;if not i:TimeToDieIsNotValid()and not i:IsUserCycleBlacklisted()then a7=i:TimeToDie()end end end;local function an()ab=false;ac=false;local ao=h:IsActive()local ap=h:Name()if ao then if ap=="Primal Storm Elemental"then ab=true elseif ap=="Primal Fire Elemental"then ac=true end end end;local function aq(ar)if ar==nil then return nil end;local as=ar:IsCastable()and ar:IsReady()if ar==x.Stormkeeper or ar==x.ElementalBlast or ar==x.Icefury then local at=not g:IsMoving()or g:BuffUp(x.SpiritwalkersGraceBuff)return as and at and not g:IsCasting(ar)elseif ar==x.LightningBolt or ar==x.ChainLightning then local at=not g:IsMoving()or g:BuffUp(x.StormkeeperBuff)or g:BuffUp(x.SpiritwalkersGraceBuff)return as and at elseif ar==x.LavaBurst then local at=not g:IsMoving()or g:BuffUp(x.LavaSurgeBuff)or g:BuffUp(x.SpiritwalkersGraceBuff)local au=g:BuffUp(x.LavaSurgeBuff)local av=not g:IsCasting(x.LavaBurst)and x.LavaBurst:Charges()>=1;local aw=g:IsCasting(x.LavaBurst)and x.LavaBurst:Charges()==2;return as and at and(au or av or aw)elseif ar==x.PrimordialWave then return as and not g:BuffUp(x.PrimordialWaveBuff)and not g:BuffUp(x.LavaSurgeBuff)else return as end end;local function ax()local ay=UnitPower("player",w)if not g:IsCasting()then return ay else if g:IsCasting(x.ElementalBlast)then return ay+30 elseif g:IsCasting(x.Icefury)then return ay+25 elseif g:IsCasting(x.LightningBolt)then return ay+8 elseif g:IsCasting(x.LavaBurst)then return ay+10*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)elseif g:IsCasting(x.ChainLightning)then return ay+4*a3 else return ay end end end;local function az()if not x.MasterOfTheElements:IsAvailable()then return false end;local aA=g:BuffUp(x.MasterOfTheElementsBuff)if not g:IsCasting()then return aA else if g:IsCasting(x.LavaBurst)then return true elseif g:IsCasting(x.ElementalBlast)then return false elseif g:IsCasting(x.Icefury)then return false elseif g:IsCasting(x.LightningBolt)then return false elseif g:IsCasting(x.ChainLightning)then return false else return aA end end end;local function aB()if not x.Stormkeeper:IsAvailable()then return false end;local aC=g:BuffUp(x.StormkeeperBuff)if not g:IsCasting()then return aC else if g:IsCasting(x.Stormkeeper)then return true else return aC end end end;local function aD()if not x.Icefury:IsAvailable()then return false end;local aE=g:BuffUp(x.IcefuryBuff)if not g:IsCasting()then return aE else if g:IsCasting(x.Icefury)then return true else return aE end end end;local function aF()if g:BuffUp(x.EchoesofGreatSunderingBuff)then return x.Earthquake elseif Y and not g:BuffUp(x.EchoesofGreatSunderingBuff)then return x.EarthShock elseif a3>1 then return x.Earthquake else return x.EarthShock end end;local function aG()if aq(x.Fleshcraft)then if n(x.Fleshcraft,nil,nil)then Q=324631;return"Precombat Fleshcraft"end end;if aq(x.Stormkeeper)then if n(x.Stormkeeper,nil)then Q=191634;return"Precombat Stormkeeper"end end;if aq(x.ElementalBlast)then if n(x.ElementalBlast,nil,nil,not i:IsSpellInRange(x.ElementalBlast))then Q=117014;return"Precombat Elemental Blast"end end;if g:IsCasting(x.ElementalBlast)and aq(x.PrimordialWave)then if n(x.PrimordialWave,nil,nil,not i:IsSpellInRange(x.PrimordialWave))then Q=326059;return"Precombat Primwave"end end;if g:IsCasting(x.ElementalBlast)and not aq(x.PrimordialWave)and x.FlameShock:CooldownRemains()==0 then if n(x.FlameShock,nil,nil,not i:IsSpellInRange(x.FlameShock))then Q=188389;return"Precombat Flameshock"end end;if aq(x.LavaBurst)and not g:IsCasting(x.LavaBurst)and(not x.ElementalBlast:IsAvailable()or x.ElementalBlast:IsAvailable()and not aq(x.ElementalBlast))then if n(x.LavaBurst,nil,nil,not i:IsSpellInRange(x.LavaBurst))then Q=51505;return"Precombat Lavaburst"end end;if g:IsCasting(x.LavaBurst)and x.FlameShock:CooldownRemains()==0 then if n(x.FlameShock,nil,nil,not i:IsSpellInRange(x.FlameShock))then Q=188389;return"Precombat Flameshock"end end;if g:IsCasting(x.LavaBurst)and aq(x.PrimordialWave)then if n(x.PrimordialWave,nil,nil,not i:IsSpellInRange(x.PrimordialWave))then Q=326059;return"Precombat Primwave"end end end;local function aH()if(U.Commons.Enabled.TopTrinket or U.Commons.Enabled.BottomTrinket)and p()then local aI=g:GetUseableTrinkets(z)if aI then if n(aI,nil,nil)then if aI:ID()==D and U.Commons.Enabled.TopTrinket then Q=24;return"top trinket 1"elseif aI:ID()==F and U.Commons.Enabled.BottomTrinket then Q=30;return"Bot trinket 2"end end end end;if aq(x.ChainHarvest)then if n(x.ChainHarvest,nil,nil)then Q=320674;return"Chain Harvest CD"end end;if aq(x.FaeTransfusion)then if n(x.FaeTransfusion,nil,nil)then Q=328923;return"Fae Transfusion CD"end end;if aq(x.Stormkeeper)then if n(x.Stormkeeper,nil)then Q=191634;return"Stormkeeper CD"end end;if aq(x.EchoingShock)then if n(x.EchoingShock,nil)then Q=320125;return"Echoing Shock CD"end end;if aq(x.LiquidMagmaTotem)then if n(x.LiquidMagmaTotem,nil)then Q=192222;return"Liquid Magma Totem CD"end end;if aq(x.FireElemental)then if n(x.FireElemental,nil)then Q=198067;return"Fire Elemental CD"end end;if aq(x.StormElemental)then if n(x.StormElemental,nil)then Q=192249;return"Storm Elemental CD"end end;if ac and x.Meteor:CooldownRemains()==0 then if n(x.Meteor,nil,nil)then Q=117588;return"Meteor CD"end end;if ab and h:BuffUp(x.CallLightningBuff)and not h:IsChanneling(x.EyeOfTheStorm)and x.EyeOfTheStorm:CooldownRemains()==0 then if n(x.EyeOfTheStorm,nil,nil)then Q=157375;return"Eye of the Storm CD"end end end;local function aJ()if W then return math.min(4,a3)end;if ab then return 0 end;if a3==1 then return math.min(3,a3)end;if(a3==2 or a3==3)and(a3==2 or a3==3)then return math.min(3,a3)end;if a3>=4 then return math.max(a0(x.MasterOfTheElements:IsAvailable()),0)end;return 1 end;local function aK()local aL=nil;if aq(x.PrimordialWave)then aL=x.PrimordialWave elseif x.FlameShock:CooldownRemains()==0 then aL=x.FlameShock end;if aL==nil or a9==nil then return nil end;if a9:GUID()==i:GUID()and a9:TimeToDie()>=15 then if g:IsCasting(x.PrimordialWave)or x.PrimordialWave:InFlight()then return nil end;if n(aL,nil,nil,not i:IsInRange(40))then if aL==x.PrimordialWave then Q=326059;return"main-target "..aL.SpellName end;if aL==x.FlameShock then Q=188389;return"main-target "..aL.SpellName end end else if aL==x.PrimordialWave then if a9:GUID()==f("mouseover"):GUID()then P=1326059;if m.CastLeftNameplate(a9,aL)then return"off-target "..aL.SpellName end elseif(a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285)and U.Elemental.TargetSwap=="AutoSwap"and a9:GUID()~=i:GUID()and not u then P=999;if m.CastLeftNameplate(a9,aL)then return"off-target "..aL.SpellName end elseif(a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285)and a9:GUID()==i:GUID()then Q=326059;if m.CastLeftNameplate(a9,aL)then Q=326059;return"off-target "..aL.SpellName end elseif a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285 then if m.CastLeftNameplate(a9,aL)then return"off-target "..aL.SpellName end end elseif aL==x.FlameShock and a9:TimeToDie()>=15 then if a9:GUID()==f("mouseover"):GUID()then P=1188389;if m.CastLeftNameplate(a9,aL)then P=1188389;return"off-target "..aL.SpellName end elseif(a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285)and U.Elemental.TargetSwap=="AutoSwap"and a9:GUID()~=i:GUID()and not u then P=999;if m.CastLeftNameplate(a9,aL)then P=999;return"off-target "..aL.SpellName end elseif(a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285)and a9:GUID()==i:GUID()then Q=188389;if m.CastLeftNameplate(a9,aL)then Q=188389;return"off-target "..aL.SpellName end elseif a9:AffectingCombat()or a9:IsDummy()or a9:NPCID()==153285 then if m.CastLeftNameplate(a9,aL)then return"off-target "..aL.SpellName end end end end;return nil end;local function aM()local aN=math.min(a3,20)if g:BuffUp(x.EchoesofGreatSunderingBuff)and ax()>=60 then if n(x.Earthquake)then return"MOTE EOGS"end end;local aO=aF()if aN>=4 and ax()>=90 then if n(aO)then if aO==x.LavaBurst then Q=51505;return"Spending Maelstrom despite MOTE because Builder will overcap (AOE)"end;if aO==x.ElementalBlast then Q=117014;return"Spending Maelstrom despite MOTE because Builder will overcap (AOE)"end;if aO==x.FrostShock then Q=196840;return"Spending Maelstrom despite MOTE because Builder will overcap (AOE)"end;if aO==x.Icefury then Q=210714;return"Spending Maelstrom despite MOTE because Builder will overcap (AOE)"end;if aO==x.ChainLightning then Q=188443;return"Spending Maelstrom despite MOTE because Builder will overcap (AOE)"end end end;local aP=10*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)if aN<=2 and x.LavaBurst:ChargesFractional()>=2.0 and aq(x.LavaBurst)and g:BuffUp(x.LavaSurgeBuff)and(ax()+aP<=100 or Z)then if n(x.LavaBurst)then Q=51505;return"Lavaburst special case 1"end end;if aN<=2 and Z and x.LavaBurst:ChargesFractional()>=1.0 and aq(x.LavaBurst)and ax()>=60 and ax()+aP<=100 then if n(x.LavaBurst)then Q=51505;return"Lavaburst special case 2"end end;if aN>=8 and ax()>=60 and aO==x.Earthquake then if n(x.Earthquake)then Q=61882;return"MOTE 8t+ EQ"end elseif aN>=5 and aB()then if n(x.ChainLightning)then Q=188443;return"MOTE 5t+ SK CL"end elseif aN>=5 and ax()>=60 and aO==x.Earthquake then if n(x.Earthquake)then Q=61882;return"MOTE 5-7t EQ"end elseif aN>=4 and aB()then if n(x.ChainLightning)then Q=188443;return"MOTE 4t SK CL"end elseif aN>=3 and ax()>=60 and aO==x.Earthquake then if n(x.Earthquake)then Q=61882;return"MOTE 3-4t EQ"end elseif aN>=3 and aB()then if n(x.ChainLightning)then Q=188443;return"MOTE 3t SK CL"end elseif aN>=2 and ax()>=60 and aO==x.Earthquake then if n(x.Earthquake)then rshouldcast=61882;eturn"MOTE 2t EQ"end elseif aN>=5 then if n(x.ChainLightning)then Q=188443;return"MOTE 5t CL"end elseif aN>=1 and aB()then if n(x.LightningBolt)then Q=188196;return"MOTE 1t SK LB"end elseif aN>=2 and aB()then if n(x.ChainLightning)then Q=188443;return"MOTE 2t SK CL"end elseif aN>=4 then if n(x.ChainLightning)then Q=188443;return"MOTE 4t CL"end elseif aN>=1 and ax()>=60 and aO==x.EarthShock then if n(x.EarthShock)then Q=8042;return"MOTE ES"end elseif aN>=3 then if n(x.ChainLightning)then Q=188443;return"MOTE 3t CL"end elseif aD()then if n(x.FrostShock)then Q=196840;return"MOTE Frost Shock"end elseif aq(x.ElementalBlast)then if n(x.ElementalBlast)then Q=117014;return"MOTE EleBlast"end elseif aq(x.Icefury)then if n(x.Icefury)then Q=210714;return"MOTE Icefury"end elseif a6>0 then local aQ=aK()if aQ then return"Even with MOTE up, correct move is probably to refresh flameshocks."end elseif aN>=2 then if n(x.ChainLightning)then Q=188443;return"MOTE 2t CL"end elseif aq(x.LightningBolt)then if n(x.LightningBolt)then Q=188196;return"MOTE LB"end end;return nil end;local function aR()local aP=10*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)local aS=14*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)if aq(x.LavaBurst)and g:BuffUp(x.PrimordialWaveBuff)then return x.LavaBurst,false,aS elseif aq(x.LightningBolt)and ab then return x.LightningBolt,false,11 elseif ax()+aP>=60 and g:BuffUp(x.LavaSurgeBuff)and x.MasterOfTheElements:IsAvailable()and not az()then return x.LavaBurst,false,8 elseif g:BuffUp(x.LavaSurgeBuff)and x.LavaBurst:ChargesFractional()>=1.25 then return x.LavaBurst,false,aS elseif aq(x.ElementalBlast)then return x.ElementalBlast,false,45 elseif g:BuffUp(x.LavaSurgeBuff)then return x.LavaBurst,false,aS elseif aq(x.Icefury)then return x.Icefury,false,37 elseif aq(x.LavaBurst)then return x.LavaBurst,false,aS elseif aD()then return x.FrostShock,false,8 elseif aq(x.LightningBolt)then return x.LightningBolt,true,11 end;return nil,false,0 end;local function aT()local aP=10*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)local aS=14*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)local aN=a4;local aU=4*aN+3*aN*aN;if aq(x.LavaBurst)and a5>=3 and g:BuffUp(x.PrimordialWaveBuff)then return x.LavaBurst,false,aS elseif aq(x.ChainLightning)and ab then return x.ChainLightning,false,aU elseif ax()+aP>=60 and g:BuffUp(x.LavaSurgeBuff)and aF()==x.Earthquake and x.MasterOfTheElements:IsAvailable()and not az()then return x.LavaBurst,false,0 elseif g:BuffUp(x.LavaSurgeBuff)and x.LavaBurst:ChargesFractional()>=1.5 then return x.LavaBurst,false,aS elseif aq(x.ElementalBlast)then return x.ElementalBlast,false,45 elseif g:BuffUp(x.LavaSurgeBuff)then return x.LavaBurst,false,aS elseif aq(x.LavaBurst)then return x.LavaBurst,false,aS elseif aD()then return x.FrostShock,false,8 elseif aq(x.Icefury)then return x.Icefury,false,37 elseif aq(x.ChainLightning)then return x.ChainLightning,true,aU end;return nil,false,0 end;local function aV()local aP=10*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)local aS=14*(1+a0(g:BuffUp(x.PrimordialWaveBuff))*a5)local aN=a4;local aU=4*aN+3*aN*aN;if aq(x.LavaBurst)and a5>=3 and g:BuffUp(x.PrimordialWaveBuff)then return x.LavaBurst,false,aS elseif aq(x.ChainLightning)and ab then return x.ChainLightning,false,aU elseif ax()+aP>=60 and g:BuffUp(x.LavaSurgeBuff)and aF()==x.Earthquake and x.MasterOfTheElements:IsAvailable()and not az()then return x.LavaBurst,false,0 elseif aq(x.ChainLightning)then return x.ChainLightning,false,aU elseif aq(x.LavaBurst)then return x.LavaBurst,true,aS end;return nil,false,0 end;local function aW()local aQ;if a5<aJ()then aQ=aK()if aQ then return aQ end end;if az()then aQ=aM()if aQ then return aQ end end;local aX,aY,aZ=nil,false,0;if o()then a4=i:GetEnemiesInSplashRangeCount(40)end;if a3==1 then aX,aY,aZ=aR()end;if(a3==2 or a3==3)and(a3==2 or a3==3)then aX,aY,aZ=aT()end;if a3>=4 and a3>=2 then aX,aY,aZ=aV()end;local a_=aY and a6>0 and a5<=aJ()local b0=a3==1 and x.PrimordialWave:IsAvailable()and aq(x.PrimordialWave)and not ab;if a_ or b0 then aQ=aK()if aQ then return aQ end end;local aO=nil;aO=aF()if ax()+aZ>100 and ax()>=60 then if n(aO)then if aO==x.LavaBurst then Q=51505;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.ElementalBlast then Q=117014;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.FrostShock then Q=196840;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.Icefury then Q=210714;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.ChainLightning then Q=188443;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.EarthShock then Q=8042;return"Spending Maelstrom because the best builder would overcap."end;if aO==x.Earthquake then Q=61882;return"Spending Maelstrom because the best builder would overcap."end end end;if aX~=nil and aq(aX)then if n(aX)then if aX==x.LavaBurst then Q=51505;return"Building Maelstrom with optimal Builder (AOE)"end;if aX==x.ElementalBlast then Q=117014;return"Building Maelstrom with optimal Builder (AOE)"end;if aX==x.FrostShock then Q=196840;return"Building Maelstrom with optimal Builder (AOE)"end;if aX==x.Icefury then Q=210714;return"Building Maelstrom with optimal Builder (AOE)"end;if aX==x.LightningBolt then Q=188196;return"Building Maelstrom with optimal Builder (AOE)"end;if aX==x.ChainLightning then Q=188443;return"Building Maelstrom with optimal Builder (AOE)"end end end;if aX==nil then if ax()>=60 then if n(aO)then if aO==x.LavaBurst then Q=51505;return"Spending Maelstrom because we cannot build"end;if aO==x.ElementalBlast then Q=117014;return"Spending Maelstrom because we cannot build"end;if aO==x.FrostShock then Q=196840;return"Spending Maelstrom because we cannot build"end;if aO==x.Icefury then Q=210714;return"Spending Maelstrom because we cannot build"end;if aO==x.ChainLightning then Q=188443;return"Spending Maelstrom because we cannot build"end;if aO==x.EarthShock then Q=8042;return"Spending Maelstrom because the best builder would overcap."end end end;aQ=aK()if aQ then return"Refreshing Flame Shock because we cannot build or spend"end;if n(x.FrostShock)then Q=196840;return"Casting Frost Shock because we cannot build or spend or refresh flame shock"end end;return nil end;local function b1()s=HeroRotationCharDB.Toggles[6]q=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[5]u=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[60]end;local function b2()H=g:GetEnemiesInMeleeRange(8)I=g:GetEnemiesInRange(30)J=g:GetEnemiesInRange(40)K=i:GetEnemiesInSplashRange(40)D,E=GetInventoryItemID("player",13)F,E=GetInventoryItemID("player",14)if o()then L=i:GetEnemiesInSplashRangeCount(8)M=i:GetEnemiesInSplashRangeCount(40)a4=i:GetEnemiesInSplashRangeCount(40)else L=1;M=1 end;if v then M=10;L=10 end;ad()an()if not BotOn then P=0;Q=0 end;if P>0 then P=0 end;if Q>0 then Q=0 end;G=b1()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;local aQ;if U.Elemental.PreferEarthShield and x.EarthShield:IsCastable()and(g:BuffDown(x.EarthShield)or not g:AffectingCombat()and g:BuffStack(x.EarthShield)<5)then if n(x.EarthShield,nil)then Q=974;return"Earth Shield Refresh"end elseif x.LightningShield:IsCastable()and g:BuffDown(x.LightningShield)and(U.Elemental.PreferEarthShield and g:BuffDown(x.EarthShield)or not U.Elemental.PreferEarthShield)then if n(x.LightningShield,nil)then Q=192106;return"Lightning Shield Refresh"end end;if not g:AffectingCombat()and S.TargetIsValid()and s then aQ=aG()if aQ then return aQ end end;if S.TargetIsValid()and g:AffectingCombat()and(i:AffectingCombat()or i:IsDummy()or i:NPCID()==153285 or i:NPCID()==168326 or i:NPCID()==176581 or i:NPCID()==176920)and not g:IsDeadOrGhost()then aQ=aH()if aQ then return aQ end;aQ=aW()if aQ then return aQ end;m.CastAnnotated(x.Pool,false,"ERR")end end;local function b3()end;function ReturnSpell1()if Q==0 then return 0 else return Q end end;function ReturnSpellMO1()if P==0 then return 0 else return P end end;m.SetAPL(262,b2,b3)