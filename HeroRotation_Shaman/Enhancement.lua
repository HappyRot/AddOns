local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.AoEON;local o=l.CDsON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[6]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[12]local u=HeroRotationCharDB.Toggles[60]local v=HeroRotationCharDB.Toggles[90]local w=HeroRotationCharDB.Toggles[91]local x=HeroRotationCharDB.Toggles[92]local y=HeroRotationCharDB.Toggles[93]local z=HeroRotationCharDB.Toggles[94]local A=HeroRotationCharDB.Toggles[96]local B=HeroRotationCharDB.Toggles[95]local C=HeroRotationCharDB.Toggles[97]local D=0;local GetWeaponEnchantInfo=GetWeaponEnchantInfo;local E=math.max;local F=math.min;local G=string.match;local H=i.Shaman.Enhancement;local I=k.Shaman.Enhancement;local J={I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}local K=g:GetEquipment()local L=k(0)local M=k(0)local N,O=GetInventoryItemID("player",13)local P,O=GetInventoryItemID("player",14)local Q;local R,S;local T,U;local V;local W=10;local X=8;local Y=6;local Z=1000;local _,a0;local a1=H.LavaBurst:IsAvailable()and 2 or 1;local a2=H.LightningBolt;local a3=11111;local a4=11111;d:RegisterForEvent(function()a1=H.LavaBurst:IsAvailable()and 2 or 1 end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")d:RegisterForEvent(function()a2=H.LightningBolt;a3=11111;a4=11111 end,"PLAYER_REGEN_ENABLED")local a4;local a5=0;local a6=0;local a7=0;local a8=0;local a9=0;local aa=l.Commons.Everyone;local ab={General=l.GUISettings.General,Commons=l.GUISettings.APL.Shaman.Commons,Enhancement=l.GUISettings.APL.Shaman.Enhancement}local function ac()for ad=1,6,1 do if G(g:TotemName(ad),'Totem')then return ad end end end;local ae=g:HasLegendaryEquipped(132)local af=g:HasLegendaryEquipped(138)local ag=g:HasLegendaryEquipped(141)local ah=g:HasLegendaryEquipped(246)or g:HasUnity()and H.FaeTransfusion:IsAvailable()d:RegisterForEvent(function()ae=g:HasLegendaryEquipped(132)af=g:HasLegendaryEquipped(138)ag=g:HasLegendaryEquipped(141)ah=g:HasLegendaryEquipped(246)or g:HasUnity()and H.FaeTransfusion:IsAvailable()end,"PLAYER_EQUIPMENT_CHANGED")local ai=g:CovenantID()d:RegisterForEvent(function()ai=g:CovenantID()end,"COVENANT_CHOSEN")local function aj(ak)if ak then return 1 else return 0 end end;local function al(ak)return ak~=0 end;local function am()for ad=1,6,1 do if string.match(g:TotemName(ad),'Totem')then return ad end end end;local function an()if not H.AlphaWolf:IsAvailable()or g:BuffDown(H.FeralSpiritBuff)then return 0 end;local ao=F(H.CrashLightning:TimeSinceLastCast(),H.ChainLightning:TimeSinceLastCast())if ao>8 or ao>H.FeralSpirit:TimeSinceLastCast()then return 0 end;return 8-ao end;local function ap(aq,ar)local as=0;if l.AoEON()then for O,at in pairs(ar)do if at:DebuffUp(aq)then as=as+1;a5=as end end end end;local function au(av)if(av:DebuffRefreshable(H.FlameShockDebuff)or av:DebuffDown(H.FlameShockDebuff))and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==f("mouseover"):GUID()then a7=1188389;return true elseif(av:DebuffRefreshable(H.FlameShockDebuff)or av:DebuffDown(H.FlameShockDebuff))and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and ab.Enhancement.TargetSwap=="AutoSwap"and av:GUID()~=h:GUID()and not t then a7=999;return true elseif(av:DebuffRefreshable(H.FlameShockDebuff)or av:DebuffDown(H.FlameShockDebuff))and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==h:GUID()then a8=188389;return true elseif(av:DebuffRefreshable(H.FlameShockDebuff)or av:DebuffDown(H.FlameShockDebuff))and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)then return true end end;local function aw(av)if av:DebuffRefreshable(H.LashingFlamesDebuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==f("mouseover"):GUID()then a7=160103;return true elseif av:DebuffRefreshable(H.LashingFlamesDebuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and ab.Enhancement.TargetSwap=="AutoSwap"and av:GUID()~=h:GUID()and not t then a7=999;return true elseif av:DebuffRefreshable(H.LashingFlamesDebuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==h:GUID()then a8=60103;return true elseif av:DebuffRefreshable(H.LashingFlamesDebuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)then return true end end;local function ax(av)return av:DebuffRemains(H.FlameShockDebuff)end;local function ay(av)if g:BuffDown(H.PrimordialWaveBuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==f("mouseover"):GUID()then a7=1326059;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and ab.Enhancement.TargetSwap=="AutoSwap"and av:GUID()~=h:GUID()and not t then a7=999;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==h:GUID()then a8=326059;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)then return true end end;local function az(av)return av:DebuffRemains(H.LashingFlamesDebuff)end;local function aA(av)if H.LashingFlames:IsAvailable()and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==f("mouseover"):GUID()then a7=160103;return true elseif H.LashingFlames:IsAvailable()and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and ab.Enhancement.TargetSwap=="AutoSwap"and av:GUID()~=h:GUID()and not t then a7=999;return true elseif H.LashingFlames:IsAvailable()and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==h:GUID()then a8=60103;return true elseif H.LashingFlames:IsAvailable()and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)then return true end end;local function aB(av)if av:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<a0 and H.FlameShockDebuff:AuraActiveCount()<6)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==f("mouseover"):GUID()then a7=160103;return true elseif av:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<a0 and H.FlameShockDebuff:AuraActiveCount()<6)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and ab.Enhancement.TargetSwap=="AutoSwap"and av:GUID()~=h:GUID()and not t then a7=999;return true elseif av:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<a0 and H.FlameShockDebuff:AuraActiveCount()<6)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)and av:GUID()==h:GUID()then a8=60103;return true elseif av:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<a0 and H.FlameShockDebuff:AuraActiveCount()<6)and(av:AffectingCombat()or av:IsDummy()or av:NPCID()==153285 or av:NPCID()==168326 or UnitExists("boss1"))and av:IsInMeleeRange(8)then return true end end;local function aC()if H.Stormkeeper:IsCastable()and not g:IsMoving()then if m(H.Stormkeeper)then a8=191634;return"Stormkeeper precombat"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem precombat"end end;if H.Fleshcraft:IsCastable()and p and(H.PustuleEruption:SoulbindEnabled()or H.VolatileSolvent:SoulbindEnabled())then if m(H.Fleshcraft,nil,nil)then a8=324631;return"fleshcraft precombat 6"end end end;local function aD()if H.PrimordialWave:IsReady()and o()and(h:DebuffUp(H.FlameShockDebuff)and H.LashingFlames:IsAvailable())then if m(H.PrimordialWave,nil,nil,not h:IsSpellInRange(H.PrimordialWave))then a8=326059;return"primordial_wave single 6"end end;if H.FlameShock:IsReady()and(h:DebuffDown(H.FlameShockDebuff)and H.LashingFlames:IsAvailable())then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock single 4"end end;if H.ElementalBlast:IsReady()and(V>=5 and H.ElementalSpirits:IsAvailable()and Shaman.FeralSpiritCount>=4)then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast single 6"end end;if H.Sundering:IsReady()and o()and g:HasTier(30,2)and q then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering single 8"end end;if H.LightningBolt:IsCastable()and(V>=5 and g:BuffDown(H.CracklingThunderBuff)and g:BuffUp(H.AscendanceBuff)and a2==H.ChainLightning and g:BuffRemains(H.AscendanceBuff)>H.Windstrike:CooldownRemains()+g:GCD())then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt single 10"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.DoomWindsBuff)or H.DeeplyRootedElements:IsAvailable()or H.Stormblast:IsAvailable()and g:BuffUp(H.StormbringerBuff))then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike single 14"end end;if H.LavaLash:IsReady()and g:BuffUp(H.HotHandBuff)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash single 16"end end;if H.WindfuryTotem:IsReady()and g:BuffDown(H.WindfuryTotemBuff,true)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem single 18"end end;if H.ElementalBlast:IsReady()and(V>=5 and H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges())then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast single 20"end end;if H.LightningBolt:IsCastable()and(V>=8 and g:BuffUp(H.PrimordialWaveBuff)and(g:BuffDown(H.SplinteredElementsBuff)or a4<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt single 22"end end;if H.ChainLightning:IsReady()and(V>=8 and g:BuffUp(H.CracklingThunderBuff)and H.ElementalSpirits:IsAvailable())then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then a8=188196;return"chain_lightning single 24"end end;if H.ElementalBlast:IsReady()and(V>=8 and(Shaman.FeralSpiritCount>=2 or not H.ElementalSpirits:IsAvailable()))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast single 26"end end;if H.LavaBurst:IsReady()and(not H.ThorimsInvocation:IsAvailable()and V>=5)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then a8=51505;return"lava_burst single 28"end end;if H.LightningBolt:IsCastable()and((V>=8 or H.StaticAccumulation:IsAvailable()and V>=5)and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt single 30"end end;if H.CrashLightning:IsReady()and(H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and an()==0)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning single 36"end end;if H.PrimordialWave:IsReady()and o()then if m(H.PrimordialWave,nil,nil,not h:IsSpellInRange(H.PrimordialWave))then a8=326059;return"primordial_wave single 38"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock single 40"end end;if H.IceStrike:IsReady()and(H.ElementalAssault:IsAvailable()and H.SwirlingMaelstrom:IsAvailable())then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike single 36"end end;if H.LavaLash:IsCastable()and H.LashingFlames:IsAvailable()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then return"lava_lash single 38"end end;if H.IceStrike:IsReady()and g:BuffDown(H.IceStrikeBuff)then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike single 44"end end;if H.FrostShock:IsReady()and g:BuffUp(H.HailstormBuff)then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock single 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash single 48"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike single 50"end end;if H.Windstrike:IsCastable()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then a8=115356;return"windstrike single 52"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike single 54"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering single 56"end end;if H.BagofTricks:IsCastable()and o()then if m(H.BagofTricks,nil,nil,not h:IsSpellInRange(H.BagofTricks))then a8=312411;return"bag_of_tricks single 58"end end;if H.FireNova:IsReady()and(H.SwirlingMaelstrom:IsAvailable()and H.FlameShockDebuff:AuraActiveCount()>0 and V<W)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=333975;return"fire_nova single 60"end end;if H.LightningBolt:IsCastable()and(H.Hailstorm:IsAvailable()and V>=5 and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt single 62"end end;if H.FrostShock:IsReady()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock single 64"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,ab.Enhancement.GCDasOffGCD.CrashLightning,nil,not h:IsInMeleeRange(8))then return"crash_lightning single 66"end end;if H.FireNova:IsReady()and h:DebuffUp(H.FlameShockDebuff)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=333975;return"fire_nova single 68"end end;if H.EarthElemental:IsCastable()then if m(H.EarthElemental,nil)then a8=198103;return"earth_elemental single 70"end end;if H.FlameShock:IsReady()then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock single 72"end end;if H.ChainLightning:IsReady()and(V>=5 and g:BuffUp(H.CracklingThunderBuff)and H.ElementalSpirits:IsAvailable())then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then a8=187874;return"chain_lightning single 70"end end;if H.LightningBolt:IsCastable()and(V>=5 and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt single 74"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem single 76"end end end;local function aE()if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and(H.UnrulyWinds:IsAvailable()and EnemiesMeleeCount>=10 or EnemiesMeleeCount>=15))then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning aoe 2"end end;if H.LightningBolt:IsCastable()and((H.FlameShockDebuff:AuraActiveCount()==EnemiesMeleeCount or H.FlameShockDebuff:AuraActiveCount()>=6)and g:BuffUp(H.PrimordialWaveBuff)and V==W and(g:BuffDown(H.SplinteredElementsBuff)or a4<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt aoe 4"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and(H.PrimordialWave:IsAvailable()or H.FireNova:IsAvailable())and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<EnemiesMeleeCount and H.FlameShockDebuff:AuraActiveCount()<6)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash aoe 6"end end;if H.PrimordialWave:IsReady()and o()and g:BuffDown(H.PrimordialWaveBuff)then if aa.CastTargetIf(H.PrimordialWave,_,"min",ax,ay,nil,not h:IsSpellInRange(H.PrimordialWave),ab.Commons.DisplayStyle.Signature)then a8=326059;return"primordial_wave aoe 8"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==a1 or Shaman.FeralSpiritCount>=2))and V==W and(not H.CrashingStorms:IsAvailable()or EnemiesMeleeCount<=3))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast aoe 10"end end;if H.ChainLightning:IsReady()and V==W then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then a8=188196;return"chain_lightning aoe 14"end end;if H.CrashLightning:IsReady()and(g:BuffUp(H.DoomWindsBuff)or g:BuffDown(H.CrashLightningBuff)or H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and an()==0)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning aoe 16"end end;if H.Sundering:IsReady()and o()and(g:BuffUp(H.DoomWindsBuff)or g:HasTier(30,2))then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering aoe 18"end end;if H.FireNova:IsReady()and(H.FlameShockDebuff:AuraActiveCount()==6 or H.FlameShockDebuff:AuraActiveCount()>=4 and H.FlameShockDebuff:AuraActiveCount()>=EnemiesMeleeCount)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=333975;return"fire_nova aoe 20"end end;if H.LavaLash:IsReady()and H.LashingFlames:IsAvailable()then if aa.CastTargetIf(H.LavaLash,_,"min",az,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash aoe 22"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<EnemiesMeleeCount and H.FlameShockDebuff:AuraActiveCount()<6 or H.AshenCatalyst:IsAvailable()and g:BuffStack(H.AshenCatalystBuff)==X)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash aoe 24"end end;if H.IceStrike:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffDown(H.IceStrikeBuff))then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike aoe 26"end end;if H.FrostShock:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffUp(H.HailstormBuff))then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock aoe 28"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering aoe 30"end end;if H.FlameShock:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffDown(H.FlameShockDebuff))then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock aoe 32"end end;if H.FlameShock:IsReady()and((H.FireNova:IsAvailable()or H.PrimordialWave:IsAvailable())and H.FlameShockDebuff:AuraActiveCount()<EnemiesMeleeCount and H.FlameShockDebuff:AuraActiveCount()<6)then if aa.CastCycle(H.FlameShock,_,au,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock aoe 34"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=3 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=60103;return"fire_nova aoe 36"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.CrashLightningBuff)and(H.DeeplyRootedElements:IsAvailable()or g:BuffStack(H.ConvergingStormsBuff)==6))then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike aoe 38"end end;if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and g:BuffUp(H.CLCrashLightningBuff)and EnemiesMeleeCount>=4)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning aoe 40"end end;if H.Windstrike:IsReady()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then a8=115356;return"windstrike aoe 42"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike aoe 44"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike aoe 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash aoe 48"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning aoe 50"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=2 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=60103;return"fire_nova aoe 52"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==a1 or Shaman.FeralSpiritCount>=2))and V>=5 and(not H.CrashingStorms:IsAvailable()or EnemiesMeleeCount<=3))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast aoe 54"end end;if H.ChainLightning:IsReady()and V>=5 then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then a8=188196;return"chain_lightning aoe 56"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem aoe 58"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock aoe 60"end end;if H.FrostShock:IsReady()and not H.Hailstorm:IsAvailable()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock aoe 62"end end end;local function aF()if H.LightningBolt:IsCastable()and((H.FlameShockDebuff:AuraActiveCount()>=EnemiesMeleeCount or H.FlameShockDebuff:AuraActiveCount()>=6)and g:BuffUp(H.PrimordialWaveBuff)and V==W and(g:BuffDown(H.SplinteredElementsBuff)or a4<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt funnel 2"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<EnemiesMeleeCount and H.FlameShockDebuff:AuraActiveCount()<6 or H.AshenCatalyst:IsAvailable()and g:BuffStack(H.AshenCatalystBuff)==X)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash funnel 4"end end;if H.PrimordialWave:IsReady()and o()and g:BuffDown(H.PrimordialWaveBuff)then if aa.CastTargetIf(H.PrimordialWave,_,"min",ax,nil,not h:IsSpellInRange(H.PrimordialWave))then a8=326059;return"primordial_wave funnel 6"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges()or g:BuffUp(H.FeralSpiritBuff)))and V==W)then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast funnel 8"end end;if H.Windstrike:IsCastable()and(H.ThorimsInvocation:IsAvailable()and V>1 or g:BuffStack(H.ConvergingStormsBuff)==Y)then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then a8=115356;return"windstrike funnel 10"end end;if H.Stormstrike:IsReady()and g:BuffStack(H.ConvergingStormsBuff)==Y then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike funnel 12"end end;if H.ChainLightning:IsReady()and(V==W and g:BuffUp(H.CracklingThunderBuff))then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then a8=188196;return"chain_lightning funnel 14"end end;if H.LavaBurst:IsReady()and(g:BuffStack(H.MoltenWeaponBuff)+aj(g:BuffUp(H.VolcanicStrengthBuff))>g:BuffStack(H.CracklingSurgeBuff)and V==W)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then a8=51505;return"lava_burst funnel 16"end end;if H.LightningBolt:IsCastable()and V==W then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt funnel 18"end end;if H.CrashLightning:IsReady()and(g:BuffUp(H.DoomWindsBuff)or g:BuffDown(H.CrashLightningBuff)or H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and an()==0 or H.ConvergingStorms:IsAvailable()and g:BuffStack(H.ConvergingStormsBuff)<Y)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning funnel 20"end end;if H.Sundering:IsReady()and o()and(g:BuffUp(H.DoomWindsBuff)or g:HasTier(30,2))then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering funnel 22"end end;if H.FireNova:IsReady()and(H.FlameShockDebuff:AuraActiveCount()>=6 or H.FlameShockDebuff:AuraActiveCount()>=4 and H.FlameShockDebuff:AuraActiveCount()>=EnemiesMeleeCount)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=60103;return"fire_nova funnel 24"end end;if H.IceStrike:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffDown(H.IceStrikeBuff))then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike funnel 26"end end;if H.FrostShock:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffUp(H.HailstormBuff))then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock funnel 28"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then a8=197214;return"sundering funnel 30"end end;if H.FlameShock:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffDown(H.FlameShockDebuff))then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock funnel 32"end end;if H.FlameShock:IsReady()and((H.FireNova:IsAvailable()or H.PrimordialWave:IsAvailable())and H.FlameShockDebuff:AuraActiveCount()<EnemiesMeleeCount and H.FlameShockDebuff:AuraActiveCount()<6)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock funnel 34"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=3 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=60103;return"fire_nova funnel 36"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.CrashLightningBuff)and H.DeeplyRootedElements:IsAvailable())then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike funnel 38"end end;if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and g:BuffUp(H.CLCrashLightningBuff)and EnemiesMeleeCount>=4)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning funnel 40"end end;if H.Windstrike:IsCastable()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then a8=115356;return"windstrike funnel 42"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then a8=17364;return"stormstrike funnel 44"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then a8=342240;return"ice_strike funnel 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then a8=60103;return"lava_lash funnel 48"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then a8=187874;return"crash_lightning funnel 50"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=2 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then a8=60103;return"fire_nova funnel 52"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges()or g:BuffUp(H.FeralSpiritBuff)))and V>=5)then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then a8=117014;return"elemental_blast funnel 54"end end;if H.LavaBurst:IsReady()and(g:BuffStack(H.MoltenWeaponBuff)+aj(g:BuffUp(H.VolcanicStrengthBuff))>g:BuffStack(H.CracklingSurgeBuff)and V>=5)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then a8=51505;return"lava_burst funnel 56"end end;if H.LightningBolt:IsCastable()and V>=5 then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then a8=188196;return"lightning_bolt funnel 58"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem funnel 60"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then a8=188389;return"flame_shock funnel 62"end end;if H.FrostShock:IsReady()and not H.Hailstorm:IsAvailable()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then a8=196840;return"frost_shock funnel 64"end end end;local function aG()r=HeroRotationCharDB.Toggles[6]p=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[5]t=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]u=HeroRotationCharDB.Toggles[60]o=l.CDsON;v=HeroRotationCharDB.Toggles[90]w=HeroRotationCharDB.Toggles[91]x=HeroRotationCharDB.Toggles[92]y=HeroRotationCharDB.Toggles[93]z=HeroRotationCharDB.Toggles[94]A=HeroRotationCharDB.Toggles[96]B=HeroRotationCharDB.Toggles[95]C=HeroRotationCharDB.Toggles[97]D=0;for ad=1,20 do if select(10,UnitDebuff("player",ad))==240447 then if select(6,UnitDebuff("player",ad))~=nil then D=select(6,UnitDebuff("player",ad))-GetTime()end end end;N=GetInventoryItemID("player",13)P=GetInventoryItemID("player",14)if not ab.Commons.Enabled.TopTrinket and not ab.Commons.Enabled.BotTrinket then J={N,P,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}elseif not ab.Commons.Enabled.TopTrinket and ab.Commons.Enabled.BotTrinket then J={N,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}elseif not ab.Commons.Enabled.BotTrinket and ab.Commons.Enabled.TopTrinket then J={P,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}end end;local function aH()if n()then EnemiesMelee=g:GetEnemiesInMeleeRange(5)EnemiesMeleeCount=#EnemiesMelee>0 and#EnemiesMelee or 1 else EnemiesMelee={}EnemiesMeleeCount=1 end;if aa.TargetIsValid()or g:AffectingCombat()then a3=d.BossFightRemains()a4=a3;if a4==11111 then a4=d.FightRemains(EnemiesMelee,false)end;V=g:BuffStack(H.MaelstromWeaponBuff)Z=F(H.FeralSpirit:CooldownRemains()/(1+1.5*H.WitchDoctorsAncestry:TalentRank())+1000*aj(not H.FeralSpirit:IsAvailable()),H.DoomWinds:CooldownRemains()+1000*aj(not H.DoomWinds:IsAvailable()),H.Ascendance:CooldownRemains()+1000*aj(not H.Ascendance:IsAvailable()))end;if not BotOn then a7=0;a8=0 end;if a7>0 then a7=0 end;if a8>0 then a8=0 end;Q=aG()if l.QueuedCast()then a8=l.QueuedCast()return"Custom Queue "..i(a8):ID()end;if g:IsChanneling(H.FaeTransfusion)then if l.CastAnnotated(H.Pool,false,"WAIT")then a8=99999;return"Pool During FaeTransfusion"end end;if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[5]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[5]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if ab.Enhancement.PreferEarthShield and H.EarthShield:IsCastable()and H.EarthShield:IsAvailable()and(g:BuffDown(H.EarthShield)or not g:AffectingCombat()and g:BuffStack(H.EarthShield)<5)then if m(H.EarthShield,nil)then a8=974;return"Earth Shield Refresh"end elseif H.LightningShield:IsCastable()and g:BuffDown(H.LightningShield)and(ab.Enhancement.PreferEarthShield and g:BuffDown(H.EarthShield)or not ab.Enhancement.PreferEarthShield)then if m(H.LightningShield,nil)then a8=192106;return"Lightning Shield Refresh"end end;if(not R or T<600000)and H.WindfuryWeapon:IsCastable()then if m(H.WindfuryWeapon)then a8=33757;return"WindfuryWeapon enchant"end end;if(not S or U<600000)and H.FlamentongueWeapon:IsCastable()then if m(H.FlamentongueWeapon)then a8=318038;return"FlamentongueWeapon enchant"end end;if not g:AffectingCombat()and aa.TargetIsValid()and r then local Q=aC()if Q then return Q end end;if g:IsChanneling()or g:IsChanneling(H.FaeTransfusion)then if m(H.Pool,nil)then a8=99999;return"Trinket Channel"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if H.FrostShock:IsCastable()then if m(H.FrostShock,nil)then a7=1196840;return"explosive MO FS"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if H.FrostShock:IsCastable()then if m(H.FrostShock,nil)then a8=196840;return"explosive  FS"end end end;if w and H.CapacitorTotem:IsUsableP()and H.CapacitorTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.CapacitorTotem,nil,nil,nil)then a8=1192058;return"queue CapacitorTotem"end elseif(not H.CapacitorTotem:IsUsableP()or H.CapacitorTotem:CooldownRemains(BypassRecovery)>0)and w then HeroRotationCharDB.Toggles[91]=not HeroRotationCharDB.Toggles[91]l.Print("Capacitor Totem Queue is now "..(HeroRotationCharDB.Toggles[91]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and H.HealingStreamTotem:IsUsableP()and H.HealingStreamTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.HealingStreamTotem,nil,nil,nil)then a8=5394;return"queue HealingStreamTotem"end elseif(not H.HealingStreamTotem:IsUsableP()or H.HealingStreamTotem:CooldownRemains(BypassRecovery)>0)and x then HeroRotationCharDB.Toggles[92]=not HeroRotationCharDB.Toggles[92]l.Print("Healing Stream Totem Queue is now "..(HeroRotationCharDB.Toggles[92]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and H.TremorTotem:IsUsableP()and H.TremorTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.TremorTotem,nil,nil,nil)then a8=8143;return"queue TremorTotem"end elseif(not H.TremorTotem:IsUsableP()or H.TremorTotem:CooldownRemains(BypassRecovery)>0)and y then HeroRotationCharDB.Toggles[93]=not HeroRotationCharDB.Toggles[93]l.Print("Tremor Totem Queue is now "..(HeroRotationCharDB.Toggles[93]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and H.WindRushTotem:IsUsableP()and H.WindRushTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.WindRushTotem,nil,nil,nil)then a8=192077;return"queue WindRushTotem"end elseif(not H.WindRushTotem:IsUsableP()or H.WindRushTotem:CooldownRemains(BypassRecovery)>0)and z then HeroRotationCharDB.Toggles[94]=not HeroRotationCharDB.Toggles[94]l.Print("Wind Rush Totem Queue is now "..(HeroRotationCharDB.Toggles[94]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and H.FaeTransfusion:IsUsableP()and H.FaeTransfusion:CooldownRemains(BypassRecovery)<=0 and H.FaeTransfusion:IsAvailable()then if m(H.FaeTransfusion,nil)then a8=328923;return"FaeTransfusion 1"end elseif(not H.FaeTransfusion:IsUsableP()or H.FaeTransfusion:CooldownRemains(BypassRecovery)>0 or not H.FaeTransfusion:IsAvailable())and A then HeroRotationCharDB.Toggles[96]=not HeroRotationCharDB.Toggles[96]l.Print("Fae Transfusion Queue is now"..(HeroRotationCharDB.Toggles[96]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and H.Hex:IsUsableP()and H.Hex:CooldownRemains(BypassRecovery)<=0 and UnitExists("mouseover")then if l.Cast(H.Hex,nil,nil,nil)then if UnitExists("mouseover")and f("mouseover"):IsInRange(40)then a7=151514;return"queue Hex MO"end end elseif(not H.Hex:IsUsableP()or H.Hex:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[95]=not HeroRotationCharDB.Toggles[95]l.Print("Hex Queue is now "..(HeroRotationCharDB.Toggles[95]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if not g:AffectingCombat()and aa.TargetIsValid()and r then local Q=aC()if Q then return Q end end;for ad=1,25 do local aI,O,O,aJ=UnitBuff("target",ad)if aJ~=nil and aJ=="Magic"then if H.Purge:IsCastable()and C and h:IsInRange(20)then if m(H.Purge,nil)then a8=370;return"Purge"end end end end;for ad=0,40 do local O,O,aK,aJ,O,O,O,O,O,aL=UnitDebuff("mouseover",ad)if H.CleanseSpirit:IsCastable()and UnitIsDead("mouseover")~=true and UnitCanAttack("player","mouseover")~=true and IsItemInRange(34471,"mouseover")and aJ=="Curse"then if m(H.CleanseSpirit,nil)then a7=151886;return"Cleanse Spirit MO"end end end;if aa.TargetIsValid()and(g:AffectingCombat()or r)and(h:AffectingCombat()or h:IsDummy()or h:NPCID()==153285 or h:NPCID()==168326 or h:NPCID()==176581 or h:NPCID()==176920 or h:NPCID()==177892 or h:NPCID()==182778 or h:NPCID()==185402 or h:NPCID()==183945 or h:NPCID()==182074 or h:NPCID()==184737 or h:NPCID()==179733 or h:NPCID()==115402 or h:NPCID()==115406 or h:NPCID()==115395 or UnitExists("boss1")or h:NPCID()==115388 or r)and not g:IsDeadOrGhost()then local aM=0;local aN=0;if GetNumGroupMembers()>0 then if UnitInParty("player")then for ad=1,GetNumGroupMembers()do if UnitExists("party"..ad)then aN=aN+UnitHealth("party"..ad)aM=aM+UnitHealthMax("party"..ad)end end end;if UnitInRaid("player")then for ad=1,GetNumGroupMembers()do if UnitExists("raid"..ad)then aN=aN+UnitHealth("raid"..ad)aM=aM+UnitHealthMax("raid"..ad)end end end elseif GetNumGroupMembers()==0 then aN=UnitHealth("player")aM=UnitHealthMax("player")end;if g:HealthPercentage()<ab.Enhancement.HealthstoneHP and I.Healthstone:IsReady()and I.Healthstone:CooldownRemains()<=0 then if m(I.Healthstone,nil)then a8=40;return"Healthstone HP"end end;if g:HealthPercentage()<ab.Enhancement.HealPotHP and I.CosmicHealPot:IsReady()and I.CosmicHealPot:CooldownRemains()<=0 then if m(I.CosmicHealPot,nil)then a8=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<ab.Enhancement.HealPotHP and I.HealPot:IsReady()and I.HealPot:CooldownRemains()<=0 then if m(I.HealPot,nil)then a8=41;return"HealPot HP"end end;if g:HealthPercentage()<ab.Enhancement.PhialHP and I.PhialofSerenity:IsReady()and I.PhialofSerenity:CooldownRemains()<=0 then if m(I.PhialofSerenity,nil)then a8=55;return"PhialofSerenity HP"end end;if aN/aM*100<=ab.Enhancement.FaeTransfusionHealHP and g:BuffUp(i(328933))then if m(H.FaeTransfusion,nil)then a8=328923;return"FaeTransfusion Heal"end end;if g:HealthPercentage()<ab.Enhancement.AstralShiftHP and H.AstralShift:IsAvailable()and H.AstralShift:IsReady()then if m(H.AstralShift)then a8=108271;return"AstralShift HP"end end;if g:HealthPercentage()<ab.Enhancement.HealingSurgeHP and H.HealingSurge:IsReady()and(not g:IsMoving()or g:BuffUp(H.MaelstromWeaponBuff))then if m(H.HealingSurge)then a8=8004;return"HealingSurge HP"end end;if UnitInParty("player")and ab.Enhancement.HealingSurgePartyHP>0 and g:BuffUp(H.MaelstromWeaponBuff)and H.HealingSurge:IsReady()then if UnitExists("party1")and not f("party1"):IsDeadOrGhost()and f("party1"):HealthPercentage()<ab.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then a8=18004;return"HealingSurge party 1 HP"end elseif UnitExists("party2")and not f("party2"):IsDeadOrGhost()and f("party2"):HealthPercentage()<ab.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then a8=28004;return"HealingSurge party 2 HP"end elseif UnitExists("party3")and not f("party3"):IsDeadOrGhost()and f("party3"):HealthPercentage()<ab.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then a8=38004;return"HealingSurge party 3 HP"end elseif UnitExists("party4")and not f("party4"):IsDeadOrGhost()and f("party4"):HealthPercentage()<ab.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then a8=48004;return"HealingSurge party 4 HP"end end end;if not h:IsInMeleeRange(10)and a0>0 and ab.Enhancement.TargetSwap=="AutoSwap"and not t then a7=999 end;if I.PotionofSpectralAgility:IsReady()and o()and ab.Commons.Enabled.Potions and s then if m(I.PotionofSpectralAgility,nil,nil)then a8=50;return"potion default 4"end end;if(ab.Commons.Enabled.TopTrinket or ab.Commons.Enabled.BottomTrinket)and o()and h:IsInMeleeRange(10)then if I.TheFirstSigil:IsEquippedAndReady()and(H.Ascendance:IsAvailable()and H.Ascendance:CooldownRemains()<10 or H.HotHand:IsAvailable()and g:BuffUp(H.MoltenWeaponBuff)or g:BuffUp(H.IcyEdgeBuff)or H.Stormflurry:IsAvailable()and g:BuffUp(H.CracklingSurgeBuff)or h:DebuffUp(H.EarthenSpike)or a0>1 or a4<30)then if m(I.TheFirstSigil,nil,nil)then if I.TheFirstSigil:ID()==N and ab.Commons.Enabled.TopTrinket then a8=24;return"top trinket 1"elseif I.TheFirstSigil:ID()==P and ab.Commons.Enabled.BottomTrinket then a8=30;return"Bot trinket 2"end end end;if I.CacheofAcquiredTreasures:IsEquippedAndReady()and(g:BuffUp(H.AcquiredSwordBuff)or a4<25)then if m(I.CacheofAcquiredTreasures,nil,nil)then if I.CacheofAcquiredTreasures:ID()==N and ab.Commons.Enabled.TopTrinket then a8=24;return"top trinket 1"elseif I.CacheofAcquiredTreasures:ID()==P and ab.Commons.Enabled.BottomTrinket then a8=30;return"Bot trinket 2"end end end;if I.ScarsofFraternalStrife:IsEquippedAndReady()and(g:BuffDown(H.ScarsofFraternalStrifeBuff4)or a4<31 or a0>1)then if m(I.ScarsofFraternalStrife,nil,nil)then if I.ScarsofFraternalStrife:ID()==N and ab.Commons.Enabled.TopTrinket then a8=24;return"top trinket 1"elseif I.ScarsofFraternalStrife:ID()==P and ab.Commons.Enabled.BottomTrinket then a8=30;return"Bot trinket 2"end end end;local aO=g:GetUseableTrinkets(J)if aO then if m(aO,nil,nil)then if aO:ID()==N and ab.Commons.Enabled.TopTrinket then a8=24;return"top trinket 1"elseif aO:ID()==P and ab.Commons.Enabled.BottomTrinket then a8=30;return"Bot trinket 2"end end end end;if o()and h:IsInMeleeRange(10)then if H.BloodFury:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a4%120<=15 or Z>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.BloodFury,nil)then a8=20572;return"Blood Fury 420"end end;if H.Berserking:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a4%180<=12 or Z>=180 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.Berserking,nil)then a8=26297;return"Berserking 422"end end;if H.AncestralCall:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a4%120<=15 or Z>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.AncestralCall,nil)then a8=274738;return"Ancestral Call 428"end end;if H.Fireblood:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a4%120<=8 or Z>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.Fireblood,nil)then a8=265221;return"Fireblood 426"end end;if H.BagofTricks:IsCastable()and h:IsInRange(8)and(not H.Ascendance:IsAvailable()or not g:BuffUp(H.AscendanceBuff))then if l.Cast(H.BagofTricks,nil,nil,not h:IsInRange(40))then a8=312411;return"Bag of Tricks 430"end end end;if H.FeralSpirit:IsCastable()and h:IsInRange(40)and o()then if m(H.FeralSpirit,nil)then a8=51533;return"feral_spirit default 6"end end;if H.FaeTransfusion:IsReady()and h:IsInMeleeRange(10)and not g:IsMoving()and p and((H.Ascendance:IsAvailable()or af)and(H.GroveInvigoration:IsAvailable()or H.FieldofBlossoms:IsAvailable()or a0==1))then if m(H.FaeTransfusion,nil,nil,not h:IsInRange(40))then a8=328923;return"fae_transfusion default 8"end end;if H.DoomWinds:IsCastable()and o()then if m(H.DoomWinds,nil,nil,not h:IsSpellInRange(H.DoomWinds))then a8=384352;return"doom_winds default 10"end end;if H.Ascendance:IsCastable()and o()and(h:DebuffUp(H.FlameShockDebuff)and(a2==H.LightningBolt and a0==1 or a2==H.ChainLightning and a0>1))and h:IsInMeleeRange(10)then if m(H.Ascendance,nil)then a8=114051;return"ascendance default 12"end end;if H.WindfuryTotem:IsReady()and h:IsInMeleeRange(15)and(af and g:BuffDown(H.DoomWindsBuff)and H.WindfuryTotem:TimeSinceLastCast()>60)then if m(H.WindfuryTotem,nil)then a8=8512;return"windfury_totem default 14"end end;if EnemiesMeleeCount==1 then local Q=aD()if Q then return Q end end;if n()and EnemiesMeleeCount>1 then if ab.Enhancement.Rotation=="Standard"then local Q=aE()if Q then return Q end else local Q=aF()if Q then return Q end end end;if l.CastAnnotated(H.Pool,false,"WAIT")then a8=9999;return"Wait/Pool Resources"end end end;local function aP()H.FlameShockDebuff:RegisterAuraTracking()SetCVar("autoSelfCast","1")if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell2()if a8==0 then return 0 else return a8 end end;function ReturnSpellMO2()if a7==0 then return 0 else return a7 end end;l.SetAPL(263,aH,aP)