local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.AoEON;local o=l.CDsON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[6]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[12]local u=HeroRotationCharDB.Toggles[60]local v=HeroRotationCharDB.Toggles[90]local w=HeroRotationCharDB.Toggles[91]local x=HeroRotationCharDB.Toggles[92]local y=HeroRotationCharDB.Toggles[93]local z=HeroRotationCharDB.Toggles[94]local A=HeroRotationCharDB.Toggles[96]local B=HeroRotationCharDB.Toggles[95]local C=HeroRotationCharDB.Toggles[97]local D=0;local GetWeaponEnchantInfo=GetWeaponEnchantInfo;local E=math.max;local F=math.min;local G=string.match;local H=i.Shaman.Enhancement;local I=k.Shaman.Enhancement;local J={I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}local K=g:GetEquipment()local L=k(0)local M=k(0)local N,O=GetInventoryItemID("player",13)local P,O=GetInventoryItemID("player",14)local Q;local R,S;local T,U;local V,W,X,Y,Z;local _;local a0=10;local a1=8;local a2=6;local a3=1000;local a4,a5;local a6=H.LavaBurst:IsAvailable()and 2 or 1;local a7=H.LightningBolt;local a8=11111;local a9=11111;d:RegisterForEvent(function()a6=H.LavaBurst:IsAvailable()and 2 or 1 end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")d:RegisterForEvent(function()a7=H.LightningBolt;a8=11111;a9=11111 end,"PLAYER_REGEN_ENABLED")local a9;local aa=0;local ab=0;local ac=0;local ad=0;local ae=0;local af=l.Commons.Everyone;local ag={General=l.GUISettings.General,Commons=l.GUISettings.APL.Shaman.Commons,Enhancement=l.GUISettings.APL.Shaman.Enhancement}local function ah()for ai=1,6,1 do if G(g:TotemName(ai),'Totem')then return ai end end end;local aj=g:HasLegendaryEquipped(132)local ak=g:HasLegendaryEquipped(138)local al=g:HasLegendaryEquipped(141)local am=g:HasLegendaryEquipped(246)or g:HasUnity()and H.FaeTransfusion:IsAvailable()d:RegisterForEvent(function()aj=g:HasLegendaryEquipped(132)ak=g:HasLegendaryEquipped(138)al=g:HasLegendaryEquipped(141)am=g:HasLegendaryEquipped(246)or g:HasUnity()and H.FaeTransfusion:IsAvailable()end,"PLAYER_EQUIPMENT_CHANGED")local an=g:CovenantID()d:RegisterForEvent(function()an=g:CovenantID()end,"COVENANT_CHOSEN")local function ao(ap)if ap then return 1 else return 0 end end;local function aq(ap)return ap~=0 end;local function ar()for ai=1,6,1 do if string.match(g:TotemName(ai),'Totem')then return ai end end end;local function as()if not H.AlphaWolf:IsAvailable()or g:BuffDown(H.FeralSpiritBuff)then return 0 end;local at=F(H.CrashLightning:TimeSinceLastCast(),H.ChainLightning:TimeSinceLastCast())if at>8 or at>H.FeralSpirit:TimeSinceLastCast()then return 0 end;return 8-at end;local function au(av,aw)local ax=0;if l.AoEON()then for O,ay in pairs(aw)do if ay:DebuffUp(av)then ax=ax+1;aa=ax end end end end;local function az(aA)if(aA:DebuffRefreshable(H.FlameShockDebuff)or aA:DebuffDown(H.FlameShockDebuff))and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==f("mouseover"):GUID()then ac=1188389;return true elseif(aA:DebuffRefreshable(H.FlameShockDebuff)or aA:DebuffDown(H.FlameShockDebuff))and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and ag.Enhancement.TargetSwap=="AutoSwap"and aA:GUID()~=h:GUID()and not t then ac=999;return true elseif(aA:DebuffRefreshable(H.FlameShockDebuff)or aA:DebuffDown(H.FlameShockDebuff))and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==h:GUID()then ad=188389;return true elseif(aA:DebuffRefreshable(H.FlameShockDebuff)or aA:DebuffDown(H.FlameShockDebuff))and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)then return true end end;local function aB(aA)if aA:DebuffRefreshable(H.LashingFlamesDebuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==f("mouseover"):GUID()then ac=160103;return true elseif aA:DebuffRefreshable(H.LashingFlamesDebuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and ag.Enhancement.TargetSwap=="AutoSwap"and aA:GUID()~=h:GUID()and not t then ac=999;return true elseif aA:DebuffRefreshable(H.LashingFlamesDebuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==h:GUID()then ad=60103;return true elseif aA:DebuffRefreshable(H.LashingFlamesDebuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)then return true end end;local function aC(aA)return aA:DebuffRemains(H.FlameShockDebuff)end;local function aD(aA)if g:BuffDown(H.PrimordialWaveBuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==f("mouseover"):GUID()then ac=1326059;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and ag.Enhancement.TargetSwap=="AutoSwap"and aA:GUID()~=h:GUID()and not t then ac=999;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==h:GUID()then ad=326059;return true elseif g:BuffDown(H.PrimordialWaveBuff)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)then return true end end;local function aE(aA)return aA:DebuffRemains(H.LashingFlamesDebuff)end;local function aF(aA)if H.LashingFlames:IsAvailable()and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==f("mouseover"):GUID()then ac=160103;return true elseif H.LashingFlames:IsAvailable()and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and ag.Enhancement.TargetSwap=="AutoSwap"and aA:GUID()~=h:GUID()and not t then ac=999;return true elseif H.LashingFlames:IsAvailable()and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==h:GUID()then ad=60103;return true elseif H.LashingFlames:IsAvailable()and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)then return true end end;local function aG(aA)if aA:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<X and H.FlameShockDebuff:AuraActiveCount()<6)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==f("mouseover"):GUID()then ac=160103;return true elseif aA:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<X and H.FlameShockDebuff:AuraActiveCount()<6)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and ag.Enhancement.TargetSwap=="AutoSwap"and aA:GUID()~=h:GUID()and not t then ac=999;return true elseif aA:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<X and H.FlameShockDebuff:AuraActiveCount()<6)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)and aA:GUID()==h:GUID()then ad=60103;return true elseif aA:DebuffUp(H.FlameShockDebuff)and(H.FlameShockDebuff:AuraActiveCount()<X and H.FlameShockDebuff:AuraActiveCount()<6)and(aA:AffectingCombat()or aA:IsDummy()or aA:NPCID()==153285 or aA:NPCID()==168326 or UnitExists("boss1"))and aA:IsInMeleeRange(8)then return true end end;local function aH()if H.Stormkeeper:IsCastable()and not g:IsMoving()then if m(H.Stormkeeper)then ad=191634;return"Stormkeeper precombat"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem precombat"end end;if H.Fleshcraft:IsCastable()and p and(H.PustuleEruption:SoulbindEnabled()or H.VolatileSolvent:SoulbindEnabled())then if m(H.Fleshcraft,nil,nil)then ad=324631;return"fleshcraft precombat 6"end end end;local function aI()if H.PrimordialWave:IsReady()and o()and(h:DebuffUp(H.FlameShockDebuff)and H.LashingFlames:IsAvailable())then if m(H.PrimordialWave,nil,nil,not h:IsSpellInRange(H.PrimordialWave))then ad=326059;return"primordial_wave single 6"end end;if H.FlameShock:IsReady()and(h:DebuffDown(H.FlameShockDebuff)and H.LashingFlames:IsAvailable())then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock single 4"end end;if H.ElementalBlast:IsReady()and(_>=5 and H.ElementalSpirits:IsAvailable())then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast single 6"end end;if H.Sundering:IsReady()and o()and g:HasTier(30,2)and q then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering single 8"end end;if H.LightningBolt:IsCastable()and(_>=5 and g:BuffDown(H.CracklingThunderBuff)and g:BuffUp(H.AscendanceBuff)and a7==H.ChainLightning and g:BuffRemains(H.AscendanceBuff)>H.Windstrike:CooldownRemains()+g:GCD())then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt single 10"end end;if H.Windstrike:IsCastable()and(H.ThorimsInvocation:IsAvailable()and _>=1 and(H.DeeplyRootedElements:IsAvailable()or H.Stormblast:IsAvailable()and g:BuffUp(H.StormbringerBuff)or H.ElementalAssault:IsAvailable()and H.Stormflurry:IsAvailable()or a7==H.LightningBolt))then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike single 12"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.DoomWindsBuff)or H.DeeplyRootedElements:IsAvailable()or H.Stormblast:IsAvailable()and g:BuffUp(H.StormbringerBuff)or H.ElementalAssault:IsAvailable()and H.Stormflurry:IsAvailable()and _<a0)then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike single 14"end end;if H.LavaLash:IsReady()and g:BuffUp(H.HotHandBuff)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash single 16"end end;if H.WindfuryTotem:IsReady()and g:BuffDown(H.WindfuryTotemBuff,true)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem single 18"end end;if H.ElementalBlast:IsReady()and(_>=5 and H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges())then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast single 20"end end;if H.LightningBolt:IsCastable()and(_>=5 and g:BuffUp(H.PrimordialWaveBuff)and(g:BuffDown(H.SplinteredElementsBuff)or a9<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt single 22"end end;if H.ChainLightning:IsReady()and(_>=5 and g:BuffUp(H.CracklingThunderBuff)and H.ElementalSpirits:IsAvailable())then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then ad=188196;return"chain_lightning single 24"end end;if H.ElementalBlast:IsReady()and(_>=5 and(g:BuffUp(H.FeralSpiritBuff)or not H.ElementalSpirits:IsAvailable()))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast single 26"end end;if H.LavaBurst:IsReady()and(not H.ThorimsInvocation:IsAvailable()and _>=5)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then ad=51505;return"lava_burst single 28"end end;if H.LightningBolt:IsCastable()and((_==a0 or H.StaticAccumulation:IsAvailable()and _>=5)and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt single 30"end end;if g:BuffUp(H.DoomWindsBuff)then if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike single 32"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering single 34"end end end;if H.CrashLightning:IsReady()and(g:BuffUp(H.DoomWindsBuff)or H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and as()==0)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning single 36"end end;if H.PrimordialWave:IsReady()and o()then if m(H.PrimordialWave,nil,nil,not h:IsSpellInRange(H.PrimordialWave))then ad=326059;return"primordial_wave single 38"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock single 40"end end;if H.LavaLash:IsCastable()and(H.MoltenAssault:IsAvailable()and h:DebuffRefreshable(H.FlameShockDebuff))then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash single 42"end end;if H.IceStrike:IsReady()and g:BuffDown(H.IceStrikeBuff)then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike single 44"end end;if H.FrostShock:IsReady()and g:BuffUp(H.HailstormBuff)then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock single 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash single 48"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike single 50"end end;if H.Windstrike:IsCastable()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike single 52"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike single 54"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering single 56"end end;if H.BagofTricks:IsCastable()and o()then if m(H.BagofTricks,nil,nil,not h:IsSpellInRange(H.BagofTricks))then ad=312411;return"bag_of_tricks single 58"end end;if H.FireNova:IsReady()and(H.SwirlingMaelstrom:IsAvailable()and H.FlameShockDebuff:AuraActiveCount()>0 and _<a0)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=333975;return"fire_nova single 60"end end;if H.LightningBolt:IsCastable()and(H.Hailstorm:IsAvailable()and _>=5 and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt single 62"end end;if H.FrostShock:IsReady()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock single 64"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,ag.Enhancement.GCDasOffGCD.CrashLightning,nil,not h:IsInMeleeRange(8))then return"crash_lightning single 66"end end;if H.FireNova:IsReady()and h:DebuffUp(H.FlameShockDebuff)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=333975;return"fire_nova single 68"end end;if H.EarthElemental:IsCastable()then if m(H.EarthElemental,nil)then ad=198103;return"earth_elemental single 70"end end;if H.FlameShock:IsReady()then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock single 72"end end;if H.LightningBolt:IsCastable()and(_>=5 and g:BuffDown(H.PrimordialWaveBuff))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt single 74"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem single 76"end end end;local function aJ()if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and(H.UnrulyWinds:IsAvailable()and a5>=10 or a5>=15))then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning aoe 2"end end;if H.LightningBolt:IsCastable()and((H.FlameShockDebuff:AuraActiveCount()==a5 or H.FlameShockDebuff:AuraActiveCount()>=6)and g:BuffUp(H.PrimordialWaveBuff)and _==a0 and(g:BuffDown(H.SplinteredElementsBuff)or a9<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt aoe 4"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and(H.PrimordialWave:IsAvailable()or H.FireNova:IsAvailable())and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<a5 and H.FlameShockDebuff:AuraActiveCount()<6)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash aoe 6"end end;if H.PrimordialWave:IsReady()and o()and g:BuffDown(H.PrimordialWaveBuff)then if af.CastTargetIf(H.PrimordialWave,a4,"min",aC,aD,nil,not h:IsSpellInRange(H.PrimordialWave),ag.Commons.DisplayStyle.Signature)then ad=326059;return"primordial_wave aoe 8"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==a6 or g:BuffUp(H.FeralSpiritBuff)))and _==a0 and(not H.CrashingStorms or a5<=3))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast aoe 10"end end;if H.Windstrike:IsReady()and(H.ThorimsInvocation:IsAvailable()and a7==H.ChainLightning and _>1)then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike aoe 12"end end;if H.ChainLightning:IsReady()and _==a0 then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then ad=188196;return"chain_lightning aoe 14"end end;if H.CrashLightning:IsReady()and(g:BuffUp(H.DoomWindsBuff)or g:BuffDown(H.CrashLightningBuff)or H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and as()==0)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning aoe 16"end end;if H.Sundering:IsReady()and o()and(g:BuffUp(H.DoomWindsBuff)or g:HasTier(30,2))then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering aoe 18"end end;if H.FireNova:IsReady()and(H.FlameShockDebuff:AuraActiveCount()==6 or H.FlameShockDebuff:AuraActiveCount()>=4 and H.FlameShockDebuff:AuraActiveCount()>=a5)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=333975;return"fire_nova aoe 20"end end;if H.LavaLash:IsReady()and H.LashingFlames:IsAvailable()then if af.CastTargetIf(H.LavaLash,a4,"min",aE,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash aoe 22"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<a5 and H.FlameShockDebuff:AuraActiveCount()<6 or H.AshenCatalyst:IsAvailable()and g:BuffStack(H.AshenCatalystBuff)==a1)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash aoe 24"end end;if H.IceStrike:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffDown(H.IceStrikeBuff))then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike aoe 26"end end;if H.FrostShock:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffUp(H.HailstormBuff))then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock aoe 28"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering aoe 30"end end;if H.FlameShock:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffDown(H.FlameShockDebuff))then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock aoe 32"end end;if H.FlameShock:IsReady()and((H.FireNova:IsAvailable()or H.PrimordialWave:IsAvailable())and H.FlameShockDebuff:AuraActiveCount()<a5 and H.FlameShockDebuff:AuraActiveCount()<6)then if af.CastCycle(H.FlameShock,a4,az,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock aoe 34"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=3 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=60103;return"fire_nova aoe 36"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.CrashLightningBuff)and(H.DeeplyRootedElements:IsAvailable()or g:BuffStack(H.ConvergingStormsBuff)==6))then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike aoe 38"end end;if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and g:BuffUp(H.CLCrashLightningBuff)and a5>=4)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning aoe 40"end end;if H.Windstrike:IsReady()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike aoe 42"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike aoe 44"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike aoe 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash aoe 48"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning aoe 50"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=2 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=60103;return"fire_nova aoe 52"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==a6 or g:BuffUp(H.FeralSpiritBuff)))and _>=5 and(not H.CrashingStorms:IsAvailable()or a5<=3))then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast aoe 54"end end;if H.ChainLightning:IsReady()and _>=5 then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then ad=188196;return"chain_lightning aoe 56"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem aoe 58"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock aoe 60"end end;if H.FrostShock:IsReady()and not H.Hailstorm:IsAvailable()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock aoe 62"end end end;local function aK()if H.LightningBolt:IsCastable()and((H.FlameShockDebuff:AuraActiveCount()==a5 or H.FlameShockDebuff:AuraActiveCount()>=6)and g:BuffUp(H.PrimordialWaveBuff)and _==a0 and(g:BuffDown(H.SplinteredElementsBuff)or a9<=12))then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt funnel 2"end end;if H.LavaLash:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffUp(H.FlameShockDebuff)and H.FlameShockDebuff:AuraActiveCount()<a5 and H.FlameShockDebuff:AuraActiveCount()<6 or H.AshenCatalyst:IsAvailable()and g:BuffStack(H.AshenCatalystBuff)==a1)then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash funnel 4"end end;if H.PrimordialWave:IsReady()and o()and g:BuffDown(H.PrimordialWaveBuff)then if af.CastTargetIf(H.PrimordialWave,a4,"min",aC,nil,not h:IsSpellInRange(H.PrimordialWave))then ad=326059;return"primordial_wave funnel 6"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges()or g:BuffUp(H.FeralSpiritBuff)))and _==a0)then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast funnel 8"end end;if H.Windstrike:IsCastable()and(H.ThorimsInvocation:IsAvailable()and _>1 or g:BuffStack(H.ConvergingStormsBuff)==a2)then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike funnel 10"end end;if H.Stormstrike:IsReady()and g:BuffStack(H.ConvergingStormsBuff)==a2 then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike funnel 12"end end;if H.ChainLightning:IsReady()and(_==a0 and g:BuffUp(H.CracklingThunderBuff))then if m(H.ChainLightning,nil,nil,not h:IsSpellInRange(H.ChainLightning))then ad=188196;return"chain_lightning funnel 14"end end;if H.LavaBurst:IsReady()and(g:BuffStack(H.MoltenWeaponBuff)+ao(g:BuffUp(H.VolcanicStrengthBuff))>g:BuffStack(H.CracklingSurgeBuff)and _==a0)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then ad=51505;return"lava_burst funnel 16"end end;if H.LightningBolt:IsCastable()and _==a0 then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt funnel 18"end end;if H.CrashLightning:IsReady()and(g:BuffUp(H.DoomWindsBuff)or g:BuffDown(H.CrashLightningBuff)or H.AlphaWolf:IsAvailable()and g:BuffUp(H.FeralSpiritBuff)and as()==0 or H.ConvergingStorms:IsAvailable()and g:BuffStack(H.ConvergingStormsBuff)<a2)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning funnel 20"end end;if H.Sundering:IsReady()and o()and(g:BuffUp(H.DoomWindsBuff)or g:HasTier(30,2))then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering funnel 22"end end;if H.FireNova:IsReady()and(H.FlameShockDebuff:AuraActiveCount()>=6 or H.FlameShockDebuff:AuraActiveCount()>=4 and H.FlameShockDebuff:AuraActiveCount()==a5)then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=60103;return"fire_nova funnel 24"end end;if H.IceStrike:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffDown(H.IceStrikeBuff))then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike funnel 26"end end;if H.FrostShock:IsReady()and(H.Hailstorm:IsAvailable()and g:BuffUp(H.HailstormBuff))then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock funnel 28"end end;if H.Sundering:IsReady()and o()then if m(H.Sundering,nil,nil,not h:IsInMeleeRange(11))then ad=197214;return"sundering funnel 30"end end;if H.FlameShock:IsReady()and(H.MoltenAssault:IsAvailable()and h:DebuffDown(H.FlameShockDebuff))then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock funnel 32"end end;if H.FlameShock:IsReady()and((H.FireNova:IsAvailable()or H.PrimordialWave:IsAvailable())and H.FlameShockDebuff:AuraActiveCount()<a5 and H.FlameShockDebuff:AuraActiveCount()<6)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock funnel 34"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=3 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=60103;return"fire_nova funnel 36"end end;if H.Stormstrike:IsReady()and(g:BuffUp(H.CrashLightningBuff)and H.DeeplyRootedElements:IsAvailable())then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike funnel 38"end end;if H.CrashLightning:IsReady()and(H.CrashingStorms:IsAvailable()and g:BuffUp(H.CLCrashLightningBuff)and a5>=4)then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning funnel 40"end end;if H.Windstrike:IsCastable()then if m(H.Windstrike,nil,nil,not h:IsSpellInRange(H.Windstrike))then ad=115356;return"windstrike funnel 42"end end;if H.Stormstrike:IsReady()then if m(H.Stormstrike,nil,nil,not h:IsSpellInRange(H.Stormstrike))then ad=17364;return"stormstrike funnel 44"end end;if H.IceStrike:IsReady()then if m(H.IceStrike,nil,nil,not h:IsSpellInRange(H.IceStrike))then ad=342240;return"ice_strike funnel 46"end end;if H.LavaLash:IsReady()then if m(H.LavaLash,nil,nil,not h:IsSpellInRange(H.LavaLash))then ad=60103;return"lava_lash funnel 48"end end;if H.CrashLightning:IsReady()then if m(H.CrashLightning,nil,nil,not h:IsInMeleeRange(8))then ad=187874;return"crash_lightning funnel 50"end end;if H.FireNova:IsReady()and H.FlameShockDebuff:AuraActiveCount()>=2 then if m(H.FireNova,nil,nil,not h:IsSpellInRange(H.FireNova))then ad=60103;return"fire_nova funnel 52"end end;if H.ElementalBlast:IsReady()and((not H.ElementalSpirits:IsAvailable()or H.ElementalSpirits:IsAvailable()and(H.ElementalBlast:Charges()==H.ElementalBlast:MaxCharges()or g:BuffUp(H.FeralSpiritBuff)))and _>=5)then if m(H.ElementalBlast,nil,nil,not h:IsSpellInRange(H.ElementalBlast))then ad=117014;return"elemental_blast funnel 54"end end;if H.LavaBurst:IsReady()and(g:BuffStack(H.MoltenWeaponBuff)+ao(g:BuffUp(H.VolcanicStrengthBuff))>g:BuffStack(H.CracklingSurgeBuff)and _>=5)then if m(H.LavaBurst,nil,nil,not h:IsSpellInRange(H.LavaBurst))then ad=51505;return"lava_burst funnel 56"end end;if H.LightningBolt:IsCastable()and _>=5 then if m(H.LightningBolt,nil,nil,not h:IsSpellInRange(H.LightningBolt))then ad=188196;return"lightning_bolt funnel 58"end end;if H.WindfuryTotem:IsReady()and(g:BuffDown(H.WindfuryTotemBuff,true)or H.WindfuryTotem:TimeSinceLastCast()>90)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem funnel 60"end end;if H.FlameShock:IsReady()and h:DebuffDown(H.FlameShockDebuff)then if m(H.FlameShock,nil,nil,not h:IsSpellInRange(H.FlameShock))then ad=188389;return"flame_shock funnel 62"end end;if H.FrostShock:IsReady()and not H.Hailstorm:IsAvailable()then if m(H.FrostShock,nil,nil,not h:IsSpellInRange(H.FrostShock))then ad=196840;return"frost_shock funnel 64"end end end;local function aL()r=HeroRotationCharDB.Toggles[6]p=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[5]t=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]u=HeroRotationCharDB.Toggles[60]o=l.CDsON;v=HeroRotationCharDB.Toggles[90]w=HeroRotationCharDB.Toggles[91]x=HeroRotationCharDB.Toggles[92]y=HeroRotationCharDB.Toggles[93]z=HeroRotationCharDB.Toggles[94]A=HeroRotationCharDB.Toggles[96]B=HeroRotationCharDB.Toggles[95]C=HeroRotationCharDB.Toggles[97]D=0;for ai=1,20 do if select(10,UnitDebuff("player",ai))==240447 then if select(6,UnitDebuff("player",ai))~=nil then D=select(6,UnitDebuff("player",ai))-GetTime()end end end;N=GetInventoryItemID("player",13)P=GetInventoryItemID("player",14)if not ag.Commons.Enabled.TopTrinket and not ag.Commons.Enabled.BotTrinket then J={N,P,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}elseif not ag.Commons.Enabled.TopTrinket and ag.Commons.Enabled.BotTrinket then J={N,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}elseif not ag.Commons.Enabled.BotTrinket and ag.Commons.Enabled.TopTrinket then J={P,I.CacheofAcquiredTreasures:ID(),I.ScarsofFraternalStrife:ID(),I.TheFirstSigil:ID()}end end;local function aM()R,T,O,O,S,U=GetWeaponEnchantInfo()if n()then V=g:GetEnemiesInRange(40)Z=#V;W=g:GetEnemiesInMeleeRange(10)X=#W;a4=g:GetEnemiesInMeleeRange(10)a5=#a4 else V={}Z=1;W={}X=1;a4={}a5=1 end;a9=d.FightRemains(W,false)if not BotOn then ac=0;ad=0 end;if ac>0 then ac=0 end;if ad>0 then ad=0 end;_=g:BuffStack(H.MaelstromWeaponBuff)Q=aL()if l.QueuedCast()then ad=l.QueuedCast()return"Custom Queue "..i(ad):ID()end;if g:IsChanneling(H.FaeTransfusion)then if l.CastAnnotated(H.Pool,false,"WAIT")then ad=99999;return"Pool During FaeTransfusion"end end;if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if ag.Enhancement.PreferEarthShield and H.EarthShield:IsCastable()and H.EarthShield:IsAvailable()and(g:BuffDown(H.EarthShield)or not g:AffectingCombat()and g:BuffStack(H.EarthShield)<5)then if m(H.EarthShield,nil)then ad=974;return"Earth Shield Refresh"end elseif H.LightningShield:IsCastable()and g:BuffDown(H.LightningShield)and(ag.Enhancement.PreferEarthShield and g:BuffDown(H.EarthShield)or not ag.Enhancement.PreferEarthShield)then if m(H.LightningShield,nil)then ad=192106;return"Lightning Shield Refresh"end end;if(not R or T<600000)and H.WindfuryWeapon:IsCastable()then if m(H.WindfuryWeapon)then ad=33757;return"WindfuryWeapon enchant"end end;if(not S or U<600000)and H.FlamentongueWeapon:IsCastable()then if m(H.FlamentongueWeapon)then ad=318038;return"FlamentongueWeapon enchant"end end;if not g:AffectingCombat()and af.TargetIsValid()and r then local Q=aH()if Q then return Q end end;if g:IsChanneling()or g:IsChanneling(H.FaeTransfusion)then if m(H.Pool,nil)then ad=99999;return"Trinket Channel"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if H.FrostShock:IsCastable()then if m(H.FrostShock,nil)then ac=1196840;return"explosive MO FS"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if H.FrostShock:IsCastable()then if m(H.FrostShock,nil)then ad=196840;return"explosive  FS"end end end;if w and H.CapacitorTotem:IsUsableP()and H.CapacitorTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.CapacitorTotem,nil,nil,nil)then ad=1192058;return"queue CapacitorTotem"end elseif(not H.CapacitorTotem:IsUsableP()or H.CapacitorTotem:CooldownRemains(BypassRecovery)>0)and w then HeroRotationCharDB.Toggles[91]=not HeroRotationCharDB.Toggles[91]l.Print("Capacitor Totem Queue is now "..(HeroRotationCharDB.Toggles[91]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and H.HealingStreamTotem:IsUsableP()and H.HealingStreamTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.HealingStreamTotem,nil,nil,nil)then ad=5394;return"queue HealingStreamTotem"end elseif(not H.HealingStreamTotem:IsUsableP()or H.HealingStreamTotem:CooldownRemains(BypassRecovery)>0)and x then HeroRotationCharDB.Toggles[92]=not HeroRotationCharDB.Toggles[92]l.Print("Healing Stream Totem Queue is now "..(HeroRotationCharDB.Toggles[92]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and H.TremorTotem:IsUsableP()and H.TremorTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.TremorTotem,nil,nil,nil)then ad=8143;return"queue TremorTotem"end elseif(not H.TremorTotem:IsUsableP()or H.TremorTotem:CooldownRemains(BypassRecovery)>0)and y then HeroRotationCharDB.Toggles[93]=not HeroRotationCharDB.Toggles[93]l.Print("Tremor Totem Queue is now "..(HeroRotationCharDB.Toggles[93]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and H.WindRushTotem:IsUsableP()and H.WindRushTotem:CooldownRemains(BypassRecovery)<=0 then if l.Cast(H.WindRushTotem,nil,nil,nil)then ad=192077;return"queue WindRushTotem"end elseif(not H.WindRushTotem:IsUsableP()or H.WindRushTotem:CooldownRemains(BypassRecovery)>0)and z then HeroRotationCharDB.Toggles[94]=not HeroRotationCharDB.Toggles[94]l.Print("Wind Rush Totem Queue is now "..(HeroRotationCharDB.Toggles[94]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and H.FaeTransfusion:IsUsableP()and H.FaeTransfusion:CooldownRemains(BypassRecovery)<=0 and H.FaeTransfusion:IsAvailable()then if m(H.FaeTransfusion,nil)then ad=328923;return"FaeTransfusion 1"end elseif(not H.FaeTransfusion:IsUsableP()or H.FaeTransfusion:CooldownRemains(BypassRecovery)>0 or not H.FaeTransfusion:IsAvailable())and A then HeroRotationCharDB.Toggles[96]=not HeroRotationCharDB.Toggles[96]l.Print("Fae Transfusion Queue is now"..(HeroRotationCharDB.Toggles[96]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and H.Hex:IsUsableP()and H.Hex:CooldownRemains(BypassRecovery)<=0 and UnitExists("mouseover")then if l.Cast(H.Hex,nil,nil,nil)then if UnitExists("mouseover")and f("mouseover"):IsInRange(40)then ac=151514;return"queue Hex MO"end end elseif(not H.Hex:IsUsableP()or H.Hex:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[95]=not HeroRotationCharDB.Toggles[95]l.Print("Hex Queue is now "..(HeroRotationCharDB.Toggles[95]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if not g:AffectingCombat()and af.TargetIsValid()and r then local Q=aH()if Q then return Q end end;for ai=1,25 do local aN,O,O,aO=UnitBuff("target",ai)if aO~=nil and aO=="Magic"then if H.Purge:IsCastable()and C and h:IsInRange(20)then if m(H.Purge,nil)then ad=370;return"Purge"end end end end;for ai=0,40 do local O,O,aP,aO,O,O,O,O,O,aQ=UnitDebuff("mouseover",ai)if H.CleanseSpirit:IsCastable()and UnitIsDead("mouseover")~=true and UnitCanAttack("player","mouseover")~=true and IsItemInRange(34471,"mouseover")and aO=="Curse"then if m(H.CleanseSpirit,nil)then ac=151886;return"Cleanse Spirit MO"end end end;if af.TargetIsValid()and(g:AffectingCombat()or r)and(h:AffectingCombat()or h:IsDummy()or h:NPCID()==153285 or h:NPCID()==168326 or h:NPCID()==176581 or h:NPCID()==176920 or h:NPCID()==177892 or h:NPCID()==182778 or h:NPCID()==185402 or h:NPCID()==183945 or h:NPCID()==182074 or h:NPCID()==184737 or h:NPCID()==179733 or h:NPCID()==115402 or h:NPCID()==115406 or h:NPCID()==115395 or UnitExists("boss1")or h:NPCID()==115388 or r)and not g:IsDeadOrGhost()then local aR=0;local aS=0;if GetNumGroupMembers()>0 then if UnitInParty("player")then for ai=1,GetNumGroupMembers()do if UnitExists("party"..ai)then aS=aS+UnitHealth("party"..ai)aR=aR+UnitHealthMax("party"..ai)end end end;if UnitInRaid("player")then for ai=1,GetNumGroupMembers()do if UnitExists("raid"..ai)then aS=aS+UnitHealth("raid"..ai)aR=aR+UnitHealthMax("raid"..ai)end end end elseif GetNumGroupMembers()==0 then aS=UnitHealth("player")aR=UnitHealthMax("player")end;if g:HealthPercentage()<ag.Enhancement.HealthstoneHP and I.Healthstone:IsReady()and I.Healthstone:CooldownRemains()<=0 then if m(I.Healthstone,nil)then ad=40;return"Healthstone HP"end end;if g:HealthPercentage()<ag.Enhancement.HealPotHP and I.CosmicHealPot:IsReady()and I.CosmicHealPot:CooldownRemains()<=0 then if m(I.CosmicHealPot,nil)then ad=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<ag.Enhancement.HealPotHP and I.HealPot:IsReady()and I.HealPot:CooldownRemains()<=0 then if m(I.HealPot,nil)then ad=41;return"HealPot HP"end end;if g:HealthPercentage()<ag.Enhancement.PhialHP and I.PhialofSerenity:IsReady()and I.PhialofSerenity:CooldownRemains()<=0 then if m(I.PhialofSerenity,nil)then ad=55;return"PhialofSerenity HP"end end;if aS/aR*100<=ag.Enhancement.FaeTransfusionHealHP and g:BuffUp(i(328933))then if m(H.FaeTransfusion,nil)then ad=328923;return"FaeTransfusion Heal"end end;if g:HealthPercentage()<ag.Enhancement.AstralShiftHP and H.AstralShift:IsAvailable()and H.AstralShift:IsReady()then if m(H.AstralShift)then ad=108271;return"AstralShift HP"end end;if g:HealthPercentage()<ag.Enhancement.HealingSurgeHP and H.HealingSurge:IsReady()and(not g:IsMoving()or g:BuffUp(H.MaelstromWeaponBuff))then if m(H.HealingSurge)then ad=8004;return"HealingSurge HP"end end;if UnitInParty("player")and ag.Enhancement.HealingSurgePartyHP>0 and g:BuffUp(H.MaelstromWeaponBuff)and H.HealingSurge:IsReady()then if UnitExists("party1")and not f("party1"):IsDeadOrGhost()and f("party1"):HealthPercentage()<ag.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then ad=18004;return"HealingSurge party 1 HP"end elseif UnitExists("party2")and not f("party2"):IsDeadOrGhost()and f("party2"):HealthPercentage()<ag.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then ad=28004;return"HealingSurge party 2 HP"end elseif UnitExists("party3")and not f("party3"):IsDeadOrGhost()and f("party3"):HealthPercentage()<ag.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then ad=38004;return"HealingSurge party 3 HP"end elseif UnitExists("party4")and not f("party4"):IsDeadOrGhost()and f("party4"):HealthPercentage()<ag.Enhancement.HealingSurgePartyHP then if m(H.HealingSurge)then ad=48004;return"HealingSurge party 4 HP"end end end;if not h:IsInMeleeRange(10)and X>0 and ag.Enhancement.TargetSwap=="AutoSwap"and not t then ac=999 end;if I.PotionofSpectralAgility:IsReady()and o()and ag.Commons.Enabled.Potions and s then if m(I.PotionofSpectralAgility,nil,nil)then ad=50;return"potion default 4"end end;if(ag.Commons.Enabled.TopTrinket or ag.Commons.Enabled.BottomTrinket)and o()and h:IsInMeleeRange(10)then if I.TheFirstSigil:IsEquippedAndReady()and(H.Ascendance:IsAvailable()and H.Ascendance:CooldownRemains()<10 or H.HotHand:IsAvailable()and g:BuffUp(H.MoltenWeaponBuff)or g:BuffUp(H.IcyEdgeBuff)or H.Stormflurry:IsAvailable()and g:BuffUp(H.CracklingSurgeBuff)or h:DebuffUp(H.EarthenSpike)or X>1 or a9<30)then if m(I.TheFirstSigil,nil,nil)then if I.TheFirstSigil:ID()==N and ag.Commons.Enabled.TopTrinket then ad=24;return"top trinket 1"elseif I.TheFirstSigil:ID()==P and ag.Commons.Enabled.BottomTrinket then ad=30;return"Bot trinket 2"end end end;if I.CacheofAcquiredTreasures:IsEquippedAndReady()and(g:BuffUp(H.AcquiredSwordBuff)or a9<25)then if m(I.CacheofAcquiredTreasures,nil,nil)then if I.CacheofAcquiredTreasures:ID()==N and ag.Commons.Enabled.TopTrinket then ad=24;return"top trinket 1"elseif I.CacheofAcquiredTreasures:ID()==P and ag.Commons.Enabled.BottomTrinket then ad=30;return"Bot trinket 2"end end end;if I.ScarsofFraternalStrife:IsEquippedAndReady()and(g:BuffDown(H.ScarsofFraternalStrifeBuff4)or a9<31 or X>1)then if m(I.ScarsofFraternalStrife,nil,nil)then if I.ScarsofFraternalStrife:ID()==N and ag.Commons.Enabled.TopTrinket then ad=24;return"top trinket 1"elseif I.ScarsofFraternalStrife:ID()==P and ag.Commons.Enabled.BottomTrinket then ad=30;return"Bot trinket 2"end end end;local aT=g:GetUseableTrinkets(J)if aT then if m(aT,nil,nil)then if aT:ID()==N and ag.Commons.Enabled.TopTrinket then ad=24;return"top trinket 1"elseif aT:ID()==P and ag.Commons.Enabled.BottomTrinket then ad=30;return"Bot trinket 2"end end end end;if o()and h:IsInMeleeRange(10)then if H.BloodFury:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a9%120<=15 or a3>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.BloodFury,nil)then ad=20572;return"Blood Fury 420"end end;if H.Berserking:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a9%180<=12 or a3>=180 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.Berserking,nil)then ad=26297;return"Berserking 422"end end;if H.AncestralCall:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a9%120<=15 or a3>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.AncestralCall,nil)then ad=274738;return"Ancestral Call 428"end end;if H.Fireblood:IsCastable()and(g:BuffUp(H.AscendanceBuff)or g:BuffUp(H.FeralSpiritBuff)or g:BuffUp(H.DoomWindsBuff)or a9%120<=8 or a3>=120 or not H.Ascendance:IsAvailable()and not H.FeralSpirit:IsAvailable()and not H.DoomWinds:IsAvailable())then if l.Cast(H.Fireblood,nil)then ad=265221;return"Fireblood 426"end end;if H.BagofTricks:IsCastable()and h:IsInRange(8)and(not H.Ascendance:IsAvailable()or not g:BuffUp(H.AscendanceBuff))then if l.Cast(H.BagofTricks,nil,nil,not h:IsInRange(40))then ad=312411;return"Bag of Tricks 430"end end end;if H.FeralSpirit:IsCastable()and h:IsInRange(40)and o()then if m(H.FeralSpirit,nil)then ad=51533;return"feral_spirit default 6"end end;if H.FaeTransfusion:IsReady()and h:IsInMeleeRange(10)and not g:IsMoving()and p and((H.Ascendance:IsAvailable()or ak)and(H.GroveInvigoration:IsAvailable()or H.FieldofBlossoms:IsAvailable()or X==1))then if m(H.FaeTransfusion,nil,nil,not h:IsInRange(40))then ad=328923;return"fae_transfusion default 8"end end;if H.Ascendance:IsCastable()and o()and(h:DebuffUp(H.FlameShockDebuff)and(a7==H.LightningBolt and a5==1 or a7==H.ChainLightning and a5>1))and h:IsInMeleeRange(10)then if m(H.Ascendance,nil)then ad=114051;return"ascendance default 10"end end;if H.WindfuryTotem:IsReady()and h:IsInMeleeRange(15)and(ak and g:BuffDown(H.DoomWindsBuff)and H.WindfuryTotem:TimeSinceLastCast()>60)then if m(H.WindfuryTotem,nil)then ad=8512;return"windfury_totem default 12"end end;if X<2 then local Q=aI()if Q then return Q end end;if n()and a5>1 then if ag.Enhancement.Rotation=="Standard"then local Q=aJ()if Q then return Q end else local Q=aK()if Q then return Q end end end;if l.CastAnnotated(H.Pool,false,"WAIT")then ad=9999;return"Wait/Pool Resources"end end end;local function aU()H.FlameShockDebuff:RegisterAuraTracking()SetCVar("autoSelfCast","1")if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell2()if ad==0 then return 0 else return ad end end;function ReturnSpellMO2()if ac==0 then return 0 else return ac end end;l.SetAPL(263,aM,aU)