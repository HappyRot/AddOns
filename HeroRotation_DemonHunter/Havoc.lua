local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.CastSuggested;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[12]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[40]local v=HeroRotationCharDB.Toggles[42]local w=HeroRotationCharDB.Toggles[43]local x=HeroRotationCharDB.Toggles[41]local y=HeroRotationCharDB.Toggles[45]local z=HeroRotationCharDB.Toggles[46]local A=HeroRotationCharDB.Toggles[47]local B=HeroRotationCharDB.Toggles[48]local C=HeroRotationCharDB.Toggles[49]local D=GetInventoryItemID("player",13)local E=GetInventoryItemID("player",14)local F=HeroRotationCharDB.Toggles[44]local G=l.Commons.Everyone.num;local H=l.Commons.Everyone.bool;local I=math.min;local J=math.max;local K=0;local L=0;local M=false;local N=j.DemonHunter.Havoc;local O=k.DemonHunter.Havoc;local P={O.AlgetharPuzzleBox:ID()}local Q=g:GetEquipment()local R=Q[13]and k(Q[13])or k(0)local S=Q[14]and k(Q[14])or k(0)local T,U;local V,W;local X=l.Commons.Everyone;local Y={General=l.GUISettings.General,Commons=l.GUISettings.APL.DemonHunter.Commons,Havoc=l.GUISettings.APL.DemonHunter.Havoc}local Z={{N.FelEruption,"Cast Fel Eruption (Interrupt)",function()return true end},{N.ChaosNova,"Cast Chaos Nova (Interrupt)",function()return true end}}local _=false;local a0=false;local a1=false;local a2=false;local a3=false;local a4=false;local a5=false;local a6=N.AFireInside:IsAvailable()and 5 or 1;local a7=g:GCD()+0.25;local a8=0;local a9=0;local aa=false;local ab=11111;local ac=11111;local ad=true;local function G(ae)if ae then return 1 else return 0 end end;local function H(ae)return ae~=0 end;local af=true;d:RegisterForEvent(function()a0=false;a1=false;a2=false;a3=false;a4=false;ab=11111;ac=11111 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()Q=g:GetEquipment()R=Q[13]and k(Q[13])or k(0)S=Q[14]and k(Q[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()a6=N.AFireInside:IsAvailable()and 5 or 1 end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")local function ag(ah)if BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and ah:GUID()==f("mouseover"):GUID()then if N.DemonBlades:IsAvailable()then L=1111 else L=111 end;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and Y.Havoc.TargetSwap=="AutoSwap"and ah:GUID()~=h:GUID()and not s then L=999;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and ah:GUID()==h:GUID()and h:IsInRange(8)then K=162243;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)then return true end end;local function ai(ah)return ah:DebuffRemains(N.BurningWoundDebuff)end;local function aj(ah)if BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and ah:GUID()==f("mouseover"):GUID()then if N.DemonBlades:IsAvailable()then L=1111 else L=111 end;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and Y.Havoc.TargetSwap=="AutoSwap"and ah:GUID()~=h:GUID()and not s then L=999;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)and ah:GUID()==h:GUID()then K=162243;return true elseif BurningWoundEquipped and ah:DebuffRemains(N.BurningWoundDebuff)<4 and ah:IsInRange(8)then return true end end;local function ak(al)if N.Felblade:TimeSinceLastCast()<=g:GCD()then return true elseif N.VengefulRetreat:TimeSinceLastCast()<1.0 then return false end;return al and h:IsInMeleeRange(al)or h:IsInMeleeRange(5)end;local function am()return Y.Havoc.ConserveFelRush and N.FelRush:Charges()==2 or not Y.Havoc.ConserveFelRush end;local function an(ah)return ah:DebuffRemains(N.BurningWoundDebuff)or ah:DebuffRemains(N.BurningWoundLegDebuff)end;local function ao(ah)return N.BurningWound:IsAvailable()and ah:DebuffRemains(N.BurningWoundDebuff)<4 and N.BurningWoundDebuff:AuraActiveCount()<I(V,3)end;local function ap()_=R:Cooldown()==180 or S:Cooldown()==180;a9=0;if R:HasStatAnyDps()and(not S:HasStatAnyDps()or R:Cooldown()>=S:Cooldown())then a9=1 end;if S:HasStatAnyDps()and(not R:HasStatAnyDps()or S:Cooldown()>=R:Cooldown())then a9=2 end;if N.ArcaneTorrent:IsCastable()and n()then if o(N.ArcaneTorrent,nil,nil,not h:IsInRange(8))then return"arcane_torrent precombat 2"end end;if N.ImmolationAura:IsCastable()and not v then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura precombat 6"end end;if N.SigilofFlame:IsCastable()and not O.AlgetharPuzzleBox:IsEquipped()then if o(N.SigilofFlame,nil,nil,not h:IsInRange(30))then K=204596;return"sigil_of_flame precombat 8"end end;if not h:IsInMeleeRange(5)and not w and N.Felblade:IsCastable()then if o(N.Felblade,nil,nil,not h:IsSpellInRange(N.Felblade))then K=183226;return"felblade precombat 9"end end;if not h:IsInMeleeRange(5)and N.FelRush:IsCastable()and af and(not N.Felblade:IsAvailable()or N.Felblade:CooldownDown()and not g:PrevGCDP(1,N.Felblade))then if o(N.FelRush,nil,nil,not h:IsInRange(15))then K=195072;return"fel_rush precombat 10"end end;if h:IsInMeleeRange(5)and(N.DemonsBite:IsCastable()or N.DemonBlades:IsAvailable())then if N.DemonBlades:IsAvailable()and IsCurrentSpell(6603)~=true then if o(N.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then K=1162243;return"demons_bite or demon_blades precombat 4"end else if o(N.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then K=162243;return"demons_bite or demon_blades precombat 4"end end end end;local function aq()if g:BuffDown(N.FelBarrage)then if N.DeathSweep:IsReady()then if o(N.DeathSweep,nil,nil,not ak(8))then K=210152;return"death_sweep meta_end 2"end end;if N.Annihilation:IsReady()then if o(N.Annihilation,nil,nil,not ak(5))then K=201427;return"annihilation meta_end 4"end end end end;local function ar()if n()then if N.Metamorphosis:IsCastable()and not N.Demonic:IsAvailable()then if o(N.Metamorphosis,nil,nil,not h:IsInRange(40))then K=191427;return"metamorphosis cooldown 2"end end;if N.Metamorphosis:IsCastable()and(N.Demonic:IsAvailable()and(not N.ChaoticTransformation:IsAvailable()and N.EyeBeam:CooldownDown()or N.EyeBeam:CooldownRemains()>20 and(not a0 or g:PrevGCDP(1,N.DeathSweep)or g:PrevGCDP(2,N.DeathSweep))or ac<25+G(N.ShatteredDestiny:IsAvailable())*70 and N.EyeBeam:CooldownDown()and N.BladeDance:CooldownDown())and g:BuffDown(N.InnerDemonBuff))then if o(N.Metamorphosis,nil,nil,not h:IsInRange(40))then K=191427;return"metamorphosis cooldown 4"end end end;if Y.Commons.Enabled.Potions and(g:BuffRemains(N.MetamorphosisBuff)>25 or g:BuffUp(N.MetamorphosisBuff)and N.Metamorphosis:CooldownUp()or ac<60 or a8>0.1 and a8<10)then local as=X.PotionSelected()if as and as:IsReady()then if o(as,nil,nil)then K=4;return"potion cooldown 6"end end end;if n()and N.ElysianDecree:IsCastable()and h:DebuffDown(N.EssenceBreakDebuff)then if o(N.ElysianDecree,nil,nil,not h:IsInRange(30))then K=306830;return"elysian_decree cooldown 8"end end;if Y.Commons.Enabled.Trinkets then local at=g:GetUseableTrinkets(P,13)if at then if o(at,nil,nil)then K=20;return"trinket1 main 10"end end;local au=g:GetUseableTrinkets(P,14)if au then if o(au,nil,nil)then K=25;return"trinket2 main 12"end end end end;local function av()r=HeroRotationCharDB.Toggles[5]q=HeroRotationCharDB.Toggles[4]s=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]u=HeroRotationCharDB.Toggles[40]x=HeroRotationCharDB.Toggles[41]v=HeroRotationCharDB.Toggles[42]w=HeroRotationCharDB.Toggles[43]F=HeroRotationCharDB.Toggles[44]y=HeroRotationCharDB.Toggles[45]z=HeroRotationCharDB.Toggles[46]A=HeroRotationCharDB.Toggles[47]B=HeroRotationCharDB.Toggles[48]C=HeroRotationCharDB.Toggles[49]D=GetInventoryItemID("player",13)E=GetInventoryItemID("player",14)M=Y.Havoc.FelRushMode=="All In"or Y.Havoc.FelRushMode=="Safe"and N.Felblade:CooldownRemains(BypassRecovery)<=0 or Y.Havoc.FelRushMode=="w/ Gap Closer"and(N.Felblade:CooldownRemains(BypassRecovery)<=0 or N.Metamorphosis:CooldownRemains(BypassRecovery)<=0 and MetaReady or N.FelRush:Charges()==2 or N.TheHunt:CooldownRemains(BypassRecovery)<=0)RetreatReady=true;if not h:IsInMeleeRange(5)and not w and N.Felblade:IsCastable()then if o(N.Felblade,nil,nil,not h:IsSpellInRange(N.Felblade))then K=183226;return"felblade precombat 9"end end end;local function aw()if N.VengefulRetreat:IsCastable()and RetreatReady and(N.EyeBeam:CooldownRemains()<0.3 and N.EssenceBreak:CooldownRemains()<a7*2 and a8>5 and g:Fury()>=30 and N.Inertia:IsAvailable())then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 22"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and N.EssenceBreak:IsAvailable()and a8>1 and(N.EssenceBreak:CooldownRemains()>15 or N.EssenceBreak:CooldownRemains()<a7 and(not N.Demonic:IsAvailable()or g:BuffUp(N.MetamorphosisBuff)or N.EyeBeam:CooldownRemains()>15+10*G(N.CycleofHatred:IsAvailable())))and(a8<30 or g:GCDRemains()-1<0)and(not N.Initiative:IsAvailable()or g:BuffRemains(N.InitiativeBuff)<a7 or a8>4))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 24"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and N.EssenceBreak:IsAvailable()and a8>1 and(N.EssenceBreak:CooldownRemains()>15 or N.EssenceBreak:CooldownRemains()<a7*2 and(g:BuffRemains(N.InitiativeBuff)<a7 and not a5 and N.EyeBeam:CooldownRemains()<=g:GCDRemains()and g:Fury()>30 or not N.Demonic:IsAvailable()or g:BuffUp(N.MetamorphosisBuff)or N.EyeBeam:CooldownRemains()>15+10*G(N.CycleofHatred:IsAvailable())))and(g:BuffDown(N.UnboundChaosBuff)or g:BuffUp(N.InertiaBuff)))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 26"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and not N.EssenceBreak:IsAvailable()and a8>1 and((g:BuffDown(N.InitiativeBuff)or g:PrevGCDP(1,N.DeathSweep)and N.Metamorphosis:CooldownUp()and N.ChaoticTransformation:IsAvailable())and N.Initiative:IsAvailable()))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 28"end end end;local function ax()if g:IsChanneling(N.EyeBeam)then if o(N.Pool)then K=9999;return"casting EB"end end;if m()then T=g:GetEnemiesInMeleeRange(5)U=g:GetEnemiesInMeleeRange(20)V=#T>0 and#T or 1;W=#U else V=1;W=1 end;if not BotOn then L=0;K=0 end;if L>0 then L=0 end;if K>0 then K=0 end;if x and N.Imprison:IsCastable(BypassRecovery)and N.Imprison:CooldownRemains()<=0 and f("mouseover"):GUID()~=nil then if o(N.Imprison,nil,nil,nil)then L=231;return"queue Imprison MO"end elseif x and N.Imprison:IsCastable(BypassRecovery)and N.Imprison:CooldownRemains()<=0 and X.TargetIsValid()then if o(N.Imprison,nil,nil,nil)then K=217832;return"queue Imprison"end elseif(not N.Imprison:IsUsableP()or N.Imprison:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[41]=not HeroRotationCharDB.Toggles[41]l.Print("Imprison Queue is now "..(HeroRotationCharDB.Toggles[41]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and N.FelEruption:IsCastable(BypassRecovery)and N.FelEruption:CooldownRemains(BypassRecovery)<=0 and N.FelEruption:IsAvailable()and f("mouseover"):GUID()~=nil then if o(N.FelEruption,nil,nil,nil)then L=1211881;return"queue Fel Eruption"end elseif y and N.FelEruption:IsCastable(BypassRecovery)and N.FelEruption:CooldownRemains(BypassRecovery)<=0 and N.FelEruption:IsAvailable()and X.TargetIsValid()then if o(N.FelEruption,nil,nil,nil)then K=211881;return"queue Fel Eruption"end elseif(not N.FelEruption:IsUsableP()and g:Fury()>10 or N.FelEruption:CooldownRemains()>0 or not N.FelEruption:IsAvailable())and y then HeroRotationCharDB.Toggles[45]=not HeroRotationCharDB.Toggles[45]l.Print("Fel Eruption Queue is now "..(HeroRotationCharDB.Toggles[45]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and N.ChaosNova:IsCastable(BypassRecovery)and N.ChaosNova:CooldownRemains(BypassRecovery)<=0 and g:Fury()>=30 then if o(N.ChaosNova,nil,nil,nil)then K=179057;return"queue Chaos Nova MO"end elseif(not N.ChaosNova:IsUsableP()and g:Fury()>30 or N.ChaosNova:CooldownRemains()>0 or not X.TargetIsValid())and z then HeroRotationCharDB.Toggles[46]=not HeroRotationCharDB.Toggles[46]l.Print("ChaosNova Queue is now "..(HeroRotationCharDB.Toggles[46]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and N.FelRush:IsCastable(BypassRecovery)and N.FelRush:CooldownRemains(BypassRecovery)<=0 then if o(N.FelRush,nil,nil,nil)then K=195072;return"queue FelRush"end elseif(not N.FelRush:IsUsableP()or N.FelRush:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[48]=not HeroRotationCharDB.Toggles[48]l.Print("Fel Rush Queue is now "..(HeroRotationCharDB.Toggles[48]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if C and N.Darkness:IsCastable(BypassRecovery)and N.Darkness:CooldownRemains(BypassRecovery)<=0 then if o(N.Darkness,nil,nil,nil)then K=196718;return"queue FelRush"end elseif(not N.Darkness:IsUsableP()or N.Darkness:CooldownRemains()>0)and C then HeroRotationCharDB.Toggles[49]=not HeroRotationCharDB.Toggles[49]l.Print("Darkness Queue is now "..(HeroRotationCharDB.Toggles[49]and"|cff00ff00on|r."or"|cffff0000off|r."))end;av()for ay=1,25 do local az,aA,aA,aB=UnitBuff("target",ay)if aB~=nil and aB=="Magic"then if N.ConsumeMagic:IsCastable()and F and h:IsInRange(30)then if o(N.ConsumeMagic,nil)then K=278326;return"Consume Magic"end end end end;if N.Blur:IsCastable()and g:HealthPercentage()<=Y.Havoc.BlurHealthThreshold and g:AffectingCombat()then if o(N.Blur,nil)then K=198589;return"Blur defensives (Danger)"end end;if g:HealthPercentage()<Y.Havoc.PhialHP and O.PhialofSerenity:IsReady()and O.PhialofSerenity:CooldownRemains()<=0 and CovenantID==1 then if l.Cast(O.PhialofSerenity,nil)then K=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<Y.Havoc.HealthstoneHP and O.Healthstone:IsReady()and O.Healthstone:CooldownRemains()<=0 then if l.Cast(O.Healthstone,nil)then K=40;return"Healthstone HP"end end;if g:HealthPercentage()<Y.Havoc.HealPotHP and O.CosmicHealPot:IsReady()and O.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(O.CosmicHealPot,nil)then K=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<Y.Havoc.HealPotHP and O.HealPot:IsReady()and O.HealPot:CooldownRemains()<=0 then if l.Cast(O.HealPot,nil)then K=41;return"HealPot HP"end end;if X.TargetIsValid()or g:AffectingCombat()then if L>0 then L=0 end;if K>0 then K=0 end;ab=d.BossFightRemains()ac=ab;if ac==11111 then ac=d.FightRemains(T,false)end;a7=g:GCD()+0.25;a8=d.CombatTime()end;if X.TargetIsValid()and(g:AffectingCombat()or r)then if not g:AffectingCombat()and r then local aC=ap()if aC then return aC end end;a0=N.FirstBlood:IsAvailable()or N.TrailofRuin:IsAvailable()or N.ChaosTheory:IsAvailable()and g:BuffDown(N.ChaosTheoryBuff)or V>1;a1=a0 and g:Fury()<75-G(N.DemonBlades:IsAvailable())*20 and N.BladeDance:CooldownRemains()<a7;a2=N.Demonic:IsAvailable()and not N.BlindFury:IsAvailable()and N.EyeBeam:CooldownRemains()<a7*2 and g:FuryDeficit()>30;a4=N.Momentum:IsAvailable()and g:BuffDown(N.MomentumBuff)or N.Inertia:IsAvailable()and g:BuffDown(N.InertiaBuff)local aD=J(N.EyeBeam:BaseDuration(),g:GCD())a5=N.Demonic:IsAvailable()and N.EssenceBreak:IsAvailable()and _ and ac>N.Metamorphosis:CooldownRemains()+30+G(N.ShatteredDestiny:IsAvailable())*60 and N.Metamorphosis:CooldownRemains()<20 and N.Metamorphosis:CooldownRemains()>aD+a7*(G(N.InnerDemon:IsAvailable())+2)if N.ImmolationAura:IsCastable()and not v and(N.Ragefire:IsAvailable()and V>=3 and(N.BladeDance:CooldownDown()or h:DebuffDown(N.EssenceBreakDebuff)))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 2"end end;local aC=X.Interrupt(10,N.Disrupt,Y.Commons.OffGCDasOffGCD.Disrupt,Z)if aC then return aC end;if N.ImmolationAura:IsCastable()and not v and(N.AFireInside:IsAvailable()and N.Inertia:IsAvailable()and g:BuffDown(N.UnboundChaosBuff)and N.ImmolationAura:FullRechargeTime()<a7*2 and h:DebuffDown(N.EssenceBreakDebuff))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 4"end end;if N.FelRush:IsCastable()and af and am()and(g:BuffUp(N.UnboundChaosBuff)and(N.ImmolationAura:Charges()==2 and h:DebuffDown(N.EssenceBreakDebuff)or g:PrevGCDP(1,N.EyeBeam)and g:BuffUp(N.InertiaBuff)and g:BuffRemains(N.InertiaBuff)<3))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 6"end end;local as=X.PotionSelected()local aE=not Y.Commons.Enabled.Potions or not as or as:TimeSinceLastCast()<30 or not as:IsReady()if N.TheHunt:IsCastable()and(a8<10 and aE and(not N.Inertia:IsAvailable()or g:BuffUp(N.MetamorphosisBuff)and h:DebuffDown(N.EssenceBreakDebuff)))then if o(N.TheHunt,nil,nil,not h:IsSpellInRange(N.TheHunt))then K=323639;return"the_hunt main 8"end end;if N.ImmolationAura:IsCastable()and(N.Inertia:IsAvailable()and(N.EyeBeam:CooldownRemains()<a7*2 or g:BuffUp(N.MetamorphosisBuff))and N.EssenceBreak:CooldownRemains()<a7*3 and g:BuffDown(N.UnboundChaosBuff)and g:BuffDown(N.InertiaBuff)and h:DebuffDown(N.EssenceBreakDebuff))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 10"end end;if N.ImmolationAura:IsCastable()and not v and(N.Inertia:IsAvailable()and g:BuffDown(N.UnboundChaosBuff)and(N.ImmolationAura:FullRechargeTime()<N.EssenceBreak:CooldownRemains()or not N.EssenceBreak:IsAvailable())and h:DebuffDown(N.EssenceBreakDebuff)and(g:BuffDown(N.MetamorphosisBuff)or g:BuffRemains(N.MetamorphosisBuff)>6)and N.BladeDance:CooldownDown()and(g:Fury()<75 or N.BladeDance:CooldownRemains()<a7*2))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 12"end end;if N.FelRush:IsCastable()and af and am()and(g:BuffUp(N.UnboundChaosBuff)and(g:BuffRemains(N.UnboundChaosBuff)<a7*2 or h:TimeToDie()<a7*2))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 14"end end;if N.FelRush:IsCastable()and af and am()and(N.Inertia:IsAvailable()and g:BuffDown(N.InertiaBuff)and g:BuffUp(N.UnboundChaosBuff)and N.EyeBeam:CooldownRemains()+3>g:BuffRemains(N.UnboundChaosBuff)and(N.BladeDance:CooldownDown()or N.EssenceBreak:CooldownUp()))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 16"end end;if N.FelRush:IsCastable()and af and am()and(g:BuffUp(N.UnboundChaosBuff)and N.Inertia:IsAvailable()and g:BuffDown(N.InertiaBuff)and(g:BuffUp(N.MetamorphosisBuff)or N.EssenceBreak:CooldownRemains()>10))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 18"end end;local aC=ar()if aC then return aC end;if g:BuffUp(N.MetamorphosisBuff)and g:BuffRemains(N.MetamorphosisBuff)<a7 and V<3 then local aC=aq()if aC then return aC end end;if N.Annihilation:IsReady()and(g:BuffUp(N.InnerDemonBuff)and N.Metamorphosis:CooldownRemains()<=g:GCD()*3)then if o(N.Annihilation,nil,nil,not ak(5))then K=201427;return"annihilation main 20"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.EyeBeam:CooldownRemains()<0.3 and N.EssenceBreak:CooldownRemains()<a7*2 and a8>5 and g:Fury()>=30 and N.Inertia:IsAvailable())then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 22"end;if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 6"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and N.EssenceBreak:IsAvailable()and a8>1 and(N.EssenceBreak:CooldownRemains()>15 or N.EssenceBreak:CooldownRemains()<a7 and(not N.Demonic:IsAvailable()or g:BuffUp(N.MetamorphosisBuff)or N.EyeBeam:CooldownRemains()>15+10*G(N.CycleofHatred:IsAvailable())))and(a8<30 or g:GCDRemains()-1<0)and(not N.Initiative:IsAvailable()or g:BuffRemains(N.InitiativeBuff)<a7 or a8>4))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 24"end;if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 6"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and N.EssenceBreak:IsAvailable()and a8>1 and(N.EssenceBreak:CooldownRemains()>15 or N.EssenceBreak:CooldownRemains()<a7*2 and(g:BuffRemains(N.InitiativeBuff)<a7 and not a5 and N.EyeBeam:CooldownRemains()<=g:GCDRemains()and g:Fury()>30 or not N.Demonic:IsAvailable()or g:BuffUp(N.MetamorphosisBuff)or N.EyeBeam:CooldownRemains()>15+10*G(N.CycleofHatred:IsAvailable())))and(g:BuffDown(N.UnboundChaosBuff)or g:BuffUp(N.InertiaBuff)))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 26"end;if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 6"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(N.Initiative:IsAvailable()and not N.EssenceBreak:IsAvailable()and a8>1 and((g:BuffDown(N.InitiativeBuff)or g:PrevGCDP(1,N.DeathSweep)and N.Metamorphosis:CooldownUp()and N.ChaoticTransformation:IsAvailable())and N.Initiative:IsAvailable()))then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 28"end;if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 6"end end;if N.FelRush:IsCastable()and af and am()and(N.Momentum:IsAvailable()and g:BuffRemains(N.MomentumBuff)<a7*2 and N.EyeBeam:CooldownRemains()<=a7 and h:DebuffDown(N.EssenceBreakDebuff)and N.BladeDance:CooldownDown())then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 30"end end;if N.FelRush:IsCastable()and af and am()and(N.Inertia:IsAvailable()and g:BuffDown(N.InertiaBuff)and g:BuffUp(N.UnboundChaosBuff)and(g:BuffUp(N.MetamorphosisBuff)or N.EyeBeam:CooldownRemains()>N.ImmolationAura:Recharge()and N.EyeBeam:CooldownRemains()>4)and h:DebuffDown(N.EssenceBreakDebuff)and N.BladeDance:CooldownDown())then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 32"end end;if N.EssenceBreak:IsCastable()and((g:BuffRemains(N.MetamorphosisBuff)>a7*3 or N.EyeBeam:CooldownRemains()>10)and(not N.TacticalRetreat:IsAvailable()or g:BuffUp(N.TacticalRetreatBuff)or a8<10)and N.BladeDance:CooldownRemains()<=3.1*a7 or ac<6)then if o(N.EssenceBreak,nil,nil,not ak(10))then K=258860;return"essence_break main 34"end end;if N.DeathSweep:IsReady()and(a0 and(not N.EssenceBreak:IsAvailable()or N.EssenceBreak:CooldownRemains()>a7*2)and g:BuffDown(N.FelBarrage))then if o(N.DeathSweep,nil,nil,not ak(8))then K=210152;return"death_sweep main 36"end end;if N.TheHunt:IsCastable()and(h:DebuffDown(N.EssenceBreakDebuff)and(a8<10 or N.Metamorphosis:CooldownRemains()>10 or not O.AlgetharPuzzleBox:IsEquipped())and(V==1 or V>3 or ac<10)and(h:DebuffDown(N.EssenceBreakDebuff)and(not N.FuriousGaze:IsAvailable()or g:BuffUp(N.FuriousGazeBuff)or g:HasTier(31,4))or not g:HasTier(30,2))and a8>10)then if o(N.TheHunt,nil,nil,not h:IsSpellInRange(N.TheHunt))then K=323639;return"the_hunt main 38"end end;if N.FelBarrage:IsCastable()and(V>1 or V==1 and g:FuryDeficit()<20 and g:BuffDown(N.MetamorphosisBuff))then if o(N.FelBarrage,nil,nil,not ak(8))then K=211053;return"fel_barrage main 40"end end;if N.GlaiveTempest:IsReady()and((h:DebuffDown(N.EssenceBreakDebuff)or V>1)and g:BuffDown(N.FelBarrage))then if o(N.GlaiveTempest,nil)then K=342817;return"glaive_tempest main 42"end end;if N.Annihilation:IsReady()and(g:BuffUp(N.InnerDemonBuff)and N.EyeBeam:CooldownRemains()<=g:GCD()and g:BuffDown(N.FelBarrage))then if o(N.Annihilation,nil,nil,not ak(5))then K=201427;return"annihilation main 44"end end;if N.FelRush:IsCastable()and af and am()and(N.Momentum:IsAvailable()and N.EyeBeam:CooldownRemains()<=a7 and g:BuffRemains(N.MomentumBuff)<5 and g:BuffDown(N.MetamorphosisBuff))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 46"end end;if N.EyeBeam:IsReady()and ad and(h:DebuffDown(N.EssenceBreakDebuff)and(N.Metamorphosis:CooldownRemains()>30-G(N.CycleofHatred:IsAvailable())*15 or N.Metamorphosis:CooldownRemains()<a7*2 and(not N.EssenceBreak:IsAvailable()or N.EssenceBreak:CooldownRemains()<a7*1.5))and(g:BuffDown(N.MetamorphosisBuff)or g:BuffRemains(N.MetamorphosisBuff)>a7 or not N.RestlessHunter:IsAvailable())and(N.CycleofHatred:IsAvailable()or not N.Initiative:IsAvailable()or N.VengefulRetreat:CooldownRemains()>5 or a8<10)and g:BuffDown(N.InnerDemonBuff)or ac<15)then if o(N.EyeBeam,nil,nil,not ak(20))then K=198013;return"eye_beam main 48"end end;if N.BladeDance:IsReady()and ad and(a0 and(N.EyeBeam:CooldownRemains()>5 or O.AlgetharPuzzleBox:IsEquipped()and N.Metamorphosis:CooldownRemains()>10*g:SpellHaste()or not N.Demonic:IsAvailable())and g:BuffDown(N.FelBarrage)or g:HasTier(31,2))then if o(N.BladeDance,nil,nil,not ak(8))then K=188499;return"blade_dance main 50"end end;if N.SigilofFlame:IsCastable()and(N.AnyMeansNecessary:IsAvailable()and h:DebuffDown(N.EssenceBreakDebuff)and V>=4)then if o(N.SigilofFlame,nil,nil,not h:IsInRange(30))then K=204596;return"sigil_of_flame main 52"end end;if N.ThrowGlaive:IsCastable()and(N.Soulscar:IsAvailable()and V>=2-G(N.FuriousThrows:IsAvailable())and h:DebuffDown(N.EssenceBreakDebuff)and(N.ThrowGlaive:FullRechargeTime()<a7*3 or V>1)and not g:HasTier(31,2))then if o(N.ThrowGlaive,nil,nil,not h:IsInRange(30))then K=185123;return"throw_glaive main 54"end end;if N.ImmolationAura:IsCastable()and not v and(V>=2 and g:Fury()<70 and h:DebuffDown(N.EssenceBreakDebuff))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 56"end end;if N.Annihilation:IsReady()and(not a1 and(N.EssenceBreak:CooldownDown()or not N.EssenceBreak:IsAvailable())and g:BuffDown(N.FelBarrage)or g:HasTier(30,2))then if o(N.Annihilation,nil,nil,not ak(5))then K=201427;return"annihilation main 58"end end;if N.Felblade:IsCastable()and not w and ad and(g:FuryDeficit()>=40 and N.AnyMeansNecessary:IsAvailable()and h:DebuffDown(N.EssenceBreakDebuff)or N.AnyMeansNecessary:IsAvailable()and h:DebuffDown(N.EssenceBreakDebuff))then if o(N.Felblade,nil,nil,not h:IsSpellInRange(N.Felblade))then K=183226;return"felblade main 60"end end;if N.SigilofFlame:IsCastable()and(g:FuryDeficit()>=40 and N.AnyMeansNecessary:IsAvailable())then if o(N.SigilofFlame,nil,nil,not h:IsInRange(30))then K=204596;return"sigil_of_flame main 62"end end;if N.ThrowGlaive:IsReady()and(N.Soulscar:IsAvailable()and W>=2-G(N.FuriousThrows:IsAvailable())and h:DebuffDown(N.EssenceBreakDebuff)and not g:HasTier(31,2))then if o(N.ThrowGlaive,nil,nil,not h:IsSpellInRange(N.ThrowGlaive))then K=185123;return"throw_glaive main 64"end end;if N.ImmolationAura:IsCastable()and not v and(g:BuffStack(N.ImmolationAuraBuff)<a6 and h:IsInRange(8)and(g:BuffDown(N.UnboundChaosBuff)or not N.UnboundChaos:IsAvailable())and(N.ImmolationAura:Recharge()<N.EssenceBreak:CooldownRemains()or not N.EssenceBreak:IsAvailable()and N.EyeBeam:CooldownRemains()>N.ImmolationAura:Recharge()))then if o(N.ImmolationAura,nil,nil,not ak(8))then K=258920;return"immolation_aura main 66"end end;if N.ThrowGlaive:IsReady()and(N.Soulscar:IsAvailable()and N.ThrowGlaive:FullRechargeTime()<N.BladeDance:CooldownRemains()and g:HasTier(31,2)and g:BuffDown(N.FelBarrage)and not a2)then if o(N.ThrowGlaive,nil,nil,not h:IsSpellInRange(N.ThrowGlaive))then K=185123;return"throw_glaive main 68"end end;if N.ChaosStrike:IsReady()and ad and(not a1 and not a2 and g:BuffDown(N.FelBarrage))then if o(N.ChaosStrike,nil,nil,not h:IsSpellInRange(N.ChaosStrike))then K=162794;return"chaos_strike main 70"end end;if N.SigilofFlame:IsCastable()and(V==1 and g:FuryDeficit()>=30 and h:IsInRange(30))then if o(N.SigilofFlame,nil,nil,not h:IsInRange(30))then K=204596;return"sigil_of_flame main 72"end end;if N.Felblade:IsCastable()and not w and ad and g:FuryDeficit()>=40 then if o(N.Felblade,nil,nil,not h:IsSpellInRange(N.Felblade))then K=183226;return"felblade main 74"end end;if N.FelRush:IsCastable()and af and am()and(not N.Momentum:IsAvailable()and N.DemonBlades:IsAvailable()and N.EyeBeam:CooldownDown()and g:BuffDown(N.UnboundChaosBuff)and(N.FelRush:Recharge()<N.EssenceBreak:CooldownRemains()or not N.EssenceBreak:IsAvailable()))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 76"end end;if N.DemonsBite:IsCastable()then if X.CastTargetIf(N.DemonsBite,T,"min",an,ao,not h:IsSpellInRange(N.DemonsBite))then return"demons_bite main 72"end end;if N.FelRush:IsCastable()and af and am()and(not N.Momentum:IsAvailable()and not N.DemonBlades:IsAvailable()and V>1 and g:BuffDown(N.UnboundChaosBuff))then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 74"end end;if N.SigilofFlame:IsCastable()and(g:FuryDeficit()>=30 and h:IsInRange(30))then if o(N.SigilofFlame,nil,nil,not h:IsInRange(30))then K=204596;return"sigil_of_flame main 76"end end;if N.DemonsBite:IsCastable()then if N.DemonBlades:IsAvailable()and IsCurrentSpell(6603)~=true then if o(N.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then K=1162243;return"demons_bite or demon_blades precombat 4"end else if o(N.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then K=162243;return"demons_bite or demon_blades precombat 4"end end end;if N.FelRush:IsCastable()and af and am()and(N.Momentum:IsAvailable()and g:BuffRemains(N.MomentumBuff)<=20)then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 80"end end;if N.FelRush:IsCastable()and af and(not ak(8)and not N.Momentum:IsAvailable()and am())then if o(N.FelRush,nil,nil)then K=195072;return"fel_rush main 82"end end;if N.VengefulRetreat:IsCastable()and RetreatReady and(not N.Initiative:IsAvailable()and not ak())then if o(N.VengefulRetreat,nil)then K=198793;return"vengeful_retreat main 84"end end;if N.ThrowGlaive:IsReady()and((N.DemonBlades:IsAvailable()or not h:IsInRange(12))and h:DebuffDown(N.EssenceBreakDebuff)and h:IsSpellInRange(N.ThrowGlaive)and not g:HasTier(31,2))then if o(N.ThrowGlaive,nil,nil,not h:IsSpellInRange(N.ThrowGlaive))then K=185123;return"throw_glaive main 86"end end;if l.CastAnnotated(N.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function aF()N.BurningWoundDebuff:RegisterAuraTracking()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell()if K==0 then return 0 else return K end end;function ReturnSpellMO()if L==0 then return 0 else return L end end;l.SetAPL(577,ax,aF)