local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[40]local u=HeroRotationCharDB.Toggles[42]local v=HeroRotationCharDB.Toggles[43]local w=HeroRotationCharDB.Toggles[41]local x=HeroRotationCharDB.Toggles[44]local y=false;local z=false;local A=false;local B=false;local C=l.Cast;local D=l.CastSuggested;local E=string.match;local F=j.DemonHunter.Havoc;local G=k.DemonHunter.Havoc;local H={}local I=g:GetEquipment()local J=k(0)local K=k(0)local L,M=GetInventoryItemID("player",13)local N,M=GetInventoryItemID("player",14)if I[13]then J=k(I[13])end;if I[14]then K=k(I[14])end;local O;local P,Q;local R,S;local T=g:HasLegendaryEquipped(20)local U=g:HasLegendaryEquipped(23)local V=g:HasLegendaryEquipped(25)local W=l.Commons.Everyone;local X={General=l.GUISettings.General,Commons=l.GUISettings.APL.DemonHunter.Commons,Havoc=l.GUISettings.APL.DemonHunter.Havoc}local Y={{F.FelEruption,"Cast Fel Eruption (Interrupt)",function()return true end},{F.ChaosNova,"Cast Chaos Nova (Interrupt)",function()return true end}}local Z=0;local _=0;local a0=false;local a1=false;local a2=false;local a3=false;local a4=false;local a5=false;local a6=false;local a7=0;local a8=false;d:RegisterForEvent(function()a1=false;a2=false;a3=false;a4=false;a5=false;a6=false end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()I=g:GetEquipment()J=k(0)K=k(0)if I[13]then J=k(I[13])end;if I[14]then K=k(I[14])end;T=g:HasLegendaryEquipped(20)U=g:HasLegendaryEquipped(23)V=g:HasLegendaryEquipped(25)end,"PLAYER_EQUIPMENT_CHANGED")local function a9(aa)if aa then return 1 else return 0 end end;local function ab(aa)return aa~=0 end;local function ac(ad)if F.Felblade:TimeSinceLastCast()<=g:GCD()then return true elseif F.VengefulRetreat:TimeSinceLastCast()<1.0 and F.VengefulRetreat:TimeSinceLastCast()>0.25 or F.FelRush:TimeSinceLastCast()<1.0 then return false end;return ad and h:IsInMeleeRange(ad)or h:IsInMeleeRange(5)end;local function ae()return true end;local function af(ag)local ah=0;for ai in pairs(ag)do local aj=ag[ai]if aj:DebuffDown(F.BurningWoundDebuff)then ah=ah+1 end end;return ah end;local function ak(ag)local al=0;for ai in pairs(ag)do local aj=ag[ai]if aj:DebuffDown(F.SadisticGleeDebuff)then al=al+1 end end;return al end;local function am(an)return an:DebuffRemains(F.BurningWoundDebuff)end;local function ao(an)if V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and an:GUID()==f("mouseover"):GUID()and X.Havoc.TargetSwap=="Mouseover"then if F.DemonBlades:IsAvailable()then _=1111 else _=111 end;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and X.Havoc.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not r then _=999;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and an:GUID()==h:GUID()and h:IsInRange(8)then Z=162243;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)then return true end end;local function ap(an)return an:DebuffRemains(F.BurningWoundDebuff)end;local function aq(an)if V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and an:GUID()==f("mouseover"):GUID()and X.Havoc.TargetSwap=="Mouseover"then if F.DemonBlades:IsAvailable()then _=1111 else _=111 end;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and X.Havoc.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not r then _=999;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)and an:GUID()==h:GUID()then Z=162243;return true elseif V and an:DebuffRemains(F.BurningWoundDebuff)<4 and an:IsInRange(8)then return true end end;local function ar()if J:TrinketHasStatAnyDps()and not K:TrinketHasStatAnyDps()then a7=1 end;if K:TrinketHasStatAnyDps()and not J:TrinketHasStatAnyDps()then a7=2 end;if J:TrinketHasStatAnyDps()and K:TrinketHasStatAnyDps()or not(J:TrinketHasStatAnyDps()and K:TrinketHasStatAnyDps())then a7=0 end;a8=F.BlindFury:IsAvailable()and(T or F.DemonBlades:IsAvailable())if not h:IsInMeleeRange(5)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and h:IsInRange(15)and F.FelRush:IsCastable()and y then if C(F.FelRush,nil,nil,not h:IsInRange(15))then Z=195072;return"fel_rush precombat 2"end end;if h:IsInMeleeRange(5)and(F.DemonsBite:IsCastable()or F.DemonBlades:IsAvailable())then if F.DemonBlades:IsAvailable()and IsCurrentSpell(6603)~=true then if C(F.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then Z=1162243;return"demons_bite or demon_blades precombat 4"end else if C(F.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then Z=162243;return"demons_bite or demon_blades precombat 4"end end end end;local function as()if F.Metamorphosis:IsCastable()and A and h:IsInRange(8)and(not F.Demonic:IsAvailable()and(F.EyeBeam:CooldownRemains()>20 or not B)and(not F.SinfulBrand:IsAvailable()or h:DebuffDown(F.SinfulBrandDebuff))or d.BossFilteredFightRemains("<",25))then if C(F.Metamorphosis,nil,nil,not h:IsInRange(40))then Z=191427;return"metamorphosis cooldown 2"end end;if F.Metamorphosis:IsCastable()and A and h:IsInRange(8)and(F.Demonic:IsAvailable()and((F.EyeBeam:CooldownRemains()>20 or not B)and(not a2 or F.BladeDance:CooldownRemains()>g:GCD()))and(not F.SinfulBrand:IsAvailable()or h:DebuffDown(F.SinfulBrandDebuff))or d.BossFilteredFightRemains("<",25))then if C(F.Metamorphosis,nil,nil,not h:IsInRange(40))then Z=191427;return"metamorphosis cooldown 4"end end;if(G.PotionofPhantomFire:IsReady()or G.PotionofSpectralAgility:IsReady())and h:IsInMeleeRange(8)and l.CDsON()and s and X.Commons.Enabled.Potions and(g:BuffRemains(F.MetamorphosisBuff)>25 or d.BossFilteredFightRemains("<",60))then if C(G.PotionofPhantomFire,nil,nil)then Z=4;return"potion cooldown 6"end end;if J:IsReady()and h:IsInRange(10)and X.Commons.Enabled.TopTrinket and l.CDsON()and(a7==1 and(g:BuffUp(F.MetamorphosisBuff)or not F.Demonic:IsAvailable()and(F.Metamorphosis:CooldownRemains()>d.FightRemains(Q)or not A)or d.BossFilteredFightRemains("<=",20))or a7==2 and not K:IsReady()or a7==0)then if C(J,nil,nil)then if J:ID()==L then Z=20;return"top trinket 1"elseif J:ID()==N then Z=25;return"bot trinket 1"end end end;if K:IsReady()and h:IsInRange(10)and X.Commons.Enabled.BottomTrinket and l.CDsON()and(a7==2 and(g:BuffUp(F.MetamorphosisBuff)or not F.Demonic:IsAvailable()and(F.Metamorphosis:CooldownRemains()>d.FightRemains(Q)or not A)or d.BossFilteredFightRemains("<=",20))or a7==1 and not J:IsReady()or a7==0)then if C(K,nil,nil)then if K:ID()==L then Z=20;return"top trinket 1"elseif K:ID()==N then Z=25;return"bot trinket 1"end end end;if F.SinfulBrand:IsCastable()and h:IsInMeleeRange(30)and o and h:DebuffDown(F.SinfulBrandDebuff)then if C(F.SinfulBrand,nil,nil,not h:IsSpellInRange(F.SinfulBrand))then Z=317009;return"sinful_brand cooldown 12"end end;if F.TheHunt:IsCastable()and h:IsInRange(40)and o and(not F.Demonic:IsAvailable()and not a6 and not a1 or g:BuffUp(F.FuriousGazeBuff)or F.Demonic:IsAvailable())then if C(F.TheHunt,nil,nil,not h:IsSpellInRange(F.TheHunt))then Z=323639;return"the_hunt cooldown 14"end end;if F.ElysianDecree:IsCastable()and h:IsInRange(30)and o and R>0 then if C(F.ElysianDecree,nil,nil,not h:IsInRange(30))then Z=306830;return"elysian_decree cooldown 16"end end end;local function at()if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(F.UnboundChaos:IsAvailable()and g:BuffUp(F.UnboundChaosBuff)and F.FelRush:Charges()==2)and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 2"end end;if F.DeathSweep:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and a2 then if C(F.DeathSweep,nil,nil,not ac(8))then Z=210152;return"death_sweep demonic 4"end end;if F.GlaiveTempest:IsReady()and h:IsInMeleeRange(8)and R>0 then if C(F.GlaiveTempest,nil,nil,not h:IsInMeleeRange(8))then Z=342817;return"glaive_tempest demonic 6"end end;if F.ThrowGlaive:IsCastable()and h:IsInMeleeRange(30)and F.VengefulRetreat:TimeSinceLastCast()>1 and(F.SerratedGlaive:ConduitEnabled()and(F.EyeBeam:CooldownRemains()<6 and B)and g:BuffDown(F.MetamorphosisBuff)and h:DebuffDown(F.ExposedWoundDebuff))then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive demonic 8"end end;if F.EyeBeam:IsReady()and B and not h:IsCasting(j(355806))and h:IsInMeleeRange(10)and F.VengefulRetreat:TimeSinceLastCast()>=1 and(R>0 and(not a8 or R>1 or g:Fury()<70))then if C(F.EyeBeam,nil,nil,not h:IsInRange(20))then Z=198013;return"eye_beam demonic 10"end end;if F.BladeDance:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and(a2 and not F.Metamorphosis:CooldownUp()and(F.EyeBeam:CooldownRemains()>5 or not B))then if C(F.BladeDance,nil,nil,not ac(8))then Z=188499;return"blade_dance demonic 12"end end;if F.ImmolationAura:IsCastable()and not u and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and g:BuffDown(F.ImmolationAuraBuff)then if C(F.ImmolationAura,nil,nil,not ac(8))then Z=258920;return"immolation_aura demonic 14"end end;if F.Annihilation:IsReady()and h:IsInRange(8)and h:IsInMeleeRange(8)and not a3 then if C(F.Annihilation,nil,nil,not h:IsSpellInRange(F.Annihilation))then Z=201427;return"annihilation demonic 16"end end;if F.Felblade:IsCastable()and not v and h:IsInRange(15)and(h:IsInRange(8)or not t)and g:FuryDeficit()>=40 and(not ac()or F.VengefulRetreat:TimeSinceLastCast()>=1.0)then if C(F.Felblade,nil,nil,not h:IsSpellInRange(F.Felblade))then Z=183226;return"felblade demonic 18"end end;if F.EssenceBreak:IsCastable()and h:IsInMeleeRange(10)and F.VengefulRetreat:TimeSinceLastCast()>1 then if C(F.EssenceBreak,nil,nil,not ac(10))then Z=258860;return"essence_break demonic 20"end end;if F.ChaosStrike:IsReady()and h:IsInMeleeRange(8)and(not a3 and not a4)then if C(F.ChaosStrike,nil,nil,not h:IsSpellInRange(F.ChaosStrike))then Z=162794;return"chaos_strike demonic 22"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(F.DemonBlades:IsAvailable()and not F.EyeBeam:CooldownUp()and ae())and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 24"end end;if F.DemonsBite:IsCastable()or F.DemonBlades:IsAvailable()then if V and not F.DemonBlades:IsAvailable()and(h:DebuffRemains(F.BurningWoundDebuff)<4 or(UnitsWithoutBWCount==0 or not m()))then if C(F.DemonsBite,nil,nil,not h:IsSpellInRange(F.DemonsBite))then Z=162243;return"demons_bite 26T"end end;if W.CastTargetIf(F.DemonsBite,P,"min",ap,aq)then return"demons_bite demonic 26"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(not F.DemonBlades:IsAvailable()and R>1 and F.FelRush:Charges()==2)and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 28"end end;if F.DemonsBite:IsCastable()and not F.DemonBlades:IsAvailable()and h:IsInMeleeRange(8)and not V then if C(F.DemonsBite,nil,nil,not h:IsSpellInRange(F.DemonsBite))then Z=162243;return"demons_bite demonic 30"end end;if F.ThrowGlaive:IsCastable()and h:IsInRange(30)and not ac()then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive demonic 32"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(not ac()and ae())and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 34"end end;if F.VengefulRetreat:IsCastable()and F.EyeBeam:TimeSinceLastCast()>1 and h:IsInRange(5)and z and not t and not ac()then if C(F.VengefulRetreat,nil)then Z=198793;return"vengeful_retreat demonic 36"end end;if F.ThrowGlaive:IsCastable()and h:IsInRange(30)and F.DemonBlades:IsAvailable()then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive demonic 38"end end end;local function au()if F.VengefulRetreat:IsCastable()and F.EyeBeam:TimeSinceLastCast()>1 and h:IsInRange(5)and z and not t and(F.Momentum:IsAvailable()and g:BuffDown(F.PreparedBuff)and d.CombatTime()>1)then if C(F.VengefulRetreat,nil)then Z=198793;return"vengeful_retreat normal 2"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and((g:BuffUp(F.UnboundChaosBuff)or a6 and(not F.UnboundChaos:IsAvailable()or not F.ImmolationAura:CooldownUp()))and ae())and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 34"end end;if F.FelBarrage:IsCastable()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInMeleeRange(8)and R>1 then if C(F.FelBarrage,nil,nil,not ac(8))then Z=211053;return"fel_barrage normal 6"end end;if F.DeathSweep:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and a2 then if C(F.DeathSweep,nil,nil,not ac(8))then Z=210152;return"death_sweep normal 8"end end;if F.ImmolationAura:IsCastable()and not u and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and g:BuffDown(F.ImmolationAuraBuff)then if C(F.ImmolationAura,nil,nil,not ac(8))then Z=258920;return"immolation_aura normal 10"end end;if F.GlaiveTempest:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInMeleeRange(8)and(not a6 and R>0)then if C(F.GlaiveTempest,nil)then Z=342817;return"glaive_tempest normal 12"end end;if F.ThrowGlaive:IsCastable()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInRange(30)and(F.SerratedGlaive:ConduitEnabled()and(F.EyeBeam:CooldownRemains()<6 and B)and g:BuffDown(F.MetamorphosisBuff)and h:DebuffDown(F.ExposedWoundDebuff))then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive normal 14"end end;if F.EyeBeam:IsReady()and B and not h:IsCasting(j(355806))and h:IsInMeleeRange(10)and F.VengefulRetreat:TimeSinceLastCast()>=1 and(not a6 and(S>0 and(not a8 or R>1 or g:Fury()<70)))then if C(F.EyeBeam,nil,nil,not ac(20))then Z=198013;return"eye_beam normal 16"end end;if F.BladeDance:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>=1 and h:IsInMeleeRange(8)and a2 then if C(F.BladeDance,nil,nil,not ac(8))then Z=188499;return"blade_dance normal 18"end end;if F.Felblade:IsCastable()and not v and h:IsInMeleeRange(15)and(h:IsInRange(8)or not t)and g:FuryDeficit()>=40 and(not ac()or F.VengefulRetreat:TimeSinceLastCast()>=1.0)then if C(F.Felblade,nil,nil,not h:IsSpellInRange(F.Felblade))then Z=183226;return"felblade normal 20"end end;if F.EssenceBreak:IsCastable()and h:IsInMeleeRange(10)and F.VengefulRetreat:TimeSinceLastCast()>1 then if C(F.EssenceBreak,nil,nil,not ac(10))then Z=258860;return"essence_break normal 22"end end;if F.Annihilation:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInMeleeRange(8)and((F.DemonBlades:IsAvailable()or not a6 or g:FuryDeficit()<30 or g:BuffRemains(F.MetamorphosisBuff)<5)and not a3)then if C(F.Annihilation,nil,nil,not h:IsSpellInRange(F.Annihilation))then Z=201427;return"annihilation normal 24"end end;if F.ChaosStrike:IsReady()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInMeleeRange(8)and((F.DemonBlades:IsAvailable()or not a6 or g:FuryDeficit()<30)and not a1 and not a3)then if C(F.ChaosStrike,nil,nil,not h:IsSpellInRange(F.ChaosStrike))then Z=162794;return"chaos_strike normal 26"end end;if F.EyeBeam:IsReady()and B and not h:IsCasting(j(355806))and h:IsInMeleeRange(10)and F.VengefulRetreat:TimeSinceLastCast()>=1 and F.BlindFury:IsAvailable()then if C(F.EyeBeam,nil,nil,not h:IsInRange(20))then Z=198013;return"eye_beam normal 28"end end;if(F.DemonsBite:IsCastable()or F.DemonBlades:IsAvailable())and F.VengefulRetreat:TimeSinceLastCast()>1 then if V and not F.DemonBlades:IsAvailable()and(h:DebuffRemains(F.BurningWoundDebuff)<4 or(UnitsWithoutBWCount==0 or not m()))then if C(F.DemonsBite,nil,nil,not h:IsSpellInRange(F.DemonsBite))then Z=162243;return"demons_bite 26T"end end;if W.CastTargetIf(F.DemonsBite,P,"min",am,ao)then return"demons_bite normal 28"end end;if F.DemonsBite:IsCastable()and not F.DemonBlades:IsAvailable()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInMeleeRange(8)and not V then if C(F.DemonsBite,nil,nil,not h:IsSpellInRange(F.DemonsBite))then Z=162243;return"demons_bite normal 30"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(not F.Momentum:IsAvailable()and F.DemonBlades:IsAvailable()and ae())and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 34"end end;if F.Felblade:IsCastable()and not v and h:IsInRange(15)and(not ac()and not t)then if C(F.Felblade,nil,nil,not h:IsSpellInRange(F.Felblade))then Z=183226;return"felblade normal 34"end end;if F.FelRush:IsCastable()and h:IsInRange(15)and F.VengefulRetreat:TimeSinceLastCast()>0.75 and not t and(not ac()and not F.Momentum:IsAvailable()and ae())and y then if C(F.FelRush,nil,nil)then Z=195072;return"fel_rush demonic 34"end end;if F.VengefulRetreat:IsCastable()and F.EyeBeam:TimeSinceLastCast()>1 and h:IsInRange(5)and z and not t and not ac()then if C(F.VengefulRetreat,nil)then Z=198793;return"vengeful_retreat normal 38"end end;if F.ThrowGlaive:IsCastable()and F.VengefulRetreat:TimeSinceLastCast()>1 and h:IsInRange(30)and F.DemonBlades:IsAvailable()then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive normal 40"end end end;local function av()if m()then P=g:GetEnemiesInMeleeRange(8)Q=g:GetEnemiesInMeleeRange(20)R=#P;S=#Q else R=1;S=1 end;UnitsWithoutBWCount=af(P)UnitsWithoutSGCount=ak(P)q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=not HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[40]w=HeroRotationCharDB.Toggles[41]u=HeroRotationCharDB.Toggles[42]v=HeroRotationCharDB.Toggles[43]x=HeroRotationCharDB.Toggles[44]y=X.Havoc.FelRushMode=="All In"or X.Havoc.FelRushMode=="Safe"and F.Felblade:CooldownRemains(BypassRecovery)<=0 or X.Havoc.FelRushMode=="w/ Gap Closer"and(F.Felblade:CooldownRemains(BypassRecovery)<=0 or F.Metamorphosis:CooldownRemains(BypassRecovery)<=0 and A or F.FelRush:Charges()==2 or F.TheHunt:CooldownRemains(BypassRecovery)<=0 and o)z=X.Havoc.VengefulRetreatMode=="All In"or X.Havoc.VengefulRetreatMode=="Safe"and F.Felblade:CooldownRemains(BypassRecovery)<=0 or X.Havoc.VengefulRetreatMode=="w/ Gap Closer"and(F.Felblade:CooldownRemains(BypassRecovery)<=0 or F.Metamorphosis:CooldownRemains(BypassRecovery)<=0 and A or F.FelRush:CooldownRemains(BypassRecovery)<=0 or F.TheHunt:CooldownRemains(BypassRecovery)<=0 and o)A=false;B=false;if X.Havoc.IncludedCooldowns.Metamorphosis and l.CDsON()or X.Havoc.IncludedSmallCooldowns.Metamorphosis and(l.CDsON()or p)or not X.Havoc.IncludedSmallCooldowns.Metamorphosis and not X.Havoc.IncludedCooldowns.Metamorphosis then A=true end;if X.Havoc.IncludedCooldowns.EyeBeam and l.CDsON()or X.Havoc.IncludedSmallCooldowns.EyeBeam and(l.CDsON()or p)or not X.Havoc.IncludedSmallCooldowns.EyeBeam and not X.Havoc.IncludedCooldowns.EyeBeam then B=true end;if not BotOn then _=0;Z=0 end;if _>0 then _=0 end;if Z>0 then Z=0 end;a0=false;if g:IsChanneling(F.EyeBeam)then if C(F.Pool)then Z=9999;return"casting EB"end end;if w and F.Imprison:IsUsableP()and F.Imprison:CooldownRemains(BypassRecovery)<=0 and f("mouseover"):GUID()~=nil then if C(F.Imprison,nil,nil,nil)then _=231;return"queue Imprison MO"end elseif w and F.Imprison:IsUsableP()and F.Imprison:CooldownRemains(BypassRecovery)<=0 and W.TargetIsValid()then if C(F.Imprison,nil,nil,nil)then Z=217832;return"queue Imprison"end elseif(not F.Imprison:IsUsableP()or F.Imprison:CooldownRemains()>0 or not W.TargetIsValid())and w then HeroRotationCharDB.Toggles[41]=not HeroRotationCharDB.Toggles[41]l.Print("Imprison Queue is now "..(HeroRotationCharDB.Toggles[41]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if g:FuryDeficit()>=35 and not g:IsChanneling(F.EyeBeam)or not g:AffectingCombat()then a0=true end;if W.TargetIsValid()then if not g:AffectingCombat()and q then local O=ar()if O then return O end end;if not U and not T then a2=F.FirstBlood:IsAvailable()or R>=3-a9(F.TrailofRuin:IsAvailable())end;if U then a2=g:BuffDown(F.ChaosTheoryBuff)or F.FirstBlood:IsAvailable()and R>=2-a9(F.TrailofRuin:IsAvailable())or not F.CycleofHatred:IsAvailable()and R>=4-a9(F.TrailofRuin:IsAvailable())end;if T then a2=F.FirstBlood:IsAvailable()or(g:BuffUp(F.MetamorphosisBuff)or F.TrailofRuin:IsAvailable()or h:DebuffUp(F.EssenceBreakDebuff))and R>=3-a9(F.TrailofRuin:IsAvailable())or not F.Demonic:IsAvailable()and R>=4 end;if F.EssenceBreak:IsAvailable()and F.EssenceBreak:CooldownUp()then a2=false end;a1=not F.Demonic:IsAvailable()and(F.Metamorphosis:CooldownRemains()<6 and A)and g:FuryDeficit()>30;a3=a2 and g:Fury()<75-a9(F.FirstBlood:IsAvailable())*20;a4=F.Demonic:IsAvailable()and not F.BlindFury:IsAvailable()and(F.EyeBeam:CooldownRemains()<g:GCD()*2 and B)and g:FuryDeficit()>20;a6=F.Momentum:IsAvailable()and g:BuffDown(F.MomentumBuff)and not t;local O=W.Interrupt(10,F.Disrupt,X.Commons.OffGCDasOffGCD.Disrupt,Y)if O then return O end;for aw=1,25 do local ax,M,M,ay=UnitBuff("target",aw)if ay~=nil and ay=="Magic"then if F.ConsumeMagic:IsCastable()and x and h:IsInRange(30)then if C(F.ConsumeMagic,nil)then Z=278326;return"Consume Magic"end end end end;if G.CruciformVeinripper:IsEquipped()and h:DebuffUp(F.SadisticGleeDebuff)and UnitsWithoutSGCount>0 and X.Havoc.TargetSwap=="AutoSwap"and not r then _=999 end;if n()or o and g:AffectingCombat()then local O=as()if O then return O end end;if F.Blur:IsCastable()and g:HealthPercentage()<=X.Havoc.BlurHealthThreshold and g:AffectingCombat()then if C(F.Blur,nil)then Z=198589;return"Blur defensives (Danger)"end end;if F.ThrowGlaive:IsCastable()and F.VengefulRetreat:TimeSinceLastCast()>1 and g:AffectingCombat()and(g:BuffStack(F.FelBombardmentBuff)==5 and(g:BuffUp(F.ImmolationAuraBuff)or g:BuffDown(F.MetamorphosisBuff)))then if C(F.ThrowGlaive,nil,nil,not h:IsSpellInRange(F.ThrowGlaive))then Z=185123;return"throw_glaive fel_bombardment"end end;if F.Demonic:IsAvailable()and g:AffectingCombat()then local O=at()if O then return O end end;if true and g:AffectingCombat()then local O=au()if O then return O end end end end;local function az()end;function ReturnSpell()if Z==0 then return 0 else return Z end end;function ReturnSpellMO()if _==0 then return 0 else return _ end end;function ShouldOrb()return a0 end;l.SetAPL(577,av,az)