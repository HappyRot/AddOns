local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.Commons.Everyone.num;local q=l.Commons.Everyone.bool;local r=math.min;local s=l.Commons.Everyone;local t=l.Commons.Paladin;local u=g:GetEquipment()local v=u[13]and k(u[13])or k(0)local w=u[14]and k(u[14])or k(0)local x=GetInventoryItemID("player",13)local y=GetInventoryItemID("player",14)local z={General=l.GUISettings.General,Commons=l.GUISettings.APL.Paladin.Commons,Retribution=l.GUISettings.APL.Paladin.Retribution}local A=j.Paladin.Retribution;local B=k.Paladin.Retribution;local C={B.AlgetharPuzzleBox:ID()}local D=HeroRotationCharDB.Toggles[175]local E=HeroRotationCharDB.Toggles[176]local F=HeroRotationCharDB.Toggles[177]local G=HeroRotationCharDB.Toggles[178]local H=HeroRotationCharDB.Toggles[179]local I=HeroRotationCharDB.Toggles[180]local J=HeroRotationCharDB.Toggles[181]local K=HeroRotationCharDB.Toggles[182]local L=0;local M=0;local N;local O;local P;local Q=11111;local R=11111;local S;local T=0;local U=0;local V;local W=A.FinalVerdict:IsLearned()and A.FinalVerdict or A.TemplarsVerdict;d:RegisterForEvent(function()Q=11111;R=11111 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()W=A.FinalVerdict:IsLearned()and A.FinalVerdict or A.TemplarsVerdict end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")local function X()local Y=g:GCDRemains()local Z=r(A.CrusaderStrike:CooldownRemains(),A.BladeofJustice:CooldownRemains(),A.Judgment:CooldownRemains(),A.HammerofWrath:IsUsable()and A.HammerofWrath:CooldownRemains()or 10,A.WakeofAshes:CooldownRemains())if Y>Z then return Y end;return Z end;local function _()return g:BuffDown(A.RetributionAura)and g:BuffDown(A.DevotionAura)and g:BuffDown(A.ConcentrationAura)and g:BuffDown(A.CrusaderAura)end;local function a0()if A.ShieldofVengeance:IsCastable()then if o(A.ShieldofVengeance,nil)then L=184662;return"shield_of_vengeance precombat 6"end end;if W:IsReady()and T>=4 and h:IsSpellInRange(W)then if o(W)then L=383328;return"either verdict precombat 2"end end;if A.BladeofJustice:IsCastable()then if o(A.BladeofJustice,nil,nil,not h:IsSpellInRange(A.BladeofJustice))then L=184575;return"blade_of_justice precombat 4"end end;if A.Judgment:IsCastable()then if o(A.Judgment,nil,nil,not h:IsSpellInRange(A.Judgment))then L=275773;return"judgment precombat 6"end end;if A.HammerofWrath:IsReady()then if o(A.HammerofWrath,nil,nil,not h:IsSpellInRange(A.HammerofWrath))then L=24275;return"hammer_of_wrath precombat 8"end end;if A.CrusaderStrike:IsCastable()then if o(A.CrusaderStrike,nil,nil,not h:IsInMeleeRange(5))then L=35395;return"crusader_strike 10"end end end;local function a1()if z.Commons.Enabled.Potions and(g:BuffUp(A.AvengingWrathBuff)or g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)==10 or R<25)then local a2=s.PotionSelected()if a2 and a2:IsReady()then if l.Cast(a2,nil,nil)then L=10;return"potion cooldowns 2"end end end;if A.LightsJudgment:IsCastable()then if o(A.LightsJudgment,z.Commons.OffGCDasOffGCD.Racials,nil,not h:IsInRange(40))then L=255647;return"lights_judgment cooldowns 4"end end;if A.Fireblood:IsCastable()and(g:BuffUp(A.AvengingWrathBuff)or g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)==10)then if o(A.Fireblood,z.Commons.OffGCDasOffGCD.Racials)then L=265221;return"fireblood cooldowns 6"end end;if(z.Commons.Enabled.TopTrinket or z.Commons.Enabled.BottomTrinket)and n()then local a3=g:GetUseableTrinkets(C)if a3 and R<20 then if l.Cast(a3,nil,nil)then if a3:ID()==x and z.Commons.Enabled.TopTrinket then L=13;return"Generic use_items for "..a3:Name()elseif a3:ID()==y and z.Commons.Enabled.BottomTrinket then L=14;return"Generic use_items for "..a3:Name()end end end end;if A.ShieldofVengeance:IsCastable()and(R>15 and(not A.ExecutionSentence:IsAvailable()or h:DebuffDown(A.ExecutionSentence)))then if o(A.ShieldofVengeance,nil)then L=184662;return"shield_of_vengeance cooldowns 10"end end;if A.ExecutionSentence:IsCastable()and((g:BuffDown(A.CrusadeBuff)and A.Crusade:CooldownRemains()>15 or g:BuffStack(A.CrusadeBuff)==10 or A.AvengingWrath:CooldownRemains()<0.75 or A.AvengingWrath:CooldownRemains()>15)and(T>=4 and d.CombatTime()<5 or T>=3 and d.CombatTime()>5 or T>=2 and A.DivineAuxiliary:IsAvailable())and(h:TimeToDie()>8 and not A.ExecutionersWill:IsAvailable()or h:TimeToDie()>12))then if o(A.ExecutionSentence,nil,nil,not h:IsSpellInRange(A.ExecutionSentence))then L=343527;return"execution_sentence cooldowns 14"end end;if A.AvengingWrath:IsCastable()and(T>=4 and d.CombatTime()<5 or T>=3 and d.CombatTime()>5 or T>=2 and A.DivineAuxiliary:IsAvailable()and(A.ExecutionSentence:CooldownUp()or A.FinalReckoning:CooldownUp()))then if o(A.AvengingWrath,nil)then L=31884;return"avenging_wrath cooldowns 12"end end;if A.Crusade:IsCastable()and(T>=4 and d.CombatTime()<5 or T>=3 and d.CombatTime()>=5)then if o(A.Crusade,nil)then L=231895;return"crusade cooldowns 14"end end;if A.FinalReckoning:IsCastable()and((T>=4 and d.CombatTime()<8 or T>=3 and d.CombatTime()>=8 or T>=2 and A.DivineAuxiliary:IsAvailable())and(A.AvengingWrath:CooldownRemains()>10 or A.Crusade:CooldownDown()and(g:BuffDown(A.CrusadeBuff)or g:BuffStack(A.CrusadeBuff)>=10))and(S>0 or T==5 or T>=2 and A.DivineAuxiliary:IsAvailable()))then if o(A.FinalReckoning,nil,nil,not h:IsSpellInRange(A.FinalReckoning))then L=343721;return"final_reckoning cooldowns 18"end end end;local function a4()V=(P>=3 or P>=2 and not A.DivineArbiter:IsAvailable()or g:BuffUp(A.EmpyreanPowerBuff))and g:BuffDown(A.EmpyreanLegacyBuff)and not(g:BuffUp(A.DivineArbiterBuff)and g:BuffStack(A.DivineArbiterBuff)>24)if A.DivineStorm:IsReady()and(V and(not A.Crusade:IsAvailable()or A.Crusade:CooldownRemains()>U*3 or g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)<10))then if o(A.DivineStorm,nil,nil,not h:IsInMeleeRange(8))then L=53385;return"divine_storm finishers 2"end end;if A.JusticarsVengeance:IsReady()and(not A.Crusade:IsAvailable()or A.Crusade:CooldownRemains()>U*3 or g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)<10)then if o(A.JusticarsVengeance,nil,nil,not h:IsSpellInRange(A.JusticarsVengeance))then L=215661;return"justicars_vengeance finishers 4"end end;if W:IsReady()and(not A.Crusade:IsAvailable()or A.Crusade:CooldownRemains()>U*3 or g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)<10)then if o(W,nil,nil,not h:IsSpellInRange(W))then L=383328;return"either verdict finishers 6"end end end;local function a5()if T>=5 or g:BuffUp(A.EchoesofWrathBuff)and g:HasTier(31,4)and A.CrusadingStrikes:IsAvailable()or(h:DebuffUp(A.JudgmentDebuff)or T==4)and g:BuffUp(A.DivineResonanceBuff)and not g:HasTier(31,2)then local ShouldReturn=a4()if ShouldReturn then return ShouldReturn end end;if A.WakeofAshes:IsCastable()and(T<=2 and(A.AvengingWrath:CooldownDown()or A.Crusade:CooldownDown())and(not A.ExecutionSentence:IsAvailable()or A.ExecutionSentence:CooldownRemains()>4 or R<8))then if o(A.WakeofAshes,nil,nil,not h:IsInMeleeRange(12))then L=255937;return"wake_of_ashes generators 2"end end;if A.BladeofJustice:IsCastable()and(h:DebuffDown(A.ExpurgationDebuff)and T<=3 and g:HasTier(31,2))then if o(A.BladeofJustice,nil,nil,not h:IsSpellInRange(A.BladeofJustice))then L=184575;return"blade_of_justice generators 4"end end;if A.DivineToll:IsCastable()and(T<=2 and h:DebuffDown(A.JudgmentDebuff)and(A.AvengingWrath:CooldownRemains()>15 or A.Crusade:CooldownRemains()>15 or R<8))then if o(A.DivineToll,nil,nil,not h:IsInRange(30))then L=375576;return"divine_toll generators 4"end end;if A.Judgment:IsReady()and(h:DebuffUp(A.ExpurgationDebuff)and g:BuffDown(A.EchoesofWrathBuff)and g:HasTier(31,2))then if o(A.Judgment,nil,nil,not h:IsSpellInRange(A.Judgment))then L=275773;return"judgment generators 8"end end;if T>=3 and g:BuffUp(A.CrusadeBuff)and g:BuffStack(A.CrusadeBuff)<10 then local ShouldReturn=a4()if ShouldReturn then return ShouldReturn end end;if A.TemplarSlash:IsReady()and(A.TemplarStrike:TimeSinceLastCast()+U<4 and P>=2)then if o(A.TemplarSlash,nil,nil,not h:IsInMeleeRange(9))then L=406647;return"templar_slash generators 6"end end;if A.BladeofJustice:IsCastable()and((T<=3 or not A.HolyBlade:IsAvailable())and(P>=2 and not A.CrusadingStrikes:IsAvailable()or P>=4))then if o(A.BladeofJustice,nil,nil,not h:IsSpellInRange(A.BladeofJustice))then L=184575;return"blade_of_justice generators 8"end end;if A.HammerofWrath:IsReady()and((P<2 or not A.BlessedChampion:IsAvailable()or g:HasTier(30,4))and(T<=3 or h:HealthPercentage()>20 or not A.VanguardsMomentum:IsAvailable()))then if o(A.HammerofWrath,nil,nil,not h:IsSpellInRange(A.HammerofWrath))then L=24275;return"hammer_of_wrath generators 14"end end;if A.TemplarSlash:IsReady()and A.TemplarStrike:TimeSinceLastCast()+U<4 then if o(A.TemplarSlash,nil,nil,not h:IsSpellInRange(A.TemplarSlash))then L=406647;return"templar_slash generators 16"end end;if A.Judgment:IsReady()and(h:DebuffDown(A.JudgmentDebuff)and(T<=3 or not A.BoundlessJudgment:IsAvailable()))then if o(A.Judgment,nil,nil,not h:IsSpellInRange(A.Judgment))then L=275773;return"judgment generators 17"end end;if A.BladeofJustice:IsCastable()and(T<=3 or not A.HolyBlade:IsAvailable())then if o(A.BladeofJustice,nil,nil,not h:IsSpellInRange(A.BladeofJustice))then L=184575;return"blade_of_justice generators 18"end end;if h:HealthPercentage()<=20 or g:BuffUp(A.AvengingWrathBuff)or g:BuffUp(A.CrusadeBuff)or g:BuffUp(A.EmpyreanPowerBuff)then local ShouldReturn=a4()if ShouldReturn then return ShouldReturn end end;if A.Consecration:IsCastable()and(h:DebuffDown(A.ConsecrationDebuff)and P>=2)then if o(A.Consecration,nil,nil,not h:IsInMeleeRange(8))then L=111111;return"consecration generators 22"end end;if A.DivineHammer:IsCastable()and P>=2 then if o(A.DivineHammer,nil,nil,not h:IsInMeleeRange(8))then L=198034;return"divine_hammer generators 24"end end;if A.CrusaderStrike:IsCastable()and(A.CrusaderStrike:ChargesFractional()>=1.75 and(T<=2 or T<=3 and A.BladeofJustice:CooldownRemains()>U*2 or T==4 and A.BladeofJustice:CooldownRemains()>U*2 and A.Judgment:CooldownRemains()>U*2))then if o(A.CrusaderStrike,nil,nil,not h:IsSpellInRange(A.CrusaderStrike))then L=35395;return"crusader_strike generators 26"end end;local ShouldReturn=a4()if ShouldReturn then return ShouldReturn end;if A.TemplarSlash:IsReady()then if o(A.TemplarSlash,nil,nil,not h:IsSpellInRange(A.TemplarSlash))then L=406647;return"templar_slash generators 28"end end;if A.TemplarStrike:IsReady()then if o(A.TemplarStrike,nil,nil,not h:IsSpellInRange(A.TemplarSlash))then L=407480;return"templar_strike generators 30"end end;if A.Judgment:IsReady()and(T<=3 or not A.BoundlessJudgment:IsAvailable())then if o(A.Judgment,nil,nil,not h:IsSpellInRange(A.Judgment))then L=275773;return"judgment generators 32"end end;if A.HammerofWrath:IsReady()and(T<=3 or h:HealthPercentage()>20 or not A.VanguardsMomentum:IsAvailable())then if o(A.HammerofWrath,nil,nil,not h:IsSpellInRange(A.HammerofWrath))then L=24275;return"hammer_of_wrath generators 34"end end;if A.CrusaderStrike:IsCastable()then if o(A.CrusaderStrike,nil,nil,not h:IsSpellInRange(A.CrusaderStrike))then L=407480;return"crusader_strike generators 26"end end;if A.ArcaneTorrent:IsCastable()then if o(A.ArcaneTorrent,nil,nil,not h:IsInRange(8))then L=50613;return"arcane_torrent generators 28"end end;if A.Consecration:IsCastable()then if o(A.Consecration,nil,nil,not h:IsInMeleeRange(8))then L=111111;return"consecration generators 30"end end;if A.DivineHammer:IsCastable()then if o(A.DivineHammer,nil,nil,not h:IsInMeleeRange(8))then L=198034;return"divine_hammer generators 32"end end end;local function a6()D=HeroRotationCharDB.Toggles[175]E=HeroRotationCharDB.Toggles[176]F=HeroRotationCharDB.Toggles[177]G=HeroRotationCharDB.Toggles[178]H=HeroRotationCharDB.Toggles[179]I=HeroRotationCharDB.Toggles[180]J=HeroRotationCharDB.Toggles[181]K=HeroRotationCharDB.Toggles[182]end;local function a7()if ShouldReturn then return ShouldReturn end;if M>0 then M=0 end;if L>0 then L=0 end;if ShouldReturn then return ShouldReturn end;if g:HealthPercentage()<z.Commons.HealthstoneHP and B.Healthstone:IsReady()and B.Healthstone:CooldownRemains()<=0 then if l.Cast(B.Healthstone,nil)then L=12;return"Healthstone HP"end end;if g:HealthPercentage()<z.Commons.HealPotHP and B.CosmicHealPot:IsReady()and B.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(B.CosmicHealPot,nil)then L=11;return"CosmicHealPot HP"end end;if g:HealthPercentage()<z.Commons.HealPotHP and B.HealPot:IsReady()and not B.CosmicHealPot:IsReady()and B.HealPot:CooldownRemains()<=0 then if l.Cast(B.HealPot,nil)then L=11;return"HealPot HP"end end;if A.WordofGlory:IsCastable()and g:HolyPower()>=3 and g:HealthPercentage()<z.Retribution.WOGHP then if l.Cast(A.WordofGlory,nil)then L=85673;return"Word of Glory HP"end end;if m()then O=g:GetEnemiesInMeleeRange(8)P=#O;N=g:GetEnemiesInMeleeRange(5)else O={}P=1;N={}end;S=X()ShouldReturn=a6()if l.QueuedCast()then L=l.QueuedCast()return"Custom Queue "..j(L):ID()end;if D and A.BlessingOfFreedom:IsUsableP()and A.BlessingOfFreedom:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.BlessingOfFreedom,nil,nil,nil)then L=1044;return"queue Freedom"end elseif(not A.BlessingOfFreedom:IsUsableP()or A.BlessingOfFreedom:CooldownRemains(BypassRecovery)>0)and D then HeroRotationCharDB.Toggles[175]=not HeroRotationCharDB.Toggles[175]l.Print("Freedom Queue is now "..(HeroRotationCharDB.Toggles[175]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if E and A.HammerofJustice:IsUsableP()and A.HammerofJustice:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.HammerofJustice,nil,nil,nil)then L=853;return"queue HammerofJustice"end elseif(not A.HammerofJustice:IsUsableP()or A.HammerofJustice:CooldownRemains(BypassRecovery)>0)and E then HeroRotationCharDB.Toggles[176]=not HeroRotationCharDB.Toggles[176]l.Print("HammerofJustice Queue is now "..(HeroRotationCharDB.Toggles[176]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if F and A.BlindingLight:IsUsableP()and A.BlindingLight:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.BlindingLight,nil,nil,nil)then L=115750;return"queue BlindingLight"end elseif(not A.BlindingLight:IsUsableP()or A.BlindingLight:CooldownRemains(BypassRecovery)>0)and F then HeroRotationCharDB.Toggles[177]=not HeroRotationCharDB.Toggles[177]l.Print("BlindingLight Queue is now "..(HeroRotationCharDB.Toggles[177]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if G and A.BlessingOfProtection:IsUsableP()and A.BlessingOfProtection:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.BlessingOfProtection,nil,nil,nil)then L=1022;return"queue BlessingOfProtection"end elseif(not A.BlessingOfProtection:IsUsableP()or A.BlessingOfProtection:CooldownRemains(BypassRecovery)>0)and G then HeroRotationCharDB.Toggles[178]=not HeroRotationCharDB.Toggles[178]l.Print("BlessingOfProtection Queue is now "..(HeroRotationCharDB.Toggles[178]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if H and A.BlessingofSacrifice:IsUsableP()and A.BlessingofSacrifice:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.BlessingofSacrifice,nil,nil,nil)then L=6940;return"queue BlessingofSacrifice"end elseif(not A.BlessingofSacrifice:IsUsableP()or A.BlessingofSacrifice:CooldownRemains(BypassRecovery)>0)and H then HeroRotationCharDB.Toggles[179]=not HeroRotationCharDB.Toggles[179]l.Print("BlessingofSacrifice Queue is now "..(HeroRotationCharDB.Toggles[179]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if I and A.Repentance:IsUsableP()and A.Repentance:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.Repentance,nil,nil,nil)then L=20066;return"queue Repentance"end elseif(not A.Repentance:IsUsableP()or A.Repentance:CooldownRemains(BypassRecovery)>0)and I then HeroRotationCharDB.Toggles[180]=not HeroRotationCharDB.Toggles[180]l.Print("Repentance Queue is now "..(HeroRotationCharDB.Toggles[180]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if J and A.TurnEvil:IsUsableP()and A.TurnEvil:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.TurnEvil,nil,nil,nil)then L=10326;return"queue TurnEvil"end elseif(not A.TurnEvil:IsUsableP()or A.TurnEvil:CooldownRemains(BypassRecovery)>0)and J then HeroRotationCharDB.Toggles[181]=not HeroRotationCharDB.Toggles[181]l.Print("TurnEvil Queue is now "..(HeroRotationCharDB.Toggles[181]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if I and A.Intercession:IsUsableP()and A.Intercession:CooldownRemains(BypassRecovery)<=0 then if l.Cast(A.Intercession,nil,nil,nil)then L=391054;return"queue Intercession"end elseif(not A.Intercession:IsUsableP()or A.Intercession:CooldownRemains(BypassRecovery)>0)and I then HeroRotationCharDB.Toggles[182]=not HeroRotationCharDB.Toggles[182]l.Print("Intercession Queue is now "..(HeroRotationCharDB.Toggles[182]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if s.TargetIsValid()or g:AffectingCombat()then Q=d.BossFightRemains()R=Q;if R==11111 then R=d.FightRemains(O,false)end;U=g:GCD()T=g:HolyPower()end;if g:IsMounted()==true then if A.CrusaderAura:IsCastable()and not g:BuffUp(A.CrusaderAura)then if o(A.CrusaderAura)then L=32223;return"CrusaderAura for Mountspeed"end end else if A.RetributionAura:IsCastable()and not g:BuffUp(A.RetributionAura)then if o(A.RetributionAura)then L=183435;return"Retribution Aura for Fighting"end end end;if s.TargetIsValid()then if not g:AffectingCombat()then local ShouldReturn=a0()if ShouldReturn then return ShouldReturn end end;local ShouldReturn=s.Interrupt(5,A.Rebuke,z.Commons.OffGCDasOffGCD.Rebuke,Interrupts)if ShouldReturn then return ShouldReturn end;if n()then local ShouldReturn=a1()if ShouldReturn then return ShouldReturn end end;local ShouldReturn=a5()if ShouldReturn then return ShouldReturn end;if o(A.Pool)then return"Wait/Pool Resources"end end end;function ReturnSpell()if L==0 then return 0 else return L end end;function ReturnSpellMO()if M==0 then return 0 else return M end end;local function a8()l.Print("Retribution Paladin rotation has been updated for patch 10.2.0.")end;l.SetAPL(70,a7,a8)