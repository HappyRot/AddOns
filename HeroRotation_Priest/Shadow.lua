local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.CastSuggested;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[6]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[12]local v=HeroRotationCharDB.Toggles[60]local w=HeroRotationCharDB.Toggles[61]local x=false;local y=false;local z=false;local A=false;local B=false;local C=math.min;local D=j.Priest.Shadow;local E=k.Priest.Shadow;local F={E.DarkmoonDeckPutrescence:ID(),E.DreadfireVessel:ID(),E.EmpyrealOrdinance:ID(),E.GlyphofAssimilation:ID(),E.InscrutableQuantumDevice:ID(),E.MacabreSheetMusic:ID(),E.ShadowedOrbofTorment:ID(),E.SinfulGladiatorsBadgeofFerocity:ID(),E.SoullettingRuby:ID(),E.SunbloodAmethyst:ID()}local G=g:GetEquipment()local H=k(0)local I=k(0)local J,K=GetInventoryItemID("player",13)local L,K=GetInventoryItemID("player",14)if G[13]then H=k(G[13])end;if G[14]then I=k(G[14])end;local M;local N,O,P,Q;local R,S;local T;local U;local V=0;local W=0;local X=0;local Y=l.Commons.Everyone;local Z={General=l.GUISettings.General,Commons=l.GUISettings.APL.Priest.Commons,Shadow=l.GUISettings.APL.Priest.Shadow}local _=false;local a0=false;local a1=1;local a2=false;local a3=false;local a4=g:HasLegendaryEquipped(202)local a5=g:HasLegendaryEquipped(161)local a6=g:HasLegendaryEquipped(158)local a7=g:HasLegendaryEquipped(159)local a8=j(200174)d:RegisterForEvent(function()_=false;a0=false;a1=1;a2=false;a3=false end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()a4=g:HasLegendaryEquipped(202)a5=g:HasLegendaryEquipped(161)a6=g:HasLegendaryEquipped(158)a7=g:HasLegendaryEquipped(159)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()D.ShadowCrash:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")D.ShadowCrash:RegisterInFlight()local function a9(aa)if aa then return 1 else return 0 end end;local function ab(aa)return aa~=0 end;local function ac(ad,ae)if ae then return ad:DebuffUp(D.ShadowWordPainDebuff)and ad:DebuffUp(D.VampiricTouchDebuff)and ad:DebuffUp(D.DevouringPlagueDebuff)else return ad:DebuffUp(D.ShadowWordPainDebuff)and ad:DebuffUp(D.VampiricTouchDebuff)end end;local function af(ag)local ah=0;for ai in pairs(ag)do local aj=ag[ai]if aj:DebuffDown(D.ShadowWordPainDebuff)then ah=ah+1 end end;return ah end;local function ak(ag)local al=0;for ai in pairs(ag)do local aj=ag[ai]if aj:DebuffRefreshable(D.ShadowWordPainDebuff)then al=al+1 end end;return al end;local function am(an)return not ac(an,true)end;local function ao(an)if(an:HealthPercentage()<20 and S<4 or a8:TimeSinceLastCast()<=15 and a7)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=1136149;return true elseif(an:HealthPercentage()<20 and S<4 or a8:TimeSinceLastCast()<=15 and a7)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif(an:HealthPercentage()<20 and S<4 or a8:TimeSinceLastCast()<=15 and a7)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=136149;return true elseif(an:HealthPercentage()<20 and S<4 or a8:TimeSinceLastCast()<=15 and a7)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function ap(an)if an:TimeToDie()<20 and g:BuffDown(D.VoidformBuff)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=1319952;return true elseif an:TimeToDie()<20 and g:BuffDown(D.VoidformBuff)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif an:TimeToDie()<20 and g:BuffDown(D.VoidformBuff)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=319952;return true elseif an:TimeToDie()<20 and g:BuffDown(D.VoidformBuff)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function aq(an)if ac(an,false)and an:TimeToDie()>3 and(g:BuffDown(D.VoidformBuff)or g:BuffRemains(D.VoidformBuff)<D.VoidBolt:CooldownRemains()-0.5)and D.VampiricTouchDebuff:AuraActiveCount()>=S and S<5+6*a9(D.TwistofFate:IsAvailable())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=1263165;return true elseif ac(an,false)and an:TimeToDie()>3 and(g:BuffDown(D.VoidformBuff)or g:BuffRemains(D.VoidformBuff)<D.VoidBolt:CooldownRemains()-0.5)and D.VampiricTouchDebuff:AuraActiveCount()>=S and S<5+6*a9(D.TwistofFate:IsAvailable())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif ac(an,false)and an:TimeToDie()>3 and(g:BuffDown(D.VoidformBuff)or g:BuffRemains(D.VoidformBuff)<D.VoidBolt:CooldownRemains()-0.5)and D.VampiricTouchDebuff:AuraActiveCount()>=S and S<5+6*a9(D.TwistofFate:IsAvailable())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=263165;return true elseif ac(an,false)and an:TimeToDie()>3 and(g:BuffDown(D.VoidformBuff)or g:BuffRemains(D.VoidformBuff)<D.VoidBolt:CooldownRemains()-0.5)and D.VampiricTouchDebuff:AuraActiveCount()>=S and S<5+6*a9(D.TwistofFate:IsAvailable())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function ar(an)if(an:DebuffRefreshable(D.VampiricTouchDebuff)and(an:TimeToDie()>8 or an:IsDummy())or D.Misery:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)or g:BuffUp(D.UnfurlingDarknessBuff))and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=134914;return true elseif(an:DebuffRefreshable(D.VampiricTouchDebuff)and(an:TimeToDie()>8 or an:IsDummy())or D.Misery:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)or g:BuffUp(D.UnfurlingDarknessBuff))and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif(an:DebuffRefreshable(D.VampiricTouchDebuff)and(an:TimeToDie()>8 or an:IsDummy())or D.Misery:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)or g:BuffUp(D.UnfurlingDarknessBuff))and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=34914;return true elseif(an:DebuffRefreshable(D.VampiricTouchDebuff)and(an:TimeToDie()>8 or an:IsDummy())or D.Misery:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)or g:BuffUp(D.UnfurlingDarknessBuff))and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function as(an)if an:DebuffRefreshable(D.ShadowWordPainDebuff)and an:TimeToDie()>4 and not D.Misery:IsAvailable()and not(D.SearingNightmare:IsAvailable()and S>a1)and(not D.PsychicLink:IsAvailable()or D.PsychicLink:IsAvailable()and S<=2)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=1589;return true elseif an:DebuffRefreshable(D.ShadowWordPainDebuff)and an:TimeToDie()>4 and not D.Misery:IsAvailable()and not(D.SearingNightmare:IsAvailable()and S>a1)and(not D.PsychicLink:IsAvailable()or D.PsychicLink:IsAvailable()and S<=2)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif an:DebuffRefreshable(D.ShadowWordPainDebuff)and an:TimeToDie()>4 and not D.Misery:IsAvailable()and not(D.SearingNightmare:IsAvailable()and S>a1)and(not D.PsychicLink:IsAvailable()or D.PsychicLink:IsAvailable()and S<=2)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=589;return true elseif an:DebuffRefreshable(D.ShadowWordPainDebuff)and an:TimeToDie()>4 and not D.Misery:IsAvailable()and not(D.SearingNightmare:IsAvailable()and S>a1)and(not D.PsychicLink:IsAvailable()or D.PsychicLink:IsAvailable()and S<=2)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function at(an)if D.SearingNightmare:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)and S>2 and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=148045;return true elseif D.SearingNightmare:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)and S>2 and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif D.SearingNightmare:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)and S>2 and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=48045;return true elseif D.SearingNightmare:IsAvailable()and an:DebuffRefreshable(D.ShadowWordPainDebuff)and S>2 and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function au(an)if g:Insanity()<90 and(ac(an,true)and(not D.VoidEruption:CooldownUp()or not y or not D.HungeringVoid:IsAvailable())or g:BuffUp(D.VoidformBuff))and(not D.HungeringVoid:IsAvailable()or an:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff))and(not D.SearingNightmare:IsAvailable()or S<5)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then V=1323673;return true elseif g:Insanity()<90 and(ac(an,true)and(not D.VoidEruption:CooldownUp()or not y or not D.HungeringVoid:IsAvailable())or g:BuffUp(D.VoidformBuff))and(not D.HungeringVoid:IsAvailable()or an:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff))and(not D.SearingNightmare:IsAvailable()or S<5)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;if V==999 then starttime=GetTime()endtime=starttime+0.25 elseif V>0 and endtime~=nil and GetTime()>endtime then V=0 end;return true elseif g:Insanity()<90 and(ac(an,true)and(not D.VoidEruption:CooldownUp()or not y or not D.HungeringVoid:IsAvailable())or g:BuffUp(D.VoidformBuff))and(not D.HungeringVoid:IsAvailable()or an:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff))and(not D.SearingNightmare:IsAvailable()or S<5)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then W=323673;return true elseif g:Insanity()<90 and(ac(an,true)and(not D.VoidEruption:CooldownUp()or not y or not D.HungeringVoid:IsAvailable())or g:BuffUp(D.VoidformBuff))and(not D.HungeringVoid:IsAvailable()or an:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff))and(not D.SearingNightmare:IsAvailable()or S<5)and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function av(an)return an:HealthPercentage()end;local function aw(an)if(g:BuffUp(D.PowerInfusionBuff)or not Z.Shadow.SelfPI or E.ShadowedOrbofTorment:IsEquipped())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==f("mouseover"):GUID()and Z.Shadow.TargetSwap=="Mouseover"then if E.SoullettingRuby:ID()==GetInventoryItemID("player",13)then V=241;return true elseif E.SoullettingRuby:ID()==GetInventoryItemID("player",14)then V=251;return true end elseif(g:BuffUp(D.PowerInfusionBuff)or not Z.Shadow.SelfPI or E.ShadowedOrbofTorment:IsEquipped())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and Z.Shadow.TargetSwap=="AutoSwap"and an:GUID()~=h:GUID()and not u then V=999;return true elseif(g:BuffUp(D.PowerInfusionBuff)or not Z.Shadow.SelfPI or E.ShadowedOrbofTorment:IsEquipped())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)and an:GUID()==h:GUID()then if E.SoullettingRuby:ID()==GetInventoryItemID("player",13)then V=241;return true elseif E.SoullettingRuby:ID()==GetInventoryItemID("player",14)then V=251;return true end elseif(g:BuffUp(D.PowerInfusionBuff)or not Z.Shadow.SelfPI or E.ShadowedOrbofTorment:IsEquipped())and(an:AffectingCombat()or an:IsDummy()or an:NPCID()==153285)then return true end end;local function ax()if Y.TargetIsValid()and not g:IsDeadOrGhost()and not g:AffectingCombat()and s and not g:IsMoving()then if D.ArcaneTorrent:IsCastable()and n()then if o(D.ArcaneTorrent,nil,nil,not h:IsSpellInRange(D.ArcaneTorrent))then W=28730;return"arcane_torrent 6"end end;if Z.Commons.Enabled.Trinkets and E.ShadowedOrbofTorment:IsEquippedAndReady()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>2)then if o(E.ShadowedOrbofTorment,nil,nil)then if E.ShadowedOrbofTorment:ID()==J then W=24;return"top trinket 1"elseif E.ShadowedOrbofTorment:ID()==L then W=30;return"top trinket 2"end end end;a1=2;if D.VampiricTouch:IsCastable()then if o(D.VampiricTouch,nil,nil,not h:IsSpellInRange(D.VampiricTouch))then W=34914;return"vampiric_touch 10"end end;if D.MindBlast:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.MindBlast:CastTime()+0.5)and(D.Misery:IsAvailable()and(not a5 or not D.VoidTorrent:IsAvailable()))then if o(D.MindBlast,nil,nil,not h:IsSpellInRange(D.MindBlast))then W=8092;return"mind_blast 12"end end;if D.VoidTorrent:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>3+0.5)and z and(D.Misery:IsAvailable()and a5)then if o(D.VoidTorrent,nil,nil,not h:IsSpellInRange(D.VoidTorrent))then W=263165;return"void_torrent 14"end end;if D.MindFlay:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsChanneling(D.MindFlay)and(D.Misery:IsAvailable()and a5 and not D.VoidTorrent:IsAvailable())then if o(D.MindFlay,nil,nil,not h:IsSpellInRange(D.MindFlay))then W=15407;return"mind_flay 15"end end;if D.ShadowWordPain:IsCastable()and not D.Misery:IsAvailable()then if o(D.ShadowWordPain,nil,nil,not h:IsSpellInRange(D.ShadowWordPain))then W=589;return"shadow_word_pain 16"end end end end;local function ay()if E.DarkmoonDeckPutrescence:IsEquippedAndReady()then if o(E.DarkmoonDeckPutrescence,nil,nil,not h:IsInRange(40))then if E.DarkmoonDeckPutrescence:ID()==J then W=24;return"top trinket 1"elseif E.DarkmoonDeckPutrescence:ID()==L then W=30;return"top trinket 2"end end end;if E.SunbloodAmethyst:IsEquippedAndReady()then if o(E.SunbloodAmethyst,nil,nil,not h:IsInRange(40))then if E.SunbloodAmethyst:ID()==J then W=24;return"top trinket 1"elseif E.SunbloodAmethyst:ID()==L then W=30;return"top trinket 2"end end end;if E.GlyphofAssimilation:IsEquippedAndReady()then if o(E.GlyphofAssimilation,nil,nil,not h:IsInRange(50))then if E.GlyphofAssimilation:ID()==J then W=24;return"top trinket 1"elseif E.GlyphofAssimilation:ID()==L then W=30;return"top trinket 2"end end end;if E.DreadfireVessel:IsEquippedAndReady()then if o(E.DreadfireVessel,nil,nil,not h:IsInRange(50))then if E.DreadfireVessel:ID()==J then W=24;return"top trinket 1"elseif E.DreadfireVessel:ID()==L then W=30;return"top trinket 2"end end end end;local function az()if E.EmpyrealOrdinance:IsEquippedAndReady()and(D.VoidEruption:CooldownRemains()<=12 and y or(D.VoidEruption:CooldownRemains()>27 or not y))then if o(E.EmpyrealOrdinance,nil,nil,not h:IsInRange(40))then if E.EmpyrealOrdinance:ID()==J then W=24;return"top trinket 1"elseif E.EmpyrealOrdinance:ID()==L then W=30;return"top trinket 2"end end end;if E.InscrutableQuantumDevice:IsEquippedAndReady()and(g:BuffUp(D.VoidformBuff)and g:BuffUp(D.PowerInfusionBuff)or d.BossFilteredFightRemains("<=",20)or g:BuffUp(D.PowerInfusionBuff)and(d.BossFilteredFightRemains("<",D.VoidEruption:CooldownRemains()+15)or not y)or g:BuffUp(D.VoidformBuff)and(d.BossFilteredFightRemains("<",D.PowerInfusion:CooldownRemains()+15)or not x)or(D.PowerInfusion:CooldownRemains()>=10 or not x)and(D.VoidEruption:CooldownRemains()>=10 or not y)and d.BossFilteredFightRemains(">=",190))then if o(E.InscrutableQuantumDevice,nil,nil)then if E.InscrutableQuantumDevice:ID()==J then W=24;return"top trinket 1"elseif E.InscrutableQuantumDevice:ID()==L then W=30;return"top trinket 2"end end end;if E.MacabreSheetMusic:IsEquippedAndReady()and(D.VoidEruption:CooldownRemains()>10 or not y)then if o(E.MacabreSheetMusic,nil,nil)then if E.MacabreSheetMusic:ID()==J then W=24;return"top trinket 1"elseif E.MacabreSheetMusic:ID()==L then W=30;return"top trinket 2"end end end;if E.SoullettingRuby:IsEquippedAndReady()and(g:BuffUp(D.PowerInfusionBuff)or not Z.Shadow.SelfPI or E.ShadowedOrbofTorment:IsEquipped())then if o(E.SoullettingRuby,nil,nil)then if E.SoullettingRuby:ID()==J then W=24;return"top trinket 1"elseif E.SoullettingRuby:ID()==L then W=30;return"top trinket 2"end end end;if E.SinfulGladiatorsBadgeofFerocity:IsEquippedAndReady()and(D.VoidEruption:CooldownRemains()>=10 or not y)then if o(E.SinfulGladiatorsBadgeofFerocity,nil,nil)then if E.SinfulGladiatorsBadgeofFerocity:ID()==J then W=24;return"top trinket 1"elseif E.SinfulGladiatorsBadgeofFerocity:ID()==L then W=30;return"top trinket 2"end end end;if E.ShadowedOrbofTorment:IsEquippedAndReady()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>2.5)and(g:BuffDown(D.VoidformBuff)or g:PrevGCD(1,D.VoidBolt))then if o(E.ShadowedOrbofTorment,nil,nil)then if E.ShadowedOrbofTorment:ID()==J then W=24;return"top trinket 1"elseif E.ShadowedOrbofTorment:ID()==L then W=30;return"top trinket 2"end end end;if(not D.HungeringVoid:IsAvailable()or h:DebuffUp(D.HungeringVoidDebuff))and(g:BuffUp(D.VoidformBuff)or(D.VoidEruption:CooldownRemains()>10 or not y))then local M=ay()if M then return M end end;if g:BuffUp(D.VoidformBuff)or g:BuffUp(D.PowerInfusionBuff)or(D.VoidEruption:CooldownRemains()>10 or not y)then local aA=g:GetUseableTrinkets(F)if aA then if o(aA,nil,nil)then if aA:ID()==J then W=24;return"top trinket 1"elseif aA:ID()==L then W=30;return"top trinket 2"end end end end end;local function aB()if D.PowerInfusion:IsCastable()and x and not g:IsMoving()and(Z.Shadow.SelfPI and(g:BuffUp(D.VoidformBuff)or g:Covenant()~="Kyrian"and(D.VoidEruption:CooldownRemains()>=10 or not y)or(d.BossFilteredFightRemains("<",D.VoidEruption:CooldownRemains())or not y))and(d.BossFilteredFightRemains(">=",D.VoidEruption:CooldownRemains()+15)and y and(D.VoidEruption:CooldownRemains()<=g:GCD()*4 and y)or d.BossFilteredFightRemains(">",D.PowerInfusion:Cooldown())and x or(d.BossFilteredFightRemains("<",D.VoidEruption:CooldownRemains()+15)or not y)or g:Covenant()=="Kyrian"or g:BloodlustUp()))then if o(D.PowerInfusion,nil)then W=10060;return"power_infusion 50"end end;if D.FaeGuardians:IsReady()and q and(g:BuffDown(D.VoidformBuff)and(not D.VoidTorrent:CooldownUp()or not z or not D.VoidTorrent:IsAvailable())and(_ and S==1 or D.VampiricTouchDebuff:AuraActiveCount()==S and S>1)or g:BuffUp(D.VoidformBuff)and(D.GroveInvigoration:IsAvailable()or D.FieldofBlossoms:IsAvailable()))then if o(D.FaeGuardians,nil)then W=327661;return"fae_guardians 52"end end;if D.Mindgames:IsReady()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.Mindgames:CastTime()+0.5)and not g:IsMoving()and q then if g:Insanity()<90 and(ac(h,true)and(not D.VoidEruption:CooldownUp()or not y or not D.HungeringVoid:IsAvailable())or g:BuffUp(D.VoidformBuff))and(not D.HungeringVoid:IsAvailable()or h:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff))and(not D.SearingNightmare:IsAvailable()or S<5)then if o(D.Mindgames,nil,nil,not h:IsSpellInRange(D.Mindgames))then W=323673;return"mindgames 54"end end end;if D.UnholyNova:IsReady()and q and((g:BuffUp(D.PowerInfusionBuff)or(D.PowerInfusion:CooldownRemains()>=10 or not x)or not Z.Shadow.SelfPI)and(not D.HungeringVoid:IsAvailable()or h:DebuffUp(D.HungeringVoidDebuff)or g:BuffDown(D.VoidformBuff)))then if o(D.UnholyNova,nil,nil,not h:IsSpellInRange(D.UnholyNova))then W=324724;return"Shadow_nova 56"end end;if D.BoonoftheAscended:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.BoonoftheAscended:CastTime()+0.5)and q and(g:BuffDown(D.VoidformBuff)and(not D.VoidEruption:CooldownUp()or not y)and S>1 and not D.SearingNightmare:IsAvailable()or g:BuffUp(D.VoidformBuff)and S<2 and not D.SearingNightmare:IsAvailable()and(g:PrevGCD(1,D.VoidBolt)and(not E.EmpyrealOrdinance:IsEquipped()or not D.HungeringVoid:IsAvailable())or E.EmpyrealOrdinance:IsEquipped()and E.EmpyrealOrdinance:CooldownRemains()<=162 and h:DebuffUp(D.HungeringVoidDebuff))or g:BuffUp(D.VoidformBuff)and D.SearingNightmare:IsAvailable())then if o(D.BoonoftheAscended,nil)then W=325013;return"boon_of_the_ascended 58"end end;if Z.Commons.Enabled.Trinkets then local M=az()if M then return M end end end;local function aC()if D.AscendedBlast:IsReady()and S<=3 then if o(D.AscendedBlast,nil,nil,not h:IsSpellInRange(D.AscendedBlast))then W=235283;return"ascended_blast 70"end end;if D.AscendedNova:IsReady()and(#N>1 and S>1+a9(D.SearingNightmare:IsAvailable()))then if o(D.AscendedNova,nil,nil,not h:IsInRange(8))then W=325020;return"ascended_nova 72"end end end;local function aD()if D.SearingNightmare:IsReady()and g:IsChanneling(D.MindSear)and(a2 and not a3 or U>0 and S>1)then if o(D.SearingNightmare,nil,nil,not h:IsInRange(40))then W=341385;return"searing_nightmare 80"end end;if D.SearingNightmare:IsReady()and g:IsChanneling(D.MindSear)and(U>0 and S>2)then if o(D.SearingNightmare,nil,nil,not h:IsInRange(40))then W=341385;return"searing_nightmare 82"end end;if D.MindBlast:IsCastable()and(g:BuffUp(D.DarkThoughtBuff)and(g:IsChanneling(D.MindFlay)or g:IsChanneling(D.MindSear)))then if o(D.MindBlast,nil,nil,not h:IsSpellInRange(D.MindBlast))then W=8092;return"mind_blast 84"end end end;local function aE()if g:BuffUp(D.BoonoftheAscendedBuff)then local M=aC()if M then return M end end;if D.VoidBolt:CooldownUp()and g:BuffUp(D.DissonantEchoesBuff)then if o(D.VoidBolt,nil,nil,not h:IsInRange(40))then W=214771;return"void_bolt 90"end end;if D.VoidEruption:IsReady()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.VoidErruption:CastTime()+0.5)and y and not g:IsMoving()and(a3 and(g:Insanity()>=40 or a8:TimeSinceLastCast()<=15 and a7 and(not D.MindBlast:CooldownUp()and not D.ShadowWordDeath:CooldownUp()or S>=4)and(g:Insanity()<=85 or D.SearingNightmare:IsAvailable()and a2)and(not a8:CooldownUp()or not B)and(not D.MindBlast:CooldownUp()or S>2)))then if o(D.VoidEruption,nil,nil,not h:IsSpellInRange(D.VoidEruption))then W=228260;return"void_eruption 92"end end;if D.ShadowWordPain:IsCastable()and(g:BuffUp(D.FaeGuardiansBuff)and h:DebuffDown(D.WrathfulFaerieDebuff)and S<4)then if D.Misery:IsAvailable()and h:TimeToDie()>=6 then if o(D.VampiricTouch,nil,nil,not h:IsSpellInRange(D.VampiricTouch))then W=34914;return"vampiric_touch 94"end else if o(D.ShadowWordPain,nil,nil,not h:IsSpellInRange(D.ShadowWordPain))then W=589;return"shadow_word_pain 94"end end end;if true then local M=aB()if M then return M end end;if D.MindSear:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsMoving()and not g:IsChanneling(D.MindSear)and(D.SearingNightmare:IsAvailable()and S>a1 and T>0 and(not a8:CooldownUp()or not B))then if o(D.MindSear,nil,nil,not h:IsSpellInRange(D.MindSear))then W=48045;return"mind_sear 97"end end;if D.Damnation:IsCastable()then if Y.CastCycle(D.Damnation,P,am,not h:IsSpellInRange(D.Damnation))then W=341374;return"damnation 98"end end;if D.ShadowWordDeath:IsReady()and(a8:TimeSinceLastCast()<=15 and a7 and 15-a8:TimeSinceLastCast()<=g:GCD()+0.5)then if o(D.ShadowWordDeath,nil,nil,not h:IsSpellInRange(D.ShadowWordDeath))then W=136149;return"shadow_word_death 99"end end;if D.MindBlast:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.MindBlast:CastTime()+0.5)and not g:IsMoving()and S<4 and((D.MindBlast:Charges()>=1 and(h:DebuffUp(D.HungeringVoidDebuff)or not D.HungeringVoid:IsAvailable())or 15-a8:TimeSinceLastCast()<=D.MindBlast:CastTime()+g:GCD()+0.5)and a8:TimeSinceLastCast()<=15 and a7 and 15-a8:TimeSinceLastCast()>D.MindBlast:CastTime())then if o(D.MindBlast,nil,nil,not h:IsSpellInRange(D.MindBlast))then W=8092;return"mind_blast 100"end end;if D.VoidBolt:IsCastable()and(S<4 or D.HungeringVoid:IsAvailable()and S<=6)and(g:Insanity()<=85 and D.HungeringVoid:IsAvailable()and D.SearingNightmare:IsAvailable()and S<=6 or(D.HungeringVoid:IsAvailable()and not D.SearingNightmare:IsAvailable()or S==1))then if o(D.VoidBolt,nil,nil,not h:IsInRange(40))then W=214771;return"void_bolt 101"end end;if D.DevouringPlague:IsReady()and(S<3 or g:BuffUp(D.VoidformBuff))and((h:DebuffRefreshable(D.DevouringPlagueDebuff)or g:Insanity()>75)and(not a3 or g:Insanity()>=85)and(not D.SearingNightmare:IsAvailable()or D.SearingNightmare:IsAvailable()and not a2))then if o(D.DevouringPlague,nil,nil,not h:IsSpellInRange(D.DevouringPlague))then W=335467;return"devouring_plague 102"end end;if D.VoidBolt:IsCastable()and(S<4 or D.HungeringVoid:IsAvailable()and S<=6)and(S<4+a9(D.DissonantEchoes:ConduitEnabled())and g:Insanity()<=85 and D.SearingNightmare:IsAvailable()or not D.SearingNightmare:IsAvailable())then if o(D.VoidBolt,nil,nil,not h:IsInRange(40))then W=214771;return"void_bolt 103"end end;if D.ShadowWordDeath:IsReady()and h:IsSpellInRange(D.ShadowWordDeath)and(h:HealthPercentage()<20 and S<4 or a8:TimeSinceLastCast()<=15 and a7)then if o(D.ShadowWordDeath,nil)then W=136149;return"shadow_word_death 104"end end;if D.ShadowWordDeath:IsReady()and S<4 then if Y.CastCycle(D.ShadowWordDeath,P,ao,not h:IsSpellInRange(D.ShadowWordDeath),nil)then return"shadow_word_death 104"end end;if D.SurrenderToMadness:IsCastable()then if Y.CastCycle(D.SurrenderToMadness,P,ap,not h:IsSpellInRange(D.SurrenderToMadness),Z.Shadow.OffGCDasOffGCD.SurrenderToMadness)then return"surrender_to_madness 106"end end;if D.VoidTorrent:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>3+0.5)and z and not g:IsMoving()and S<4 then if ac(h,false)and h:TimeToDie()>3 and(g:BuffDown(D.VoidformBuff)or g:BuffRemains(D.VoidformBuff)<D.VoidBolt:CooldownRemains()-0.5)and D.VampiricTouchDebuff:AuraActiveCount()>=S and S<5+6*a9(D.TwistofFate:IsAvailable())then if o(D.VoidTorrent,nil)then W=263165;return"void_torrent 107"end end end;if a8:IsCastable()and B and(h:DebuffUp(D.VampiricTouchDebuff)and(D.SearingNightmare:IsAvailable()and S>a1 or h:DebuffUp(D.ShadowWordPainDebuff))and(not a7 or D.VampiricTouchDebuff:AuraActiveCount()>=S))then if o(D.Mindbender,nil,nil,not h:IsSpellInRange(D.Mindbender))then W=200174;return"shadowfiend/mindbender 108"end end;if D.ShadowWordDeath:IsReady()and(a6 and _ and h:TimeToX(20)>D.ShadowWordDeath:Cooldown()+g:GCD())then if o(D.ShadowWordDeath,nil,nil,not h:IsSpellInRange(D.ShadowWordDeath))then W=136149;return"shadow_word_death 112"end end;if D.ShadowCrash:IsCastable()and A then if o(D.ShadowCrash,nil,nil,not h:IsInRange(40))then W=205385;return"shadow_crash 114"end end;if D.MindSear:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsMoving()and not g:IsChanneling(D.MindSear)and(S>a1 and g:BuffUp(D.DarkThoughtBuff))then if o(D.MindSear,nil,nil,not h:IsSpellInRange(D.MindSear))then W=48045;return"mind_sear 118"end end;if D.MindFlay:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsMoving()and not g:IsCasting(D.MindFlay)and(g:BuffUp(D.DarkThoughtBuff)and not(g:BuffUp(D.VoidformBuff)and D.VoidBolt:CooldownRemains()<=g:GCD())and _)then if o(D.MindFlay,nil,nil,not h:IsSpellInRange(D.MindFlay))then W=15407;return"mind_flay 120"end end;if D.DevouringPlague:IsReady()and(S<3 or g:BuffUp(D.VoidformBuff))and S<4 and(a5 and _ and not a0)then if o(D.DevouringPlague,nil,nil,not h:IsSpellInRange(D.DevouringPlague))then W=335467;return"devouring_plague 121"end end;if D.MindBlast:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.MindBlast:CastTime()+0.5)and not g:IsMoving()and(_ and S<4+2*a9(D.Misery:IsAvailable())+D.VampiricTouchDebuff:AuraActiveCount()*a9(D.PsychicLink:IsAvailable())+C(5,S)*a9(a8:TimeSinceLastCast()<=15 and a7)and(not a7 or(not a8:CooldownUp()or not B)and a7 or D.VampiricTouchDebuff:AuraActiveCount()==S))then if o(D.MindBlast,nil,nil,not h:IsSpellInRange(D.MindBlast))then W=8092;return"mind_blast 122"end end;if D.VampiricTouch:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.VampiricTouch:CastTime()+0.5)and not g:IsMoving()and(h:DebuffRefreshable(D.VampiricTouchDebuff)and not g:IsCasting(D.VampiricTouch)and h:IsSpellInRange(D.VampiricTouch)and(h:TimeToDie()>8 or h:IsDummy()or h:NPCID()==153285)or D.Misery:IsAvailable()and h:DebuffRefreshable(D.ShadowWordPainDebuff)or g:BuffUp(D.UnfurlingDarknessBuff))then if o(D.VampiricTouch,nil)then W=34914;return"vampiric_touch 124"end end;if D.VampiricTouch:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>D.VampiricTouch:CastTime()+0.5)and not g:IsMoving()and(S<4 or S<7 and g:Insanity()<30 and g:BuffDown(D.DarkThoughtBuff))then if Y.CastCycle(D.VampiricTouch,P,ar,not h:IsSpellInRange(D.VampiricTouch))then return"vampiric_touch 124"end end;if D.ShadowWordPain:IsCastable()and S<4 and(h:DebuffRefreshable(D.ShadowWordPainDebuff)and h:TimeToDie()>4 and not D.Misery:IsAvailable()and D.PsychicLink:IsAvailable()and S>2)then if o(D.ShadowWordPain,nil,nil,not h:IsSpellInRange(D.ShadowWordPain))then W=589;return"shadow_word_pain 126"end end;if D.ShadowWordPain:IsCastable()and(h:DebuffRefreshable(D.ShadowWordPainDebuff)and h:IsSpellInRange(D.ShadowWordPain)and(h:TimeToDie()>4 or h:IsDummy()or h:NPCID()==153285)and not D.Misery:IsAvailable()and not(D.SearingNightmare:IsAvailable()and S>a1)and(not D.PsychicLink:IsAvailable()or D.PsychicLink:IsAvailable()and S<=2))then if o(D.ShadowWordPain,nil)then W=589;return"shadow_word_pain 128"end end;if D.ShadowWordPain:IsCastable()and S<4 and not D.Misery:IsAvailable()then if Y.CastCycle(D.ShadowWordPain,P,as,not h:IsSpellInRange(D.ShadowWordPain))then return"shadow_word_pain 128"end end;if D.MindSear:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsMoving()and not g:IsChanneling(D.MindSear)and S>a1 and(D.VoidBolt:CooldownRemains()>=g:GCD()or not g:BuffUp(D.VoidformBuff)or S>6)then if o(D.MindSear,nil,nil,not h:IsSpellInRange(D.MindSear))then W=48045;return"mind_sear 130"end end;if D.MindFlay:IsCastable()and(g:DebuffDown(j(240447))or g:DebuffRemains(j(240447))>1)and not g:IsMoving()and not g:IsChanneling(D.MindFlay)and S<=a1 and(D.VoidBolt:CooldownRemains()>=g:GCD()or not g:BuffUp(D.VoidformBuff))then if o(D.MindFlay,nil,nil,not h:IsSpellInRange(D.MindFlay))then W=15407;return"mind_flay 132"end end;if D.ShadowWordDeath:IsReady()and g:IsMoving()then if o(D.ShadowWordDeath,nil,nil,not h:IsSpellInRange(D.ShadowWordDeath))then W=136149;return"shadow_word_death 133"end end;if D.ShadowWordPain:IsCastable()and g:IsMoving()then if o(D.ShadowWordPain,nil,nil,not h:IsSpellInRange(D.ShadowWordPain))then W=589;return"shadow_word_pain 134"end end end;local function aF()s=HeroRotationCharDB.Toggles[6]q=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[5]u=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[60]w=HeroRotationCharDB.Toggles[61]x=false;y=false;z=false;A=false;B=false;if Z.Shadow.IncludedCooldowns.PowerInfusion and n()or Z.Shadow.IncludedSmallCooldowns.PowerInfusion and(n()or r)or not Z.Shadow.IncludedSmallCooldowns.PowerInfusion and not Z.Shadow.IncludedCooldowns.PowerInfusion then x=true end;if Z.Shadow.IncludedCooldowns.VoidErruption and n()or Z.Shadow.IncludedSmallCooldowns.VoidErruption and(n()or r)or not Z.Shadow.IncludedSmallCooldowns.VoidErruption and not Z.Shadow.IncludedCooldowns.VoidErruption then y=true end;if Z.Shadow.IncludedCooldowns.VoidTorrent and n()or Z.Shadow.IncludedSmallCooldowns.VoidTorrent and(n()or r)or not Z.Shadow.IncludedSmallCooldowns.VoidTorrent and not Z.Shadow.IncludedCooldowns.VoidTorrent then z=true end;if Z.Shadow.IncludedCooldowns.ShadowCrash and n()or Z.Shadow.IncludedSmallCooldowns.ShadowCrash and(n()or r)or not Z.Shadow.IncludedSmallCooldowns.ShadowCrash and not Z.Shadow.IncludedCooldowns.ShadowCrash then A=true end;if Z.Shadow.IncludedCooldowns.MindBender and n()or Z.Shadow.IncludedSmallCooldowns.MindBender and(n()or r)or not Z.Shadow.IncludedSmallCooldowns.MindBender and not Z.Shadow.IncludedCooldowns.MindBender then B=true end end;local function aG()N=g:GetEnemiesInMeleeRange(8)O=g:GetEnemiesInRange(30)P=g:GetEnemiesInRange(40)Q=h:GetEnemiesInSplashRange(15)J,K=GetInventoryItemID("player",13)L,K=GetInventoryItemID("player",14)if m()and Z.Commons.AoeMode=="Conservative"then R=h:GetEnemiesInSplashRangeCount(8)S=h:GetEnemiesInSplashRangeCount(15)elseif m()and Z.Commons.AoeMode=="Aggresive"then local aH=0;for aI=1,20 do local aJ="nameplate"..aI;if UnitExists(aJ)then if UnitCanAttack("player",aJ)then if UnitCanAttack("player",aJ)and UnitAffectingCombat("target")and IsItemInRange(32698,aJ)and UnitDetailedThreatSituation("player",aJ)~=nil or f(aJ):IsDummy()or string.find(UnitGUID(aJ),153285)or string.find(UnitGUID(aJ),31146)or string.find(UnitGUID(aJ),176581)or string.find(UnitGUID(aJ),179124)or string.find(UnitGUID(aJ),179010)or string.find(UnitGUID(aJ),180323)or string.find(UnitGUID(aJ),179010)or string.find(UnitGUID(aJ),179942)or string.find(UnitGUID(aJ),176521)or string.find(UnitGUID(aJ),177594)or string.find(UnitGUID(aJ),177117)or string.find(UnitGUID(aJ),176581)or string.find(UnitGUID(aJ),180840)or string.find(UnitGUID(aJ),176605)or UnitName(aJ)=="Glacial Spike"or string.find(UnitGUID(aJ),180473)or string.find(UnitGUID(aJ),180474)or string.find(UnitGUID(aJ),176929)or string.find(UnitGUID(aJ),176920)or string.find(UnitGUID(aJ),177154)or string.find(UnitGUID(aJ),177787)or string.find(UnitGUID(aJ),177889)or string.find(UnitGUID(aJ),177891)or string.find(UnitGUID(aJ),177892)or string.find(UnitGUID(aJ),168326)then aH=aH+1 end end end end;R=aH;S=aH end;if not m()then R=1;S=1 end;if v then S=10;R=10 end;T=af(Q)U=ak(Q)if not BotOn then V=0;W=0 end;if V>0 then V=0 end;if W>0 then W=0 end;M=aF()if j(200174):IsAvailable()then a8=j(200174)else a8=j(132603)end;if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if w and D.MassDispell:IsUsableP()and D.MassDispell:CooldownRemains(BypassRecovery)<=0 then if l.Cast(D.MassDispell,nil,nil,nil)then W=327830;return"queue RingOfPeace"end elseif(not D.MassDispell:IsUsableP()or D.MassDispell:CooldownRemains(BypassRecovery)>0)and w then HeroRotationCharDB.Toggles[61]=not HeroRotationCharDB.Toggles[61]l.Print("Mass Dispel Queue is now "..(HeroRotationCharDB.Toggles[61]and"|cff00ff00on|r."or"|cffff0000off|r."))end;local aK=select(1,UnitCastingInfo("player"))if g:DebuffRemains(j(240447))<0.5 and g:DebuffUp(j(240447))and(g:IsChanneling(D.MindSear)or g:IsChanneling(D.MindFlay))then if o(D.Pool,nil)then W=1999;return"Quaking Stope"end end;if g:IsChanneling(j(355321))then if o(D.Pool,nil)then W=999;return"Trinket Channel"end end;if D.Shadowform:IsCastable()and g:BuffDown(D.ShadowformBuff)then if o(D.Shadowform,nil)then W=232698;return"shadowform 4"end end;if D.PowerWordShield:IsCastable()and g:DebuffDown(D.WeakenedSoul)and not g:IsChanneling()and not g:IsCasting()and(Z.Shadow.PWS=="Moving"and g:IsMoving()or Z.Shadow.PWS=="Always"or Z.Shadow.PWS=="OOC Moving"and g:IsMoving()and not g:AffectingCombat())then if o(D.PowerWordShield,nil)then W=17;return"PW:S Settings"end end;if g:IsChanneling(D.VoidTorrent)then if o(D.Pool,nil)then W=99999;return"channeling 4"end end;if not g:AffectingCombat()and Y.TargetIsValid()and s then local M=ax()if M then return M end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if D.ShadowWordDeath:IsCastable()then if o(D.ShadowWordDeath,nil)then V=1136149;return"explosive MO SWD"end end;if D.ShadowWordPain:IsCastable()then if o(D.ShadowWordPain,nil)then V=1589;return"explosive MO SWP"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if D.ShadowWordDeath:IsCastable()then if o(D.ShadowWordDeath,nil)then W=136149;return"explosive  SWD"end end;if D.ShadowWordPain:IsCastable()then if o(D.ShadowWordPain,nil)then W=589;return"explosive  SWP"end end end;if Y.TargetIsValid()and g:AffectingCombat()and(h:AffectingCombat()or h:IsDummy()or h:NPCID()==153285 or h:NPCID()==168326 or h:NPCID()==176581 or h:NPCID()==176920)and not g:IsDeadOrGhost()then if D.Dispersion:IsCastable()and g:HealthPercentage()<Z.Shadow.DispersionHP then if o(D.Dispersion,nil)then W=47585;return"dispersion low_hp"end end;if E.PotionofPhantomFire:IsReady()and Z.Commons.Enabled.Potions and t and(g:BuffUp(D.VoidformBuff)or g:BuffUp(D.PowerInfusionBuff))then if o(E.PotionofPhantomFire,nil,nil)then W=50;return"potion_of_spectral_intellect 2"end end;_=ac(h,false)a0=ac(h,true)a2=S>2+a9(g:BuffUp(D.VoidformBuff))a3=D.VoidEruption:CooldownUp()and y and(S==1 or S>=4 or D.HungeringVoid:IsAvailable()or g:Covenant()=="Kyrian")if n()then if D.Fireblood:IsCastable()and g:BuffUp(D.VoidformBuff)then if o(D.Fireblood,nil)then W=265221;return"fireblood 22"end end;if D.Berserking:IsCastable()and g:BuffUp(D.VoidformBuff)then if o(D.Berserking,nil)then W=26297;return"berserking 24"end end;if D.LightsJudgment:IsCastable()and S>=2 then if o(D.LightsJudgment,nil,nil,not h:IsSpellInRange(D.LightsJudgment))then W=255647;return"lights_judgment 26"end end;if D.AncestralCall:IsCastable()and g:BuffUp(D.VoidformBuff)then if o(D.AncestralCall,nil)then W=274738;return"ancestral_call 28"end end;if D.BagofTricks:IsCastable()then if o(D.BagofTricks,nil,nil,not h:IsSpellInRange(D.BagofTricks))then W=312411;return"bag_of_tricks 30"end end end;if true then local M=aD()if M then return M end end;if true then local M=aE()if M then return M end end end;if Y.TargetIsValid()and not UnitIsFriend("target","player")and g:AffectingCombat()and(not h:AffectingCombat()and not h:IsDummy()and h:NPCID()~=153285)and not u then V=999 end end;local function aL()D.VampiricTouchDebuff:RegisterAuraTracking()end;function ReturnSpell()if W==0 then return 0 else return W end end;function ReturnSpellMO()if V==0 then return 0 else return V end end;l.SetAPL(258,aG,aL)