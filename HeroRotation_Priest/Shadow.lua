local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.CastSuggested;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[12]local u=HeroRotationCharDB.Toggles[60]local v=HeroRotationCharDB.Toggles[61]local w=HeroRotationCharDB.Toggles[62]local x=false;local y=false;local z=false;local A=false;local B=false;local C=0;local D=math.min;local E=j.Priest.Shadow;local F=k.Priest.Shadow;local G={F.ArchitectsIngenuityCore:ID(),F.EmpyrealOrdinance:ID(),F.InscrutableQuantumDevice:ID(),F.MacabreSheetMusic:ID(),F.ShadowedOrbofTorment:ID(),F.SinfulGladiatorsBadgeofFerocity:ID(),F.SoullettingRuby:ID(),F.TheFirstSigil:ID(),F.ScarsofFraternalStrife:ID()}local H=g:GetEquipment()local I=k(0)local J=k(0)local K,L=GetInventoryItemID("player",13)local M,L=GetInventoryItemID("player",14)if H[13]then I=k(H[13])end;if H[14]then J=k(H[14])end;local N;local O,P,Q,R;local S,T;local U;local V;local W=0;local X=0;local Y=0;local Z;local _;local a0=l.Commons.Everyone;local a1={General=l.GUISettings.General,Commons=l.GUISettings.APL.Priest.Commons,Shadow=l.GUISettings.APL.Priest.Shadow}local a2=0;local a3=0;local a4=0;local Z=0;local a5=0;local a6=false;local a7=false;local a8=1;local a9=false;local aa=false;local ab=false;local ac=false;local ad=0;local ae=false;local af=2;local ag=false;local ah=0;local ai=g:HasLegendaryEquipped(202)local aj=g:HasLegendaryEquipped(161)local ak=g:HasLegendaryEquipped(158)local al=g:HasLegendaryEquipped(159)local am=j(200174)d:RegisterForEvent(function()a6=false;a7=false;a8=1;a9=false;aa=false;ab=false;ac=false;ad=0;ae=false;af=2;ag=false;ah=0 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()ai=g:HasLegendaryEquipped(202)aj=g:HasLegendaryEquipped(161)ak=g:HasLegendaryEquipped(158)al=g:HasLegendaryEquipped(159)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()E.ShadowCrash:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")E.ShadowCrash:RegisterInFlight()local function an(ao)if ao then return 1 else return 0 end end;local function ap(ao)return ao~=0 end;local function aq(ar,as)if as then return ar:DebuffUp(E.ShadowWordPainDebuff)and(ar:DebuffUp(E.VampiricTouchDebuff)or ar:TimeToDie()<18 or ar:IsDummy())and ar:DebuffUp(E.DevouringPlagueDebuff)else return ar:DebuffUp(E.ShadowWordPainDebuff)and(ar:DebuffUp(E.VampiricTouchDebuff)or ar:TimeToDie()<18 or ar:IsDummy())end end;local function at(au)local av=0;if au~=nil then for aw in pairs(au)do local ax=au[aw]if ax:DebuffDown(E.ShadowWordPainDebuff)then av=av+1 end end end;return av end;local function ay(au)local az=0;if au~=nil then for aw in pairs(au)do local ax=au[aw]if ax:DebuffRefreshable(E.ShadowWordPainDebuff)then az=az+1 end end end;return az end;local function aA(au)local aB=0;if au~=nil then for aw in pairs(au)do local ax=au[aw]if ax:DebuffDown(E.VampiricTouch)and(ax:TimeToDie()>18 or ax:IsDummy())then aB=aB+1 end end end;return aB end;local function aC(aD)if(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy())or aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1136149;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy())or aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy())or aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=136149;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy())or aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aE(aD)if(aD:HealthPercentage()<20 and T<4 or am:TimeSinceLastCast()<=15 and al and T<=7)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1136149;return true elseif(aD:HealthPercentage()<20 and T<4 or am:TimeSinceLastCast()<=15 and al and T<=7)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif(aD:HealthPercentage()<20 and T<4 or am:TimeSinceLastCast()<=15 and al)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=136149;return true elseif(aD:HealthPercentage()<20 and T<4 or am:TimeSinceLastCast()<=15 and al)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aF(aD)if(aD:TimeToDie()<20 or aD:IsDummy())and g:BuffDown(E.VoidformBuff)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1319952;return true elseif(aD:TimeToDie()<20 or aD:IsDummy())and g:BuffDown(E.VoidformBuff)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif(aD:TimeToDie()<20 or aD:IsDummy())and g:BuffDown(E.VoidformBuff)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=319952;return true elseif(aD:TimeToDie()<20 or aD:IsDummy())and g:BuffDown(E.VoidformBuff)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aG(aD)if aq(aD,false)and(aD:TimeToDie()>=18 or aD:IsDummy())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1263165;return true elseif aq(aD,false)and(aD:TimeToDie()>=18 or aD:IsDummy())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif aq(aD,false)and(aD:TimeToDie()>=18 or aD:IsDummy())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=263165;return true elseif aq(aD,false)and(aD:TimeToDie()>=18 or aD:IsDummy())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aH(aD)if(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy()or aD:NPCID()==153285)and(aD:DebuffUp(E.VampiricTouchDebuff)or not ad)and ab>0 or E.Misery:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(E.ShadowCrash:CooldownRemains()>=aD:DebuffRemains(E.VampiricTouchDebuff)or aD:DebuffDown(E.VampiricTouchDebuff))and E.ShadowCrash:TimeSinceLastCast()>1 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=134914;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy()or aD:NPCID()==153285)and(aD:DebuffUp(E.VampiricTouchDebuff)or not ad)and ab>0 or E.Misery:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(E.ShadowCrash:CooldownRemains()>=aD:DebuffRemains(E.VampiricTouchDebuff)or aD:DebuffDown(E.VampiricTouchDebuff))and E.ShadowCrash:TimeSinceLastCast()>1 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy()or aD:NPCID()==153285)and(aD:DebuffUp(E.VampiricTouchDebuff)or not ad)and ab>0 or E.Misery:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(E.ShadowCrash:CooldownRemains()>=aD:DebuffRemains(E.VampiricTouchDebuff)or aD:DebuffDown(E.VampiricTouchDebuff))and E.ShadowCrash:TimeSinceLastCast()>1 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=34914;return true elseif(aD:DebuffRefreshable(E.VampiricTouchDebuff)and(aD:TimeToDie()>18 or aD:IsDummy()or aD:NPCID()==153285)and(aD:DebuffUp(E.VampiricTouchDebuff)or not ad)and ab>0 or E.Misery:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff))and(E.ShadowCrash:CooldownRemains()>=aD:DebuffRemains(E.VampiricTouchDebuff)or aD:DebuffDown(E.VampiricTouchDebuff))and E.ShadowCrash:TimeSinceLastCast()>1 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aI(aD)if aD:DebuffRefreshable(E.ShadowWordPainDebuff)and(aD:TimeToDie()>=18 or aD:IsDummy())and not E.Misery:IsAvailable()and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1589;return true elseif aD:DebuffRefreshable(E.ShadowWordPainDebuff)and(aD:TimeToDie()>=18 or aD:IsDummy())and not E.Misery:IsAvailable()and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif aD:DebuffRefreshable(E.ShadowWordPainDebuff)and(aD:TimeToDie()>=18 or aD:IsDummy())and not E.Misery:IsAvailable()and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=589;return true elseif aD:DebuffRefreshable(E.ShadowWordPainDebuff)and(aD:TimeToDie()>=18 or aD:IsDummy())and not E.Misery:IsAvailable()and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aJ(aD)if E.SearingNightmare:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff)and T>2 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=148045;return true elseif E.SearingNightmare:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff)and T>2 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif E.SearingNightmare:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff)and T>2 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=48045;return true elseif E.SearingNightmare:IsAvailable()and aD:DebuffRefreshable(E.ShadowWordPainDebuff)and T>2 and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aK(aD)if g:Insanity()<90 and(aq(aD,true)and(not E.VoidEruption:CooldownUp()or not y or not E.HungeringVoid:IsAvailable())or g:BuffUp(E.VoidformBuff))and(not E.HungeringVoid:IsAvailable()or aD:DebuffUp(E.HungeringVoidDebuff)or g:BuffDown(E.VoidformBuff))and(not E.SearingNightmare:IsAvailable()or T<5)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then W=1323673;return true elseif g:Insanity()<90 and(aq(aD,true)and(not E.VoidEruption:CooldownUp()or not y or not E.HungeringVoid:IsAvailable())or g:BuffUp(E.VoidformBuff))and(not E.HungeringVoid:IsAvailable()or aD:DebuffUp(E.HungeringVoidDebuff)or g:BuffDown(E.VoidformBuff))and(not E.SearingNightmare:IsAvailable()or T<5)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;if W==999 then starttime=GetTime()endtime=starttime+0.25 elseif W>0 and endtime~=nil and GetTime()>endtime then W=0 end;return true elseif g:Insanity()<90 and(aq(aD,true)and(not E.VoidEruption:CooldownUp()or not y or not E.HungeringVoid:IsAvailable())or g:BuffUp(E.VoidformBuff))and(not E.HungeringVoid:IsAvailable()or aD:DebuffUp(E.HungeringVoidDebuff)or g:BuffDown(E.VoidformBuff))and(not E.SearingNightmare:IsAvailable()or T<5)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then X=323673;return true elseif g:Insanity()<90 and(aq(aD,true)and(not E.VoidEruption:CooldownUp()or not y or not E.HungeringVoid:IsAvailable())or g:BuffUp(E.VoidformBuff))and(not E.HungeringVoid:IsAvailable()or aD:DebuffUp(E.HungeringVoidDebuff)or g:BuffDown(E.VoidformBuff))and(not E.SearingNightmare:IsAvailable()or T<5)and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aL(aD)return aD:HealthPercentage()end;local function aM(aD)if(g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or F.ShadowedOrbofTorment:IsEquipped())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==f("mouseover"):GUID()and a1.Shadow.TargetSwap=="Mouseover"then if F.SoullettingRuby:ID()==GetInventoryItemID("player",13)then W=241;return true elseif F.SoullettingRuby:ID()==GetInventoryItemID("player",14)then W=251;return true end elseif(g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or F.ShadowedOrbofTorment:IsEquipped())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and a1.Shadow.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not t then W=999;return true elseif(g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or F.ShadowedOrbofTorment:IsEquipped())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)and aD:GUID()==h:GUID()then if F.SoullettingRuby:ID()==GetInventoryItemID("player",13)then W=241;return true elseif F.SoullettingRuby:ID()==GetInventoryItemID("player",14)then W=251;return true end elseif(g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or F.ShadowedOrbofTorment:IsEquipped())and(aD:AffectingCombat()or aD:IsDummy()or aD:NPCID()==153285 or aD:NPCID()==168326)then return true end end;local function aN()if a0.TargetIsValid()and not g:IsDeadOrGhost()and not g:AffectingCombat()and(r or a1.Commons.DBMSupport and l.BossMods:GetPullTimer()<_+g:GCD()and l.BossMods:GetPullTimer()>0)and not g:IsMoving()then if E.Fleshcraft:IsCastable()and(C==0 or C>E.Fleshcraft:ExecuteTime())and not g:IsMoving()and(E.PustuleEruption:SoulbindEnabled()or E.VolatileSolvent:SoulbindEnabled())then if o(E.Fleshcraft,nil,nil)then X=324631;return"fleshcraft precombat 1"end end;if E.ArcaneTorrent:IsCastable()and n()then if o(E.ArcaneTorrent,nil,nil,not h:IsSpellInRange(E.ArcaneTorrent))then X=28730;return"arcane_torrent 6"end end;if(a1.Commons.Enabled.TopTrinket or a1.Commons.Enabled.BottomTrinket)and F.ShadowedOrbofTorment:IsEquippedAndReady()and(C==0 or C>2)then if o(F.ShadowedOrbofTorment,nil,nil)then if F.ShadowedOrbofTorment:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.ShadowedOrbofTorment:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;a8=2;if E.MindBlast:IsReady()and(C==0 or C>E.MindBlast:CastTime()+0.5)and E.Damnation:IsAvailable()then if o(E.MindBlast,nil,nil,not h:IsSpellInRange(E.MindBlast))then X=8092;return"mind_blast 11"end end;if E.VampiricTouch:IsCastable()and(C==0 or C>E.VampiricTouch:CastTime()+0.5)and not E.Damnation:IsAvailable()then if o(E.VampiricTouch,nil,nil,not h:IsSpellInRange(E.VampiricTouch))then X=34914;return"vampiric_touch 10"end end;if E.MindBlast:IsCastable()and(C==0 or C>E.MindBlast:CastTime()+0.5)and(E.Misery:IsAvailable()and(not aj or not E.VoidTorrent:IsAvailable()))then if o(E.MindBlast,nil,nil,not h:IsSpellInRange(E.MindBlast))then X=8092;return"mind_blast 12"end end;if E.VoidTorrent:IsCastable()and(C==0 or C>3+0.5)and z and(E.Misery:IsAvailable()and aj)then if o(E.VoidTorrent,nil,nil,not h:IsSpellInRange(E.VoidTorrent))then X=263165;return"void_torrent 14"end end;if E.MindFlay:IsCastable()and(C==0 or C>1)and not g:IsChanneling(E.MindFlay)and T<=a8 and(E.Misery:IsAvailable()and aj and not E.VoidTorrent:IsAvailable())then if o(E.MindFlay,nil,nil,not h:IsSpellInRange(E.MindFlay))then X=15407;return"mind_flay 15"end end;if E.ShadowWordPain:IsCastable()and not E.Misery:IsAvailable()then if o(E.ShadowWordPain,nil,nil,not h:IsSpellInRange(E.ShadowWordPain))then X=589;return"shadow_word_pain 16"end end end end;local function aO()if F.ScarsofFraternalStrife:IsEquippedAndReady()and n()and(g:BuffDown(E.ScarsofFraternalStrifeBuff4)and a4>1 or(g:BuffUp(E.VoidformBuff)or g:BuffUp(E.PowerInfusionBuff)or E.VoidEruption:CooldownRemains()>10))then if o(F.ScarsofFraternalStrife,nil,nil)then if F.ScarsofFraternalStrife:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.ScarsofFraternalStrife:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.EmpyrealOrdinance:IsEquippedAndReady()and n()and(E.VoidEruption:CooldownRemains()<=12 and y or(E.VoidEruption:CooldownRemains()>27 or not y))then if o(F.EmpyrealOrdinance,nil,nil,not h:IsInRange(40))then if F.EmpyrealOrdinance:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.EmpyrealOrdinance:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.InscrutableQuantumDevice:IsEquippedAndReady()and n()and(g:BuffUp(E.VoidformBuff)and g:BuffUp(E.PowerInfusionBuff)or d.BossFilteredFightRemains("<=",20)or g:BuffUp(E.PowerInfusionBuff)and(d.BossFilteredFightRemains("<",E.VoidEruption:CooldownRemains()+15)or not y)or g:BuffUp(E.VoidformBuff)and(d.BossFilteredFightRemains("<",E.PowerInfusion:CooldownRemains()+15)or not x)or(E.PowerInfusion:CooldownRemains()>=10 or not x)and(E.VoidEruption:CooldownRemains()>=10 or not y)and d.BossFilteredFightRemains(">=",190))then if o(F.InscrutableQuantumDevice,nil,nil)then if F.InscrutableQuantumDevice:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.InscrutableQuantumDevice:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.MacabreSheetMusic:IsEquippedAndReady()and n()and(E.VoidEruption:CooldownRemains()>10 or not y)then if o(F.MacabreSheetMusic,nil,nil)then if F.MacabreSheetMusic:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.MacabreSheetMusic:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.SoullettingRuby:IsEquippedAndReady()and n()and(g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or F.ShadowedOrbofTorment:IsEquipped())then if o(F.SoullettingRuby,nil,nil)then if F.SoullettingRuby:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.SoullettingRuby:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.TheFirstSigil:IsEquippedAndReady()and n()and(g:BuffUp(E.VoidformBuff)or g:BuffUp(E.PowerInfusionBuff)or not a1.Shadow.SelfPI or E.VoidEruption:CooldownRemains()>10 or F.SoullettingRuby:IsEquipped()and not F.SoullettingRuby:IsReady()or Z<20)then if o(F.TheFirstSigil,nil,nil)then if F.TheFirstSigil:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.TheFirstSigil:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.SinfulGladiatorsBadgeofFerocity:IsEquippedAndReady()and n()and(E.VoidEruption:CooldownRemains()>=10 or not y)then if o(F.SinfulGladiatorsBadgeofFerocity,nil,nil)then if F.SinfulGladiatorsBadgeofFerocity:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.SinfulGladiatorsBadgeofFerocity:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.ShadowedOrbofTorment:IsEquippedAndReady()and n()and(C==0 or C>2.5)and(E.PowerInfusion:CooldownRemains()<=10 and x and E.VoidEruption:CooldownRemains()<=10 and y and(g:BuffDown(E.VoidformBuff)or g:PrevGCD(1,E.VoidBolt)))then if o(F.ShadowedOrbofTorment,nil,nil)then if F.ShadowedOrbofTorment:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.ShadowedOrbofTorment:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if F.ArchitectsIngenuityCore:IsEquippedAndReady()and n()then if o(F.ArchitectsIngenuityCore,nil,nil,not h:IsInRange(30))then if F.ArchitectsIngenuityCore:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif F.ArchitectsIngenuityCore:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end;if n()and(g:BuffUp(E.VoidformBuff)or g:BuffUp(E.PowerInfusionBuff)or(E.VoidEruption:CooldownRemains()>10 or not y))then local aP=g:GetUseableTrinkets(G)if aP then if o(aP,nil,nil)then if aP:ID()==K and a1.Commons.Enabled.TopTrinket then X=24;return"top trinket 1"elseif aP:ID()==M and a1.Commons.Enabled.BottomTrinket then X=30;return"top trinket 2"end end end end end;local function aQ()if E.PowerInfusion:IsCastable()and x and not g:IsMoving()and(a1.Shadow.SelfPI and(g:BuffUp(E.VoidformBuff)or g:BuffUp(E.DarkAscension)))then if o(E.PowerInfusion,nil)then X=10060;return"power_infusion 50"end end;if E.VoidEruption:IsReady()and(C==0 or C>E.VoidEruption:CastTime()+0.5)and y and not g:IsMoving()and(am:IsReady()and(am:TimeSinceLastCast()<15 or not E.Mindbender:IsAvailable())and(E.MindBlast:Charges()==0 or a4>15 or g:BuffUp(E.ShadowyInsightBuff)and E.MindBlast:Charges()==g:BuffStack(E.ShadowyInsightBuff)))then if o(E.VoidEruption,nil,nil,not h:IsSpellInRange(E.VoidEruption))then X=228260;return"void_eruption 92"end end;if E.DarkAscension:IsCastable()and(C==0 or C>E.DarkAscension:CastTime()+0.5)and n()and not g:IsMoving()and(am:TimeSinceLastCast()<15 and E.MindBlast:Charges()<2 or not E.Mindbender:IsAvailable()and not am:CooldownUp()or am:CooldownRemains()>=15 and E.FaeGuardians:CooldownRemains()>=4*g:GCD())then if o(E.DarkAscension,nil)then X=391109;return"DarkAscension 51"end end;if true then local N=aO()if N then return N end end;if E.UnholyNova:IsReady()and(h:DebuffUp(E.ShadowWordPainDebuff)and ad or E.ShadowCrash:TimeSinceLastCast()<1)then if o(E.UnholyNova,nil,nil,not h:IsSpellInRange(E.UnholyNova))then X=324724;return"UnholyNova 56"end end;if E.FaeGuardians:IsReady()and((h:DebuffUp(E.ShadowWordPainDebuff)and ad or E.ShadowCrash:TimeSinceLastCast()<1)and(not E.VoidEruption:IsAvailable()or g:BuffUp(E.VoidformBuff)and not E.VoidBolt:CooldownUp()and E.MindBlast:FullRechargeTime()>g:GCD()or not E.VoidEruption:CooldownUp()and E.VoidEruption:IsAvailable()))then if o(E.FaeGuardians,nil)then X=327661;return"fae_guardians 52"end end;if am:IsCastable()and B and(h:DebuffUp(E.ShadowWordPainDebuff)and ad or E.ShadowCrash:TimeSinceLastCast()<1)then if o(am,nil,nil,not h:IsSpellInRange(E.Mindbender))then X=200174;return"shadowfiend/mindbender 108"end end end;local function aR()if true then local N=aQ()if N then return N end end;if E.ShadowWordDeath:IsReady()and am:TimeSinceLastCast()<=15 and ag and(15-am:TimeSinceLastCast()<=g:GCD()or h:HealthPercentage()<20)and T<=7 then if o(E.ShadowWordDeath,nil,nil,not h:IsSpellInRange(E.ShadowWordDeath))then X=136149;return"shadow_word_death 99"end end;if E.MindBlast:IsCastable()and(C==0 or C>E.MindBlast:CastTime()+0.5)and(not g:IsMoving()or g:BuffUp(E.DarkThoughtBuff))and(E.MindBlast:CastTime()<E.VoidBolt:CooldownRemains()or g:BuffUp(E.DarkThoughtBuff)and E.VoidBolt:CooldownRemains()>g:GCD()*1.1 or g:BuffDown(E.VoidformBuff))and((E.MindBlast:FullRechargeTime()<=g:GCD()or 15-am:TimeSinceLastCast()<=E.MindBlast:CastTime()+g:GCD())and am:TimeSinceLastCast()<=15 and ag and 15-am:TimeSinceLastCast()>E.MindBlast:CastTime()and T<=7)then if o(E.MindBlast,nil,nil,not h:IsSpellInRange(E.MindBlast))then X=8092;return"mind_blast 100"end end;if E.Damnation:IsCastable()then if a0.CastCycle(E.Damnation,Q,aC,not h:IsSpellInRange(E.Damnation))then X=341374;return"damnation 98"end end;if E.VoidBolt:IsCastable()and a6 and g:Insanity()<=85 then if o(E.VoidBolt,nil,nil,not h:IsInRange(40))then X=214771;return"void_bolt 90"end end;if E.MindSear:IsCastable()and g:Insanity()>50 and(C==0 or C>1)and not g:IsMoving()and not g:IsChanneling(E.MindSear)and((T>a8 or g:BuffUp(E.VoidformBuff))and g:BuffUp(E.MindDevourerBuff))then if o(E.MindSear,nil,nil,not h:IsSpellInRange(E.MindSear))then X=48045;return"mind_sear 97"end end;if g:IsChanneling(E.MindSear)then if o(E.Pool,nil)then X=99999;return"channeling 4"end end;if E.MindSear:IsCastable()and g:Insanity()>50 and(C==0 or C>1)and not g:IsMoving()and not g:IsChanneling(E.MindSear)and T>a8 then if o(E.MindSear,nil,nil,not h:IsSpellInRange(E.MindSear))then X=48045;return"mind_sear 97"end end;if E.DevouringPlague:IsReady()and(h:DebuffRefreshable(E.DevouringPlagueDebuff)and not ae or g:Insanity()>75 or E.VoidTorrent:IsAvailable()and E.VoidTorrent:CooldownRemains()<=3*g:GCD()and z or g:BuffUp(E.MindDevourerBuff)and E.MindBlast:FullRechargeTime()<=2*g:GCD()and not E.VoidEruption:CooldownUp()and E.VoidEruption:IsAvailable())then if o(E.DevouringPlague,nil,nil,not h:IsSpellInRange(E.DevouringPlague))then X=335467;return"devouring_plague 102"end end;if E.ShadowWordDeath:IsReady()and h:IsSpellInRange(E.ShadowWordDeath)and(h:HealthPercentage()<20 and T<4 and(not ag or am:CooldownRemains()>=10)or am:TimeSinceLastCast()<=15 and ag and T<=7 or g:BuffUp(E.DeathspeakerBuff)and am:CooldownRemains()+g:GCD()>g:BuffRemains(E.DeathspeakerBuff))then if o(E.ShadowWordDeath,nil)then X=136149;return"shadow_word_death 104"end end;if E.VampiricTouch:IsCastable()and(C==0 or C>E.VampiricTouch:CastTime()+0.5)and not g:IsMoving()and not g:IsCasting(E.VampiricTouch)and h:IsSpellInRange(E.VampiricTouch)then if a0.CastCycle(E.VampiricTouch,Q,aH,not h:IsSpellInRange(E.VampiricTouch))then X=34914;return"VampiricTouch 98"end end;if E.ShadowWordPain:IsCastable()then if a0.CastCycle(E.ShadowWordPain,Q,aI,not h:IsSpellInRange(E.ShadowWordPain))then X=589;return"ShadowWordPain 98"end end;if E.MindBlast:IsCastable()and(C==0 or C>E.MindBlast:CastTime()+0.5)and(not g:IsMoving()or g:BuffUp(E.DarkThoughtBuff))and(E.MindBlast:CastTime()<E.VoidBolt:CooldownRemains()or g:BuffUp(E.DarkThoughtBuff)and E.VoidBolt:CooldownRemains()>g:GCD()*1.1 or g:BuffDown(E.VoidformBuff))and(ad and(not g:BuffUp(E.MindDevourerBuff)or E.VoidEruption:CooldownUp()and E.VoidEruption:IsAvailable()))then if o(E.MindBlast,nil,nil,not h:IsSpellInRange(E.MindBlast))then X=8092;return"mind_blast 100"end end;if E.Mindgames:IsReady()and(C==0 or C>E.Mindgames:CastTime()+0.5)and not g:IsMoving()and(T<5 and a7)then if o(E.Mindgames,nil,nil,not h:IsSpellInRange(E.Mindgames))then X=323673;return"mindgames 54"end end;if E.ShadowCrash:IsCastable()and A then if o(E.ShadowCrash,nil,nil,not h:IsInRange(40))then X=205385;return"shadow_crash 114"end end;if E.DarkVoid:IsCastable()and(q or n())then if o(E.DarkVoid,nil,nil,not h:IsInRange(40))then X=263346;return"DarkVoid 114"end end;if E.DevouringPlague:IsReady()and(g:BuffUp(E.VoidformBuff)and a6)then if o(E.DevouringPlague,nil,nil,not h:IsSpellInRange(E.DevouringPlague))then X=335467;return"devouring_plague 102"end end;if E.VoidTorrent:IsCastable()and(C==0 or C>3+0.5)and z and not g:IsMoving()and g:Insanity()<=35 then if a0.CastCycle(E.VoidTorrent,Q,aG,not h:IsSpellInRange(E.VoidTorrent),nil)then X=263165;return"VoidTorrent 104"end end;if E.MindBlast:IsCastable()and(C==0 or C>E.MindBlast:CastTime()+0.5)and(not g:IsMoving()or g:BuffUp(E.DarkThoughtBuff))and(E.VoidBolt:CooldownRemains()>=E.MindBlast:CastTime()or not g:BuffUp(E.VoidformBuff))and(not ag or not am:CooldownUp()and ag or ad)then if o(E.MindBlast,nil,nil,not h:IsSpellInRange(E.MindBlast))then X=8092;return"mind_blast 122"end end;if E.VampiricTouch:IsCastable()and(C==0 or C>E.VampiricTouch:CastTime()+0.5)and not g:IsMoving()and not g:IsCasting(E.VampiricTouch)and h:IsSpellInRange(E.VampiricTouch)and g:BuffUp(E.UnfurlingDarknessBuff)then if o(E.VampiricTouch,nil)then X=34914;return"vampiric_touch 127"end end;if E.MindFlay:IsCastable()and(C==0 or C>1)and not g:IsMoving()and not g:IsChanneling(E.MindFlay)and(g:BuffUp(E.MindFlayInsanityBuff)and a6 and(not g:BuffUp(E.SurgeofDarkness)or E.ScreamsoftheVoid:IsAvailable()))then if o(E.MindFlay,nil,nil,not h:IsSpellInRange(E.MindFlay))then X=15407;return"mind_flay 120"end end;if E.MindSpike:IsCastable()and(C==0 or C>E.MindSpike:CastTime())and not g:IsMoving()and(g:BuffUp(E.MindFlayInsanityBuff)and a6 and(not g:BuffUp(E.SurgeofDarkness)or E.ScreamsoftheVoid:IsAvailable()))then if o(E.MindSpike,nil,nil,not h:IsSpellInRange(E.MindSpike))then X=73510;return"MindSpike 120"end end;if E.MindFlay:IsCastable()and(C==0 or C>1)and not g:IsMoving()and not g:IsChanneling(E.MindFlay)then if o(E.MindFlay,nil,nil,not h:IsSpellInRange(E.MindFlay))then X=15407;return"MindFlay 97"end end;if g:IsChanneling(E.MindFlay)and E.MindFlay:TickTime()*2<GetTime()-g:ChannelStart()then X=1999 end;if E.ShadowWordDeath:IsReady()and g:IsMoving()then if o(E.ShadowWordDeath,nil,nil,not h:IsSpellInRange(E.ShadowWordDeath))then X=136149;return"shadow_word_death 133"end end;if E.ShadowWordPain:IsCastable()and g:IsMoving()then if o(E.ShadowWordPain,nil,nil,not h:IsSpellInRange(E.ShadowWordPain))then X=589;return"shadow_word_pain 134"end end end;local function aS()r=HeroRotationCharDB.Toggles[5]q=HeroRotationCharDB.Toggles[4]t=HeroRotationCharDB.Toggles[12]s=not HeroRotationCharDB.Toggles[15]u=HeroRotationCharDB.Toggles[60]v=HeroRotationCharDB.Toggles[61]w=HeroRotationCharDB.Toggles[62]x=false;y=false;z=false;A=false;B=false;if a1.Shadow.PowerInfusion=="CDs"and n()or a1.Shadow.PowerInfusion=="Small CDs"and(n()or q)or a1.Shadow.PowerInfusion=="Always"then x=true end;if a1.Shadow.VoidEruption=="CDs"and n()or a1.Shadow.VoidEruption=="Small CDs"and(n()or q)or a1.Shadow.VoidEruption=="Always"then y=true end;if a1.Shadow.VoidTorrent=="CDs"and n()or a1.Shadow.VoidTorrent=="Small CDs"and(n()or q)or a1.Shadow.VoidTorrent=="Always"then z=true end;if a1.Shadow.MindBender=="CDs"and n()or a1.Shadow.MindBender=="Small CDs"and(n()or q)or a1.Shadow.MindBender=="Always"then B=true end;if a1.Shadow.ShadowCrash=="CDs"and n()or a1.Shadow.ShadowCrash=="Small CDs"and(n()or q)or a1.Shadow.ShadowCrash=="Always"then A=true end;C=0;for aT=1,20 do if select(10,UnitDebuff("player",aT))==240447 then if select(6,UnitDebuff("player",aT))~=nil then C=select(6,UnitDebuff("player",aT))-GetTime()end end end;_=0;if E.Fleshcraft:IsCastable()and(C==0 or C>E.Fleshcraft:ExecuteTime())and not g:IsMoving()and(E.PustuleEruption:SoulbindEnabled()or E.VolatileSolvent:SoulbindEnabled())then _=_+3 end;if E.ArcaneTorrent:IsCastable()and n()then _=_+g:GCD()end;if(F.ShadowedOrbofTorment:ID()==K and a1.Commons.Enabled.TopTrinket or F.ShadowedOrbofTorment:ID()==M and a1.Commons.Enabled.BottomTrinket)and F.ShadowedOrbofTorment:IsEquippedAndReady()and(C==0 or C>2)then _=_+2 end;if E.VampiricTouch:IsCastable()and(C==0 or C>E.VampiricTouch:CastTime()+0.5)and not E.Damnation:IsAvailable()then _=_+E.VampiricTouch:CastTime()end;if E.MindBlast:IsReady()and(C==0 or C>E.MindBlast:CastTime()+0.5)and E.Damnation:IsAvailable()then _=_+E.MindBlast:CastTime()end end;local function aU()O=g:GetEnemiesInMeleeRange(8)P=g:GetEnemiesInRange(30)Q=g:GetEnemiesInRange(40)R=h:GetEnemiesInSplashRange(15)K,L=GetInventoryItemID("player",13)M,L=GetInventoryItemID("player",14)if m()and a1.Commons.AoeMode=="Conservative"then S=h:GetEnemiesInSplashRangeCount(8)T=h:GetEnemiesInSplashRangeCount(15)elseif m()and a1.Commons.AoeMode=="Aggresive"then local aV=0;for aW=1,20 do local aX="nameplate"..aW;if UnitExists(aX)then if UnitCanAttack("player",aX)then if UnitCanAttack("player",aX)and UnitAffectingCombat("target")and IsItemInRange(32698,aX)and UnitDetailedThreatSituation("player",aX)~=nil or f(aX):IsDummy()or string.find(UnitGUID(aX),153285)or string.find(UnitGUID(aX),31146)or string.find(UnitGUID(aX),176581)or string.find(UnitGUID(aX),179124)or string.find(UnitGUID(aX),179010)or string.find(UnitGUID(aX),180323)or string.find(UnitGUID(aX),179010)or string.find(UnitGUID(aX),179942)or string.find(UnitGUID(aX),176521)or string.find(UnitGUID(aX),177594)or string.find(UnitGUID(aX),177117)or string.find(UnitGUID(aX),176581)or string.find(UnitGUID(aX),180840)or string.find(UnitGUID(aX),176605)or UnitName(aX)=="Glacial Spike"or string.find(UnitGUID(aX),180473)or string.find(UnitGUID(aX),180474)or string.find(UnitGUID(aX),176929)or string.find(UnitGUID(aX),176920)or string.find(UnitGUID(aX),177154)or string.find(UnitGUID(aX),177787)or string.find(UnitGUID(aX),177889)or string.find(UnitGUID(aX),177891)or string.find(UnitGUID(aX),177892)or string.find(UnitGUID(aX),168326)or string.find(UnitGUID(aX),182778)or string.find(UnitGUID(aX),183945)then aV=aV+1 end end end end;S=aV;T=aV end;local aY=0;for aZ=1,20 do local aX="nameplate"..aZ;if UnitExists(aX)then if UnitCanAttack("player",aX)then if UnitCanAttack("player",aX)and UnitAffectingCombat("target")and IsItemInRange(32698,aX)and UnitDetailedThreatSituation("player",aX)~=nil and f(aX):TimeToDie()>=18 or f(aX):IsDummy()or string.find(UnitGUID(aX),153285)or string.find(UnitGUID(aX),31146)or string.find(UnitGUID(aX),176581)or string.find(UnitGUID(aX),179124)or string.find(UnitGUID(aX),179010)or string.find(UnitGUID(aX),180323)or string.find(UnitGUID(aX),179010)or string.find(UnitGUID(aX),179942)or string.find(UnitGUID(aX),176521)or string.find(UnitGUID(aX),177594)or string.find(UnitGUID(aX),177117)or string.find(UnitGUID(aX),176581)or string.find(UnitGUID(aX),180840)or string.find(UnitGUID(aX),176605)or UnitName(aX)=="Glacial Spike"or string.find(UnitGUID(aX),180473)or string.find(UnitGUID(aX),180474)or string.find(UnitGUID(aX),176929)or string.find(UnitGUID(aX),176920)or string.find(UnitGUID(aX),177154)or string.find(UnitGUID(aX),177787)or string.find(UnitGUID(aX),177889)or string.find(UnitGUID(aX),177891)or string.find(UnitGUID(aX),177892)or string.find(UnitGUID(aX),168326)or string.find(UnitGUID(aX),182778)or string.find(UnitGUID(aX),183945)then aY=aY+1 end end end end;if not m()then S=1;T=1;aY=1 end;if u then T=10;S=10 end;U=at(R)V=ay(R)if not BotOn then W=0;X=0 end;if W>0 then W=0 end;if X>0 then X=0 end;N=aS()if l.QueuedCast()then X=l.QueuedCast()return"Custom Queue "..j(X):ID()end;if j(200174):IsAvailable()then am=E.Mindbender else am=E.Shadowfiend end;if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if v and E.MassDispell:IsUsableP()and E.MassDispell:CooldownRemains(BypassRecovery)<=0 then if l.Cast(E.MassDispell,nil,nil,nil)then X=327830;return"queue RingOfPeace"end elseif(not E.MassDispell:IsUsableP()or E.MassDispell:CooldownRemains(BypassRecovery)>0)and v then HeroRotationCharDB.Toggles[61]=not HeroRotationCharDB.Toggles[61]l.Print("Mass Dispel Queue is now "..(HeroRotationCharDB.Toggles[61]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and j(9484):IsUsableP()and j(9484):CooldownRemains(BypassRecovery)<=0 then if f("mouseover"):GUID()~=nil and f("mouseover"):IsInRange(30)then W=19484;return"queue Shackle MO"end elseif(not j(9484):IsUsableP()or j(9484):CooldownRemains()>0 or g:PrevGCD(1,j(9484)))and w then HeroRotationCharDB.Toggles[62]=not HeroRotationCharDB.Toggles[62]l.Print("Shackle Undead Queue is now "..(HeroRotationCharDB.Toggles[62]and"|cff00ff00on|r."or"|cffff0000off|r."))end;local a_=select(1,UnitCastingInfo("player"))if C~=0 and C<0.5 and(g:IsChanneling(E.MindSear)or g:IsChanneling(E.MindFlay))then if o(E.Pool,nil)then X=1999;return"Quaking Stope"end end;if g:IsDeadOrGhost()then X=999 end;if g:IsChanneling(j(355321))then if o(E.Pool,nil)then X=999;return"Trinket Channel"end end;if E.Shadowform:IsCastable()and g:BuffDown(E.ShadowformBuff)then if o(E.Shadowform,nil)then X=232698;return"shadowform 4"end end;if E.PowerWordShield:IsCastable()and g:DebuffDown(E.WeakenedSoul)and not g:IsChanneling()and not g:IsCasting()and(a1.Shadow.PWS=="Moving"and g:IsMoving()or a1.Shadow.PWS=="Always"or a1.Shadow.PWS=="OOC Moving"and g:IsMoving()and not g:AffectingCombat())then if o(E.PowerWordShield,nil)then X=17;return"PW:S Settings"end end;if g:IsChanneling(E.VoidTorrent)then if o(E.Pool,nil)then X=99999;return"channeling 4"end end;if g:IsChanneling(j(324631))then if g:AffectingCombat()and a1.Shadow.CastCancelFC then X=1999 elseif l.CastAnnotated(E.Pool,false,"WAIT")then X=99999;return"Pool During Fleshcraft"end end;a8=2;if not g:AffectingCombat()and(r or a1.Commons.DBMSupport and l.BossMods:GetPullTimer()<_+g:GCD()and l.BossMods:GetPullTimer()>0)and a0.TargetIsValid()and not g:IsMoving()then local N=aN()if N then return N end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if E.ShadowWordDeath:IsCastable()then if o(E.ShadowWordDeath,nil)then W=1136149;return"explosive MO SWD"end end;if E.ShadowWordPain:IsCastable()then if o(E.ShadowWordPain,nil)then W=1589;return"explosive MO SWP"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if E.ShadowWordDeath:IsCastable()then if o(E.ShadowWordDeath,nil)then X=136149;return"explosive  SWD"end end;if E.ShadowWordPain:IsCastable()then if o(E.ShadowWordPain,nil)then X=589;return"explosive  SWP"end end end;if a0.TargetIsValid()and g:AffectingCombat()and(h:AffectingCombat()or h:IsDummy()or h:NPCID()==153285 or h:NPCID()==168326 or h:NPCID()==176581 or h:NPCID()==176920 or h:NPCID()==177892 or h:NPCID()==182778 or h:NPCID()==185402 or h:NPCID()==183945 or h:NPCID()==182074 or h:NPCID()==184737 or h:NPCID()==179733 or h:NPCID()==115402 or h:NPCID()==115406 or h:NPCID()==115395 or UnitExists("boss1")or h:NPCID()==115388 or r)and not g:IsDeadOrGhost()then Z=d.FightRemains(R,false)if h:IsDummy()or h:NPCID()==153285 or h:NPCID()==168326 or h:NPCID()==176581 or h:NPCID()==176920 then Z=99999999999 end;a4=d.CombatTime()a5=Z+a4;if E.Dispersion:IsCastable()and g:HealthPercentage()<a1.Shadow.DispersionHP then if o(E.Dispersion,nil)then X=47585;return"dispersion low_hp"end end;if E.DesperatePrayer:IsCastable()and g:HealthPercentage()<a1.Shadow.DesperatePrayerHP then if o(E.DesperatePrayer,nil)then X=19236;return"DesperatePrayer low_hp"end end;if g:HealthPercentage()<a1.Commons.HealthstoneHP and F.Healthstone:IsReady()and F.Healthstone:CooldownRemains()<=0 then if l.Cast(F.Healthstone,nil)then X=40;return"Healthstone HP"end end;if g:HealthPercentage()<a1.Commons.HealPotHP and F.CosmicHealPot:IsReady()and F.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(F.CosmicHealPot,nil)then X=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<a1.Commons.HealPotHP and F.HealPot:IsReady()and F.HealPot:CooldownRemains()<=0 then if l.Cast(F.HealPot,nil)then X=41;return"HealPot HP"end end;if F.PotionofPhantomFire:IsReady()and a1.Commons.Enabled.Potions and s and((g:BuffUp(E.VoidformBuff)or g:BuffUp(E.PowerInfusionBuff))and not l.GUISettings.General.HoldPotforBL or l.GUISettings.General.HoldPotforBL and g:BloodlustUp())then if o(F.PotionofPhantomFire,nil,nil)then X=50;return"potion_of_phantomfire 2"end end;if F.PotionofSpectralIntellect:IsReady()and a1.Commons.Enabled.Potions and s and((g:BuffUp(E.VoidformBuff)or g:BuffUp(E.PowerInfusionBuff))and not l.GUISettings.General.HoldPotforBL or l.GUISettings.General.HoldPotforBL and g:BloodlustUp())then if o(F.PotionofSpectralIntellect,nil,nil)then X=50;return"potion_of_spectral_intellect 2"end end;a8=2;a6=aq(h,false)a7=aq(h,true)ab=aY;if g:BuffUp(E.VoidformBuff)then ab=an(aY<=5)*aY end;ac=0;if aA(R)>0 then ac=1 end;ad=E.VampiricTouchDebuff:AuraActiveCount()>=ab or not ac;a9=T>2+an(g:BuffUp(E.VoidformBuff))ag=al or E.InescapableTorment:IsAvailable()ae=E.VoidEruption:CooldownRemains()<=g:GCD()*3 and E.VoidEruption:IsAvailable()and y or E.DarkAscension:CooldownUp()and E.DarkAscension:IsAvailable()if n()then if E.Fireblood:IsCastable()and g:BuffUp(E.VoidformBuff)then if o(E.Fireblood,nil)then X=265221;return"fireblood 22"end end;if E.Berserking:IsCastable()and g:BuffUp(E.VoidformBuff)then if o(E.Berserking,nil)then X=26297;return"berserking 24"end end;if E.LightsJudgment:IsCastable()and T>=2 then if o(E.LightsJudgment,nil,nil,not h:IsSpellInRange(E.LightsJudgment))then X=255647;return"lights_judgment 26"end end;if E.AncestralCall:IsCastable()and g:BuffUp(E.VoidformBuff)then if o(E.AncestralCall,nil)then X=274738;return"ancestral_call 28"end end end;ah=60;if true then local N=aR()if N then return N end end end;if a0.TargetIsValid()and not UnitIsFriend("target","player")and g:AffectingCombat()and(not h:AffectingCombat()and not h:IsDummy()and h:NPCID()~=153285)and not t then W=999 end end;local function b0()E.VampiricTouchDebuff:RegisterAuraTracking()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(6)end end;function ReturnSpell()if X==0 then return 0 else return X end end;function ReturnSpellMO()if W==0 then return 0 else return W end end;l.SetAPL(258,aU,b0)