local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.CDsON;local o=l.AoEON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[6]local s=HeroRotationCharDB.Toggles[12]local t=HeroRotationCharDB.Toggles[13]local u=HeroRotationCharDB.Toggles[14]local v=HeroRotationCharDB.Toggles[15]local w=HeroRotationCharDB.Toggles[16]local x=HeroRotationCharDB.Toggles[80]local y=HeroRotationCharDB.Toggles[81]local z=HeroRotationCharDB.Toggles[82]local A=HeroRotationCharDB.Toggles[72]local B=HeroRotationCharDB.Toggles[83]local C=0;local D=j.DeathKnight.Blood;local E=k.DeathKnight.Blood;local F={}local G;local H;local I;local J;local K;local L;local M;local N;local O;local P;local Q;local R=d.GhoulTable;local S;local T;local U=2;local V=999999;local W=2;local X=g:CovenantID()d:RegisterForEvent(function()X=g:CovenantID()end,"COVENANT_CHOSEN")local Y=l.Commons.Everyone;local Z={General=l.GUISettings.General,Commons=l.GUISettings.APL.DeathKnight.Commons,Blood=l.GUISettings.APL.DeathKnight.Blood}local a0={{D.Asphyxiate,"Cast Asphyxiate (Interrupt)",function()return true end}}local a1=0;local a2=0;d:RegisterForEvent(function()equip=g:GetEquipment()trinket1=k(0)trinket2=k(0)if equip[13]then trinket1=k(equip[13])end;if equip[14]then trinket2=k(equip[14])end;SuperstrainEquipped=g:HasLegendaryEquipped(30)PhearomonesEquipped=g:HasLegendaryEquipped(31)DeadliestCoilEquipped=g:HasLegendaryEquipped(45)end,"PLAYER_EQUIPMENT_CHANGED")local a3={5,8,10,30,40,100}local a4={}local function a5()for _,a6 in ipairs(a3)do if a6==8 or 5 then a4[a6]=h:IsInMeleeRange(a6)end;a4[a6]=h:IsInRange(a6)end end;local function a7(a8)if a8 then return 1 else return 0 end end;local function a9(a8)return a8~=0 end;local function aa(ab)local ac=0;if ab~=nil then for _,ad in pairs(ab)do if not ad:DebuffUp(D.BloodPlagueDebuff)then ac=ac+1 end end end;return ac end;local function ae(af)if not g:IsTanking(af)and A and af:AffectingCombat()and af:GUID()==f("mouseover"):GUID()and af:NPCID()~=118044 then a2=156222;return true elseif not g:IsTanking(af)and A and af:AffectingCombat()and af:GUID()==h:GUID()and af:NPCID()~=118044 then a1=56222;return true elseif not g:IsTanking(af)and A and af:AffectingCombat()and af:NPCID()~=118044 then return true end end;local function ag()if Y.TargetIsValid()then if D.Fleshcraft:IsCastable()and(C==0 or C>D.Fleshcraft:ExecuteTime())and p and not g:IsMoving()then if m(D.Fleshcraft,nil,nil)then a1=324631;return"fleshcraft precombat 1"end end;if D.DeathsCaress:IsReady()and not h:IsInMeleeRange(5)then if m(D.DeathsCaress,nil,nil,not h:IsSpellInRange(D.DeathsCaress))then a1=195292;return"deaths_caress precombat 2"end end;if D.Marrowrend:IsReady()and h:IsInMeleeRange(5)then if m(D.Marrowrend)then a1=195182;return"marrowrend precombat 4"end end;if D.BloodBoil:IsCastable()and h:IsInMeleeRange(10)then if m(D.BloodBoil)then a1=50842;return"blood_boil precombat 6"end end end end;local function ah()if g:HealthPercentage()<Z.Commons.PhialHP and E.PhialofSerenity:IsReady()and E.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(E.PhialofSerenity,nil)then a1=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<Z.Commons.HealthstoneHP and E.Healthstone:IsReady()and E.Healthstone:CooldownRemains()<=0 then if l.Cast(E.Healthstone,nil)then a1=40;return"Healthstone HP"end end;if g:HealthPercentage()<Z.Commons.HealPotHP and E.HealPot:IsReady()and E.HealPot:CooldownRemains()<=0 then if l.Cast(E.HealPot,nil)then a1=41;return"HealPot HP"end end;if D.AntiMagicShell:IsReady()and U>0 and g:HealthPercentage()<=Z.Commons.AntiMagicShellHP then if m(D.AntiMagicShell,nil,nil)then a1=48707;return"AntiMagic Shell defensives 18"end end;if D.RuneTap:IsReady()and N and g:HealthPercentage()<=Z.Blood.RuneTapThreshold and g:Rune()>=3 and D.RuneTap:Charges()>=1 and g:BuffDown(D.RuneTapBuff)then if m(D.RuneTap,nil)then a1=194679;return"rune_tap defensives 2"end end;if Y.ActiveMitigationNeeded()and D.Marrowrend:TimeSinceLastCast()>2.5 and D.DeathStrike:TimeSinceLastCast()>2.5 then if D.DeathStrike:IsReady()and not T and g:BuffStack(D.BoneShieldBuff)>7 then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike defensives 4"end end;if D.Marrowrend:IsReady()then if m(D.Marrowrend,nil,nil,not h:IsSpellInRange(D.Marrowrend))then a1=195182;return"marrowrend defensives 6"end end;if D.DeathStrike:IsReady()and not T then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike defensives 10"end end end;if D.Marrowrend:IsReady()and(g:BuffRemains(D.BoneShieldBuff)<=6 or h:TimeToDie()<5 and g:BuffRemains(D.BoneShieldBuff)<10 and P==1)then if m(D.Marrowrend,nil,nil,not h:IsSpellInRange(D.Marrowrend))then a1=195182;return"marrowrend defensives 12"end end;if D.VampiricBlood:IsCastable()and N and g:HealthPercentage()<=Z.Blood.VampiricBloodThreshold and g:BuffDown(D.IceboundFortitudeBuff)then if m(D.VampiricBlood,nil)then a1=55233;return"vampiric_blood defensives 14"end end;if D.Lichborne:IsReady()and g:HealthPercentage()<=Z.Commons.LichborneHP then if m(D.Lichborne,nil,nil)then a1=49039;return"Lichborne defensives 18"end end;if D.DeathPact:IsAvailable()and D.DeathPact:IsReady()and g:HealthPercentage()<=Z.Commons.DeathPactHP then if m(D.DeathPact,nil,nil)then a1=48743;return"DeathPact defensives 18"end end;if D.IceboundFortitude:IsCastable()and N and g:HealthPercentage()<=Z.Blood.IceboundFortitudeThreshold and g:BuffDown(D.VampiricBloodBuff)then if m(D.IceboundFortitude,nil)then a1=48792;return"icebound_fortitude defensives 16"end end;if D.DeathStrike:IsReady()and not T and g:HealthPercentage()<=50+(g:RunicPower()>90 and 20 or 0)and not g:HealingAbsorbed()then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike defensives 18"end end end;local function ai()if D.BloodFury:IsCastable()and Z.Commons.Enabled.Racials and((D.DancingRuneWeapon:CooldownUp()or z)and(not D.Blooddrinker:IsReady()or not D.Blooddrinker:IsAvailable()))then if m(D.BloodFury,nil)then a1=20572;return"blood_fury main 2"end end;if D.Berserking:IsCastable()and Z.Commons.Enabled.Racials then if m(D.Berserking,nil)then a1=26297;return"berserking main 4"end end;if D.ArcanePulse:IsCastable()and Z.Commons.Enabled.Racials and(P>=2 or g:Rune()<1 and g:RunicPowerDeficit()>60)then if m(D.ArcanePulse,nil,nil,not h:IsInRange(8))then a1=260364;return"arcane_pulse main 6"end end;if D.LightsJudgment:IsCastable()and Z.Commons.Enabled.Racials and g:BuffUp(D.UnholyStrengthBuff)then if m(D.LightsJudgment,nil,nil,not h:IsSpellInRange(D.LightsJudgment))then a1=255647;return"lights_judgment main 8"end end;if D.AncestralCall:IsCastable()and Z.Commons.Enabled.Racials then if m(D.AncestralCall,nil)then a1=274738;return"ancestral_call main 10"end end;if D.Fireblood:IsCastable()and Z.Commons.Enabled.Racials then if m(D.Fireblood,nil)then a1=265221;return"fireblood main 12"end end;if D.BagofTricks:IsCastable()and Z.Commons.Enabled.Racials then if m(D.BagofTricks,nil,nil,not h:IsSpellInRange(D.BagofTricks))then a1=312411;return"bag_of_tricks main 14"end end;if D.ArcaneTorrent:IsCastable()and Z.Commons.Enabled.Racials and g:RunicPowerDeficit()>20 then if m(D.ArcaneTorrent,nil,nil,nil)then a1=155145;return"ArcaneTorrent main 14"end end end;local function aj()if D.DeathsDue:IsReady()and p and(g:BuffDown(D.DeathsDueBuff)or g:BuffRemains(D.DeathsDueBuff)<4 or g:BuffUp(D.CrimsonScourgeBuff))then if m(D.DeathsDue,nil,nil,not h:IsSpellInRange(D.DeathsDue))then a1=324128;return"deaths_due covenants 6"end end;if D.SwarmingMist:IsCastable()and p and(D.DancingRuneWeapon:CooldownRemains()>3 and g:RunicPower()>=90-P*3)then if m(D.SwarmingMist,nil,nil)then a1=311648;return"swarming_mist covenants 7"end end;if D.AbominationLimb:IsCastable()and p and g:BuffDown(D.DancingRuneWeaponBuff)then if m(D.AbominationLimb,nil,nil,not h:IsInRange(8))then a1=315443;return"abomination_limb covenants 16"end end;if D.Fleshcraft:IsCastable()and(C==0 or C>D.Fleshcraft:ExecuteTime())and not g:IsMoving()and p and g:BuffDown(D.DancingRuneWeaponBuff)and(D.PustuleEruption:SoulbindEnabled()or D.VolatileSolvent:SoulbindEnabled()and g:BuffDown(D.VolatileSolventHumanBuff))then if m(D.Fleshcraft,nil,nil)then a1=324631;return"fleshcraft covenants 20"end end;if D.ShackleTheUnworthy:IsCastable()and p and(D.DancingRuneWeapon:CooldownRemains()<3 or g:BuffDown(D.DancingRuneWeaponBuff))then if m(D.ShackleTheUnworthy,nil,nil,not h:IsSpellInRange(D.ShackleTheUnworthy))then a1=312202;return"shackle_the_unworthy covenants 18"end end end;local function ak()if X==3 and g:BuffUp(D.DeathAndDecayBuff)then K=15+a7(g:BuffUp(D.DancingRuneWeaponBuff))*10+P*a7(D.Heartbreaker:IsAvailable())*2 else K=(15+a7(g:BuffUp(D.DancingRuneWeaponBuff))*10+P*a7(D.Heartbreaker:IsAvailable())*2)*1.2 end;if D.Marrowrend:IsReady()and((X~=4 or g:BuffUp(D.AbominationLimbBuff))and(g:BuffRemains(D.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffRemains(D.BoneShieldBuff)<=g:GCD()+a7(D.Blooddrinker:CooldownUp())*a7(D.Blooddrinker:IsAvailable())*4 or g:BuffStack(D.BoneShieldBuff)<3)and g:RunicPowerDeficit()>20)then if m(D.Marrowrend,nil,nil,not h:IsSpellInRange(D.Marrowrend))then a1=195182;return"marrowrend drw_up 2"end end;if D.BloodBoil:IsCastable()and h:IsInRange(10)and D.BloodBoil:Charges()>=2 then if m(D.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then a1=50842;return"blood_boil drw_up 4"end end;if D.DeathStrike:IsReady()and g:RunicPower()>=Z.Blood.MinimumRP+45 and not S and not T and(g:RunicPowerDeficit()<=H and not(g:BuffRemains(D.DancingRuneWeaponBuff)<=2 and D.Bonestorm:IsAvailable()and D.Bonestorm:CooldownRemains()<2)or g:RunicPowerDeficit()<=K)then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike drw_up 6"end end;I=X==3 and g:BuffUp(D.DeathAndDecayBuff)and(g:BuffUp(D.DeathsDueBuff)and g:BuffRemains(D.DeathsDueBuff)<6)if D.HeartStrike:IsReady()and(I or g:RuneTimeToX(4)<g:GCD()or g:RunicPowerDeficit()>K)then if m(D.HeartStrike,nil,nil,not h:IsSpellInRange(D.HeartStrike))then a1=206930;return"heart_strike drw_up 8"end end end;local function al()M=g:BuffUp(D.DancingRuneWeaponBuff)and 7 or 5;if D.Tombstone:IsCastable()and(g:BuffStack(D.BoneShieldBuff)>=M and g:Rune()>=2 and g:RunicPowerDeficit()>30)then if m(D.Tombstone,nil)then a1=219808;return"tombstone drw_up_venthyr 2"end end;if D.Marrowrend:IsReady()and((g:BuffRemains(D.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffRemains(D.BoneShieldBuff)<=g:GCD()+a7(D.Blooddrinker:CooldownUp())*a7(D.Blooddrinker:IsAvailable())*4 or g:BuffStack(D.BoneShieldBuff)<5)and g:RunicPowerDeficit()>20)then if m(D.Marrowrend,nil,nil,not h:IsSpellInRange(D.Marrowrend))then a1=195182;return"drw_up_venthyr 4"end end;if D.BloodBoil:IsCastable()and D.BloodBoil:Charges()>=2 then if m(D.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then a1=50842;return"blood_boil drw_up_venthyr 6"end end;if D.DeathStrike:IsReady()and g:RunicPower()>=Z.Blood.MinimumRP+45 and not T and not S and(g:RunicPowerDeficit()<=H and not(D.Bonestorm:IsAvailable()and D.Bonestorm:CooldownRemains()<2))then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike drw_up_venthyr 8"end end;if D.Bonestorm:IsReady()and not T and(g:RunicPower()>=Z.Blood.BonestormPower and g:BuffUp(D.SwarmingMist))then if m(D.Bonestorm,nil,nil,not h:IsInRange(8))then a1=194844;return"bonestorm drw_up_venthyr 10"end end;L=15+a7(g:BuffUp(D.DancingRuneWeaponBuff))*10+P*a7(D.Heartbreaker:IsAvailable())*2;if D.HeartStrike:IsReady()and(g:RuneTimeToX(4)<g:GCD()or g:RunicPowerDeficit()>=L)then if m(D.HeartStrike,nil,nil,not h:IsSpellInRange(D.HeartStrike))then a1=206930;return"heart_strike drw_up_venthyr 12"end end end;local function am()if D.HeartStrike:IsReady()and(X==3 and g:BuffUp(D.DeathAndDecayBuff)and(g:BuffUp(D.DeathsDueBuff)and g:BuffRemains(D.DeathsDueBuff)<6))then if m(D.HeartStrike,nil,nil,not h:IsSpellInRange(D.HeartStrike))then a1=206930;return"heart_strike standard 2"end end;if D.Tombstone:IsCastable()and(g:BuffStack(D.BoneShieldBuff)>=7 and g:Rune()>=2 and X~=2)then if m(D.Tombstone,nil)then a1=219808;return"tombstone standard 4"end end;if D.Marrowrend:IsReady()and((g:BuffRemains(D.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffRemains(D.BoneShieldBuff)<=g:GCD()+a7(D.Blooddrinker:CooldownUp())*a7(D.Blooddrinker:IsAvailable())*4 or g:BuffStack(D.BoneShieldBuff)<6 or(X~=3 or g:BuffRemains(D.DeathsDueBuff)>5)and g:BuffRemains(D.BoneShieldBuff)<7)and g:RunicPowerDeficit()>=15)then if m(D.Marrowrend,nil,nil,not h:IsSpellInRange(D.Marrowrend))then a1=195182;return"marrowrend standard 6"end end;if D.DeathStrike:IsReady()and g:RunicPower()>=Z.Blood.MinimumRP+45 and not T and not S and(g:RunicPowerDeficit()<=H and not(D.Bonestorm:IsAvailable()and D.Bonestorm:CooldownRemains()<2)and not(X==2 and D.SwarmingMist:CooldownRemains()<3))then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike standard 8"end end;if D.BloodBoil:IsCastable()and h:IsInRange(10)and(D.BloodBoil:ChargesFractional()>=1.8 and(g:BuffStack(D.HemostasisBuff)<=5-EnemiesCount10y or EnemiesCount10y>2))then if m(D.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then a1=50842;return"blood_boil standard 10"end end;if D.DeathAndDecay:IsReady()and not B and(g:BuffUp(D.CrimsonScourgeBuff)and D.RelishinBlood:IsAvailable()and g:RunicPowerDeficit()>10)then if m(D.DeathAndDecay,nil,nil,not h:IsInRange(30))then a1=43265;return"death_and_decay standard 12"end end;if D.Bonestorm:IsReady()and not T and(g:RunicPower()>=Z.Blood.BonestormPower and X~=2)then if m(D.Bonestorm,nil,nil,not h:IsInRange(8))then a1=194844;return"bonestorm standard 14"end end;if X==3 and g:BuffUp(D.DeathAndDecayBuff)then J=15+P*a7(D.Heartbreaker:IsAvailable())*2 else J=(15+P*a7(D.Heartbreaker:IsAvailable())*2)*1.2 end;if D.DeathStrike:IsReady()and g:RunicPower()>=Z.Blood.MinimumRP+45 and not T and not S and(g:RunicPowerDeficit()<=J or h:TimeToDie()<10)then if m(D.DeathStrike,nil,nil,not h:IsSpellInRange(D.DeathStrike))then a1=49998;return"death_strike standard 16"end end;if D.DeathAndDecay:IsReady()and not B and P>=3 then if m(D.DeathAndDecay,nil,nil,not h:IsInRange(30))then a1=43265;return"death_and_decay standard 18"end end;if D.HeartStrike:IsReady()and g:RuneTimeToX(4)<g:GCD()then if m(D.HeartStrike,nil,nil,not h:IsSpellInRange(D.HeartStrike))then a1=206930;return"heart_strike standard 20"end end;if D.DeathAndDecay:IsReady()and not B and(g:BuffUp(D.CrimsonScourgeBuff)or D.RapidDecomposition:IsAvailable())then if m(D.DeathAndDecay,nil,nil,not h:IsInRange(30))then a1=43265;return"death_and_decay standard 22"end end;if D.Consumption:IsCastable()then if m(D.Consumption,nil,nil,not h:IsSpellInRange(D.Consumption))then a1=274156;return"consumption standard 24"end end;if D.BloodBoil:IsCastable()and h:IsInRange(10)and D.BloodBoil:ChargesFractional()>=1.1 then if m(D.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then a1=50842;return"blood_boil standard 26"end end;if D.HeartStrike:IsReady()and(g:Rune()>1 and(g:RuneTimeToX(3)<g:GCD()or g:BuffStack(D.BoneShieldBuff)>7))then if m(D.HeartStrike,nil,nil,not h:IsSpellInRange(D.HeartStrike))then a1=206930;return"heart_strike standard 28"end end end;local function an()r=HeroRotationCharDB.Toggles[6]p=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[5]s=HeroRotationCharDB.Toggles[12]t=HeroRotationCharDB.Toggles[13]u=HeroRotationCharDB.Toggles[14]v=HeroRotationCharDB.Toggles[15]w=HeroRotationCharDB.Toggles[16]x=HeroRotationCharDB.Toggles[80]y=HeroRotationCharDB.Toggles[81]z=HeroRotationCharDB.Toggles[82]A=HeroRotationCharDB.Toggles[72]S=false;T=false;if D.Bonestorm:IsAvailable()and n()and D.Bonestorm:CooldownRemains()<=0 and D.Bonestorm:IsCastable()then S=true end;C=0;for a6=1,20 do if select(10,UnitDebuff("player",a6))==240447 then if select(6,UnitDebuff("player",a6))~=nil then C=select(6,UnitDebuff("player",a6))-GetTime()end end end end;local function ao()Enemies10y=g:GetEnemiesInRange(10)if o()then O=g:GetEnemiesInMeleeRange(8)P=#O;EnemiesCount10y=#Enemies10y;Enemies40y=g:GetEnemiesInRange(40)else P=1;EnemiesCount10y=1 end;Q=aa(Enemies10y)TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)ActiveMitigationNeeded=g:ActiveMitigationNeeded()N=g:IsTankingAoE(8)or g:IsTanking(h)if not BotOn then a2=0;a1=0 end;if a2>0 then a2=0 end;if a1>0 then a1=0 end;G=an()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if g:IsChanneling(j(324631))then if l.CastAnnotated(D.Pool,false,"WAIT")then a1=99999;return"Pool During Blooddrinker"end end;if not g:AffectingCombat()and Y.TargetIsValid()and r then local G=ag()if G then return G end end;if not UnitIsEnemy("player","mouseover")and UnitIsPlayer("mouseover")and UnitIsDead("mouseover")then if D.RaiseAlly:IsCastable()and g:RunicPower()>=30 then if m(D.RaiseAlly,nil)then a2=161999;return"RaiseAlly MO"end elseif D.RaiseAlly:CooldownRemains(BypassRecovery)<=0 and g:RunicPower()<30 then T=true end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if D.HeartStrike:IsCastable()then if m(D.HeartStrike,nil)then a2=1206930;return"explosive MO HeartStrike"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if D.DeathStrike:IsCastable()then if m(D.DeathStrike,nil)then a2=149998;return"explosive MO DeathStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if D.HeartStrike:IsCastable()then if m(D.HeartStrike,nil)then a1=206930;return"explosive  HeartStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if D.DeathStrike:IsCastable()then if m(D.DeathStrike,nil)then a1=49998;return"explosive  DeathStrike"end end end;if Y.TargetIsValid()then if D.DarkCommand:IsReady()and g:AffectingCombat()and(not g:IsTanking(h)and A)then if m(D.DarkCommand,nil)then a1=56222;return"DarkCommand bear 3"end end;if D.DarkCommand:IsReady()then if Y.CastCycle(D.DarkCommand,Enemies40y,ae,not h:IsSpellInRange(D.DarkCommand))then return"DarkCommand 4"end end end;if w and D.Asphyxiate:IsUsableP()and D.Asphyxiate:CooldownRemains(BypassRecovery)<=0 then if l.Cast(D.Asphyxiate,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(D.Asphyxiate)then a2=1221562;return"queue Asphyxiate MO"else a1=221562;return"queue Asphyxiate"end end elseif(not D.Asphyxiate:IsUsableP()or D.Asphyxiate:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[16]=not HeroRotationCharDB.Toggles[16]l.Print("Asphyxiate Queue is now "..(HeroRotationCharDB.Toggles[16]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if u and D.DeathGrip:IsUsableP()and D.DeathGrip:CooldownRemains(BypassRecovery)<=0 then if l.Cast(D.DeathGrip,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(D.DeathGrip)then a2=149576;return"queue DeathGrip MO"else a1=49576;return"queue DeathGrip"end end elseif(not D.DeathGrip:IsUsableP()or D.DeathGrip:CooldownRemains()>0)and u then HeroRotationCharDB.Toggles[14]=not HeroRotationCharDB.Toggles[14]l.Print("DeathGrip Queue is now "..(HeroRotationCharDB.Toggles[14]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and D.GorefiendsGrasp:IsUsableP()and D.GorefiendsGrasp:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(D.GorefiendsGrasp,nil,nil,nil)then a1=108199;return"queue Gorefiends Grasp"end elseif(not D.GorefiendsGrasp:IsUsableP()or D.GorefiendsGrasp:CooldownRemains()>0 or not g:AffectingCombat())and x then HeroRotationCharDB.Toggles[80]=not HeroRotationCharDB.Toggles[80]l.Print("Gorefiend's Grasp Queue is now "..(HeroRotationCharDB.Toggles[80]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if t and D.AntiMagicZone:IsUsableP()and D.AntiMagicZone:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(D.AntiMagicZone,nil,nil,nil)then a1=51052;return"queue Anti Magic Zone"end elseif(not D.AntiMagicZone:IsUsableP()or D.AntiMagicZone:CooldownRemains()>0 or not g:AffectingCombat())and t then HeroRotationCharDB.Toggles[13]=not HeroRotationCharDB.Toggles[13]l.Print("Anti-Magic Zone Queue is now "..(HeroRotationCharDB.Toggles[13]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and D.ControlUndead:IsUsableP()and D.ControlUndead:CooldownRemains(BypassRecovery)<=0 and not g:PrevGCD(1,D.ControlUndead)then if l.Cast(D.ControlUndead,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsInRange(30)then a2=1111673;return"queue ControlUndead MO"else a1=111673;return"queue ControlUndead"end end elseif(not D.ControlUndead:IsUsableP()or D.ControlUndead:CooldownRemains()>0 or g:PrevGCD(1,D.ControlUndead))and y then HeroRotationCharDB.Toggles[81]=not HeroRotationCharDB.Toggles[81]l.Print("Control Undead Queue is now "..(HeroRotationCharDB.Toggles[81]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if Y.TargetIsValid()and g:AffectingCombat()then if Z.Commons.UseDefensives then local G=ah()if G then return G end end;if g:IsChanneling(D.Blooddrinker)and g:BuffUp(D.BoneShieldBuff)and Q==0 and not g:ShouldStopCasting()and g:CastRemains()>0.2 then if l.CastAnnotated(D.Pool,false,"WAIT")then a1=99999;return"Pool During Blooddrinker"end end;H=X==3 and g:BuffRemains(D.DeathsDueBuff)>6 and 70 or 55;if E.PotionofPhantomFire:IsReady()and Z.Commons.Enabled.Potions and g:BuffUp(D.DancingRuneWeaponBuff)then if m(E.PotionofPhantomFire,nil,nil)then a1=37;return"potion main 16"end end;if Z.Commons.Enabled.TopTrinket or Z.Commons.Enabled.BottomTrinket then local ap=g:GetUseableTrinkets(F)if ap then if m(ap,nil,nil)then if ap:ID()==TopTrinketID and Z.Commons.Enabled.TopTrinket and(Z.Blood.TopTrinketHP<=0 and n()or Z.Blood.TopTrinketHP>g:HealthPercentage())then a1=24;return"top trinket 1"elseif ap:ID()==BotTrinketID and Z.Commons.Enabled.BottomTrinket and(Z.Blood.BotTrinketHP<=0 and n()or Z.Blood.BotTrinketHP>g:HealthPercentage())then a1=30;return"top trinket 2"end end end end;if n()and not i:DebuffUp(j(111673))and D.RaiseDead:IsCastable()then if m(D.RaiseDead,nil,nil)then a1=46585;return"raise_dead main 24"end end;if D.Blooddrinker:IsReady()and(C==0 or C>3)and(g:BuffDown(D.DancingRuneWeaponBuff)and(X~=3 or g:BuffRemains(D.DeathsDueBuff)>7))then if m(D.Blooddrinker,nil,nil,not h:IsSpellInRange(D.Blooddrinker))then a1=206931;return"blooddrinker main 20"end end;if D.Marrowrend:IsReady()and(X==4 and g:BuffDown(D.BoneShieldBuff))then if m(D.Marrowrend)then a1=195182;return"marrowrend main 8"end end;if true then local G=ai()if G then return G end end;if D.RaiseDead:TimeSinceLastCast()<=60 and g:RunicPower()>=Z.Blood.MinimumRP+20 and D.SacrificialPact:IsReady()and((X~=3 or g:BuffRemains(D.DeathsDueBuff)>6)and g:BuffDown(D.DancingRuneWeaponBuff)and(R.remains()<2 or h:TimeToDie()<g:GCD()))then if m(D.SacrificialPact,nil)then a1=237574;return"sacrificial_pact covenants 8"end end;if true then local G=aj()if G then return G end end;if D.BloodTap:IsCastable()and(g:Rune()<=2 and g:RuneTimeToX(4)>g:GCD()and D.BloodTap:ChargesFractional()>=1.8 or g:RuneTimeToX(3)>g:GCD())then if m(D.BloodTap)then a1=221699;return"blood_tap main 12"end end;if D.DancingRuneWeapon:IsCastable()and not z and n()and X~=2 then if m(D.DancingRuneWeapon,nil)then a1=49028;return"dancing_rune_weapon main 14"end end;if g:BuffUp(D.DancingRuneWeaponBuff)and X~=2 then local G=ak()if G then return G end end;if D.DancingRuneWeapon:IsCastable()and(X==2 and D.SwarmingMist:CooldownUp()and g:RunicPower()>=90-P*3)then if m(D.DancingRuneWeapon,nil)then a1=49028;return"dancing_rune_weapon main 16"end end;if X==2 and(g:BuffUp(D.DancingRuneWeaponBuff)or g:BuffUp(D.SwarmingMist))then local G=al()if G then return G end end;if true then local G=am()if G then return G end end;if l.CastAnnotated(D.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function aq()end;function ReturnSpell1()if a1==0 then return 0 else return a1 end end;function ReturnSpellMO1()if a2==0 then return 0 else return a2 end end;l.SetAPL(250,ao,aq)