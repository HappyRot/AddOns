local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.CDsON;local o=l.AoEON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[13]local t=HeroRotationCharDB.Toggles[14]local u=not HeroRotationCharDB.Toggles[15]local v=HeroRotationCharDB.Toggles[16]local w=HeroRotationCharDB.Toggles[80]local x=HeroRotationCharDB.Toggles[81]local y=HeroRotationCharDB.Toggles[82]local z=HeroRotationCharDB.Toggles[84]local A=HeroRotationCharDB.Toggles[17]local B=HeroRotationCharDB.Toggles[85]local C=HeroRotationCharDB.Toggles[18]local D=HeroRotationCharDB.Toggles[83]local E=HeroRotationCharDB.Toggles[72]local F;local G=false;local H=0;local I=math.min;local J=j.DeathKnight.Blood;local K=k.DeathKnight.Blood;local L={}local M;local N;local O;local P;local Q;local R;local S;local T;local U;local V=d.GhoulTable;local W;local X;local Y=2;local Z=999999;local a0=2;local a1=l.Commons.Everyone;local a2={General=l.GUISettings.General,Commons=l.GUISettings.APL.DeathKnight.Commons,Blood=l.GUISettings.APL.DeathKnight.Blood}local a3={{J.Asphyxiate,"Cast Asphyxiate (Interrupt)",function()return true end}}local a4=0;local a5=0;local a6=g:HasLegendaryEquipped(30)local a7=g:HasLegendaryEquipped(31)local a8=g:HasLegendaryEquipped(45)local a9=g:HasLegendaryEquipped(35)d:RegisterForEvent(function()equip=g:GetEquipment()trinket1=k(0)trinket2=k(0)if equip[13]then trinket1=k(equip[13])end;if equip[14]then trinket2=k(equip[14])end;a6=g:HasLegendaryEquipped(30)a7=g:HasLegendaryEquipped(31)a8=g:HasLegendaryEquipped(45)a9=g:HasLegendaryEquipped(35)end,"PLAYER_EQUIPMENT_CHANGED")local aa={5,8,10,30,40,100}local ab={}local function ac()for _,ad in ipairs(aa)do if ad==8 or 5 then ab[ad]=h:IsInMeleeRange(ad)end;ab[ad]=h:IsInRange(ad)end end;local function ae(af)if af then return 1 else return 0 end end;local function ag(af)return af~=0 end;local function ah(ai)local aj=0;if ai~=nil then for _,ak in pairs(ai)do if not g:IsTanking(ak)and ak:GUID()~=h:GUID()and ak:AffectingCombat()then aj=aj+1 end end end;return aj end;local function al(ai)local am=0;if ai~=nil then for _,ak in pairs(ai)do if not ak:DebuffUp(J.BloodPlagueDebuff)then am=am+1 end end end;return am end;local function an(ao)return ao:DebuffRemains(J.SoulReaperDebuff)end;local function ap(ao)if not g:IsTanking(ao)and E and ao:AffectingCombat()and ao:GUID()==f("mouseover"):GUID()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then a5=156222;return true elseif not g:IsTanking(ao)and E and ao:AffectingCombat()and ao:GUID()==h:GUID()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then a4=56222;return true elseif not g:IsTanking(ao)and E and ao:AffectingCombat()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then return true end end;local function aq(ao)if ao:TimeToX(35)<35 and ao:TimeToDie()>ao:DebuffRemains(J.SoulReaperDebuff)+5 and ao:AffectingCombat()and ao:GUID()==f("mouseover"):GUID()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then a5=1343294;return true elseif ao:TimeToX(35)<35 and ao:TimeToDie()>ao:DebuffRemains(J.SoulReaperDebuff)+5 and ao:AffectingCombat()and ao:GUID()==h:GUID()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then a4=343294;return true elseif ao:TimeToX(35)<35 and ao:TimeToDie()>ao:DebuffRemains(J.SoulReaperDebuff)+5 and ao:AffectingCombat()and ao:NPCID()~=118044 and ao:IsInMeleeRange(30)then return true end end;local function ar()if a1.TargetIsValid()then if J.Marrowrend:IsReady()and F then if m(J.Marrowrend)then a4=195182;return"marrowrend precombat 4"end end;if J.BloodBoil:IsCastable()and F then if m(J.BloodBoil)then a4=50842;return"blood_boil precombat 6"end end end end;local function as()if J.DeathStrike:IsReady()and a2.Commons.UseDefensives and F and not X and g:HealthPercentage()<a2.Commons.UseDeathStrikeHP then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike defensives 4"end end;if g:HealthPercentage()<a2.Commons.PhialHP and a2.Commons.UseDefensives and K.PhialofSerenity:IsReady()and K.PhialofSerenity:CooldownRemains()<=0 and g:BuffDown(J.ShroudofPurgatory)then if l.Cast(K.PhialofSerenity,nil)then a4=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<a2.Commons.HealthstoneHP and a2.Commons.UseDefensives and K.Healthstone:IsReady()and K.Healthstone:CooldownRemains()<=0 and g:BuffDown(J.ShroudofPurgatory)then if l.Cast(K.Healthstone,nil)then a4=40;return"Healthstone HP"end end;if g:HealthPercentage()<a2.Commons.HealPotHP and a2.Commons.UseDefensives and K.CosmicHealPot:IsReady()and K.CosmicHealPot:CooldownRemains()<=0 and g:BuffDown(J.ShroudofPurgatory)then if l.Cast(K.CosmicHealPot,nil)then a4=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<a2.Commons.HealPotHP and a2.Commons.UseDefensives and K.HealPot:IsReady()and K.HealPot:CooldownRemains()<=0 and g:BuffDown(J.ShroudofPurgatory)then if l.Cast(K.HealPot,nil)then a4=41;return"HealPot HP"end end;if J.AntiMagicShell:IsReady()and a2.Commons.UseDefensives and Y>0 and g:HealthPercentage()<=a2.Commons.AntiMagicShellHP then if m(J.AntiMagicShell,nil,nil)then a4=48707;return"AntiMagic Shell defensives 18"end end;if J.RuneTap:IsReady()and a2.Commons.UseDefensives and Q and g:HealthPercentage()<=a2.Blood.RuneTapThreshold and g:Rune()>=3 and J.RuneTap:Charges()>=1 and g:BuffDown(J.RuneTapBuff)then if m(J.RuneTap,nil)then a4=194679;return"rune_tap defensives 2"end end;if a1.ActiveMitigationNeeded()and F and J.Marrowrend:TimeSinceLastCast()>0.5 and J.DeathStrike:TimeSinceLastCast()>0.5 then if J.DeathStrike:IsReady()and a2.Commons.UseDefensives and not X and g:BuffStack(J.BoneShieldBuff)>7 then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike defensives 4"end end;if J.Marrowrend:IsReady()and F and g:BuffStack(J.BoneShieldBuff)>=8 then if m(J.Marrowrend,nil,nil,not h:IsSpellInRange(J.Marrowrend))then a4=195182;return"marrowrend defensives 6"end end;if J.DeathStrike:IsReady()and a2.Commons.UseDefensives and F and not X then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike defensives 10"end end end;if J.Marrowrend:IsReady()and F and(g:BuffRemains(J.BoneShieldBuff)<=6 or h:TimeToDie()<5 and g:BuffRemains(J.BoneShieldBuff)<10 and S==1)then if m(J.Marrowrend,nil,nil,not h:IsSpellInRange(J.Marrowrend))then a4=195182;return"marrowrend defensives 12"end end;if J.VampiricBlood:IsCastable()and a2.Commons.UseDefensives and Q and g:HealthPercentage()<=a2.Blood.VampiricBloodThreshold and g:BuffDown(J.IceboundFortitudeBuff)then if m(J.VampiricBlood,nil)then a4=55233;return"vampiric_blood defensives 14"end end;if J.Lichborne:IsReady()and a2.Commons.UseDefensives and g:HealthPercentage()<=a2.Commons.LichborneHP then if m(J.Lichborne,nil,nil)then a4=49039;return"Lichborne defensives 18"end end;if J.DeathPact:IsAvailable()and a2.Commons.UseDefensives and J.DeathPact:IsReady()and g:HealthPercentage()<=a2.Commons.DeathPactHP then if m(J.DeathPact,nil,nil)then a4=48743;return"DeathPact defensives 18"end end;if J.IceboundFortitude:IsCastable()and a2.Commons.UseDefensives and Q and g:HealthPercentage()<=a2.Blood.IceboundFortitudeThreshold and g:BuffDown(J.VampiricBloodBuff)then if m(J.IceboundFortitude,nil)then a4=48792;return"icebound_fortitude defensives 16"end end;if J.DeathStrike:IsReady()and a2.Commons.UseDefensives and F and not X and g:HealthPercentage()<=50+(g:RunicPower()>90 and 20 or 0)and not g:HealingAbsorbed()then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike defensives 18"end end end;local function at()if J.BloodFury:IsCastable()and F and a2.Commons.Enabled.Racials and n()and((J.DancingRuneWeapon:CooldownUp()or y)and(not J.Blooddrinker:IsReady()or not J.Blooddrinker:IsAvailable()))then if m(J.BloodFury,nil)then a4=20572;return"blood_fury main 2"end end;if J.Berserking:IsCastable()and F and a2.Commons.Enabled.Racials and n()then if m(J.Berserking,nil)then a4=26297;return"berserking main 4"end end;if J.ArcanePulse:IsCastable()and F and a2.Commons.Enabled.Racials and n()and(S>=2 or g:Rune()<1 and g:RunicPowerDeficit()>60)then if m(J.ArcanePulse,nil,nil,not h:IsInRange(10))then a4=260364;return"arcane_pulse main 6"end end;if J.LightsJudgment:IsCastable()and F and a2.Commons.Enabled.Racials and n()and g:BuffUp(J.UnholyStrengthBuff)then if m(J.LightsJudgment,nil,nil,not h:IsSpellInRange(J.LightsJudgment))then a4=255647;return"lights_judgment main 8"end end;if J.AncestralCall:IsCastable()and F and a2.Commons.Enabled.Racials and n()then if m(J.AncestralCall,nil)then a4=274738;return"ancestral_call main 10"end end;if J.Fireblood:IsCastable()and F and a2.Commons.Enabled.Racials and n()then if m(J.Fireblood,nil)then a4=265221;return"fireblood main 12"end end;if J.BagofTricks:IsCastable()and F and a2.Commons.Enabled.Racials and n()then if m(J.BagofTricks,nil,nil,not h:IsSpellInRange(J.BagofTricks))then a4=312411;return"bag_of_tricks main 14"end end;if J.ArcaneTorrent:IsCastable()and F and a2.Commons.Enabled.Racials and n()and g:RunicPowerDeficit()>20 then if m(J.ArcaneTorrent,nil,nil,nil)then a4=155145;return"ArcaneTorrent main 14"end end end;local function au()if J.Tombstone:IsReady()and p and F and(g:BuffStack(J.BoneShieldBuff)>5 and g:Rune()>=2 and g:RunicPowerDeficit()>=30 and(J.ShatteringBone:IsAvailable()and g:BuffUp(J.DeathAndDecayBuff)or not J.ShatteringBone:IsAvailable()))then if m(J.Tombstone,nil)then a4=219808;return"tombstone drw_up 2"end end;if J.EmpowerRuneWeapon:IsReady()and n()and(g:Rune()<6 and g:RunicPowerDeficit()>5)then if m(J.EmpowerRuneWeapon,nil,nil,not h:IsInRange(10))then a4=47568;return"EmpowerRuneWeapon drw_up 11"end end;if J.AbominationLimb:IsCastable()and F and n()and not C and not a2.Blood.UseAbomLimbDefensive then if m(J.AbominationLimb,nil,nil,not h:IsInRange(10))then a4=315443;return"abomination_limb standard 16"end end;if J.Marrowrend:IsReady()and F and(g:BuffStack(J.BoneShieldBuff)<5 and g:BuffRemains(J.DancingRuneWeaponBuff)<g:GCD())then if m(J.Marrowrend,nil,nil,not h:IsSpellInRange(J.Marrowrend))then a4=195182;return"marrowrend drw_up 2"end end;if J.Marrowrend:IsReady()and F and((g:BuffRemains(J.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffStack(J.BoneShieldBuff)<2 and g:BuffUp(J.AbominationLimbBuff))and g:RunicPowerDeficit()>20)then if m(J.Marrowrend,nil,nil,not F)then return"marrowrend drw_up 6"end end;if J.DeathsCaress:IsReady()and not F and(g:BuffRemains(J.BoneShieldBuff)<=g:RuneTimeToX(3)and g:Rune()<=1)then if m(J.DeathsCaress,nil,nil,not h:IsSpellInRange(J.DeathsCaress))then a4=195292;return"deaths_caress drw_up 2"end end;if J.DeathStrike:IsReady()and F and g:RunicPower()>=a2.Blood.MinimumRP+45 and not X and not W and(g:BuffRemains(J.CoagulopathyBuff)<=g:GCD()or g:BuffRemains(J.IcyTalonsBuff)<=g:GCD())then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike drw_up 6"end end;if J.SoulReaper:IsReady()and(S==1 and h:TimeToX(35)<5 and h:TimeToDie()>h:DebuffRemains(J.SoulReaperDebuff)+5)then if m(J.SoulReaper,nil,nil,not F)then a4=343294;return"soul_reaper drw_up 12"end end;if J.SoulReaper:IsReady()and S>=2 then if a1.CastTargetIf(J.SoulReaper,R,"min",an,aq,not F)then return"soul_reaper drw_up 14"end end;if J.DeathAndDecay:IsCastable()and F and not D and not g:IsMoving()and(g:BuffDown(J.DeathAndDecayBuff)and(J.SanguineGround:IsAvailable()or J.UnholyGround:IsAvailable()))then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay drw_up 14"end end;if J.BloodBoil:IsCastable()and(S>2 and J.BloodBoil:ChargesFractional()>=1.1)then if m(J.BloodBoil,nil,nil,not F)then a4=50842;return"blood_boil drw_up 4"end end;P=25+T*ae(J.Heartbreaker:IsAvailable())*2;if J.DeathStrike:IsReady()and F and g:RunicPower()>=a2.Blood.MinimumRP+45 and not X and not W and g:RunicPowerDeficit()<=P then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike drw_up 6"end end;if J.Consumption:IsCastable()and F then if m(J.Consumption,nil,nil,not h:IsSpellInRange(J.Consumption))then a4=274156;return"consumption standard 24"end end;if J.DeathAndDecay:IsCastable()and F and not D and not g:IsMoving()and(g:BuffDown(J.DeathAndDecayBuff)and(S==3 and g:BuffUp(J.CrimsonScourgeBuff)or S>=4))then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay drw_up 18"end end;if J.BloodBoil:IsReady()and(J.BloodBoil:ChargesFractional()>=1.1 and g:BuffStack(J.HemostasisBuff)<5)then if m(J.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then a4=50842;return"blood_boil drw_up 24"end end;if J.HeartStrike:IsReady()and F and(g:RuneTimeToX(2)<g:GCD()or g:RunicPowerDeficit()>=P)then if m(J.HeartStrike,nil,nil,not h:IsSpellInRange(J.HeartStrike))then a4=206930;return"heart_strike drw_up 18"end end end;local function av()if J.Tombstone:IsCastable()and p and(g:BuffStack(J.BoneShieldBuff)>5 and g:Rune()>=2 and g:RunicPowerDeficit()>=30 and(J.ShatteringBone:IsAvailable()and g:BuffUp(J.DeathAndDecayBuff)or not J.ShatteringBone:IsAvailable()))then if m(J.Tombstone,nil)then a4=219808;return"tombstone standard 1"end end;if J.AbominationLimb:IsCastable()and F and n()and not C and(a2.Blood.UseAbomLimbDefensive and g:BuffStack(J.BoneShieldBuff)<6 or not a2.Blood.UseAbomLimbDefensive)then if m(J.AbominationLimb,nil,nil,not h:IsInRange(10))then a4=315443;return"abomination_limb standard 16"end end;if J.Marrowrend:IsReady()and F and(g:BuffRemains(J.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffRemains(J.BoneShieldBuff)<=g:GCD()+ae(J.Blooddrinker:CooldownUp())*ae(J.Blooddrinker:IsAvailable())*4 or g:BuffStack(J.BoneShieldBuff)<6 and g:RunicPowerDeficit()>20 and not(J.InsatiableBlade:IsAvailable()and J.DancingRuneWeapon:CooldownRemains()<g:BuffRemains(J.BoneShieldBuff)))then if m(J.Marrowrend,nil,nil,not h:IsSpellInRange(J.Marrowrend))then a4=195182;return"marrowrend standard 6"end end;if J.DeathsCaress:IsReady()and not F and(g:BuffRemains(J.BoneShieldBuff)<=g:RuneTimeToX(3)and g:Rune()<=1)then if m(J.DeathsCaress,nil,nil,not h:IsSpellInRange(J.DeathsCaress))then a4=195292;return"deaths_caress standard 2"end end;if J.DeathStrike:IsReady()and F and g:RunicPower()>=a2.Blood.MinimumRP+45 and not X and not W and(g:BuffRemains(J.CoagulopathyBuff)<=g:GCD()or g:BuffRemains(J.IcyTalonsBuff)<=g:GCD())then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike standard 8"end end;if J.DeathAndDecay:IsCastable()and F and not D and not g:IsMoving()and(g:BuffDown(J.DeathAndDecayBuff)and(J.SanguineGround:IsAvailable()or J.UnholyGround:IsAvailable()))then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay drw_up 14"end end;if J.Bonestorm:IsReady()and F and not X and g:RunicPower()>=a2.Blood.BonestormPower and p then if m(J.Bonestorm,nil,nil,not h:IsInRange(10))then a4=194844;return"bonestorm standard 14"end end;if J.SoulReaper:IsReady()and(S==1 and h:TimeToX(35)<5 and h:TimeToDie()>h:DebuffRemains(J.SoulReaperDebuff)+5)then if m(J.SoulReaper,nil,nil,not F)then a4=343294;return"soul_reaper standard 12"end end;if J.SoulReaper:IsReady()and S>=2 then if a1.CastTargetIf(J.SoulReaper,R,"min",an,aq,not F)then return"soul_reaper standard 14"end end;if J.DeathStrike:IsReady()and F and not X and not W and g:RunicPower()>=a2.Blood.MinimumRP+45 and(g:RunicPowerDeficit()<=N and not(J.Bonestorm:IsAvailable()and J.Bonestorm:CooldownRemains()<2))then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike standard 16"end end;if J.BloodBoil:IsCastable()and(J.BloodBoil:ChargesFractional()>=1.8 and(g:BuffStack(J.HemostasisBuff)<=5-S or S>2))then if m(J.BloodBoil,nil,nil,not F)then a4=50842;return"blood_boil standard 10"end end;if J.DeathAndDecay:IsReady()and F and not D and not g:IsMoving()and g:BuffDown(J.DeathAndDecayBuff)and(g:BuffUp(J.CrimsonScourgeBuff)and J.RelishinBlood:IsAvailable()and g:RunicPowerDeficit()>10)then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay standard 12"end end;O=15+S*ae(J.Heartbreaker:IsAvailable())*2;if J.DeathStrike:IsReady()and F and g:RunicPower()>=a2.Blood.MinimumRP+45 and not X and not W and(g:RunicPowerDeficit()<=O or h:TimeToDie()<10)then if m(J.DeathStrike,nil,nil,not h:IsSpellInRange(J.DeathStrike))then a4=49998;return"death_strike standard 28"end end;if J.DeathAndDecay:IsReady()and F and not D and not g:IsMoving()and g:BuffDown(J.DeathAndDecayBuff)and S>=3 then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay standard 18"end end;if J.HeartStrike:IsReady()and F and g:RuneTimeToX(4)<g:GCD()then if m(J.HeartStrike,nil,nil,not h:IsSpellInRange(J.HeartStrike))then a4=206930;return"heart_strike standard 2"end end;if J.Consumption:IsCastable()and F then if m(J.Consumption,nil,nil,not h:IsSpellInRange(J.Consumption))then a4=274156;return"consumption standard 24"end end;if J.DeathAndDecay:IsReady()and F and not D and not g:IsMoving()and g:BuffDown(J.DeathAndDecayBuff)and(g:BuffUp(J.CrimsonScourgeBuff)or J.RapidDecomposition:IsAvailable())then if m(J.DeathAndDecay,nil,nil,not h:IsInRange(30))then a4=43265;return"death_and_decay standard 22"end end;if J.BloodBoil:IsCastable()and J.BloodBoil:ChargesFractional()>=1.1 then if m(J.BloodBoil,nil,nil,not F)then a4=50842;return"blood_boil standard 26"end end;if J.HeartStrike:IsReady()and F and(g:Rune()>1 and(g:RuneTimeToX(3)<g:GCD()or g:BuffStack(J.BoneShieldBuff)>7))then if m(J.HeartStrike,nil,nil,not h:IsSpellInRange(J.HeartStrike))then a4=206930;return"heart_strike standard 20"end end end;local function aw()q=HeroRotationCharDB.Toggles[5]p=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[13]t=HeroRotationCharDB.Toggles[14]u=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[16]w=HeroRotationCharDB.Toggles[80]x=HeroRotationCharDB.Toggles[81]y=HeroRotationCharDB.Toggles[82]E=HeroRotationCharDB.Toggles[72]D=HeroRotationCharDB.Toggles[83]z=HeroRotationCharDB.Toggles[84]A=HeroRotationCharDB.Toggles[17]B=HeroRotationCharDB.Toggles[85]C=HeroRotationCharDB.Toggles[18]W=false;X=false;if J.Bonestorm:IsAvailable()and n()and J.Bonestorm:CooldownRemains()<=0 and J.Bonestorm:IsCastable()then W=true end;H=0;for ad=1,20 do if select(10,UnitDebuff("player",ad))==240447 then if select(6,UnitDebuff("player",ad))~=nil then H=select(6,UnitDebuff("player",ad))-GetTime()end end end end;local function ax()F=h:IsSpellInRange(J.HeartStrike)R=g:GetEnemiesInMeleeRange(10)if o()then S=#R;Enemies40y=g:GetEnemiesInRange(40,J.DarkCommand)else S=1 end;U=al(R)T=I(S,g:BuffUp(J.DeathAndDecayBuff)and 5 or 2)Q=g:IsTankingAoE(8)or g:IsTanking(h)TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)ActiveMitigationNeeded=g:ActiveMitigationNeeded()MissingAggro=ah(R)if not BotOn then a5=0;a4=0 end;if a5>0 then a5=0 end;if a4>0 then a4=0 end;M=aw()if l.QueuedCast()then a4=l.QueuedCast()return"Custom Queue "..j(a4):ID()end;if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if g:IsChanneling(j(324631))then if l.CastAnnotated(J.Pool,false,"WAIT")then a4=99999;return"Pool During Blooddrinker"end end;if not g:AffectingCombat()then G=false end;if not g:AffectingCombat()and a1.TargetIsValid()and q then local M=ar()if M then return M end end;if not UnitIsEnemy("player","mouseover")and UnitIsPlayer("mouseover")and UnitIsDead("mouseover")and not B then if J.RaiseAlly:IsCastable()and g:RunicPower()>=30 then if m(J.RaiseAlly,nil)then a5=161999;return"RaiseAlly MO"end elseif J.RaiseAlly:CooldownRemains(BypassRecovery)<=0 and g:RunicPower()<30 then X=true end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)and f("mouseover"):IsInMeleeRange(10)then if J.HeartStrike:IsCastable()then if m(J.HeartStrike,nil)then a5=1206930;return"explosive MO HeartStrike"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)and f("mouseover"):IsInMeleeRange(10)then if J.DeathStrike:IsCastable()then if m(J.DeathStrike,nil)then a5=149998;return"explosive MO DeathStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)and F then if J.HeartStrike:IsCastable()then if m(J.HeartStrike,nil)then a4=206930;return"explosive  HeartStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)and F then if J.DeathStrike:IsCastable()then if m(J.DeathStrike,nil)then a4=49998;return"explosive  DeathStrike"end end end;if a1.TargetIsValid()then if J.DarkCommand:IsReady()and g:AffectingCombat()and(not g:IsTanking(h)and E)then if m(J.DarkCommand,nil)then a4=56222;return"DarkCommand bear 3"end end;if J.DarkCommand:IsReady()then if a1.CastCycle(J.DarkCommand,Enemies40y,ap,not h:IsSpellInRange(J.DarkCommand))then return"DarkCommand 4"end end end;if v and J.Asphyxiate:IsUsableP()and J.Asphyxiate:CooldownRemains(BypassRecovery)<=0 then if l.Cast(J.Asphyxiate,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(J.Asphyxiate)then a5=1221562;return"queue Asphyxiate MO"else a4=221562;return"queue Asphyxiate"end end elseif(not J.Asphyxiate:IsUsableP()or J.Asphyxiate:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[16]=not HeroRotationCharDB.Toggles[16]l.Print("Asphyxiate Queue is now "..(HeroRotationCharDB.Toggles[16]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and J.BloodBoil:IsUsableP()and J.BloodBoil:CooldownRemains(BypassRecovery)<=0 and not g:PrevGCD(1,J.BloodBoil)then if l.Cast(J.BloodBoil,nil,nil,nil)then a4=50842;return"queue BloodBoil"end elseif(not J.BloodBoil:IsUsableP()or J.BloodBoil:CooldownRemains()>0 or g:PrevGCD(1,J.BloodBoil))and z then HeroRotationCharDB.Toggles[84]=not HeroRotationCharDB.Toggles[84]l.Print("Blood Boil Queue is now "..(HeroRotationCharDB.Toggles[84]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if t and J.DeathGrip:IsUsableP()and J.DeathGrip:CooldownRemains(BypassRecovery)<=0 then if l.Cast(J.DeathGrip,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(J.DeathGrip)then a5=149576;return"queue DeathGrip MO"else a4=49576;return"queue DeathGrip"end end elseif(not J.DeathGrip:IsUsableP()or J.DeathGrip:CooldownRemains()>0)and t then HeroRotationCharDB.Toggles[14]=not HeroRotationCharDB.Toggles[14]l.Print("DeathGrip Queue is now "..(HeroRotationCharDB.Toggles[14]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and J.GorefiendsGrasp:IsUsableP()and J.GorefiendsGrasp:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(J.GorefiendsGrasp,nil,nil,nil)then a4=108199;return"queue Gorefiends Grasp"end elseif(not J.GorefiendsGrasp:IsUsableP()or J.GorefiendsGrasp:CooldownRemains()>0 or not g:AffectingCombat())and w then HeroRotationCharDB.Toggles[80]=not HeroRotationCharDB.Toggles[80]l.Print("Gorefiend's Grasp Queue is now "..(HeroRotationCharDB.Toggles[80]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if s and J.AntiMagicZone:IsUsableP()and J.AntiMagicZone:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(J.AntiMagicZone,nil,nil,nil)then a4=51052;return"queue Anti Magic Zone"end elseif(not J.AntiMagicZone:IsUsableP()or J.AntiMagicZone:CooldownRemains()>0 or not g:AffectingCombat())and s then HeroRotationCharDB.Toggles[13]=not HeroRotationCharDB.Toggles[13]l.Print("Anti-Magic Zone Queue is now "..(HeroRotationCharDB.Toggles[13]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and J.ControlUndead:IsUsableP()and J.ControlUndead:CooldownRemains(BypassRecovery)<=0 and not g:PrevGCD(1,J.ControlUndead)then if l.Cast(J.ControlUndead,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsInRange(30)then a5=1111673;return"queue ControlUndead MO"else a4=111673;return"queue ControlUndead"end end elseif(not J.ControlUndead:IsUsableP()or J.ControlUndead:CooldownRemains()>0 or g:PrevGCD(1,J.ControlUndead))and x then HeroRotationCharDB.Toggles[81]=not HeroRotationCharDB.Toggles[81]l.Print("Control Undead Queue is now "..(HeroRotationCharDB.Toggles[81]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if a1.TargetIsValid()and g:AffectingCombat()then if true then local M=as()if M then return M end end;if g:IsChanneling(J.Blooddrinker)and g:BuffUp(J.BoneShieldBuff)and U==0 and not g:ShouldStopCasting()and g:CastRemains()>0.2 then if l.CastAnnotated(J.Pool,false,"WAIT")then a4=99999;return"Pool During Blooddrinker"end end;N=70;if a2.Commons.Enabled.Potions then local ay=a1.PotionSelected()if ay then if ay:IsReady()and n()and u and(g:BloodlustUp()and l.GUISettings.General.HoldPotforBL or not l.GUISettings.General.HoldPotforBL and g:BuffUp(J.DancingRuneWeaponBuff))then if m(ay,nil)then a4=50;return"potion cooldowns 2"end end end end;if a2.Commons.Enabled.TopTrinket or a2.Commons.Enabled.BottomTrinket then local az=g:GetUseableTrinkets(L)if az then if m(az,nil,nil)then if az:ID()==TopTrinketID and a2.Commons.Enabled.TopTrinket and(a2.Blood.TopTrinketHP<=0 and n()or a2.Blood.TopTrinketHP>g:HealthPercentage())then a4=24;return"top trinket 1"elseif az:ID()==BotTrinketID and a2.Commons.Enabled.BottomTrinket and(a2.Blood.BotTrinketHP<=0 and n()or a2.Blood.BotTrinketHP>g:HealthPercentage())then a4=30;return"top trinket 2"end end end end;if K.GaveloftheFirstArbiter:IsEquippedAndReady()and h:IsInRange(30)and n()and not A then if m(K.GaveloftheFirstArbiter,nil,nil,not h:IsInRange(30))then a4=16;return"gavel_of_the_first_arbiter trinkets 4"end end;if J.BloodBoil:IsCastable()and F and not UnitExists("boss1")and MissingAggro>0 then if m(J.BloodBoil)then a4=50842;return"blood_boil for aggro 6"end end;if n()and not i:DebuffUp(j(111673))and J.RaiseDead:IsCastable()then if m(J.RaiseDead,nil,nil)then a4=46585;return"raise_dead main 24"end end;if J.DeathsCaress:IsReady()and not F and g:BuffDown(J.BoneShieldBuff)then if m(J.DeathsCaress,nil,nil,not h:IsSpellInRange(J.DeathsCaress))then a4=195292;return"deaths_caress drw_up 2"end end;if J.Blooddrinker:IsReady()and g:BuffDown(J.DancingRuneWeaponBuff)then if m(J.Blooddrinker,nil,nil,not h:IsSpellInRange(J.Blooddrinker))then a4=206931;return"blooddrinker main 20"end end;if true then local M=at()if M then return M end end;if J.SacrificialPact:IsReady()and J.RaiseDead:TimeSinceLastCast()<=60 and V.active()and(g:BuffDown(J.DancingRuneWeaponBuff)and(V.remains()<2 or h:TimeToDie()<g:GCD()))then if m(J.SacrificialPact,nil)then a4=237574;return"sacrificial_pact covenants 8"end end;if J.BloodTap:IsCastable()and(g:Rune()<=2 and g:RuneTimeToX(4)>g:GCD()and J.BloodTap:ChargesFractional()>=1.8 or g:RuneTimeToX(3)>g:GCD())then if m(J.BloodTap)then a4=221699;return"blood_tap main 12"end end;if J.Marrowrend:IsReady()and F and g:BuffRemains(J.BoneShieldBuff)<g:GCD()+0.5 then if m(J.Marrowrend)then a4=195182;return"marrowrend main 14"end end;if J.DeathsCaress:IsReady()and not F and(g:BuffRemains(J.BoneShieldBuff)<g:GCD()+0.5 or g:BuffDown(J.BoneShieldBuff))then if m(J.DeathsCaress,nil,nil,not h:IsSpellInRange(J.DeathsCaress))then a4=195292;return"deaths_caress main 16"end end;if J.DancingRuneWeapon:IsCastable()and F and not y and n()and g:BuffDown(J.DancingRuneWeaponBuff)then if m(J.DancingRuneWeapon,nil)then a4=49028;return"dancing_rune_weapon main 14"end end;if g:BuffUp(J.DancingRuneWeaponBuff)then local M=au()if M then return M end end;if true then local M=av()if M then return M end end;if l.CastAnnotated(J.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function aA()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell1()if a4==0 then return 0 else return a4 end end;function ReturnSpellMO1()if a5==0 then return 0 else return a5 end end;l.SetAPL(250,ax,aA)