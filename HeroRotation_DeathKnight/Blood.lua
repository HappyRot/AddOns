local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.CDsON;local o=l.AoEON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[6]local s=HeroRotationCharDB.Toggles[12]local t=HeroRotationCharDB.Toggles[13]local u=HeroRotationCharDB.Toggles[14]local v=HeroRotationCharDB.Toggles[15]local w=HeroRotationCharDB.Toggles[16]local x=HeroRotationCharDB.Toggles[80]local y=HeroRotationCharDB.Toggles[81]local z=HeroRotationCharDB.Toggles[82]local A=HeroRotationCharDB.Toggles[72]local B=0;local C=j.DeathKnight.Blood;local D=k.DeathKnight.Blood;local E={}local F;local G;local H;local I;local J;local K=d.GhoulTable;local L;local M;local N=0;local O=999999;local P=0;local Q=g:CovenantID()d:RegisterForEvent(function()Q=g:CovenantID()end,"COVENANT_CHOSEN")local R=l.Commons.Everyone;local S={General=l.GUISettings.General,Commons=l.GUISettings.APL.DeathKnight.Commons,Blood=l.GUISettings.APL.DeathKnight.Blood}local T={{C.Asphyxiate,"Cast Asphyxiate (Interrupt)",function()return true end}}local U=0;local V=0;d:RegisterForEvent(function()equip=g:GetEquipment()trinket1=k(0)trinket2=k(0)if equip[13]then trinket1=k(equip[13])end;if equip[14]then trinket2=k(equip[14])end;SuperstrainEquipped=g:HasLegendaryEquipped(30)PhearomonesEquipped=g:HasLegendaryEquipped(31)DeadliestCoilEquipped=g:HasLegendaryEquipped(45)end,"PLAYER_EQUIPMENT_CHANGED")local W={5,8,10,30,40,100}local X={}local function Y()for _,Z in ipairs(W)do if Z==8 or 5 then X[Z]=h:IsInMeleeRange(Z)end;X[Z]=h:IsInRange(Z)end end;local function a0(a1)if a1 then return 1 else return 0 end end;local function a2(a1)return a1~=0 end;local function a3(a4)local a5=0;for _,a6 in pairs(a4)do if not a6:DebuffUp(C.BloodPlagueDebuff)then a5=a5+1 end end;return a5 end;local function a7(a8)if not g:IsTanking(a8)and A and a8:AffectingCombat()and a8:GUID()==f("mouseover"):GUID()and a8:NPCID()~=118044 then V=156222;return true elseif not g:IsTanking(a8)and A and a8:AffectingCombat()and a8:GUID()==h:GUID()and a8:NPCID()~=118044 then U=56222;return true elseif not g:IsTanking(a8)and A and a8:AffectingCombat()and a8:NPCID()~=118044 then return true end end;local function a9()if R.TargetIsValid()then if C.Fleshcraft:IsCastable()and(B==0 or B>C.Fleshcraft:ExecuteTime())and p and not g:IsMoving()then if m(C.Fleshcraft,nil,nil)then U=324631;return"fleshcraft precombat 1"end end;if C.DeathsCaress:IsReady()and not h:IsInMeleeRange(5)then if m(C.DeathsCaress,nil,nil,not h:IsSpellInRange(C.DeathsCaress))then U=195292;return"deaths_caress precombat 2"end end;if C.Marrowrend:IsReady()and h:IsInMeleeRange(5)then if m(C.Marrowrend)then U=195182;return"marrowrend precombat 4"end end;if C.BloodBoil:IsCastable()and h:IsInMeleeRange(10)then if m(C.BloodBoil)then U=50842;return"blood_boil precombat 6"end end end end;local function aa()if g:HealthPercentage()<S.Commons.PhialHP and D.PhialofSerenity:IsReady()and D.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(D.PhialofSerenity,nil)then U=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<S.Commons.HealthstoneHP and D.Healthstone:IsReady()and D.Healthstone:CooldownRemains()<=0 then if l.Cast(D.Healthstone,nil)then U=40;return"Healthstone HP"end end;if g:HealthPercentage()<S.Commons.HealPotHP and D.HealPot:IsReady()and D.HealPot:CooldownRemains()<=0 then if l.Cast(D.HealPot,nil)then U=41;return"HealPot HP"end end;if C.AntiMagicShell:IsReady()and N>0 and g:HealthPercentage()<=S.Commons.AntiMagicShellHP then if m(C.AntiMagicShell,nil,nil)then U=48707;return"AntiMagic Shell defensives 18"end end;if C.RuneTap:IsReady()and G and g:HealthPercentage()<=S.Blood.RuneTapThreshold and g:Rune()>=3 and C.RuneTap:Charges()>=1 and g:BuffDown(C.RuneTapBuff)then if m(C.RuneTap,nil)then U=194679;return"rune_tap defensives 2"end end;if R.ActiveMitigationNeeded()and C.Marrowrend:TimeSinceLastCast()>2.5 and C.DeathStrike:TimeSinceLastCast()>2.5 then if C.DeathStrike:IsReady()and not M and g:BuffStack(C.BoneShieldBuff)>7 then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike defensives 4"end end;if C.Marrowrend:IsReady()then if m(C.Marrowrend,nil,nil,not h:IsSpellInRange(C.Marrowrend))then U=195182;return"marrowrend defensives 6"end end;if C.Tombstone:IsReady()and g:BuffStack(C.BoneShieldBuff)>=7 then if m(C.Tombstone,nil)then U=219808;return"tombstone defensives 8"end end;if C.DeathStrike:IsReady()and not M then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike defensives 10"end end end;if C.Marrowrend:IsReady()and(g:BuffRemains(C.BoneShieldBuff)<=6 or h:TimeToDie()<5 and g:BuffRemains(C.BoneShieldBuff)<10 and I==1)then if m(C.Marrowrend,nil,nil,not h:IsSpellInRange(C.Marrowrend))then U=195182;return"marrowrend defensives 12"end end;if C.VampiricBlood:IsCastable()and G and g:HealthPercentage()<=S.Blood.VampiricBloodThreshold and g:BuffDown(C.IceboundFortitudeBuff)then if m(C.VampiricBlood,nil)then U=55233;return"vampiric_blood defensives 14"end end;if C.Lichborne:IsReady()and g:HealthPercentage()<=S.Commons.LichborneHP then if m(C.Lichborne,nil,nil)then U=49039;return"Lichborne defensives 18"end end;if C.DeathPact:IsAvailable()and C.DeathPact:IsReady()and g:HealthPercentage()<=S.Commons.DeathPactHP then if m(C.DeathPact,nil,nil)then U=48743;return"DeathPact defensives 18"end end;if C.IceboundFortitude:IsCastable()and G and g:HealthPercentage()<=S.Blood.IceboundFortitudeThreshold and g:BuffDown(C.VampiricBloodBuff)then if m(C.IceboundFortitude,nil)then U=48792;return"icebound_fortitude defensives 16"end end;if C.DeathStrike:IsReady()and not M and g:HealthPercentage()<=50+(g:RunicPower()>90 and 20 or 0)and not g:HealingAbsorbed()then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike defensives 18"end end end;local function ab()if C.BloodTap:IsCastable()and(g:Rune()<=2 and g:RuneTimeToX(4)>g:GCD()and C.BloodTap:ChargesFractional()>=1.8)then if m(C.BloodTap)then U=221699;return"blood_tap standard 2"end end;if C.DancingRuneWeapon:IsCastable()and not z and n()and(not C.Blooddrinker:IsAvailable()or not C.Blooddrinker:CooldownUp())then if m(C.DancingRuneWeapon,nil)then U=49028;return"dancing_rune_weapon standard 4"end end;if C.Marrowrend:IsReady()and((Q~=4 or g:BuffUp(C.AbominationLimbBuff))and(g:BuffRemains(C.BoneShieldBuff)<=g:RuneTimeToX(3)or g:BuffRemains(C.BoneShieldBuff)<=g:GCD()+a0(C.Blooddrinker:CooldownUp())*a0(C.Blooddrinker:IsAvailable())*2 or g:BuffStack(C.BoneShieldBuff)<3)and g:RunicPowerDeficit()>=20)then if m(C.Marrowrend,nil,nil,not h:IsSpellInRange(C.Marrowrend))then U=195182;return"marrowrend standard 8"end end;if C.DeathStrike:IsReady()and not M and not L and g:RunicPowerDeficit()<=70 then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike standard 10"end end;if C.Marrowrend:IsReady()and(g:BuffStack(C.BoneShieldBuff)<6 and g:RunicPowerDeficit()>=15 and(Q~=3 or g:BuffRemains(C.DeathsDueBuff)>5))then if m(C.Marrowrend,nil,nil,not h:IsSpellInRange(C.Marrowrend))then U=195182;return"marrowrend standard 12"end end;if C.HeartStrike:IsReady()and(not C.Blooddrinker:IsAvailable()and g:BuffRemains(C.DeathAndDecayBuff)<5 and g:RunicPowerDeficit()<=15+a0(g:BuffUp(C.DancingRuneWeaponBuff))*5+I*a0(C.Heartbreaker:IsAvailable())*2)then if m(C.HeartStrike,nil,nil,not h:IsSpellInRange(C.HeartStrike))then U=206930;return"heart_strike standard 14"end end;if C.BloodBoil:IsCastable()and h:IsInRange(10)and(C.BloodBoil:ChargesFractional()>=1.8 and(g:BuffStack(C.HemostasisBuff)<=5-EnemiesCount10y or EnemiesCount10y>2))then if m(C.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then U=50842;return"blood_boil standard 16"end end;if C.DeathAndDecay:IsReady()and(g:BuffUp(C.CrimsonScourgeBuff)and C.RelishinBlood:IsAvailable()and g:RunicPowerDeficit()>10)then if m(C.DeathAndDecay,nil,nil,not h:IsInRange(30))then U=43265;return"death_and_decay standard 18"end end;if C.Bonestorm:IsReady()and not M and(g:RunicPower()>=S.Blood.BonestormPower and g:BuffDown(C.DancingRuneWeaponBuff))then if m(C.Bonestorm,nil,nil,not h:IsInRange(8))then U=194844;return"bonestorm standard 20"end end;if C.DeathStrike:IsReady()and not M and not L and(g:RunicPowerDeficit()<=15+a0(g:BuffUp(C.DancingRuneWeaponBuff))*5+I*a0(C.Heartbreaker:IsAvailable())*2 or h:TimeToDie()<10)then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike standard 22"end end;if C.DeathAndDecay:IsReady()and I>=3 then if m(C.DeathAndDecay,nil,nil,not h:IsInRange(30))then U=43265;return"death_and_decay standard 24"end end;if C.HeartStrike:IsReady()and(g:BuffUp(C.DancingRuneWeaponBuff)or g:RuneTimeToX(4)<g:GCD())then if m(C.HeartStrike,nil,nil,not h:IsSpellInRange(C.HeartStrike))then U=206930;return"heart_strike standard 26"end end;if C.BloodBoil:IsCastable()and h:IsInRange(10)and g:BuffUp(C.DancingRuneWeaponBuff)then if m(C.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then U=50842;return"blood_boil standard 28"end end;if C.BloodTap:IsCastable()and g:RuneTimeToX(3)>g:GCD()then if m(C.BloodTap)then U=221699;return"blood_tap standard 30"end end;if C.DeathAndDecay:IsReady()and(g:BuffUp(C.CrimsonScourgeBuff)or C.RapidDecomposition:IsAvailable()or I>=2)then if m(C.DeathAndDecay,nil,nil,not h:IsInRange(30))then U=43265;return"death_and_decay standard 32"end end;if C.Consumption:IsCastable()then if m(C.Consumption,nil,nil,not h:IsSpellInRange(C.Consumption))then U=274156;return"consumption standard 34"end end;if C.BloodBoil:IsCastable()and h:IsInRange(10)and C.BloodBoil:ChargesFractional()>=1.1 then if m(C.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then U=50842;return"blood_boil standard 36"end end;if C.HeartStrike:IsReady()and(g:Rune()>1 and(g:RuneTimeToX(3)<g:GCD()or g:BuffStack(C.BoneShieldBuff)>7))then if m(C.HeartStrike,nil,nil,not h:IsSpellInRange(C.HeartStrike))then U=206930;return"heart_strike standard 38"end end;if C.ArcaneTorrent:IsCastable()and S.Commons.Enabled.Racials and n()and g:RunicPowerDeficit()>20 then if m(C.ArcaneTorrent,nil,nil,not h:IsInMeleeRange(8))then U=155145;return"arcane_torrent standard 40"end end end;local function ac()if C.DeathStrike:IsReady()and not M and not L and(Q==3 and g:BuffRemains(C.DeathsDueBuff)>6 and g:RunicPower()>70)then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike covenants 2"end end;if C.HeartStrike:IsReady()and(Q==3 and g:BuffUp(C.DeathAndDecayBuff)and((g:BuffUp(C.DeathsDueBuff)or g:BuffUp(C.DancingRuneWeaponBuff))and g:BuffRemains(C.DeathsDueBuff)))then if m(C.HeartStrike,nil,nil,not h:IsSpellInRange(C.HeartStrike))then U=206930;return"heart_strike covenants 4"end end;if C.DeathsDue:IsReady()and p and(g:BuffDown(C.DeathsDueBuff)or g:BuffRemains(C.DeathsDueBuff)<4 or g:BuffUp(C.CrimsonScourgeBuff))then if m(C.DeathsDue,nil,nil,not h:IsSpellInRange(C.DeathsDue))then U=324128;return"deaths_due covenants 6"end end;if C.RaiseDead:TimeSinceLastCast()<=60 and C.SacrificialPact:IsReady()and((Q~=3 or g:BuffRemains(C.DeathsDueBuff)>6)and g:BuffDown(C.DancingRuneWeaponBuff)and(C.RaiseDead:TimeSinceLastCast()>55+g:GCD()or d.FilteredFightRemains(Enemies10y,"<",g:GCD())))then if m(C.SacrificialPact,nil)then U=237574;return"sacrificial_pact covenants 8"end end;if C.DeathStrike:IsReady()and not M and not L and(Q==2 and g:RunicPower()>70 and C.SwarmingMist:CooldownRemains()<3)then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike covenants 10"end end;if C.SwarmingMist:IsReady()and p and g:BuffDown(C.DancingRuneWeaponBuff)then if m(C.SwarmingMist,nil,nil)then U=311648;return"swarming_mist covenants 12"end end;if C.Marrowrend:IsReady()and(Q==4 and g:BuffDown(C.BoneShieldBuff))then if m(C.Marrowrend,nil,nil,not h:IsSpellInRange(C.Marrowrend))then U=195182;return"marrowrend covenants 14"end end;if C.AbominationLimb:IsCastable()and p and g:BuffDown(C.DancingRuneWeaponBuff)then if m(C.AbominationLimb,nil,nil,not h:IsInRange(8))then U=315443;return"abomination_limb covenants 16"end end;if C.ShackleTheUnworthy:IsCastable()and p and(C.DancingRuneWeapon:CooldownRemains()<3 or g:BuffDown(C.DancingRuneWeaponBuff))then if m(C.ShackleTheUnworthy,nil,nil,not h:IsSpellInRange(C.ShackleTheUnworthy))then U=312202;return"shackle_the_unworthy covenants 18"end end;if C.Fleshcraft:IsCastable()and(B==0 or B>C.Fleshcraft:ExecuteTime())and not g:IsMoving()and p and(C.PustuleEruption:SoulbindEnabled()or C.VolatileSolvent:SoulbindEnabled())then if m(C.Fleshcraft,nil,nil)then U=324631;return"fleshcraft covenants 20"end end end;local function ad()r=HeroRotationCharDB.Toggles[6]p=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[5]s=HeroRotationCharDB.Toggles[12]t=HeroRotationCharDB.Toggles[13]u=HeroRotationCharDB.Toggles[14]v=HeroRotationCharDB.Toggles[15]w=HeroRotationCharDB.Toggles[16]x=HeroRotationCharDB.Toggles[80]y=HeroRotationCharDB.Toggles[81]z=HeroRotationCharDB.Toggles[82]A=HeroRotationCharDB.Toggles[72]L=false;M=false;if C.Bonestorm:IsAvailable()and n()and C.Bonestorm:CooldownRemains()<=0 and C.Bonestorm:IsCastable()then L=true end;if GetTime()-O>=5 then N=0 end;B=0;for Z=1,20 do if select(10,UnitDebuff("player",Z))==240447 then if select(6,UnitDebuff("player",Z))~=nil then B=select(6,UnitDebuff("player",Z))-GetTime()end end end end;local function ae(self,af,ag,ah,ai,_,aj)if aj==UnitGUID("player")then local ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,P,ay,az,aA,aB,aC,aD,aE,aF,aG=CombatLogGetCurrentEventInfo()if string.match(al,"_DAMAGE")then if al~="SWING_DAMAGE"and ax~=1 then O=GetTime()N=P end end end end;local aH=CreateFrame("Frame")aH:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")aH:SetScript("OnEvent",ae)local function aI()Enemies10y=g:GetEnemiesInRange(10)if o()then H=g:GetEnemiesInMeleeRange(8)I=#H;EnemiesCount10y=#Enemies10y;Enemies40y=g:GetEnemiesInRange(40)else I=1;EnemiesCount10y=1 end;J=a3(Enemies10y)TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)ActiveMitigationNeeded=g:ActiveMitigationNeeded()G=g:IsTankingAoE(8)or g:IsTanking(h)if not BotOn then V=0;U=0 end;if V>0 then V=0 end;if U>0 then U=0 end;F=ad()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if g:IsChanneling(j(324631))then if l.CastAnnotated(C.Pool,false,"WAIT")then U=99999;return"Pool During Blooddrinker"end end;if not g:AffectingCombat()and R.TargetIsValid()and r then local F=a9()if F then return F end end;if not UnitIsEnemy("player","mouseover")and UnitIsPlayer("mouseover")and UnitIsDead("mouseover")then if C.RaiseAlly:IsCastable()and g:RunicPower()>=30 then if m(C.RaiseAlly,nil)then V=161999;return"RaiseAlly MO"end elseif C.RaiseAlly:CooldownRemains(BypassRecovery)<=0 and g:RunicPower()<30 then M=true end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if C.HeartStrike:IsCastable()then if m(C.HeartStrike,nil)then V=1206930;return"explosive MO HeartStrike"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if C.DeathStrike:IsCastable()then if m(C.DeathStrike,nil)then V=149998;return"explosive MO DeathStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if C.HeartStrike:IsCastable()then if m(C.HeartStrike,nil)then U=206930;return"explosive  HeartStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if C.DeathStrike:IsCastable()then if m(C.DeathStrike,nil)then U=49998;return"explosive  DeathStrike"end end end;if R.TargetIsValid()then if C.DarkCommand:IsReady()and g:AffectingCombat()and(not g:IsTanking(h)and A)then if m(C.DarkCommand,nil)then U=56222;return"DarkCommand bear 3"end end;if C.DarkCommand:IsReady()then if R.CastCycle(C.DarkCommand,Enemies40y,a7,not h:IsSpellInRange(C.DarkCommand))then return"DarkCommand 4"end end end;if w and C.Asphyxiate:IsUsableP()and C.Asphyxiate:CooldownRemains(BypassRecovery)<=0 then if l.Cast(C.Asphyxiate,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(C.Asphyxiate)then V=1221562;return"queue Asphyxiate MO"else U=221562;return"queue Asphyxiate"end end elseif(not C.Asphyxiate:IsUsableP()or C.Asphyxiate:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[16]=not HeroRotationCharDB.Toggles[16]l.Print("Asphyxiate Queue is now "..(HeroRotationCharDB.Toggles[16]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if u and C.DeathGrip:IsUsableP()and C.DeathGrip:CooldownRemains(BypassRecovery)<=0 then if l.Cast(C.DeathGrip,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(C.DeathGrip)then V=149576;return"queue DeathGrip MO"else U=49576;return"queue DeathGrip"end end elseif(not C.DeathGrip:IsUsableP()or C.DeathGrip:CooldownRemains()>0)and u then HeroRotationCharDB.Toggles[14]=not HeroRotationCharDB.Toggles[14]l.Print("DeathGrip Queue is now "..(HeroRotationCharDB.Toggles[14]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and C.GorefiendsGrasp:IsUsableP()and C.GorefiendsGrasp:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(C.GorefiendsGrasp,nil,nil,nil)then U=108199;return"queue Gorefiends Grasp"end elseif(not C.GorefiendsGrasp:IsUsableP()or C.GorefiendsGrasp:CooldownRemains()>0 or not g:AffectingCombat())and x then HeroRotationCharDB.Toggles[80]=not HeroRotationCharDB.Toggles[80]l.Print("Gorefiend's Grasp Queue is now "..(HeroRotationCharDB.Toggles[80]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if t and C.AntiMagicZone:IsUsableP()and C.AntiMagicZone:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(C.AntiMagicZone,nil,nil,nil)then U=51052;return"queue Anti Magic Zone"end elseif(not C.AntiMagicZone:IsUsableP()or C.AntiMagicZone:CooldownRemains()>0 or not g:AffectingCombat())and t then HeroRotationCharDB.Toggles[13]=not HeroRotationCharDB.Toggles[13]l.Print("Anti-Magic Zone Queue is now "..(HeroRotationCharDB.Toggles[13]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and C.ControlUndead:IsUsableP()and C.ControlUndead:CooldownRemains(BypassRecovery)<=0 and not g:PrevGCD(1,C.ControlUndead)then if l.Cast(C.ControlUndead,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsInRange(30)then V=1111673;return"queue ControlUndead MO"else U=111673;return"queue ControlUndead"end end elseif(not C.ControlUndead:IsUsableP()or C.ControlUndead:CooldownRemains()>0 or g:PrevGCD(1,C.ControlUndead))and y then HeroRotationCharDB.Toggles[81]=not HeroRotationCharDB.Toggles[81]l.Print("Control Undead Queue is now "..(HeroRotationCharDB.Toggles[81]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if R.TargetIsValid()and g:AffectingCombat()then if S.Commons.UseDefensives then local F=aa()if F then return F end end;if g:IsChanneling(C.Blooddrinker)and g:BuffUp(C.BoneShieldBuff)and J==0 and not g:ShouldStopCasting()and g:CastRemains()>0.2 then if l.CastAnnotated(C.Pool,false,"WAIT")then U=99999;return"Pool During Blooddrinker"end end;if n()then if C.BloodFury:IsCastable()and S.Commons.Enabled.Racials and((C.DancingRuneWeapon:CooldownUp()or z)and(not C.Blooddrinker:IsReady()or not C.Blooddrinker:IsAvailable()))then if m(C.BloodFury,nil)then U=20572;return"blood_fury main 2"end end;if C.Berserking:IsCastable()and S.Commons.Enabled.Racials then if m(C.Berserking,nil)then U=26297;return"berserking main 4"end end;if C.ArcanePulse:IsCastable()and S.Commons.Enabled.Racials and(I>=2 or g:Rune()<1 and g:RunicPowerDeficit()>60)then if m(C.ArcanePulse,nil,nil,not h:IsInRange(8))then U=260364;return"arcane_pulse main 6"end end;if C.LightsJudgment:IsCastable()and S.Commons.Enabled.Racials and g:BuffUp(C.UnholyStrengthBuff)then if m(C.LightsJudgment,nil,nil,not h:IsSpellInRange(C.LightsJudgment))then U=255647;return"lights_judgment main 8"end end;if C.AncestralCall:IsCastable()and S.Commons.Enabled.Racials then if m(C.AncestralCall,nil)then U=274738;return"ancestral_call main 10"end end;if C.Fireblood:IsCastable()and S.Commons.Enabled.Racials then if m(C.Fireblood,nil)then U=265221;return"fireblood main 12"end end;if C.BagofTricks:IsCastable()and S.Commons.Enabled.Racials then if m(C.BagofTricks,nil,nil,not h:IsSpellInRange(C.BagofTricks))then U=312411;return"bag_of_tricks main 14"end end end;if D.PotionofPhantomFire:IsReady()and S.Commons.Enabled.Potions and g:BuffUp(C.DancingRuneWeaponBuff)then if m(D.PotionofPhantomFire,nil,nil)then U=37;return"potion main 16"end end;if S.Commons.Enabled.TopTrinket or S.Commons.Enabled.BottomTrinket then local aJ=g:GetUseableTrinkets(E)if aJ then if m(aJ,nil,nil)then if aJ:ID()==TopTrinketID and S.Commons.Enabled.TopTrinket and(S.Blood.TopTrinketHP<=0 and n()or S.Blood.TopTrinketHP>g:HealthPercentage())then U=24;return"top trinket 1"elseif aJ:ID()==BotTrinketID and S.Commons.Enabled.BottomTrinket and(S.Blood.BotTrinketHP<=0 and n()or S.Blood.BotTrinketHP>g:HealthPercentage())then U=30;return"top trinket 2"end end end end;if C.Blooddrinker:IsReady()and(B==0 or B>3)and(g:BuffDown(C.DancingRuneWeaponBuff)and(Q~=3 or g:BuffRemains(C.DeathsDueBuff)>7))then if m(C.Blooddrinker,nil,nil,not h:IsSpellInRange(C.Blooddrinker))then U=206931;return"blooddrinker main 20"end end;if C.BloodBoil:IsCastable()and h:IsInRange(10)and(C.BloodBoil:Charges()>=2 and(Q==1 or g:BuffUp(C.DancingRuneWeaponBuff)))then if m(C.BloodBoil,nil,nil,not h:IsInMeleeRange(10))then U=50842;return"blood_boil main 22"end end;if n()and not i:DebuffUp(j(111673))and C.RaiseDead:IsCastable()then if m(C.RaiseDead,nil,nil)then U=46585;return"raise_dead main 24"end end;if C.DeathStrike:IsReady()and not L and not M and d.FilteredFightRemains(Enemies10y,"<",3)then if m(C.DeathStrike,nil,nil,not h:IsSpellInRange(C.DeathStrike))then U=49998;return"death_strike main 26"end end;if true then local F=ac()if F then return F end end;if true then local F=ab()if F then return F end end;if l.CastAnnotated(C.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function aK()end;function ReturnSpell1()if U==0 then return 0 else return U end end;function ReturnSpellMO1()if V==0 then return 0 else return V end end;l.SetAPL(250,aI,aK)