local a,a=...local a=HeroDBC.DBC;local b=HeroLib;local a=HeroCache;local c=b.Unit;local d=c.Player;local e=c.Target;local f=c.Pet;local g=b.Spell;local h=b.Item;local i=HeroRotation;local j=i.Cast;local k=i.CDsON;local l=i.AoEON;local m=HeroRotationCharDB.Toggles[4]local n=HeroRotationCharDB.Toggles[5]local o=HeroRotationCharDB.Toggles[6]local p=HeroRotationCharDB.Toggles[12]local q=HeroRotationCharDB.Toggles[13]local r=HeroRotationCharDB.Toggles[14]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[16]local u=HeroRotationCharDB.Toggles[80]local v=HeroRotationCharDB.Toggles[81]local w=HeroRotationCharDB.Toggles[82]local x=HeroRotationCharDB.Toggles[84]local y=HeroRotationCharDB.Toggles[17]local z=HeroRotationCharDB.Toggles[85]local A=HeroRotationCharDB.Toggles[18]local B=HeroRotationCharDB.Toggles[83]local C=HeroRotationCharDB.Toggles[72]local D=false;local E=0;local F=math.min;local a=g.DeathKnight.Blood;local G=h.DeathKnight.Blood;local H={}local I;local J;local K;local L;local M;local N;local O;local P;local Q;local R=b.GhoulTable;local S;local T;local U=2;local V=999999;local V=2;local W=d:CovenantID()b:RegisterForEvent(function()W=d:CovenantID()end,"COVENANT_CHOSEN")local X=i.Commons.Everyone;local Y={General=i.GUISettings.General,Commons=i.GUISettings.APL.DeathKnight.Commons,Blood=i.GUISettings.APL.DeathKnight.Blood}local V={{a.Asphyxiate,"Cast Asphyxiate (Interrupt)",function()return true end}}local V=0;local Z=0;local a0=d:HasLegendaryEquipped(30)local a1=d:HasLegendaryEquipped(31)local a2=d:HasLegendaryEquipped(45)local a3=d:HasLegendaryEquipped(35)b:RegisterForEvent(function()equip=d:GetEquipment()trinket1=h(0)trinket2=h(0)if equip[13]then trinket1=h(equip[13])end;if equip[14]then trinket2=h(equip[14])end;a0=d:HasLegendaryEquipped(30)a1=d:HasLegendaryEquipped(31)a2=d:HasLegendaryEquipped(45)a3=d:HasLegendaryEquipped(35)end,"PLAYER_EQUIPMENT_CHANGED")local h={5,8,10,30,40,100}local b={}local function a3()for d,a in ipairs(h)do if a==8 or 5 then b[a]=e:IsInMeleeRange(a)end;b[a]=e:IsInRange(a)end end;local function b(a)if a then return 1 else return 0 end end;local function h(a)return a~=0 end;local function a4(V)local a=0;if V~=nil then for j,V in pairs(V)do if not d:IsTanking(V)and V:GUID()~=e:GUID()and V:AffectingCombat()then a=a+1 end end end;return a end;local function h(e)local d=0;if e~=nil then for V,e in pairs(e)do if not e:DebuffUp(a.BloodPlagueDebuff)then d=d+1 end end end;return d end;local function a1(d)return d:DebuffRemains(a.SoulReaperDebuff)end;local function a2(a)if not d:IsTanking(a)and C and a:AffectingCombat()and a:GUID()==c("mouseover"):GUID()and a:NPCID()~=118044 and a:IsInMeleeRange(30)then Z=156222;return true elseif not d:IsTanking(a)and C and a:AffectingCombat()and a:GUID()==e:GUID()and a:NPCID()~=118044 and a:IsInMeleeRange(30)then V=56222;return true elseif not d:IsTanking(a)and C and a:AffectingCombat()and a:NPCID()~=118044 and a:IsInMeleeRange(30)then return true end end;local function a3(d)if d:TimeToX(35)<35 and d:TimeToDie()>d:DebuffRemains(a.SoulReaperDebuff)+5 and d:AffectingCombat()and d:GUID()==c("mouseover"):GUID()and d:NPCID()~=118044 and d:IsInMeleeRange(30)then Z=1343294;return true elseif d:TimeToX(35)<35 and d:TimeToDie()>d:DebuffRemains(a.SoulReaperDebuff)+5 and d:AffectingCombat()and d:GUID()==e:GUID()and d:NPCID()~=118044 and d:IsInMeleeRange(30)then V=343294;return true elseif d:TimeToX(35)<35 and d:TimeToDie()>d:DebuffRemains(a.SoulReaperDebuff)+5 and d:AffectingCombat()and d:NPCID()~=118044 and d:IsInMeleeRange(30)then return true end end;local function a5()if X.TargetIsValid()then if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)then if j(a.Marrowrend)then V=195182;return"marrowrend precombat 4"end end;if a.BloodBoil:IsCastable()and e:IsInMeleeRange(10)then if j(a.BloodBoil)then V=50842;return"blood_boil precombat 6"end end end end;local function a0()if a.DeathStrike:IsReady()and Y.Commons.UseDefensives and e:IsInMeleeRange(8)and not T and d:HealthPercentage()<Y.Commons.UseDeathStrikeHP then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike defensives 4"end end;if d:HealthPercentage()<Y.Commons.PhialHP and Y.Commons.UseDefensives and G.PhialofSerenity:IsReady()and G.PhialofSerenity:CooldownRemains()<=0 and d:BuffDown(a.ShroudofPurgatory)then if i.Cast(G.PhialofSerenity,nil)then V=55;return"PhialofSerenity HP"end end;if d:HealthPercentage()<Y.Commons.HealthstoneHP and Y.Commons.UseDefensives and G.Healthstone:IsReady()and G.Healthstone:CooldownRemains()<=0 and d:BuffDown(a.ShroudofPurgatory)then if i.Cast(G.Healthstone,nil)then V=40;return"Healthstone HP"end end;if d:HealthPercentage()<Y.Commons.HealPotHP and Y.Commons.UseDefensives and G.CosmicHealPot:IsReady()and G.CosmicHealPot:CooldownRemains()<=0 and d:BuffDown(a.ShroudofPurgatory)then if i.Cast(G.CosmicHealPot,nil)then V=45;return"CosmicHealPot HP"end end;if d:HealthPercentage()<Y.Commons.HealPotHP and Y.Commons.UseDefensives and G.HealPot:IsReady()and G.HealPot:CooldownRemains()<=0 and d:BuffDown(a.ShroudofPurgatory)then if i.Cast(G.HealPot,nil)then V=41;return"HealPot HP"end end;if a.AntiMagicShell:IsReady()and Y.Commons.UseDefensives and U>0 and d:HealthPercentage()<=Y.Commons.AntiMagicShellHP then if j(a.AntiMagicShell,nil,nil)then V=48707;return"AntiMagic Shell defensives 18"end end;if a.RuneTap:IsReady()and Y.Commons.UseDefensives and M and d:HealthPercentage()<=Y.Blood.RuneTapThreshold and d:Rune()>=3 and a.RuneTap:Charges()>=1 and d:BuffDown(a.RuneTapBuff)then if j(a.RuneTap,nil)then V=194679;return"rune_tap defensives 2"end end;if X.ActiveMitigationNeeded()and e:IsInMeleeRange(8)and a.Marrowrend:TimeSinceLastCast()>.5 and a.DeathStrike:TimeSinceLastCast()>.5 then if a.DeathStrike:IsReady()and Y.Commons.UseDefensives and not T and d:BuffStack(a.BoneShieldBuff)>7 then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike defensives 4"end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and d:BuffStack(a.BoneShieldBuff)>=8 then if j(a.Marrowrend,nil,nil,not e:IsSpellInRange(a.Marrowrend))then V=195182;return"marrowrend defensives 6"end end;if a.DeathStrike:IsReady()and Y.Commons.UseDefensives and e:IsInMeleeRange(8)and not T then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike defensives 10"end end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and(d:BuffRemains(a.BoneShieldBuff)<=6 or e:TimeToDie()<5 and d:BuffRemains(a.BoneShieldBuff)<10 and O==1)then if j(a.Marrowrend,nil,nil,not e:IsSpellInRange(a.Marrowrend))then V=195182;return"marrowrend defensives 12"end end;if a.VampiricBlood:IsCastable()and Y.Commons.UseDefensives and M and d:HealthPercentage()<=Y.Blood.VampiricBloodThreshold and d:BuffDown(a.IceboundFortitudeBuff)then if j(a.VampiricBlood,nil)then V=55233;return"vampiric_blood defensives 14"end end;if a.Lichborne:IsReady()and Y.Commons.UseDefensives and d:HealthPercentage()<=Y.Commons.LichborneHP then if j(a.Lichborne,nil,nil)then V=49039;return"Lichborne defensives 18"end end;if a.DeathPact:IsAvailable()and Y.Commons.UseDefensives and a.DeathPact:IsReady()and d:HealthPercentage()<=Y.Commons.DeathPactHP then if j(a.DeathPact,nil,nil)then V=48743;return"DeathPact defensives 18"end end;if a.IceboundFortitude:IsCastable()and Y.Commons.UseDefensives and M and d:HealthPercentage()<=Y.Blood.IceboundFortitudeThreshold and d:BuffDown(a.VampiricBloodBuff)then if j(a.IceboundFortitude,nil)then V=48792;return"icebound_fortitude defensives 16"end end;if a.DeathStrike:IsReady()and Y.Commons.UseDefensives and e:IsInMeleeRange(8)and not T and d:HealthPercentage()<=50+(d:RunicPower()>90 and 20 or 0)and not d:HealingAbsorbed()then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike defensives 18"end end end;local function U()if a.BloodFury:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()and((a.DancingRuneWeapon:CooldownUp()or w)and(not a.Blooddrinker:IsReady()or not a.Blooddrinker:IsAvailable()))then if j(a.BloodFury,nil)then V=20572;return"blood_fury main 2"end end;if a.Berserking:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()then if j(a.Berserking,nil)then V=26297;return"berserking main 4"end end;if a.ArcanePulse:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()and(O>=2 or d:Rune()<1 and d:RunicPowerDeficit()>60)then if j(a.ArcanePulse,nil,nil,not e:IsInRange(8))then V=260364;return"arcane_pulse main 6"end end;if a.LightsJudgment:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()and d:BuffUp(a.UnholyStrengthBuff)then if j(a.LightsJudgment,nil,nil,not e:IsSpellInRange(a.LightsJudgment))then V=255647;return"lights_judgment main 8"end end;if a.AncestralCall:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()then if j(a.AncestralCall,nil)then V=274738;return"ancestral_call main 10"end end;if a.Fireblood:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()then if j(a.Fireblood,nil)then V=265221;return"fireblood main 12"end end;if a.BagofTricks:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()then if j(a.BagofTricks,nil,nil,not e:IsSpellInRange(a.BagofTricks))then V=312411;return"bag_of_tricks main 14"end end;if a.ArcaneTorrent:IsCastable()and e:IsInMeleeRange(8)and Y.Commons.Enabled.Racials and k()and d:RunicPowerDeficit()>20 then if j(a.ArcaneTorrent,nil,nil,nil)then V=155145;return"ArcaneTorrent main 14"end end end;local function a6()if a.Tombstone:IsReady()and n and e:IsInMeleeRange(8)and(d:BuffStack(a.BoneShieldBuff)>5 and d:Rune()>=2 and d:RunicPowerDeficit()>=30 and(a.ShatteringBone:IsAvailable()and d:BuffUp(a.DeathAndDecayBuff)or not a.ShatteringBone:IsAvailable()))then if j(a.Tombstone,nil)then V=219808;return"tombstone drw_up 2"end end;if a.EmpowerRuneWeapon:IsReady()and k()and(d:Rune()<6 and d:RunicPowerDeficit()>5)then if j(a.EmpowerRuneWeapon,nil,nil,not e:IsInRange(8))then V=47568;return"EmpowerRuneWeapon drw_up 11"end end;if a.AbominationLimb:IsCastable()and e:IsInMeleeRange(8)and k()and not A and not Y.Blood.UseAbomLimbDefensive then if j(a.AbominationLimb,nil,nil,not e:IsInRange(8))then V=315443;return"abomination_limb standard 16"end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and(d:BuffStack(a.BoneShieldBuff)<5 and d:BuffRemains(a.DancingRuneWeaponBuff)<d:GCD())then if j(a.Marrowrend,nil,nil,not e:IsSpellInRange(a.Marrowrend))then V=195182;return"marrowrend drw_up 2"end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and((d:BuffRemains(a.BoneShieldBuff)<=d:RuneTimeToX(3)or d:BuffStack(a.BoneShieldBuff)<2 and d:BuffUp(a.AbominationLimbBuff))and d:RunicPowerDeficit()>20)then if j(a.Marrowrend,nil,nil,not e:IsInMeleeRange(5))then return"marrowrend drw_up 6"end end;if a.DeathsCaress:IsReady()and not e:IsInMeleeRange(8)and(d:BuffRemains(a.BoneShieldBuff)<=d:RuneTimeToX(3)and d:Rune()<=1)then if j(a.DeathsCaress,nil,nil,not e:IsSpellInRange(a.DeathsCaress))then V=195292;return"deaths_caress drw_up 2"end end;if a.DeathStrike:IsReady()and e:IsInMeleeRange(8)and d:RunicPower()>=Y.Blood.MinimumRP+45 and not T and not S and(d:BuffRemains(a.CoagulopathyBuff)<=d:GCD()or d:BuffRemains(a.IcyTalonsBuff)<=d:GCD())then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike drw_up 6"end end;if a.SoulReaper:IsReady()and(O==1 and e:TimeToX(35)<5 and e:TimeToDie()>e:DebuffRemains(a.SoulReaperDebuff)+5)then if j(a.SoulReaper,nil,nil,not e:IsInMeleeRange(5))then V=343294;return"soul_reaper drw_up 12"end end;if a.SoulReaper:IsReady()and O>=2 then if X.CastTargetIf(a.SoulReaper,N,"min",a1,a3,not e:IsInMeleeRange(8))then return"soul_reaper drw_up 14"end end;if a.DeathAndDecay:IsCastable()and e:IsInMeleeRange(8)and not B and not d:IsMoving()and(d:BuffDown(a.DeathAndDecayBuff)and(a.SanguineGround:IsAvailable()or a.UnholyGround:IsAvailable()))then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay drw_up 14"end end;if a.BloodBoil:IsCastable()and e:IsInRange(10)and(a.BloodBoil:Charges()>=2 and d:Rune()<=1 or e:DebuffRemains(a.BloodPlagueDebuff)<=2 or EnemiesCount10y>5 and a.BloodBoil:ChargesFractional()>=1.1 and not(W==2 and d:BuffUp(a.SwarmingMist)))then if j(a.BloodBoil,nil,nil,not e:IsInMeleeRange(10))then V=50842;return"blood_boil drw_up 4"end end;L=25+P*b(a.Heartbreaker:IsAvailable())*2;if a.DeathStrike:IsReady()and e:IsInMeleeRange(8)and d:RunicPower()>=Y.Blood.MinimumRP+45 and not T and not S and d:RunicPowerDeficit()<=L then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike drw_up 6"end end;if a.Consumption:IsCastable()and e:IsInMeleeRange(8)then if j(a.Consumption,nil,nil,not e:IsSpellInRange(a.Consumption))then V=274156;return"consumption standard 24"end end;if a.DeathAndDecay:IsCastable()and e:IsInMeleeRange(10)and not B and not d:IsMoving()and(d:BuffDown(a.DeathAndDecayBuff)and(EnemiesCount10y==3 and d:BuffUp(a.CrimsonScourgeBuff)or EnemiesCount10y>=4))then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay drw_up 18"end end;if a.HeartStrike:IsReady()and e:IsInMeleeRange(8)and(d:RuneTimeToX(2)<d:GCD()or d:RunicPowerDeficit()>=L)then if j(a.HeartStrike,nil,nil,not e:IsSpellInRange(a.HeartStrike))then V=206930;return"heart_strike drw_up 18"end end end;local function L()if a.Tombstone:IsCastable()and n and(d:BuffStack(a.BoneShieldBuff)>5 and d:Rune()>=2 and d:RunicPowerDeficit()>=30 and(a.ShatteringBone:IsAvailable()and d:BuffUp(a.DeathAndDecayBuff)or not a.ShatteringBone:IsAvailable()))then if j(a.Tombstone,nil)then V=219808;return"tombstone standard 1"end end;if a.AbominationLimb:IsCastable()and e:IsInMeleeRange(8)and k()and not A and(Y.Blood.UseAbomLimbDefensive and d:BuffStack(a.BoneShieldBuff)<6 or not Y.Blood.UseAbomLimbDefensive)then if j(a.AbominationLimb,nil,nil,not e:IsInRange(8))then V=315443;return"abomination_limb standard 16"end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and(d:BuffRemains(a.BoneShieldBuff)<=d:RuneTimeToX(3)or d:BuffRemains(a.BoneShieldBuff)<=d:GCD()+b(a.Blooddrinker:CooldownUp())*b(a.Blooddrinker:IsAvailable())*4 or d:BuffStack(a.BoneShieldBuff)<6 and d:RunicPowerDeficit()>20 and not(a.InsatiableBlade:IsAvailable()and a.DancingRuneWeapon:CooldownRemains()<d:BuffRemains(a.BoneShieldBuff)))then if j(a.Marrowrend,nil,nil,not e:IsSpellInRange(a.Marrowrend))then V=195182;return"marrowrend standard 6"end end;if a.DeathsCaress:IsReady()and not e:IsInMeleeRange(8)and(d:BuffRemains(a.BoneShieldBuff)<=d:RuneTimeToX(3)and d:Rune()<=1)then if j(a.DeathsCaress,nil,nil,not e:IsSpellInRange(a.DeathsCaress))then V=195292;return"deaths_caress standard 2"end end;if a.DeathStrike:IsReady()and e:IsInMeleeRange(8)and d:RunicPower()>=Y.Blood.MinimumRP+45 and not T and not S and(d:BuffRemains(a.CoagulopathyBuff)<=d:GCD()or d:BuffRemains(a.IcyTalonsBuff)<=d:GCD())then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike standard 8"end end;if a.DeathAndDecay:IsCastable()and e:IsInMeleeRange(10)and not B and not d:IsMoving()and(d:BuffDown(a.DeathAndDecayBuff)and(a.SanguineGround:IsAvailable()or a.UnholyGround:IsAvailable()))then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay drw_up 14"end end;if a.Bonestorm:IsReady()and e:IsInMeleeRange(10)and not T and d:RunicPower()>=Y.Blood.BonestormPower and n then if j(a.Bonestorm,nil,nil,not e:IsInRange(10))then V=194844;return"bonestorm standard 14"end end;if a.SoulReaper:IsReady()and(O==1 and e:TimeToX(35)<5 and e:TimeToDie()>e:DebuffRemains(a.SoulReaperDebuff)+5)then if j(a.SoulReaper,nil,nil,not e:IsInMeleeRange(5))then V=343294;return"soul_reaper standard 12"end end;if a.SoulReaper:IsReady()and O>=2 then if X.CastTargetIf(a.SoulReaper,N,"min",a1,a3,not e:IsInMeleeRange(8))then return"soul_reaper standard 14"end end;if a.DeathStrike:IsReady()and e:IsInMeleeRange(8)and not T and not S and d:RunicPower()>=Y.Blood.MinimumRP+45 and(d:RunicPowerDeficit()<=J and not(a.Bonestorm:IsAvailable()and a.Bonestorm:CooldownRemains()<2))then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike standard 16"end end;if a.BloodBoil:IsCastable()and e:IsInRange(10)and(a.BloodBoil:ChargesFractional()>=1.8 and(d:BuffStack(a.HemostasisBuff)<=5-EnemiesCount10y or EnemiesCount10y>2))then if j(a.BloodBoil,nil,nil,not e:IsInMeleeRange(10))then V=50842;return"blood_boil standard 10"end end;if a.DeathAndDecay:IsReady()and e:IsInMeleeRange(10)and not B and not d:IsMoving()and d:BuffDown(a.DeathAndDecayBuff)and(d:BuffUp(a.CrimsonScourgeBuff)and a.RelishinBlood:IsAvailable()and d:RunicPowerDeficit()>10)then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay standard 12"end end;K=15+O*b(a.Heartbreaker:IsAvailable())*2;if a.DeathStrike:IsReady()and e:IsInMeleeRange(8)and d:RunicPower()>=Y.Blood.MinimumRP+45 and not T and not S and(d:RunicPowerDeficit()<=K or e:TimeToDie()<10)then if j(a.DeathStrike,nil,nil,not e:IsSpellInRange(a.DeathStrike))then V=49998;return"death_strike standard 28"end end;if a.DeathAndDecay:IsReady()and e:IsInMeleeRange(10)and not B and not d:IsMoving()and d:BuffDown(a.DeathAndDecayBuff)and O>=3 then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay standard 18"end end;if a.HeartStrike:IsReady()and e:IsInMeleeRange(8)and d:RuneTimeToX(4)<d:GCD()then if j(a.HeartStrike,nil,nil,not e:IsSpellInRange(a.HeartStrike))then V=206930;return"heart_strike standard 2"end end;if a.Consumption:IsCastable()and e:IsInMeleeRange(8)then if j(a.Consumption,nil,nil,not e:IsSpellInRange(a.Consumption))then V=274156;return"consumption standard 24"end end;if a.DeathAndDecay:IsReady()and e:IsInMeleeRange(10)and not B and not d:IsMoving()and d:BuffDown(a.DeathAndDecayBuff)and(d:BuffUp(a.CrimsonScourgeBuff)or a.RapidDecomposition:IsAvailable())then if j(a.DeathAndDecay,nil,nil,not e:IsInRange(30))then V=43265;return"death_and_decay standard 22"end end;if a.BloodBoil:IsCastable()and e:IsInRange(10)and a.BloodBoil:ChargesFractional()>=1.1 then if j(a.BloodBoil,nil,nil,not e:IsInMeleeRange(10))then V=50842;return"blood_boil standard 26"end end;if a.HeartStrike:IsReady()and e:IsInMeleeRange(8)and(d:Rune()>1 and(d:RuneTimeToX(3)<d:GCD()or d:BuffStack(a.BoneShieldBuff)>7))then if j(a.HeartStrike,nil,nil,not e:IsSpellInRange(a.HeartStrike))then V=206930;return"heart_strike standard 20"end end end;local function b()o=HeroRotationCharDB.Toggles[6]m=HeroRotationCharDB.Toggles[4]n=HeroRotationCharDB.Toggles[5]p=HeroRotationCharDB.Toggles[12]q=HeroRotationCharDB.Toggles[13]r=HeroRotationCharDB.Toggles[14]s=not HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[16]u=HeroRotationCharDB.Toggles[80]v=HeroRotationCharDB.Toggles[81]w=HeroRotationCharDB.Toggles[82]C=HeroRotationCharDB.Toggles[72]B=HeroRotationCharDB.Toggles[83]x=HeroRotationCharDB.Toggles[84]y=HeroRotationCharDB.Toggles[17]z=HeroRotationCharDB.Toggles[85]A=HeroRotationCharDB.Toggles[18]S=false;T=false;if a.Bonestorm:IsAvailable()and k()and a.Bonestorm:CooldownRemains()<=0 and a.Bonestorm:IsCastable()then S=true end;E=0;for a=1,20 do if select(10,UnitDebuff("player",a))==240447 then if select(6,UnitDebuff("player",a))~=nil then E=select(6,UnitDebuff("player",a))-GetTime()end end end end;local function S()Enemies10y=d:GetEnemiesInRange(10)if l()then N=d:GetEnemiesInMeleeRange(8)O=#N;EnemiesCount10y=#Enemies10y;Enemies40y=d:GetEnemiesInRange(40)else O=1;EnemiesCount10y=1 end;Q=h(Enemies10y)P=F(O,d:BuffUp(a.DeathAndDecayBuff)and 5 or 2)Q=h(Enemies10y)M=d:IsTankingAoE(8)or d:IsTanking(e)TopTrinketID,_=GetInventoryItemID("player",13)BotTrinketID,_=GetInventoryItemID("player",14)ActiveMitigationNeeded=d:ActiveMitigationNeeded()MissingAggro=a4(Enemies10y)if not BotOn then Z=0;V=0 end;if Z>0 then Z=0 end;if V>0 then V=0 end;I=b()if i.QueuedCast()then V=i.QueuedCast()return"Custom Queue "..g(V):ID()end;if i.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then starttime=GetTime()endtime=starttime+i.GUISettings.General.OpenerReset elseif i.GUISettings.General.OpenerReset>0 and endtime~=nil and GetTime()>endtime and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]i.ToggleIconFrame:UpdateButtonText(6)i.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if d:IsChanneling(g(324631))then if i.CastAnnotated(a.Pool,false,"WAIT")then V=99999;return"Pool During Blooddrinker"end end;if not d:AffectingCombat()then D=false end;if not d:AffectingCombat()and X.TargetIsValid()and o then local a=a5()if a then return a end end;if not UnitIsEnemy("player","mouseover")and UnitIsPlayer("mouseover")and UnitIsDead("mouseover")and not z then if a.RaiseAlly:IsCastable()and d:RunicPower()>=30 then if j(a.RaiseAlly,nil)then Z=161999;return"RaiseAlly MO"end elseif a.RaiseAlly:CooldownRemains(BypassRecovery)<=0 and d:RunicPower()<30 then T=true end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)and c("mouseover"):IsInMeleeRange(8)then if a.HeartStrike:IsCastable()then if j(a.HeartStrike,nil)then Z=1206930;return"explosive MO HeartStrike"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)and c("mouseover"):IsInMeleeRange(8)then if a.DeathStrike:IsCastable()then if j(a.DeathStrike,nil)then Z=149998;return"explosive MO DeathStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)and e:IsInMeleeRange(8)then if a.HeartStrike:IsCastable()then if j(a.HeartStrike,nil)then V=206930;return"explosive  HeartStrike"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)and e:IsInMeleeRange(8)then if a.DeathStrike:IsCastable()then if j(a.DeathStrike,nil)then V=49998;return"explosive  DeathStrike"end end end;if X.TargetIsValid()then if a.DarkCommand:IsReady()and d:AffectingCombat()and(not d:IsTanking(e)and C)then if j(a.DarkCommand,nil)then V=56222;return"DarkCommand bear 3"end end;if a.DarkCommand:IsReady()then if X.CastCycle(a.DarkCommand,Enemies40y,a2,not e:IsSpellInRange(a.DarkCommand))then return"DarkCommand 4"end end end;if t and a.Asphyxiate:IsUsableP()and a.Asphyxiate:CooldownRemains(BypassRecovery)<=0 then if i.Cast(a.Asphyxiate,nil,nil,nil)then if c("mouseover"):GUID()~=nil and c("mouseover"):IsSpellInRange(a.Asphyxiate)then Z=1221562;return"queue Asphyxiate MO"else V=221562;return"queue Asphyxiate"end end elseif(not a.Asphyxiate:IsUsableP()or a.Asphyxiate:CooldownRemains()>0)and t then HeroRotationCharDB.Toggles[16]=not HeroRotationCharDB.Toggles[16]i.Print("Asphyxiate Queue is now "..(HeroRotationCharDB.Toggles[16]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and a.BloodBoil:IsUsableP()and a.BloodBoil:CooldownRemains(BypassRecovery)<=0 and not d:PrevGCD(1,a.BloodBoil)then if i.Cast(a.BloodBoil,nil,nil,nil)then V=50842;return"queue BloodBoil"end elseif(not a.BloodBoil:IsUsableP()or a.BloodBoil:CooldownRemains()>0 or d:PrevGCD(1,a.BloodBoil))and x then HeroRotationCharDB.Toggles[84]=not HeroRotationCharDB.Toggles[84]i.Print("Blood Boil Queue is now "..(HeroRotationCharDB.Toggles[84]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if r and a.DeathGrip:IsUsableP()and a.DeathGrip:CooldownRemains(BypassRecovery)<=0 then if i.Cast(a.DeathGrip,nil,nil,nil)then if c("mouseover"):GUID()~=nil and c("mouseover"):IsSpellInRange(a.DeathGrip)then Z=149576;return"queue DeathGrip MO"else V=49576;return"queue DeathGrip"end end elseif(not a.DeathGrip:IsUsableP()or a.DeathGrip:CooldownRemains()>0)and r then HeroRotationCharDB.Toggles[14]=not HeroRotationCharDB.Toggles[14]i.Print("DeathGrip Queue is now "..(HeroRotationCharDB.Toggles[14]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if u and a.GorefiendsGrasp:IsUsableP()and a.GorefiendsGrasp:CooldownRemains(BypassRecovery)<=0 and d:AffectingCombat()then if i.Cast(a.GorefiendsGrasp,nil,nil,nil)then V=108199;return"queue Gorefiends Grasp"end elseif(not a.GorefiendsGrasp:IsUsableP()or a.GorefiendsGrasp:CooldownRemains()>0 or not d:AffectingCombat())and u then HeroRotationCharDB.Toggles[80]=not HeroRotationCharDB.Toggles[80]i.Print("Gorefiend's Grasp Queue is now "..(HeroRotationCharDB.Toggles[80]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if q and a.AntiMagicZone:IsUsableP()and a.AntiMagicZone:CooldownRemains(BypassRecovery)<=0 and d:AffectingCombat()then if i.Cast(a.AntiMagicZone,nil,nil,nil)then V=51052;return"queue Anti Magic Zone"end elseif(not a.AntiMagicZone:IsUsableP()or a.AntiMagicZone:CooldownRemains()>0 or not d:AffectingCombat())and q then HeroRotationCharDB.Toggles[13]=not HeroRotationCharDB.Toggles[13]i.Print("Anti-Magic Zone Queue is now "..(HeroRotationCharDB.Toggles[13]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and a.ControlUndead:IsUsableP()and a.ControlUndead:CooldownRemains(BypassRecovery)<=0 and not d:PrevGCD(1,a.ControlUndead)then if i.Cast(a.ControlUndead,nil,nil,nil)then if c("mouseover"):GUID()~=nil and c("mouseover"):IsInRange(30)then Z=1111673;return"queue ControlUndead MO"else V=111673;return"queue ControlUndead"end end elseif(not a.ControlUndead:IsUsableP()or a.ControlUndead:CooldownRemains()>0 or d:PrevGCD(1,a.ControlUndead))and v then HeroRotationCharDB.Toggles[81]=not HeroRotationCharDB.Toggles[81]i.Print("Control Undead Queue is now "..(HeroRotationCharDB.Toggles[81]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if X.TargetIsValid()and d:AffectingCombat()then if true then local a=a0()if a then return a end end;if d:IsChanneling(a.Blooddrinker)and d:BuffUp(a.BoneShieldBuff)and Q==0 and not d:ShouldStopCasting()and d:CastRemains()>.2 then if i.CastAnnotated(a.Pool,false,"WAIT")then V=99999;return"Pool During Blooddrinker"end end;J=70;if Y.Commons.Enabled.Potions then local e=X.PotionSelected()if e then local Y=e:BuffDuration()if e:IsReady()and k()and s and(d:BloodlustUp()and i.GUISettings.General.HoldPotforBL or not i.GUISettings.General.HoldPotforBL and d:BuffUp(a.DancingRuneWeaponBuff))then if j(e,nil)then V=50;return"potion cooldowns 2"end end end end;if Y.Commons.Enabled.TopTrinket or Y.Commons.Enabled.BottomTrinket then local a=d:GetUseableTrinkets(H)if a then if j(a,nil,nil)then if a:ID()==TopTrinketID and Y.Commons.Enabled.TopTrinket and(Y.Blood.TopTrinketHP<=0 and k()or Y.Blood.TopTrinketHP>d:HealthPercentage())then V=24;return"top trinket 1"elseif a:ID()==BotTrinketID and Y.Commons.Enabled.BottomTrinket and(Y.Blood.BotTrinketHP<=0 and k()or Y.Blood.BotTrinketHP>d:HealthPercentage())then V=30;return"top trinket 2"end end end end;if G.GaveloftheFirstArbiter:IsEquippedAndReady()and e:IsInRange(30)and k()and not y then if j(G.GaveloftheFirstArbiter,nil,nil,not e:IsInRange(30))then V=16;return"gavel_of_the_first_arbiter trinkets 4"end end;if a.BloodBoil:IsCastable()and e:IsInMeleeRange(10)and not UnitExists("boss1")and MissingAggro>0 then if j(a.BloodBoil)then V=50842;return"blood_boil for aggro 6"end end;if k()and not f:DebuffUp(g(111673))and a.RaiseDead:IsCastable()then if j(a.RaiseDead,nil,nil)then V=46585;return"raise_dead main 24"end end;if a.DeathsCaress:IsReady()and not e:IsInMeleeRange(8)and d:BuffDown(a.BoneShieldBuff)then if j(a.DeathsCaress,nil,nil,not e:IsSpellInRange(a.DeathsCaress))then V=195292;return"deaths_caress drw_up 2"end end;if a.Blooddrinker:IsReady()and e:IsInMeleeRange(30)and(E==0 or E>3)and d:BuffDown(a.DancingRuneWeaponBuff)then if j(a.Blooddrinker,nil,nil,not e:IsSpellInRange(a.Blooddrinker))then V=206931;return"blooddrinker main 20"end end;if true then local a=U()if a then return a end end;if a.SacrificialPact:IsReady()and a.RaiseDead:TimeSinceLastCast()<=60 and R.active()and(d:BuffDown(a.DancingRuneWeaponBuff)and(R.remains()<2 or e:TimeToDie()<d:GCD()))then if j(a.SacrificialPact,nil)then V=237574;return"sacrificial_pact covenants 8"end end;if a.BloodTap:IsCastable()and(d:Rune()<=2 and d:RuneTimeToX(4)>d:GCD()and a.BloodTap:ChargesFractional()>=1.8 or d:RuneTimeToX(3)>d:GCD())then if j(a.BloodTap)then V=221699;return"blood_tap main 12"end end;if a.Marrowrend:IsReady()and e:IsInMeleeRange(8)and d:BuffRemains(a.BoneShieldBuff)<d:GCD()+.5 then if j(a.Marrowrend)then V=195182;return"marrowrend main 14"end end;if a.DeathsCaress:IsReady()and not e:IsInMeleeRange(8)and(d:BuffRemains(a.BoneShieldBuff)<d:GCD()+.5 or d:BuffDown(a.BoneShieldBuff))then if j(a.DeathsCaress,nil,nil,not e:IsSpellInRange(a.DeathsCaress))then V=195292;return"deaths_caress main 16"end end;if a.DancingRuneWeapon:IsCastable()and e:IsInMeleeRange(10)and not w and k()and d:BuffDown(a.DancingRuneWeaponBuff)then if j(a.DancingRuneWeapon,nil)then V=49028;return"dancing_rune_weapon main 14"end end;if d:BuffUp(a.DancingRuneWeaponBuff)then local a=a6()if a then return a end end;if true then local a=L()if a then return a end end;if i.CastAnnotated(a.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function a()if HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]i.ToggleIconFrame:UpdateButtonText(6)end end;function ReturnSpell1()if V==0 then return 0 else return V end end;function ReturnSpellMO1()if Z==0 then return 0 else return Z end end;i.SetAPL(250,S,a)