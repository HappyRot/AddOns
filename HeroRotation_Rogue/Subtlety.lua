local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=d.Utils.BoolToInt;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[12]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[20]local u=HeroRotationCharDB.Toggles[21]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[26]local A=HeroRotationCharDB.Toggles[27]local B=HeroRotationCharDB.Toggles[28]local C=HeroRotationCharDB.Toggles[29]local D=HeroRotationCharDB.Toggles[30]local E=HeroRotationCharDB.Toggles[54]local F=HeroRotationCharDB.Toggles[171]local G=HeroRotationCharDB.Toggles[172]local H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337}local I=nil;local J=nil;local K=0;local L=0;local pairs=pairs;local M=table.insert;local N=math.min;local O=math.max;local P=math.abs;local Q=m.Commons.Everyone;local R=m.Commons.Rogue;local S=i.Rogue.Subtlety;local T=k.Rogue.Subtlety;local U={General=m.GUISettings.General,Commons=m.GUISettings.APL.Rogue.Commons,Subtlety=m.GUISettings.APL.Rogue.Subtlety}S.Eviscerate:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*EffectiveComboPoints*0.176*1.21*(S.Nightstalker:IsAvailable()and g:StealthUp(true,false)and 1.08 or 1)*(S.DeeperStratagem:IsAvailable()and 1.05 or 1)*(S.DarkShadow:IsAvailable()and g:BuffUp(S.ShadowDanceBuff)and 1.3 or 1)*(g:BuffUp(S.SymbolsofDeath)and 1.1 or 1)*(g:BuffUp(S.FinalityEviscerateBuff)and 1.3 or 1)*(1+g:MasteryPct()/100)*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(S.FindWeaknessDebuff)and 1.5 or 1)end)S.Rupture:RegisterPMultiplier(function()return g:BuffUp(S.FinalityRuptureBuff)and 1.3 or 1 end)local function V()m.Print("\n = ")m.Print("\n = ")m.Print("HoldsVanish = ",u)m.Print("HoldSTornado = ",C)m.Print("holdshadowdance = ",F)m.Print("holdsymbols = ",G)end;local function W()if U.Subtlety.BurnShadowDance=="On Bosses not in Dungeons"and g:IsInDungeonArea()then return false elseif U.Subtlety.BurnShadowDance~="Always"and not h:IsInBossList()then return false else return true end end;local X=g:GetEquipment()local Y=X[13]and k(X[13])or k(0)local Z=X[14]and k(X[14])or k(0)local _=GetInventoryItemID("player",13)local a0=GetInventoryItemID("player",14)local a1={}d:RegisterForEvent(function()X=g:GetEquipment()Y=X[13]and k(X[13])or k(0)Z=X[14]and k(X[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")local a2,a3,a4,a5;local a6,a7,a8,a9;local aa;local ab=R.ReturnSpell()local ac=R.ReturnSpellMO()local ad,ae,af;local ag,ah;local ai,aj;local ak=11111;local al=11111;local am,an,ao;local ap;local aq;local ar;local as;local at;local au;local av;local aw;local ax;local ay=false;local function az(aA,aB,aC,aD)local aE,aF=nil,aC;local aG=h:GUID()for aH,aI in pairs(aD)do if aI:GUID()~=aG and Q.UnitIsCycleValid(aI,aF,-aI:DebuffRemains(aA))and aB(aI)then aE,aF=aI,aI:TimeToDie()end end;if aE then m.CastLeftNameplate(aE,aA)if aE:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then if aA==S.Rupture then ac=11943 elseif aA==S.SerratedBoneSpike then ac=1328547 end elseif U.Subtlety.TargetSwap=="AutoSwap"and aE:GUID()~=h:GUID()and not r then ac=9999 end elseif false then aE,aF=nil,aC;for aH,aI in pairs(a3)do if aI:GUID()~=aG and Q.UnitIsCycleValid(aI,aF,-aI:DebuffRemains(aA))and aB(aI)then aE,aF=aI,aI:TimeToDie()end end;if aE then m.CastLeftNameplate(aE,aA)if aE:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then if aA==S.Rupture then ac=11943 elseif aA==S.SerratedBoneSpike then ac=1328547 end elseif U.Subtlety.TargetSwap=="AutoSwap"and aE:GUID()~=h:GUID()and not r then ac=9999 end end end end;local function aJ()if a4<2 then return false elseif U.Commons.UsePriorityRotation=="Always"then return true elseif U.Commons.UsePriorityRotation=="On Bosses"and h:IsInBossList()then return true elseif U.Commons.UsePriorityRotation=="Auto"then if g:InstanceDifficulty()==16 and h:NPCID()==138967 then return true elseif h:NPCID()==166969 or h:NPCID()==166971 or h:NPCID()==166970 then return true elseif h:NPCID()==183463 or h:NPCID()==183671 then return true end end;return false end;local aK=g:CovenantID()d:RegisterForEvent(function()aK=g:CovenantID()end,"COVENANT_CHOSEN")d:RegisterForEvent(function()ak=11111;al=11111 end,"PLAYER_REGEN_ENABLED")local function aL(aM)if aM then return 1 else return 0 end end;local function aN()return 25+aL(S.Vigor:IsAvailable())*20+aL(S.MasterofShadows:IsAvailable())*20+aL(S.ShadowFocus:IsAvailable())*25+aL(S.Alacrity:IsAvailable())*20+aL(a4>=4)*25 end;local function aO()return S.ShadowDance:ChargesFractional()>=0.75+l(S.ShadowDanceTalent:IsAvailable())end;local function aP()if a4==4-aL(S.SealFate:IsAvailable())then return true elseif a4>4-2*l(S.ShurikenTornado:IsAvailable())or ap and a4>=4 then return ao<=1 else return an<=1 end end;local function ax()return g:BuffUp(S.SliceandDice)or a4>=R.CPMaxSpend()end;local function aQ(aR)return g:BuffUp(S.ThistleTea)and a4==1 or aR and(a4==1 or h:DebuffUp(S.Rupture)and a4>=2)end;local function aS()return g:BuffDown(S.PremeditationBuff)and a4==1 or not S.TheRotten:IsAvailable()or a4>1 end;local function aT()return not g:BuffUp(S.TheRottenBuff)or a4>1 or an<=2 and g:BuffUp(S.TheRottenBuff)and not g:HasTier(30,2)end;local function aU(aR,aV)return aR and(g:BuffStack(S.DanseMacabreBuff)>=3 or not S.DanseMacabre:IsAvailable())and(not aV or a4~=2)end;local function aW(i)return g:BuffUp(S.ShadowDanceBuff)and i:TimeSinceLastCast()<S.ShadowDance:TimeSinceLastCast()end;local function aX(aY)return aY:DebuffRemains(S.FindWeaknessDebuff)end;local function aZ(aY)return aY:TimeToDie()end;local function a_(aY)return aY:DebuffRemains(S.Rupture)end;local function b0(aY)if(aY:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aY:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aY:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ac=1185438;return true elseif(aY:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aY:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and U.Subtlety.TargetSwap=="AutoSwap"and aY:GUID()~=h:GUID()and not r then ac=9999;return true elseif(aY:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aY:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aY:GUID()==h:GUID()then ab=185438;return true elseif aY:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aY:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains()then return true end end;local function b1(aY)if aY:IsInRange(8)and aY:TimeToDie()>10 and aY:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ac=1323654;return true elseif aY:IsInRange(8)and aY:TimeToDie()>10 and U.Subtlety.TargetSwap=="AutoSwap"and aY:GUID()~=h:GUID()and not r then ac=9999;return true elseif aY:IsInRange(8)and aY:TimeToDie()>10 and aY:GUID()==h:GUID()then ab=323654;return true elseif aY:IsInRange(8)and aY:TimeToDie()>10 then return true end end;local function b2(aY)if(aY:FilteredTimeToDie("<",ao)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aY:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ac=1137619;return true elseif(aY:FilteredTimeToDie("<",ao)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and U.Subtlety.TargetSwap=="AutoSwap"and aY:GUID()~=h:GUID()and not r then ac=9999;return true elseif(aY:FilteredTimeToDie("<",ao)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aY:GUID()==h:GUID()then ab=137619;return true elseif aY:FilteredTimeToDie("<",ao)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend()then return true end end;local function b3(aY)if aY:FilteredTimeToDie(">=",2*an)and aY:DebuffRefreshable(S.Rupture)and aY:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ac=11943;return true elseif aY:FilteredTimeToDie(">=",2*an)and aY:DebuffRefreshable(S.Rupture)and U.Subtlety.TargetSwap=="AutoSwap"and aY:GUID()~=h:GUID()and not r then ac=9999;return true elseif aY:FilteredTimeToDie(">=",2*an)and aY:DebuffRefreshable(S.Rupture)and aY:GUID()==h:GUID()then ab=1943;return true elseif aY:FilteredTimeToDie(">=",2*an)and aY:DebuffRefreshable(S.Rupture)then return true end end;local function b4()local b5=not EnergyThreshold or g:EnergyPredicted()>=EnergyThreshold;if m.AoEON()and S.ShurikenStorm:IsCastable()and a4>=2+l(S.Gloomblade:IsAvailable()and g:BuffRemains(S.LingeringShadowBuff)>=6 or g:BuffUp(S.PerforatedVeinsBuff))then if m.Cast(S.ShurikenStorm)then ab=197835;return"Cast Shuriken Storm"end end;if a8 then if S.EchoingReprimand:IsAvailable()and g:Energy()<60 and(an==2 and g:BuffUp(S.EchoingReprimand3)or an==3 and g:BuffUp(S.EchoingReprimand4)or an==4 and g:BuffUp(S.EchoingReprimand5))and(R.TimeToSht(3)<0.5 or R.TimeToSht(4)<1.0 or R.TimeToSht(5)<1.0)then if m.Cast(S.PoolEnergy)then ab=999910 end;return"ER Generator Pooling"end;if S.Gloomblade:IsCastable()then if b5 and m.Cast(S.Gloomblade)then ab=200758;return"Cast Gloomblade"end elseif S.Backstab:IsCastable()then if b5 and m.Cast(S.Backstab)then ab=53;return"Cast Backstab"end end end end;local function b6()if g:BuffUp(S.ShurikenTornado)then if S.SymbolsofDeath:IsCastable()and S.ShadowDance:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not g:BuffUp(S.ShadowDanceBuff)and not G and not F then if m.Cast(S.SymbolsofDeath)then ab=800;return"Dance + Symbols (during Tornado)"end elseif S.SymbolsofDeath:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not G then if m.Cast(S.SymbolsofDeath)then ab=212283;return"Cast Symbols of Death (during Tornado)"end elseif S.ShadowDance:IsCastable()and not g:BuffUp(S.ShadowDanceBuff)and not F then if m.Cast(S.ShadowDance)then ab=185313;return"Cast Shadow Dance (during Tornado)"end end end;local b7=ax()if S.Vanish:IsCastable()and VanishReady and not u and U.Commons.VanishOffensive and an<=2 and g:BuffStack(S.DanseMacabreBuff)>3 and(S.SecretTechnique:CooldownRemains()>=30 or not S.SecretTechnique:IsAvailable())then if m.Cast(S.Vanish,nil,nil)then ab=1856;return"Vanish Stealth CD"end end;if S.ColdBlood:IsReady()and p and not S.SecretTechnique:IsAvailable()and an>=5 then if m.Cast(S.ColdBlood)then ab=382245;return"Cast Cold Blood"end end;if a8 then if o()and S.Flagellation:IsReady()and b7 and not g:StealthUp(false,false)and an>=5 and h:FilteredTimeToDie(">",10)then if m.Cast(S.Flagellation,nil)then ab=323654;return"Cast Flagellation"end end end;if p and S.ShurikenTornado:IsCastable()and a4<=1 and ax()and S.SymbolsofDeath:CooldownUp()and S.ShadowDance:Charges()>=1 and(not S.Flagellation:IsAvailable()or g:BuffUp(S.Flagellation)or a4>=5)and an<=2 and not g:BuffUp(S.PremeditationBuff)and not C then if g:Energy()>=60 then if m.Cast(S.ShurikenTornado,nil)then ab=277925;return"Cast Shuriken Tornado"end elseif not S.ShadowFocus:IsAvailable()then if m.CastPooling(S.ShurikenTornado)then ab=277925;return"Pool for Shuriken Tornado"end end end;if a8 then if o()and S.Sepsis:IsReady()and b7 and ao>=1 and not h:FilteredTimeToDie("<",16)then if m.Cast(S.Sepsis,nil,nil)then ab=328305;return"Cast Sepsis"end end;if S.SymbolsofDeath:IsCastable()and not G then if(g:BuffRemains(S.SymbolsofDeath)<=3 and not S.ShadowDance:CooldownUp()or not g:HasTier(30,2))and aS()and b7 and(not S.Flagellation:IsAvailable()and(an<=1 or not S.TheRotten:IsAvailable())or S.Flagellation:CooldownRemains()>10 or S.Flagellation:CooldownUp()and an>=5)then if m.Cast(S.SymbolsofDeath,nil)then ab=212283;return"Cast Symbols of Death"end end end end;if S.MarkedforDeath:IsCastable()then if h:FilteredTimeToDie("<",ao)then if m.Cast(S.MarkedforDeath,nil)then ab=137619;return"Cast Marked for Death"end end;if not g:StealthUp(true,true)and ao>=R.CPMaxSpend()then if m.Cast(S.MarkedforDeath,nil)then ab=137619;return"Cast Marked for Death"end elseif m.CDsON()then if m.Cast(S.MarkedforDeath,nil)then ab=137619;return"Cast Marked for Death"end end end;if m.CDsON()then if S.ShadowBlades:IsCastable()and(b7 and ao>=2 and h:FilteredTimeToDie(">=",10)and(not S.Sepsis:IsAvailable()or S.Sepsis:CooldownRemains()<=8 or h:DebuffUp(S.Sepsis))or d.BossFilteredFightRemains("<=",20))then if m.Cast(S.ShadowBlades,nil)then ab=121471;return"Cast Shadow Blades"end end;if S.EchoingReprimand:IsReady()and a8 and ao>=3 and(ap or a4<=4 or S.ResoundingClarity:IsAvailable())and(g:BuffUp(S.ShadowDanceBuff)or not S.DanseMacabre:IsAvailable())then if m.Cast(S.EchoingReprimand,nil,nil)then ab=323547;return"Cast Echoing Reprimand"end end;if S.ShurikenTornado:IsReady()and not C then if ax and g:BuffUp(S.SymbolsofDeath)and an<=2 and(not g:BuffUp(S.PremeditationBuff)or a4>4)then if m.Cast(S.ShurikenTornado)then ab=277925;return"Cast Shuriken Tornado (SoD)"end end;if not S.Flagellation:IsAvailable()and a4>=3 and S.ShadowDance:Charges()>=1 and not g:StealthUp(true,true)then if m.Cast(S.ShurikenTornado)then ab=277925;return"Cast Shuriken Tornado (Dance)"end end end;if S.ShadowDance:IsCastable()and W()and not g:BuffUp(S.ShadowDanceBuff)and d.BossFilteredFightRemains("<=",8)and not F then if m.Cast(S.ShadowDance)then ab=185313;return"Cast Shadow Dance (Low TTD)"end end;if S.ThistleTea:IsReady()then if(S.SymbolsofDeath:CooldownRemains()>=3 or g:BuffUp(S.SymbolsofDeath))and not g:BuffUp(S.ThistleTea)and(g:EnergyDeficitPredicted()>=100 and(g:ComboPointsDeficit()>=2 or a4>=3)or S.ThistleTea:ChargesFractional()>=2.75 and g:BuffUp(S.ShadowDanceBuff))or g:BuffRemains(S.ShadowDanceBuff)>=4 and not g:BuffUp(S.ThistleTea)and a4>=3 or not g:BuffUp(S.ThistleTea)and d.BossFilteredFightRemains("<=",6*S.ThistleTea:Charges())then if m.Cast(S.ThistleTea)then ab=381623;return"Cast ThistleTea"end end end;if U.Commons.Enabled.Potions and o()and s and((g:BloodlustUp()or al<30 or g:BuffUp(S.SymbolsofDeath)and(g:BuffUp(S.ShadowBlades)or S.ShadowBlades:CooldownRemains()<=10))and not m.GUISettings.General.HoldPotforBL or m.GUISettings.General.HoldPotforBL and g:BloodlustUp())then local b8=Q.PotionSelected()if b8 and b8:IsReady()then if m.Cast(b8,nil,nil)then ab=37;return"potion cooldowns 2"end end end;if g:BuffUp(S.SymbolsofDeath)and o()then if S.BloodFury:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.BloodFury,nil)then ab=20572;return"Cast Blood Fury"end end;if S.Berserking:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.Berserking,nil)then ab=26297;return"Cast Berserking"end end;if S.Fireblood:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.Fireblood,nil)then ab=265221;return"Cast Fireblood"end end;if S.AncestralCall:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.AncestralCall,nil)then ab=274738;return"Cast Ancestral Call"end end end;local aR=g:BuffUp(S.ShadowDanceBuff)local b9=g:GetUseableTrinkets(a1)if b9 and o()and not aR then if g:BuffUp(S.SymbolsofDeath)or d.BossFilteredFightRemains("<",10)then if b9 then if m.Cast(b9,nil,nil)then if b9:ID()==GetInventoryItemID("player",13)and U.Commons.Enabled.TopTrinket then ab=24;return"Generic use_items for "..b9:Name()elseif b9:ID()==GetInventoryItemID("player",14)and U.Commons.Enabled.BottomTrinket then ab=25;return"Generic use_items for "..b9:Name()end end end end end end end;local function ba()local aR=g:BuffUp(S.ShadowDanceBuff)local b9=g:GetUseableTrinkets(a1)if b9 and o()and not aR then if g:BuffUp(S.SymbolsofDeath)or d.BossFilteredFightRemains("<",10)then if b9 then if m.Cast(b9,nil,nil)then if b9:ID()==GetInventoryItemID("player",13)and U.Commons.Enabled.TopTrinket then ab=24;return"Generic use_items for "..b9:Name()elseif b9:ID()==GetInventoryItemID("player",14)and U.Commons.Enabled.BottomTrinket then ab=25;return"Generic use_items for "..b9:Name()end end end end end end;local function bb()local aR=g:BuffUp(S.ShadowDanceBuff)local bc=g:BuffRemains(S.ShadowDanceBuff)local bd=g:BuffRemains(S.SymbolsofDeath)local be=an;local aV=StealthSpell or g:BuffUp(S.PremeditationBuff)if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aR=true;bc=8+S.ImprovedShadowDance:TalentRank()if S.TheFirstDance:IsAvailable()then be=N(g:ComboPointsMax(),an+4)end;if g:HasTier(30,2)then bd=O(bd,6)end end;if S.SliceandDice:IsCastable()and d.FilteredFightRemains(a3,">",g:BuffRemains(S.SliceandDice))then if S.Premeditation:IsAvailable()and a4<5 then if S.ShadowDance:ChargesFractional()<1.75 and g:BuffRemains(S.SliceandDice)<S.SymbolsofDeath:CooldownRemains()and(S.ShadowDance:Charges()>=1 and bd-bc<1.2)then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then ab=5171;return"Cast Slice and Dice (Premed)"end end else if a4<6 and not aR and g:BuffRemains(S.SliceandDice)<1+be*1.8 then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then ab=5171;return"Cast Slice and Dice"end end end end;local bf=aQ(aR)if(not bf or ap)and S.Rupture:IsCastable()then if a8 and(h:FilteredTimeToDie(">",6,-h:DebuffRemains(S.Rupture))or h:TimeToDieIsNotValid())and R.CanDoTUnit(h,aj)and h:DebuffRefreshable(S.Rupture,ai)then if m.Cast(S.Rupture)then ab=1943;return"Cast Rupture 1"end end end;if not bf and S.Rupture:IsCastable()then if a4==1 and g:BuffUp(S.FinalityRuptureBuff)and(S.DarkBrew:IsAvailable()or S.DanseMacabre:IsAvailable())and S.ShadowDance:CooldownRemains()<12 and S.ShadowDance:ChargesFractional()<=1 then if m.Cast(S.Rupture)then ab=1943;return"Cast Rupture (Finality)"end end end;if t and S.SecretTechnique:IsCastable()and aR and(g:BuffStack(S.DanseMacabreBuff)>=3 or not S.DanseMacabre:IsAvailable())then if S.ColdBlood:IsReady()and g:BuffDown(S.ColdBlood)then if m.Cast(S.ColdBlood)then ab=382245;return"Cast Cold Blood (FunnelAOE)"end end;if not S.ColdBlood:IsAvailable()or S.ColdBlood:IsReady()or g:BuffUp(S.ColdBlood)or S.ColdBlood:CooldownRemains()>bc-2 then if m.Cast(S.SecretTechnique)then ab=280719;return"Cast Secret Technique (FunnelAOE)"end end end;if t and S.Eviscerate:IsCastable()and a8 then if S.Eviscerate:IsReady()and m.Cast(S.Eviscerate)then ab=196819;return"Cast Eviscerate (FunnelAOE)"end end;if p and S.ColdBlood:IsReady()and aU(aR,aV)and S.SecretTechnique:CooldownUp()then if m.Cast(S.ColdBlood)then ab=382245;return"Cast Cold Blood (SecTec)"end end;if S.SecretTechnique:IsReady()and aU(aR,aV)and(not S.ColdBlood:IsAvailable()or U.Commons.OffGCDasOffGCD.ColdBlood and S.ColdBlood:IsReady()or g:BuffUp(S.ColdBlood)or S.ColdBlood:CooldownRemains()>bc-2)then if m.Cast(S.SecretTechnique)then ab=280719;return"Cast Secret Technique"end end;if not bf and S.Rupture:IsCastable()then if m.AoEON()and not ap and a4>=2 then local function bg(aY)return Q.CanDoTUnit(aY,aj)and aY:DebuffRefreshable(S.Rupture,ai)end;if not ay then az(S.Rupture,bg,2*be,a5)ay=true end end;if a8 and h:DebuffRemains(S.Rupture)<S.SymbolsofDeath:CooldownRemains()+10 and S.SymbolsofDeath:CooldownRemains()<=5 and R.CanDoTUnit(h,aj)and h:FilteredTimeToDie(">",5+S.SymbolsofDeath:CooldownRemains(),-h:DebuffRemains(S.Rupture))then if m.Cast(S.Rupture)then ab=1943;return"Cast Rupture 2"end end end;if S.BlackPowder:IsCastable()and(not ap and a4>=3 or a4==2 and aR and S.DanseMacabre:IsAvailable()and not aW(S.BlackPowder))then if S.BlackPowder:IsReady()and m.Cast(S.BlackPowder)then ab=319175;return"Cast Black Powder"end end;if S.Eviscerate:IsCastable()and a8 then if S.Eviscerate:IsReady()and m.Cast(S.Eviscerate)then ab=196819;return"Cast Eviscerate"end end end;local function bh()local aR=g:BuffUp(S.ShadowDanceBuff)local bc=g:BuffRemains(S.ShadowDanceBuff)local aV=StealthSpell or g:BuffUp(S.PremeditationBuff)local bi=g:BuffUp(S.TheRottenBuff)local bj,bk=an,ao;local bl=g:BuffUp(R.StealthSpell())or StealthSpell and StealthSpell:ID()==R.StealthSpell():ID()local bm=g:BuffUp(R.VanishBuffSpell())or StealthSpell and StealthSpell:ID()==S.Vanish:ID()if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aR=true;bc=8+S.ImprovedShadowDance:TalentRank()if g:HasTier(30,2)then bi=true end;if S.TheFirstDance:IsAvailable()then bj=N(g:ComboPointsMax(),an+4)bk=g:ComboPointsMax()-bj end end;local bn=R.EffectiveComboPoints(bj)local bo=S.Shadowstrike:IsCastable()or bl or bm or aR or g:BuffUp(S.SepsisBuff)if bl or bm then bo=bo and h:IsInRange(25)else bo=bo and a8 end;if bo and(bl or bm)and(a4<4 or ap)and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then ab=185438;return"Cast Shadowstrike (Stealth)"end end;local bp=g:BuffStack(S.DanseMacabreBuff)<5 and(bk==2 or bk==3)and(aV or bn<7)and(a4<=8 or S.LingeringShadow:IsAvailable())if bp and g:BuffUp(S.SilentStormBuff)and h:DebuffDown(S.FindWeaknessDebuff)and S.ImprovedShurikenStorm:IsAvailable()or S.DanseMacabre:IsAvailable()and bj<=1 and a4==2 and not aW(S.ShurikenStorm)then if m.Cast(S.ShurikenStorm)then ab=197835;return"Cast Shuriken Storm (FW)"end end;if S.Gloomblade:IsCastable()and(bp and(not aW(S.Gloomblade)or a4~=2)or bj<=2 and bi and a4<=3)then if m.Cast(S.Gloomblade)then ab=700;return"Cast Gloomblade (Stealth)"end end;if S.Backstab:IsCastable()and bp and S.DanseMacabre:IsAvailable()and not aW(S.Backstab)and g:BuffStack(S.DanseMacabreBuff)<=2 and a4<=2 then if m.Cast(S.Backstab)then ab=600;return"Cast Backstab (Stealth)"end end;if bn>=R.CPMaxSpend()then return bb()end;if g:BuffUp(S.ShurikenTornado)and bk<=2 then return bb()end;if a4>=4-l(S.SealFate:IsAvailable())and bn>=4 then return bb()end;if bk<=1+aL(S.SealFate:IsAvailable()or S.DeeperStratagem:IsAvailable()or S.SecretStratagem:IsAvailable())then return bb()end;if g:BuffStack(S.PerforatedVeinsBuff)>=5 and a4<3 then if S.Gloomblade:IsCastable()then if m.Cast(S.Gloomblade)then ab=7007;return"Cast Gloomblade (Stealth PV)"end elseif S.Backstab:IsCastable()then if m.Cast(S.Backstab)then ab=6006;return"Cast Backstab (Stealth PV)"end end end;if bo and not g:StealthUp(true,false)and not StealthSpell and g:BuffUp(S.SepsisBuff)and a4<4 and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then ab=185438;return"Cast Shadowstrike (Sepsis)"end end;if m.AoEON()and S.ShurikenStorm:IsCastable()and a4>=3+l(bi)and(not aV or a4>=7 and not ap)then if m.Cast(S.ShurikenStorm)then ab=197835;return"Cast Shuriken Storm"end end;if bo and(h:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and h:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then ab=185438;return"Cast Shadowstrike (FW Refresh)"end end;if bo and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then ab=185438;return"Cast Shadowstrike 2"end end end;local function bq()if m.CDsON()and S.ShadowDance:TimeSinceLastDisplay()>0.3 and S.Shadowmeld:TimeSinceLastDisplay()>0.3 and not g:IsTanking(h)then if S.Vanish:IsCastable()and(not S.DanseMacabre:IsAvailable()or a4>=3)and not aO()and ao>1 and(S.Flagellation:CooldownRemains()>=60 or not S.Flagellation:IsAvailable()or d.BossFilteredFightRemains("<=",30*S.Vanish:Charges()))then if m.Cast(S.Vanish,nil,nil)then ab=1856;return"Vanish Stealth CD"end end;if S.Shadowmeld:IsCastable()and a8 and not g:IsMoving()and g:EnergyDeficitPredicted()>10 and not aO()and ao>4 then if g:Energy()<40 then if m.CastPooling(S.Shadowmeld,g:EnergyTimeToX(40))then ab=1000;return"Pool for Shadowmeld"end end end end;ai=(4+EffectiveComboPoints*4)*0.3;if a8 and S.ShadowDance:IsCastable()and S.ShadowDance:Charges()>=1 and S.Vanish:TimeSinceLastDisplay()>0.3 and S.Shadowmeld:TimeSinceLastDisplay()>0.3 and(m.CDsON()or S.ShadowDance:ChargesFractional()>=U.Subtlety.ShDEcoCharge-(not S.ShadowDanceTalent:IsAvailable()and 0.75 or 0))and not F then if(aP()and(not S.ShadowDanceTalent:IsAvailable()and g:BuffRemains(S.SymbolsofDeath)>=2.2-l(S.Flagellation:IsAvailable())or aO())or S.ShadowDanceTalent:IsAvailable()and S.SecretTechnique:CooldownRemains()<=9 and(a4<=3 or S.DanseMacabre:IsAvailable())or g:BuffRemains(S.FlagellationPersistBuff)>=6 or a4>=4 and S.SymbolsofDeath:CooldownRemains()>10)and aT()then if m.Cast(S.ShadowDance)then ab=185313;return"Shadow Dance Stealth CD 1"end end;if W()and(aP()and d.BossFilteredFightRemains("<",S.SymbolsofDeath:CooldownRemains())or not S.ShadowDanceTalent:IsAvailable()and h:DebuffUp(S.Rupture)and a4<=4 and aT())then if m.Cast(S.ShadowDance)then ab=185313;return"Shadow Dance Stealth CD 2"end end end end;local function br()ad=nil;af=nil;ae=0;a6=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a7=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a8=h:IsInMeleeRange(a6)a9=h:IsInMeleeRange(a7)q=HeroRotationCharDB.Toggles[5]p=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[12]s=not HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[20]u=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[26]A=HeroRotationCharDB.Toggles[27]B=HeroRotationCharDB.Toggles[28]C=HeroRotationCharDB.Toggles[29]D=HeroRotationCharDB.Toggles[30]E=HeroRotationCharDB.Toggles[54]F=HeroRotationCharDB.Toggles[172]G=HeroRotationCharDB.Toggles[173]SBReady=false;SDReady=false;VanishReady=false;SoDReady=false;MfDReady=true;STReady=false;if U.Subtlety.IncludedCooldowns.ShadowBlades and o()or U.Subtlety.IncludedSmallCooldowns.ShadowBlades and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShadowBlades and not U.Subtlety.IncludedCooldowns.ShadowBlades then SBReady=true end;if U.Subtlety.IncludedCooldowns.ShadowDance and o()or U.Subtlety.IncludedSmallCooldowns.ShadowDance and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShadowDance and not U.Subtlety.IncludedCooldowns.ShadowDance then SDReady=true end;if U.Subtlety.IncludedCooldowns.Vanish and o()or U.Subtlety.IncludedSmallCooldowns.Vanish and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.Vanish and not U.Subtlety.IncludedCooldowns.Vanish then VanishReady=true end;if U.Subtlety.IncludedCooldowns.SymbolsofDeath and o()or U.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and not U.Subtlety.IncludedCooldowns.SymbolsofDeath then SoDReady=true end;if U.Subtlety.IncludedCooldowns.ShurikenTornado and o()or U.Subtlety.IncludedSmallCooldowns.ShurikenTornado and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShurikenTornado and not U.Subtlety.IncludedCooldowns.ShurikenTornado then STReady=true end;_=GetInventoryItemID("player",13)a0=GetInventoryItemID("player",14)ay=false end;local function bs()if S.Subterfuge:IsAvailable()then ag=S.Stealth2;ah=S.VanishBuff2 else ag=S.Stealth;ah=S.VanishBuff end;aa=br()a6=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a7=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a8=h:IsInMeleeRange(a6)a9=h:IsInMeleeRange(a7)if n()then a2=g:GetEnemiesInRange(30)a3=g:GetEnemiesInMeleeRange(a7)a4=#a3;a5=g:GetEnemiesInMeleeRange(a6)else a2={}a3={}a4=0;a5={}end;an=g:ComboPoints()EffectiveComboPoints=R.EffectiveComboPoints(an)ao=g:ComboPointsDeficit()ap=aJ()StealthEnergyRequired=g:EnergyMax()-aN()if Q.TargetIsValid()or g:AffectingCombat()then if IsInRaid()and UnitExists("boss1")then ak=d.BossFightRemains(nil,true)al=ak;if al==11111 then al=d.FightRemains(Enemies10yd,false)end end end;if EffectiveComboPoints>an and ao>2 and g:AffectingCombat()then if an==2 and not g:BuffUp(S.EchoingReprimand3)or an==3 and not g:BuffUp(S.EchoingReprimand4)or an==4 and not g:BuffUp(S.EchoingReprimand5)then local bt=R.TimeToSht(4)if bt==0 then bt=R.TimeToSht(5)end;if bt<O(g:EnergyTimeToX(35),g:GCDRemains())+0.5 then EffectiveComboPoints=an end end end;if g:BuffUp(S.ShurikenTornado,nil,true)and an<R.CPMaxSpend()and not C then local bu=R.TimeToNextTornado()if bu<=g:GCDRemains()or P(g:GCDRemains()-bu)<0.25 then local bv=a4+aL(g:BuffUp(S.ShadowBlades))an=N(an+bv,R.CPMaxSpend())ao=O(ao-bv,0)if EffectiveComboPoints<R.CPMaxSpend()then EffectiveComboPoints=an end end end;ai=(4+EffectiveComboPoints*4)*0.3;aj=S.Eviscerate:Damage()*U.Subtlety.EviscerateDMGOffset;if aa then return aa end;if ac>0 then ac=0 end;if ab>0 then ab=0 end;ab=R.ReturnSpell()ac=R.ReturnSpellMO()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then I=GetTime()J=I+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and J~=nil and GetTime()>J and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if m.QueuedCast()then ab=m.QueuedCast()return"Custom Queue "..i(ab):ID()end;if v and S.CheapShot:IsUsableP()and S.CheapShot:CooldownRemains()<=0 and g:StealthUp(true,true)and not g:PrevGCD(1,S.CheapShot)then if m.Cast(S.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.CheapShot)then ac=11833;return"queue Cheap Shot MO"else ab=1833;return"queue Cheap Shot"end end elseif(not S.CheapShot:IsUsableP()or S.CheapShot:CooldownRemains()>0 or g:PrevGCD(1,S.CheapShot))and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]m.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and S.KidneyShot:IsUsableP()and S.KidneyShot:CooldownRemains()<=0 then if m.Cast(S.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.KidneyShot)then ac=1408;return"queue Kidney Shot MO"else ab=408;return"queue Kidney Shot"end end elseif g:PrevGCD(1,S.KidneyShot)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]m.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and S.Blind:IsUsableP()and S.Blind:CooldownRemains()<=0 then if m.Cast(S.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Blind)then ac=12094;return"queue Blind MO"else ab=2094;return"queue Blind"end end elseif(not S.Blind:IsUsableP()or S.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]m.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and S.Sap:IsUsableP()and S.Sap:CooldownRemains()<=0 then if m.Cast(S.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Sap)then ac=16770;return"queue Sap MO"else ab=6770;return"queue Sap"end end elseif(not S.Sap:IsUsableP()or S.Sap:CooldownRemains()>0)and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]m.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and S.ShurikenTornado:IsUsableP()and S.ShurikenTornado:CooldownRemains()<=0 then if m.Cast(S.ShurikenTornado,nil,nil,nil)then ab=277925;return"queue Shuriken Tornado"end elseif(not S.ShurikenTornado:IsUsableP()or S.ShurikenTornado:CooldownRemains()>0)and z then HeroRotationCharDB.Toggles[26]=not HeroRotationCharDB.Toggles[26]m.Print("Shuriken Tornado Queue is now "..(HeroRotationCharDB.Toggles[26]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and S.Feint:IsUsableP()and S.Feint:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Feint,nil,nil,nil)then ab=202;return"queue Shuriken Tornado"end elseif(not S.Feint:IsUsableP()or S.Feint:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]m.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and S.Flagellation:IsUsableP()and S.Flagellation:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Flagellation,nil,nil,nil)then ab=323654;return"queue Flagellation Queue"end elseif(not S.Flagellation:IsUsableP()or S.Flagellation:CooldownRemains()>0 or not g:AffectingCombat())and B then HeroRotationCharDB.Toggles[28]=not HeroRotationCharDB.Toggles[28]m.Print("Flagellation Queue is now "..(HeroRotationCharDB.Toggles[28]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if S.ArcaneTorrent:IsAvailable()and S.ArcaneTorrent:IsUsableP()and S.ArcaneTorrent:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.ArcaneTorrent,nil,nil,nil)then ab=155145;return"queue ArcaneTorrent Queue"end elseif S.LightsJudgment:IsAvailable()and S.LightsJudgment:IsUsableP()and S.LightsJudgment:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.LightsJudgment,nil,nil,nil)then ab=255647;return"queue ArcaneTorrent Queue"end elseif S.BagofTricks:IsAvailable()and S.BagofTricks:IsUsableP()and S.BagofTricks:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BagofTricks,nil,nil,nil)then ab=312411;return"queue ArcaneTorrent Queue"end elseif S.BloodFury:IsAvailable()and S.BloodFury:IsUsableP()and S.BloodFury:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BloodFury,nil,nil,nil)then ab=20572;return"queue ArcaneTorrent Queue"end elseif S.Berserking:IsAvailable()and S.Berserking:IsUsableP()and S.Berserking:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Berserking,nil,nil,nil)then ab=26297;return"queue ArcaneTorrent Queue"end elseif S.Fireblood:IsAvailable()and S.Fireblood:IsUsableP()and S.Fireblood:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Fireblood,nil,nil,nil)then ab=265221;return"queue ArcaneTorrent Queue"end elseif S.AncestralCall:IsAvailable()and S.AncestralCall:IsUsableP()and S.AncestralCall:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.AncestralCall,nil,nil,nil)then ab=274738;return"queue ArcaneTorrent Queue"end elseif(S.ArcaneTorrent:IsAvailable()and(not S.ArcaneTorrent:IsUsableP()or S.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or S.LightsJudgment:IsAvailable()and(not S.LightsJudgment:IsUsableP()or S.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or S.BagofTricks:IsAvailable()and(not S.BagofTricks:IsUsableP()or S.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or S.BloodFury:IsAvailable()and(not S.BloodFury:IsUsableP()or S.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or S.Berserking:IsAvailable()and(not S.Berserking:IsUsableP()or S.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or S.Fireblood:IsAvailable()and(not S.Fireblood:IsUsableP()or S.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or S.AncestralCall:IsAvailable()and(not S.AncestralCall:IsUsableP()or S.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]m.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;aa=R.CrimsonVial()if aa then return aa end;if g:AffectingCombat()and not g:IsDeadOrGhost()then aa=R.Feint()if aa then return aa end;aa=R.Evasion()if aa then return aa end;if g:HealthPercentage()<U.Commons.PhialHP and T.PhialofSerenity:IsReady()and T.PhialofSerenity:CooldownRemains()<=0 then if m.Cast(T.PhialofSerenity,nil)then ab=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<U.Commons.HealthstoneHP and T.Healthstone:IsReady()and T.Healthstone:CooldownRemains()<=0 then if m.Cast(T.Healthstone,nil)then ab=40;return"Healthstone HP"end end;if g:HealthPercentage()<U.Commons.HealPotHP and T.CosmicHealPot:IsReady()and T.CosmicHealPot:CooldownRemains()<=0 then if m.Cast(T.CosmicHealPot,nil)then ab=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<U.Commons.HealPotHP and T.HealPot:IsReady()and not T.CosmicHealPot:IsReady()and T.HealPot:CooldownRemains()<=0 then if m.Cast(T.HealPot,nil)then ab=41;return"HealPot HP"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if S.Backstab:IsReady()and f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then ac=153;return"explosive MO SWD"end end;if S.ShurikenToss:IsReady()and f("mouseover"):IsInMeleeRange(40)and not f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then ac=1114014;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if S.Backstab:IsReady()and h:IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then ab=53;return"explosive  SWD"end end;if S.ShurikenToss:IsReady()and h:IsInMeleeRange(40)and not h:IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then ab=114014;return"explosive MO SWD"end end end;H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337}if UnitExists("target")and S.Shiv:IsReady()and not E then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for bw=0,40 do local aH,aH,bx,by,aH,aH,aH,aH,aH,bz=UnitBuff("target",bw)for aH,bA in pairs(H)do if bA==bz then if m.Cast(S.Shiv,nil)then ab=5938;return"Shiv Enrage"end end end end end end;local bB=g:AffectingCombat()and 180 or 900;local bC;if i(8679):IsAvailable()and U.Commons.LethalPoison=="Wound Poison"then bC=g:BuffRemains(i(8679))if bC<bB and not g:IsCasting(i(8679))then if m.Cast(i(8679))then ab=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and U.Commons.LethalPoison=="Deadly Poison"then bC=g:BuffRemains(i(2823))if bC<bB and not g:IsCasting(i(2823))then if m.Cast(i(2823))then ab=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and U.Commons.LethalPoison=="Instant Poison"then bC=g:BuffRemains(i(315584))if bC<bB and not g:IsCasting(i(315584))then if m.Cast(i(315584))then ab=205;return"Instant Poison Refresh"end end end;if i(381637):IsAvailable()and U.Commons.NonLethalPoison=="Atrophic Poison"then bC=g:BuffRemains(i(381637))if bC<bB and not g:IsCasting(i(381637))then if m.Cast(i(381637))then ab=381637;return"Atropic Poison Refresh"end end elseif i(5761):IsAvailable()and U.Commons.NonLethalPoison=="Numbing Poison"then bC=g:BuffRemains(i(5761))if bC<bB and not g:IsCasting(NumbingPoison)then if m.Cast(i(5761))then ab=204;return"Numbing Poison Refresh"end end elseif i(3408):IsAvailable()and U.Commons.NonLethalPoison=="Crippling Poison"then bC=g:BuffRemains(i(3408))if bC<bB and not g:IsCasting(NumbingPoison)then if m.Cast(i(3408))then ab=206;return"Crippling Poison Refresh"end end end;if not g:AffectingCombat()and not g:IsDeadOrGhost()then if not g:BuffUp(S.ShadowDanceBuff)and not g:BuffUp(R.VanishBuffSpell())then aa=R.Stealth(R.StealthSpell())if aa then return aa end end;if Q.TargetIsValid()and(h:IsSpellInRange(S.Shadowstrike)or a8)and(not g:AffectingCombat()or q)then if m.CDsON()then if S.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=R.CPMaxSpend()then if m.Cast(S.MarkedforDeath,nil)then ab=137619;return"Cast Marked for Death OOC"end end end;if g:StealthUp(true,true)and(g:AffectingCombat()or q)then aa=bh()if aa then return aa.." (OOC)"end elseif an>=5 then if g:AffectingCombat()or q then aa=bb()if aa then return aa.." (OOC)"end end elseif S.Backstab:IsCastable()then if m.Cast(S.Backstab)then ab=53;return"Cast Backstab (OOC)"end end end;return end;R.MfDSniping(S.MarkedforDeath)if Q.TargetIsValid()and(not h:DebuffUp(S.Sap)or(g:BuffUp(ah)or StealthSpell and StealthSpell:ID()==S.Vanish:ID()))then if aa then return aa end;aa=b6()if aa then return"CDs: "..aa end;local bD,bE,aH=GetSpellCooldown(57934)if U.Commons.AutoToT and g:AffectingCombat()then if bD+bE-GetTime()<=0 and S.TricksoftheTrade:IsAvailable()and S.TricksoftheTrade:CooldownRemains()<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if m.Cast(S.TricksoftheTrade)then ab=157934;return"ToT Focus"end end end;if S.SliceandDice:IsCastable()and a4<R.CPMaxSpend()and d.FilteredFightRemains(a3,">",6)and g:BuffRemains(S.SliceandDice)<g:GCD()and an>=4 then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then ab=5171;return"Cast Slice and Dice (Low Duration)"end end;if g:StealthUp(true,true)and(g:AffectingCombat()or q)then aa=bh()if aa then return"Stealthed : "..aa end end;if g:EnergyPredicted()>=StealthEnergyRequired then aa=bq()if aa then return"Stealth CDs: "..aa end end;if EffectiveComboPoints>=R.CPMaxSpend()or(ao<=1+aL(g:BuffUp(S.TheRottenBuff))or d.BossFilteredFightRemains("<",2)and EffectiveComboPoints>=3)or a4>=4-aL(S.SealFate:IsAvailable())and EffectiveComboPoints>=4 then aa=bb()if aa then return"Finish: "..aa end else aa=bq()if aa then return"Stealth CDs: "..aa end;aa=b4()if aa then return"Build: "..aa end end;if m.CDsON()then if S.ArcaneTorrent:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if m.Cast(S.ArcaneTorrent,nil)then ab=155145;return"Cast Arcane Torrent"end end;if S.ArcanePulse:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.ArcanePulse,nil)then ab=260364;return"Cast Arcane Pulse"end end;if S.LightsJudgment:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.LightsJudgment,nil)then ab=255647;return"Cast Lights Judgment"end end;if S.BagofTricks:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.BagofTricks,nil)then ab=312411;return"Cast Bag of Tricks"end end end end end;local function bF()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]m.ToggleIconFrame:UpdateButtonText(5)end;if HeroRotationCharDB.Toggles[171]then HeroRotationCharDB.Toggles[171]=not HeroRotationCharDB.Toggles[171]end;if HeroRotationCharDB.Toggles[172]then HeroRotationCharDB.Toggles[172]=not HeroRotationCharDB.Toggles[172]end;if HeroRotationCharDB.Toggles[29]then HeroRotationCharDB.Toggles[29]=not HeroRotationCharDB.Toggles[29]end end;function ReturnSpell()if ab==0 then return 0 else return ab end end;function ReturnSpellMO()if ac==0 then return 0 else return ac end end;m.SetAPL(261,bs,bF)