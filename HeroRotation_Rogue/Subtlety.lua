local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=d.Utils.BoolToInt;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[12]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[20]local u=HeroRotationCharDB.Toggles[21]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[26]local A=HeroRotationCharDB.Toggles[27]local B=HeroRotationCharDB.Toggles[28]local C=HeroRotationCharDB.Toggles[29]local D=HeroRotationCharDB.Toggles[30]local E=HeroRotationCharDB.Toggles[54]local F=HeroRotationCharDB.Toggles[171]local G=HeroRotationCharDB.Toggles[172]local H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337}local I=nil;local J=nil;local K=0;local L=0;local pairs=pairs;local M=table.insert;local N=math.min;local O=math.max;local P=math.abs;local Q=m.Commons.Everyone;local R=m.Commons.Rogue;local S=i.Rogue.Subtlety;local T=k.Rogue.Subtlety;local U={General=m.GUISettings.General,Commons=m.GUISettings.APL.Rogue.Commons,Subtlety=m.GUISettings.APL.Rogue.Subtlety}S.Eviscerate:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*EffectiveComboPoints*0.176*1.21*(S.Nightstalker:IsAvailable()and g:StealthUp(true,false)and 1.08 or 1)*(S.DeeperStratagem:IsAvailable()and 1.05 or 1)*(S.DarkShadow:IsAvailable()and g:BuffUp(S.ShadowDanceBuff)and 1.3 or 1)*(g:BuffUp(S.SymbolsofDeath)and 1.1 or 1)*(g:BuffUp(S.FinalityEviscerateBuff)and 1.3 or 1)*(1+g:MasteryPct()/100)*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(S.FindWeaknessDebuff)and 1.5 or 1)end)S.Rupture:RegisterPMultiplier(function()return g:BuffUp(S.FinalityRuptureBuff)and 1.3 or 1 end)local U={General=m.GUISettings.General,Commons=m.GUISettings.APL.Rogue.Commons,Commons2=m.GUISettings.APL.Rogue.Commons2,Subtlety=m.GUISettings.APL.Rogue.Subtlety}local function V()if U.Subtlety.BurnShadowDance=="On Bosses not in Dungeons"and g:IsInDungeonArea()then return false elseif U.Subtlety.BurnShadowDance~="Always"and not h:IsInBossList()then return false else return true end end;local W=g:GetEquipment()local X=W[13]and k(W[13])or k(0)local Y=W[14]and k(W[14])or k(0)local Z=GetInventoryItemID("player",13)local _=GetInventoryItemID("player",14)local a0={}d:RegisterForEvent(function()W=g:GetEquipment()X=W[13]and k(W[13])or k(0)Y=W[14]and k(W[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")local a1,a2,a3,a4;local a5,a6,a7,a8;local a9;local aa=R.ReturnSpell()local ab=R.ReturnSpellMO()local ac,ad,ae;local af,ag;local ah,ai;local aj=11111;local ak=11111;local al,am,an;local ao;local ap;local aq;local ar;local as;local at;local au;local av;local aw;local ax=false;local function ay(az,aA,aB,aC)local aD,aE=nil,aB;local aF=h:GUID()for aG,aH in pairs(aC)do if aH:GUID()~=aF and Q.UnitIsCycleValid(aH,aE,-aH:DebuffRemains(az))and aA(aH)then aD,aE=aH,aH:TimeToDie()end end;if aD then m.CastLeftNameplate(aD,az)if aD:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then if az==S.Rupture then ab=11943 elseif az==S.SerratedBoneSpike then ab=1328547 end elseif U.Subtlety.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not r then ab=9999 end elseif false then aD,aE=nil,aB;for aG,aH in pairs(a2)do if aH:GUID()~=aF and Q.UnitIsCycleValid(aH,aE,-aH:DebuffRemains(az))and aA(aH)then aD,aE=aH,aH:TimeToDie()end end;if aD then m.CastLeftNameplate(aD,az)if aD:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then if az==S.Rupture then ab=11943 elseif az==S.SerratedBoneSpike then ab=1328547 end elseif U.Subtlety.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not r then ab=9999 end end end end;local function aI()if a3<2 then return false elseif U.Commons.UsePriorityRotation=="Always"then return true elseif U.Commons.UsePriorityRotation=="On Bosses"and h:IsInBossList()then return true elseif U.Commons.UsePriorityRotation=="Auto"then if g:InstanceDifficulty()==16 and h:NPCID()==138967 then return true elseif h:NPCID()==166969 or h:NPCID()==166971 or h:NPCID()==166970 then return true elseif h:NPCID()==183463 or h:NPCID()==183671 then return true end end;return false end;local aJ=g:CovenantID()d:RegisterForEvent(function()aJ=g:CovenantID()end,"COVENANT_CHOSEN")d:RegisterForEvent(function()aj=11111;ak=11111 end,"PLAYER_REGEN_ENABLED")local function aK(aL)if aL then return 1 else return 0 end end;local function aM()return 25+aK(S.Vigor:IsAvailable())*20+aK(S.MasterofShadows:IsAvailable())*20+aK(S.ShadowFocus:IsAvailable())*25+aK(S.Alacrity:IsAvailable())*20+aK(a3>=4)*25 end;local function aN()return S.ShadowDance:ChargesFractional()>=0.75+l(S.ShadowDanceTalent:IsAvailable())end;local function aO()if a3==4-aK(S.SealFate:IsAvailable())then return true elseif a3>4-2*l(S.ShurikenTornado:IsAvailable())or ao and a3>=4 then return an<=1 else return am<=1 end end;local function aw()return g:BuffUp(S.SliceandDice)or a3>=R.CPMaxSpend()end;local function aP(aQ)return g:BuffUp(S.ThistleTea)and a3==1 or aQ and(a3==1 or h:DebuffUp(S.Rupture)and a3>=2)end;local function aR()return g:BuffDown(S.PremeditationBuff)and a3==1 or not S.TheRotten:IsAvailable()or a3>1 end;local function aS()return not g:BuffUp(S.TheRottenBuff)or a3>1 or am<=2 and g:BuffUp(S.TheRottenBuff)and not g:HasTier(30,2)end;local function aT(aQ,aU)return aQ and(g:BuffStack(S.DanseMacabreBuff)>=3 or not S.DanseMacabre:IsAvailable())and(not aU or a3~=2)end;local function aV(i)return g:BuffUp(S.ShadowDanceBuff)and i:TimeSinceLastCast()<S.ShadowDance:TimeSinceLastCast()end;local function aW(aX)return aX:DebuffRemains(S.FindWeaknessDebuff)end;local function aY(aX)return aX:TimeToDie()end;local function aZ(aX)return aX:DebuffRemains(S.Rupture)end;local function a_(aX)if(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aX:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ab=1185438;return true elseif(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and U.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aX:GUID()==h:GUID()then aa=185438;return true elseif aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains()then return true end end;local function b0(aX)if aX:IsInRange(8)and aX:TimeToDie()>10 and aX:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ab=1323654;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 and U.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 and aX:GUID()==h:GUID()then aa=323654;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 then return true end end;local function b1(aX)if(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aX:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ab=1137619;return true elseif(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and U.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aX:GUID()==h:GUID()then aa=137619;return true elseif aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend()then return true end end;local function b2(aX)if aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and aX:GUID()==f("mouseover"):GUID()and U.Subtlety.TargetSwap=="Mouseover"then ab=11943;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and U.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and aX:GUID()==h:GUID()then aa=1943;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)then return true end end;local function b3()local b4=not EnergyThreshold or g:EnergyPredicted()>=EnergyThreshold;if m.AoEON()and S.ShurikenStorm:IsCastable()and a3>=2+l(S.Gloomblade:IsAvailable()and g:BuffRemains(S.LingeringShadowBuff)>=6 or g:BuffUp(S.PerforatedVeinsBuff))then if m.Cast(S.ShurikenStorm)then aa=197835;return"Cast Shuriken Storm"end end;if a7 then if S.EchoingReprimand:IsAvailable()and g:Energy()<60 and(am==2 and g:BuffUp(S.EchoingReprimand3)or am==3 and g:BuffUp(S.EchoingReprimand4)or am==4 and g:BuffUp(S.EchoingReprimand5))and(R.TimeToSht(3)<0.5 or R.TimeToSht(4)<1.0 or R.TimeToSht(5)<1.0)then if m.Cast(S.PoolEnergy)then aa=999910 end;return"ER Generator Pooling"end;if S.Gloomblade:IsCastable()then if b4 and m.Cast(S.Gloomblade)then aa=200758;return"Cast Gloomblade"end elseif S.Backstab:IsCastable()then if b4 and m.Cast(S.Backstab)then aa=53;return"Cast Backstab"end end end end;local function b5()if g:BuffUp(S.ShurikenTornado)then if S.SymbolsofDeath:IsCastable()and S.ShadowDance:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not g:BuffUp(S.ShadowDanceBuff)and not G and not F then if m.Cast(S.SymbolsofDeath)then aa=800;return"Dance + Symbols (during Tornado)"end elseif S.SymbolsofDeath:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not G then if m.Cast(S.SymbolsofDeath)then aa=212283;return"Cast Symbols of Death (during Tornado)"end elseif S.ShadowDance:IsCastable()and not g:BuffUp(S.ShadowDanceBuff)and not F then if m.Cast(S.ShadowDance)then aa=185313;return"Cast Shadow Dance (during Tornado)"end end end;local b6=aw()if S.Vanish:IsCastable()and VanishReady and not u and U.Commons.VanishOffensive and am<=2 and g:BuffStack(S.DanseMacabreBuff)>3 and(S.SecretTechnique:CooldownRemains()>=30 or not S.SecretTechnique:IsAvailable())then if m.Cast(S.Vanish,nil,nil)then aa=1856;return"Vanish Stealth CD"end end;if S.ColdBlood:IsReady()and p and not S.SecretTechnique:IsAvailable()and am>=5 then if m.Cast(S.ColdBlood)then aa=382245;return"Cast Cold Blood"end end;if a7 then if o()and S.Flagellation:IsReady()and b6 and not g:StealthUp(false,false)and am>=5 and h:FilteredTimeToDie(">",10)then if m.Cast(S.Flagellation,nil)then aa=323654;return"Cast Flagellation"end end end;if p and S.ShurikenTornado:IsCastable()and a3<=1 and aw()and S.SymbolsofDeath:CooldownUp()and S.ShadowDance:Charges()>=1 and(not S.Flagellation:IsAvailable()or g:BuffUp(S.Flagellation)or a3>=5)and am<=2 and not g:BuffUp(S.PremeditationBuff)and not C then if g:Energy()>=60 then if m.Cast(S.ShurikenTornado,nil)then aa=277925;return"Cast Shuriken Tornado"end elseif not S.ShadowFocus:IsAvailable()then if m.CastPooling(S.ShurikenTornado)then aa=277925;return"Pool for Shuriken Tornado"end end end;if a7 then if o()and S.Sepsis:IsReady()and b6 and an>=1 and not h:FilteredTimeToDie("<",16)then if m.Cast(S.Sepsis,nil,nil)then aa=328305;return"Cast Sepsis"end end;if S.SymbolsofDeath:IsCastable()and not G then if(g:BuffRemains(S.SymbolsofDeath)<=3 and not S.ShadowDance:CooldownUp()or not g:HasTier(30,2))and aR()and b6 and(not S.Flagellation:IsAvailable()and(am<=1 or not S.TheRotten:IsAvailable())or S.Flagellation:CooldownRemains()>10 or S.Flagellation:CooldownUp()and am>=5)then if m.Cast(S.SymbolsofDeath,nil)then aa=212283;return"Cast Symbols of Death"end end end end;if S.MarkedforDeath:IsCastable()then if h:FilteredTimeToDie("<",an)then if m.Cast(S.MarkedforDeath,nil)then aa=137619;return"Cast Marked for Death"end end;if not g:StealthUp(true,true)and an>=R.CPMaxSpend()then if m.Cast(S.MarkedforDeath,nil)then aa=137619;return"Cast Marked for Death"end elseif m.CDsON()then if m.Cast(S.MarkedforDeath,nil)then aa=137619;return"Cast Marked for Death"end end end;if m.CDsON()then if S.ShadowBlades:IsCastable()and(b6 and an>=2 and h:FilteredTimeToDie(">=",10)and(not S.Sepsis:IsAvailable()or S.Sepsis:CooldownRemains()<=8 or h:DebuffUp(S.Sepsis))or d.BossFilteredFightRemains("<=",20))then if m.Cast(S.ShadowBlades,nil)then aa=121471;return"Cast Shadow Blades"end end;if S.EchoingReprimand:IsReady()and a7 and an>=3 and(ao or a3<=4 or S.ResoundingClarity:IsAvailable())and(g:BuffUp(S.ShadowDanceBuff)or not S.DanseMacabre:IsAvailable())then if m.Cast(S.EchoingReprimand,nil,nil)then aa=323547;return"Cast Echoing Reprimand"end end;if S.ShurikenTornado:IsReady()and not C then if aw and g:BuffUp(S.SymbolsofDeath)and am<=2 and(not g:BuffUp(S.PremeditationBuff)or a3>4)then if m.Cast(S.ShurikenTornado)then aa=277925;return"Cast Shuriken Tornado (SoD)"end end;if not S.Flagellation:IsAvailable()and a3>=3 and S.ShadowDance:Charges()>=1 and not g:StealthUp(true,true)then if m.Cast(S.ShurikenTornado)then aa=277925;return"Cast Shuriken Tornado (Dance)"end end end;if S.ShadowDance:IsCastable()and V()and not g:BuffUp(S.ShadowDanceBuff)and d.BossFilteredFightRemains("<=",8)and not F then if m.Cast(S.ShadowDance)then aa=185313;return"Cast Shadow Dance (Low TTD)"end end;if S.ThistleTea:IsReady()then if(S.SymbolsofDeath:CooldownRemains()>=3 or g:BuffUp(S.SymbolsofDeath))and not g:BuffUp(S.ThistleTea)and(g:EnergyDeficitPredicted()>=100 and(g:ComboPointsDeficit()>=2 or a3>=3)or S.ThistleTea:ChargesFractional()>=2.75 and g:BuffUp(S.ShadowDanceBuff))or g:BuffRemains(S.ShadowDanceBuff)>=4 and not g:BuffUp(S.ThistleTea)and a3>=3 or not g:BuffUp(S.ThistleTea)and d.BossFilteredFightRemains("<=",6*S.ThistleTea:Charges())then if m.Cast(S.ThistleTea)then aa=381623;return"Cast ThistleTea"end end end;if U.Commons.Enabled.Potions and o()and s and((g:BloodlustUp()or ak<30 or g:BuffUp(S.SymbolsofDeath)and(g:BuffUp(S.ShadowBlades)or S.ShadowBlades:CooldownRemains()<=10))and not m.GUISettings.General.HoldPotforBL or m.GUISettings.General.HoldPotforBL and g:BloodlustUp())then local b7=Q.PotionSelected()if b7 and b7:IsReady()then if m.Cast(b7,nil,nil)then aa=37;return"potion cooldowns 2"end end end;if g:BuffUp(S.SymbolsofDeath)and o()then if S.BloodFury:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.BloodFury,nil)then aa=20572;return"Cast Blood Fury"end end;if S.Berserking:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.Berserking,nil)then aa=26297;return"Cast Berserking"end end;if S.Fireblood:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.Fireblood,nil)then aa=265221;return"Cast Fireblood"end end;if S.AncestralCall:IsReady()and U.Commons.Enabled.Racials then if m.Cast(S.AncestralCall,nil)then aa=274738;return"Cast Ancestral Call"end end end;local aQ=g:BuffUp(S.ShadowDanceBuff)local b8=g:GetUseableTrinkets(a0)if b8 and o()and not aQ then if g:BuffUp(S.SymbolsofDeath)or d.BossFilteredFightRemains("<",10)then if b8 then if m.Cast(b8,nil,nil)then if b8:ID()==GetInventoryItemID("player",13)and U.Commons.Enabled.TopTrinket then aa=24;return"Generic use_items for "..b8:Name()elseif b8:ID()==GetInventoryItemID("player",14)and U.Commons.Enabled.BottomTrinket then aa=25;return"Generic use_items for "..b8:Name()end end end end end end end;local function b9()local aQ=g:BuffUp(S.ShadowDanceBuff)local b8=g:GetUseableTrinkets(a0)if b8 and o()and not aQ then if g:BuffUp(S.SymbolsofDeath)or d.BossFilteredFightRemains("<",10)then if b8 then if m.Cast(b8,nil,nil)then if b8:ID()==GetInventoryItemID("player",13)and U.Commons.Enabled.TopTrinket then aa=24;return"Generic use_items for "..b8:Name()elseif b8:ID()==GetInventoryItemID("player",14)and U.Commons.Enabled.BottomTrinket then aa=25;return"Generic use_items for "..b8:Name()end end end end end end;local function ba()local aQ=g:BuffUp(S.ShadowDanceBuff)local bb=g:BuffRemains(S.ShadowDanceBuff)local bc=g:BuffRemains(S.SymbolsofDeath)local bd=am;local aU=g:BuffUp(S.PremeditationBuff)or StealthSpell and S.Premeditation:IsAvailable()if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aQ=true;bb=8+S.ImprovedShadowDance:TalentRank()if S.TheFirstDance:IsAvailable()then bd=N(g:ComboPointsMax(),am+4)end;if g:HasTier(30,2)then bc=O(bc,6)end end;if S.SliceandDice:IsCastable()and d.FilteredFightRemains(a2,">",g:BuffRemains(S.SliceandDice))then if S.Premeditation:IsAvailable()and a3<5 then if S.ShadowDance:ChargesFractional()<1.75 and g:BuffRemains(S.SliceandDice)<S.SymbolsofDeath:CooldownRemains()and(S.ShadowDance:Charges()>=1 and bc-bb<1.2)then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then aa=5171;return"Cast Slice and Dice (Premed)"end end else if a3<6 and not aQ and g:BuffRemains(S.SliceandDice)<1+bd*1.8 then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then aa=5171;return"Cast Slice and Dice"end end end end;local be=aP(aQ)if(not be or ao)and S.Rupture:IsCastable()then if a7 and(h:FilteredTimeToDie(">",6,-h:DebuffRemains(S.Rupture))or h:TimeToDieIsNotValid())and R.CanDoTUnit(h,ai)and h:DebuffRefreshable(S.Rupture,ah)then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture 1"end end end;if not be and S.Rupture:IsCastable()then if a3==1 and g:BuffUp(S.FinalityRuptureBuff)and(S.DarkBrew:IsAvailable()or S.DanseMacabre:IsAvailable())and S.ShadowDance:CooldownRemains()<12 and S.ShadowDance:ChargesFractional()<=1 then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture (Finality)"end end end;if t and S.SecretTechnique:IsCastable()and aQ and(g:BuffStack(S.DanseMacabreBuff)>=3 or not S.DanseMacabre:IsAvailable())then if S.ColdBlood:IsReady()and g:BuffDown(S.ColdBlood)then if m.Cast(S.ColdBlood)then aa=382245;return"Cast Cold Blood (FunnelAOE)"end end;if not S.ColdBlood:IsAvailable()or S.ColdBlood:IsReady()or g:BuffUp(S.ColdBlood)or S.ColdBlood:CooldownRemains()>bb-2 then if m.Cast(S.SecretTechnique)then aa=280719;return"Cast Secret Technique (FunnelAOE)"end end end;if t and S.Eviscerate:IsCastable()and a7 then if S.Eviscerate:IsReady()and m.Cast(S.Eviscerate)then aa=196819;return"Cast Eviscerate (FunnelAOE)"end end;if p and S.ColdBlood:IsReady()and aT(aQ,aU)and S.SecretTechnique:CooldownUp()then if m.Cast(S.ColdBlood)then aa=382245;return"Cast Cold Blood (SecTec)"end end;if S.SecretTechnique:IsReady()and aT(aQ,aU)and(not S.ColdBlood:IsAvailable()or U.Commons.OffGCDasOffGCD.ColdBlood and S.ColdBlood:IsReady()or g:BuffUp(S.ColdBlood)or S.ColdBlood:CooldownRemains()>bb-2)then if m.Cast(S.SecretTechnique)then aa=280719;return"Cast Secret Technique"end end;if not be and S.Rupture:IsCastable()then if m.AoEON()and not ao and a3>=2 then local function bf(aX)return Q.CanDoTUnit(aX,ai)and aX:DebuffRefreshable(S.Rupture,ah)end;if not ax then ay(S.Rupture,bf,2*bd,a4)ax=true end end;if a7 and h:DebuffRemains(S.Rupture)<S.SymbolsofDeath:CooldownRemains()+10 and S.SymbolsofDeath:CooldownRemains()<=5 and R.CanDoTUnit(h,ai)and h:FilteredTimeToDie(">",5+S.SymbolsofDeath:CooldownRemains(),-h:DebuffRemains(S.Rupture))then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture 2"end end end;if S.BlackPowder:IsCastable()and(not ao and a3>=3 or a3==2 and aQ and S.DanseMacabre:IsAvailable()and not aV(S.BlackPowder))then if S.BlackPowder:IsReady()and m.Cast(S.BlackPowder)then aa=319175;return"Cast Black Powder"end end;if S.Eviscerate:IsCastable()and a7 then if S.Eviscerate:IsReady()and m.Cast(S.Eviscerate)then aa=196819;return"Cast Eviscerate"end end end;local function bg()local aQ=g:BuffUp(S.ShadowDanceBuff)local bb=g:BuffRemains(S.ShadowDanceBuff)local aU=StealthSpell or g:BuffUp(S.PremeditationBuff)local bh=g:BuffUp(S.TheRottenBuff)local bi,bj=am,an;local bk=g:BuffUp(R.StealthSpell())or StealthSpell and StealthSpell:ID()==R.StealthSpell():ID()local bl=g:BuffUp(R.VanishBuffSpell())or StealthSpell and StealthSpell:ID()==S.Vanish:ID()if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aQ=true;bb=8+S.ImprovedShadowDance:TalentRank()if g:HasTier(30,2)and g:HasTier(30,2)then bh=true end;if S.TheFirstDance:IsAvailable()then bi=N(g:ComboPointsMax(),am+4)bj=g:ComboPointsMax()-bi end end;local bm=R.EffectiveComboPoints(bi)local bn=S.Shadowstrike:IsCastable()or bk or bl or aQ or g:BuffUp(S.SepsisBuff)if bk or bl then bn=bn and h:IsInRange(25)else bn=bn and a7 end;if bn and(bk or bl)and(a3<4 or ao)and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike (Stealth)"end end;local bo=g:BuffStack(S.DanseMacabreBuff)<5 and(bj==2 or bj==3)and(aU or bm<7)and(a3<=8 or S.LingeringShadow:IsAvailable())if bo and g:BuffUp(S.SilentStormBuff)and h:DebuffDown(S.FindWeaknessDebuff)and S.ImprovedShurikenStorm:IsAvailable()or S.DanseMacabre:IsAvailable()and bi<=1 and a3==2 and not aV(S.ShurikenStorm)then if m.Cast(S.ShurikenStorm)then aa=197835;return"Cast Shuriken Storm (FW)"end end;if S.Gloomblade:IsCastable()and(bo and(not aV(S.Gloomblade)or a3~=2)or bi<=2 and bh and a3<=3)then if m.Cast(S.Gloomblade)then aa=700;return"Cast Gloomblade (Stealth)"end end;if S.Backstab:IsCastable()and bo and S.DanseMacabre:IsAvailable()and not aV(S.Backstab)and g:BuffStack(S.DanseMacabreBuff)<=2 and a3<=2 then if m.Cast(S.Backstab)then aa=600;return"Cast Backstab (Stealth)"end end;if bm>=R.CPMaxSpend()then return ba()end;if g:BuffUp(S.ShurikenTornado)and bj<=2 then return ba()end;if a3>=4-l(S.SealFate:IsAvailable())and bm>=4 then return ba()end;if bj<=1+aK(S.SealFate:IsAvailable()or S.DeeperStratagem:IsAvailable()or S.SecretStratagem:IsAvailable())then return ba()end;if g:BuffStack(S.PerforatedVeinsBuff)>=5 and a3<3 then if S.Gloomblade:IsCastable()then if m.Cast(S.Gloomblade)then aa=7007;return"Cast Gloomblade (Stealth PV)"end elseif S.Backstab:IsCastable()then if m.Cast(S.Backstab)then aa=6006;return"Cast Backstab (Stealth PV)"end end end;if bn and not g:StealthUp(true,false)and not StealthSpell and g:BuffUp(S.SepsisBuff)and a3<4 and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike (Sepsis)"end end;if m.AoEON()and S.ShurikenStorm:IsCastable()and a3>=3+l(bh)and(not aU or a3>=7 and not ao)then if m.Cast(S.ShurikenStorm)then aa=197835;return"Cast Shuriken Storm"end end;if bn and(h:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and h:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike (FW Refresh)"end end;if bn and h:IsInMeleeRange(U.Subtlety.ShadowStrikeRange)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike 2"end end end;local function bp()if m.CDsON()and S.ShadowDance:TimeSinceLastDisplay()>0.3 and S.Shadowmeld:TimeSinceLastDisplay()>0.3 and not g:IsTanking(h)then if S.Vanish:IsCastable()and(not S.DanseMacabre:IsAvailable()or a3>=3)and not aN()and an>1 and(S.Flagellation:CooldownRemains()>=60 or not S.Flagellation:IsAvailable()or d.BossFilteredFightRemains("<=",30*S.Vanish:Charges()))then if m.Cast(S.Vanish,nil,nil)then aa=1856;return"Vanish Stealth CD"end end;if S.Shadowmeld:IsCastable()and a7 and not g:IsMoving()and g:EnergyDeficitPredicted()>10 and not aN()and an>4 then if g:Energy()<40 then if m.CastPooling(S.Shadowmeld,g:EnergyTimeToX(40))then aa=1000;return"Pool for Shadowmeld"end end end end;ah=(4+EffectiveComboPoints*4)*0.3;if a7 and S.ShadowDance:IsCastable()and S.ShadowDance:Charges()>=1 and S.Vanish:TimeSinceLastDisplay()>0.3 and S.Shadowmeld:TimeSinceLastDisplay()>0.3 and(m.CDsON()or S.ShadowDance:ChargesFractional()>=U.Subtlety.ShDEcoCharge-(not S.ShadowDanceTalent:IsAvailable()and 0.75 or 0))and not F then if(aO()and(not S.ShadowDanceTalent:IsAvailable()and g:BuffRemains(S.SymbolsofDeath)>=2.2-l(S.Flagellation:IsAvailable())or aN())or S.ShadowDanceTalent:IsAvailable()and S.SecretTechnique:CooldownRemains()<=9 and(a3<=3 or S.DanseMacabre:IsAvailable())or g:BuffRemains(S.FlagellationPersistBuff)>=6 or a3>=4 and S.SymbolsofDeath:CooldownRemains()>10)and aS()then if m.Cast(S.ShadowDance)then aa=185313;return"Shadow Dance Stealth CD 1"end end;if V()and(aO()and d.BossFilteredFightRemains("<",S.SymbolsofDeath:CooldownRemains())or not S.ShadowDanceTalent:IsAvailable()and h:DebuffUp(S.Rupture)and a3<=4 and aS())then if m.Cast(S.ShadowDance)then aa=185313;return"Shadow Dance Stealth CD 2"end end end end;local function bq()ac=nil;ae=nil;ad=0;a5=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a6=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a7=h:IsInMeleeRange(a5)a8=h:IsInMeleeRange(a6)q=HeroRotationCharDB.Toggles[5]p=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[12]s=not HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[20]u=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[26]A=HeroRotationCharDB.Toggles[27]B=HeroRotationCharDB.Toggles[28]C=HeroRotationCharDB.Toggles[29]D=HeroRotationCharDB.Toggles[30]E=HeroRotationCharDB.Toggles[54]F=HeroRotationCharDB.Toggles[172]G=HeroRotationCharDB.Toggles[173]SBReady=false;SDReady=false;VanishReady=false;SoDReady=false;MfDReady=true;STReady=false;if U.Subtlety.IncludedCooldowns.ShadowBlades and o()or U.Subtlety.IncludedSmallCooldowns.ShadowBlades and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShadowBlades and not U.Subtlety.IncludedCooldowns.ShadowBlades then SBReady=true end;if U.Subtlety.IncludedCooldowns.ShadowDance and o()or U.Subtlety.IncludedSmallCooldowns.ShadowDance and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShadowDance and not U.Subtlety.IncludedCooldowns.ShadowDance then SDReady=true end;if U.Subtlety.IncludedCooldowns.Vanish and o()or U.Subtlety.IncludedSmallCooldowns.Vanish and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.Vanish and not U.Subtlety.IncludedCooldowns.Vanish then VanishReady=true end;if U.Subtlety.IncludedCooldowns.SymbolsofDeath and o()or U.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and not U.Subtlety.IncludedCooldowns.SymbolsofDeath then SoDReady=true end;if U.Subtlety.IncludedCooldowns.ShurikenTornado and o()or U.Subtlety.IncludedSmallCooldowns.ShurikenTornado and(o()or p)or not U.Subtlety.IncludedSmallCooldowns.ShurikenTornado and not U.Subtlety.IncludedCooldowns.ShurikenTornado then STReady=true end;Z=GetInventoryItemID("player",13)_=GetInventoryItemID("player",14)ax=false end;local function br()if S.Subterfuge:IsAvailable()then af=S.Stealth2;ag=S.VanishBuff2 else af=S.Stealth;ag=S.VanishBuff end;a9=bq()a5=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a6=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a7=h:IsInMeleeRange(a5)a8=h:IsInMeleeRange(a6)if n()then a1=g:GetEnemiesInRange(30)a2=g:GetEnemiesInMeleeRange(a6)a3=#a2;a4=g:GetEnemiesInMeleeRange(a5)else a1={}a2={}a3=0;a4={}end;am=g:ComboPoints()EffectiveComboPoints=R.EffectiveComboPoints(am)an=g:ComboPointsDeficit()ao=aI()StealthEnergyRequired=g:EnergyMax()-aM()if Q.TargetIsValid()or g:AffectingCombat()then if IsInRaid()and UnitExists("boss1")then aj=d.BossFightRemains(nil,true)ak=aj;if ak==11111 then ak=d.FightRemains(Enemies10yd,false)end end end;if EffectiveComboPoints>am and an>2 and g:AffectingCombat()then if am==2 and not g:BuffUp(S.EchoingReprimand3)or am==3 and not g:BuffUp(S.EchoingReprimand4)or am==4 and not g:BuffUp(S.EchoingReprimand5)then local bs=R.TimeToSht(4)if bs==0 then bs=R.TimeToSht(5)end;if bs<O(g:EnergyTimeToX(35),g:GCDRemains())+0.5 then EffectiveComboPoints=am end end end;if g:BuffUp(S.ShurikenTornado,nil,true)and am<R.CPMaxSpend()and not C then local bt=R.TimeToNextTornado()if bt<=g:GCDRemains()or P(g:GCDRemains()-bt)<0.25 then local bu=a3+aK(g:BuffUp(S.ShadowBlades))am=N(am+bu,R.CPMaxSpend())an=O(an-bu,0)if EffectiveComboPoints<R.CPMaxSpend()then EffectiveComboPoints=am end end end;ah=(4+EffectiveComboPoints*4)*0.3;ai=S.Eviscerate:Damage()*U.Subtlety.EviscerateDMGOffset;if a9 then return a9 end;if ab>0 then ab=0 end;if aa>0 then aa=0 end;aa=R.ReturnSpell()ab=R.ReturnSpellMO()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then I=GetTime()J=I+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and J~=nil and GetTime()>J and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if m.QueuedCast()then aa=m.QueuedCast()return"Custom Queue "..i(aa):ID()end;if v and S.CheapShot:IsUsableP()and S.CheapShot:CooldownRemains()<=0 and g:StealthUp(true,true)and not g:PrevGCD(1,S.CheapShot)then if m.Cast(S.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.CheapShot)then ab=11833;return"queue Cheap Shot MO"else aa=1833;return"queue Cheap Shot"end end elseif(not S.CheapShot:IsUsableP()or S.CheapShot:CooldownRemains()>0 or g:PrevGCD(1,S.CheapShot))and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]m.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and S.KidneyShot:IsUsableP()and S.KidneyShot:CooldownRemains()<=0 then if m.Cast(S.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.KidneyShot)then ab=1408;return"queue Kidney Shot MO"else aa=408;return"queue Kidney Shot"end end elseif g:PrevGCD(1,S.KidneyShot)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]m.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and S.Blind:IsUsableP()and S.Blind:CooldownRemains()<=0 then if m.Cast(S.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Blind)then ab=12094;return"queue Blind MO"else aa=2094;return"queue Blind"end end elseif(not S.Blind:IsUsableP()or S.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]m.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and S.Sap:IsUsableP()and S.Sap:CooldownRemains()<=0 then if m.Cast(S.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Sap)then ab=16770;return"queue Sap MO"else aa=6770;return"queue Sap"end end elseif(not S.Sap:IsUsableP()or S.Sap:CooldownRemains()>0)and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]m.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and S.ShurikenTornado:IsUsableP()and S.ShurikenTornado:CooldownRemains()<=0 then if m.Cast(S.ShurikenTornado,nil,nil,nil)then aa=277925;return"queue Shuriken Tornado"end elseif(not S.ShurikenTornado:IsUsableP()or S.ShurikenTornado:CooldownRemains()>0)and z then HeroRotationCharDB.Toggles[26]=not HeroRotationCharDB.Toggles[26]m.Print("Shuriken Tornado Queue is now "..(HeroRotationCharDB.Toggles[26]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and S.Feint:IsUsableP()and S.Feint:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Feint,nil,nil,nil)then aa=202;return"queue Shuriken Tornado"end elseif(not S.Feint:IsUsableP()or S.Feint:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]m.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and S.Flagellation:IsUsableP()and S.Flagellation:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Flagellation,nil,nil,nil)then aa=323654;return"queue Flagellation Queue"end elseif(not S.Flagellation:IsUsableP()or S.Flagellation:CooldownRemains()>0 or not g:AffectingCombat())and B then HeroRotationCharDB.Toggles[28]=not HeroRotationCharDB.Toggles[28]m.Print("Flagellation Queue is now "..(HeroRotationCharDB.Toggles[28]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if S.ArcaneTorrent:IsAvailable()and S.ArcaneTorrent:IsUsableP()and S.ArcaneTorrent:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.ArcaneTorrent,nil,nil,nil)then aa=155145;return"queue ArcaneTorrent Queue"end elseif S.LightsJudgment:IsAvailable()and S.LightsJudgment:IsUsableP()and S.LightsJudgment:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.LightsJudgment,nil,nil,nil)then aa=255647;return"queue ArcaneTorrent Queue"end elseif S.BagofTricks:IsAvailable()and S.BagofTricks:IsUsableP()and S.BagofTricks:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BagofTricks,nil,nil,nil)then aa=312411;return"queue ArcaneTorrent Queue"end elseif S.BloodFury:IsAvailable()and S.BloodFury:IsUsableP()and S.BloodFury:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BloodFury,nil,nil,nil)then aa=20572;return"queue ArcaneTorrent Queue"end elseif S.Berserking:IsAvailable()and S.Berserking:IsUsableP()and S.Berserking:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Berserking,nil,nil,nil)then aa=26297;return"queue ArcaneTorrent Queue"end elseif S.Fireblood:IsAvailable()and S.Fireblood:IsUsableP()and S.Fireblood:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Fireblood,nil,nil,nil)then aa=265221;return"queue ArcaneTorrent Queue"end elseif S.AncestralCall:IsAvailable()and S.AncestralCall:IsUsableP()and S.AncestralCall:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.AncestralCall,nil,nil,nil)then aa=274738;return"queue ArcaneTorrent Queue"end elseif(S.ArcaneTorrent:IsAvailable()and(not S.ArcaneTorrent:IsUsableP()or S.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or S.LightsJudgment:IsAvailable()and(not S.LightsJudgment:IsUsableP()or S.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or S.BagofTricks:IsAvailable()and(not S.BagofTricks:IsUsableP()or S.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or S.BloodFury:IsAvailable()and(not S.BloodFury:IsUsableP()or S.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or S.Berserking:IsAvailable()and(not S.Berserking:IsUsableP()or S.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or S.Fireblood:IsAvailable()and(not S.Fireblood:IsUsableP()or S.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or S.AncestralCall:IsAvailable()and(not S.AncestralCall:IsUsableP()or S.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]m.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;a9=R.CrimsonVial()if a9 then return a9 end;if g:AffectingCombat()and not g:IsDeadOrGhost()then a9=R.Feint()if a9 then return a9 end;a9=R.Evasion()if a9 then return a9 end;if g:HealthPercentage()<U.Commons.PhialHP and T.PhialofSerenity:IsReady()and T.PhialofSerenity:CooldownRemains()<=0 then if m.Cast(T.PhialofSerenity,nil)then aa=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<U.Commons.HealthstoneHP and T.Healthstone:IsReady()and T.Healthstone:CooldownRemains()<=0 then if m.Cast(T.Healthstone,nil)then aa=40;return"Healthstone HP"end end;if g:HealthPercentage()<U.Commons.HealPotHP and T.CosmicHealPot:IsReady()and T.CosmicHealPot:CooldownRemains()<=0 then if m.Cast(T.CosmicHealPot,nil)then aa=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<U.Commons.HealPotHP and T.HealPot:IsReady()and not T.CosmicHealPot:IsReady()and T.HealPot:CooldownRemains()<=0 then if m.Cast(T.HealPot,nil)then aa=41;return"HealPot HP"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if S.Backstab:IsReady()and f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then ab=153;return"explosive MO SWD"end end;if S.ShurikenToss:IsReady()and f("mouseover"):IsInMeleeRange(40)and not f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then ab=1114014;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if S.Backstab:IsReady()and h:IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then aa=53;return"explosive  SWD"end end;if S.ShurikenToss:IsReady()and h:IsInMeleeRange(40)and not h:IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then aa=114014;return"explosive MO SWD"end end end;H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337,38255}if UnitExists("target")and S.Shiv:IsReady()and not E then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for bv=0,40 do local aG,aG,bw,bx,aG,aG,aG,aG,aG,by=UnitBuff("target",bv)for aG,bz in pairs(H)do if bz==by then if m.Cast(S.Shiv,nil)then aa=5938;return"Shiv Enrage"end end end end end end;local bA=g:AffectingCombat()and 180 or 900;local bB;if i(8679):IsAvailable()and U.Commons.LethalPoison=="Wound Poison"then bB=g:BuffRemains(i(8679))if bB<bA and not g:IsCasting(i(8679))then if m.Cast(i(8679))then aa=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and U.Commons.LethalPoison=="Deadly Poison"then bB=g:BuffRemains(i(2823))if bB<bA and not g:IsCasting(i(2823))then if m.Cast(i(2823))then aa=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and U.Commons.LethalPoison=="Instant Poison"then bB=g:BuffRemains(i(315584))if bB<bA and not g:IsCasting(i(315584))then if m.Cast(i(315584))then aa=205;return"Instant Poison Refresh"end end end;if i(381637):IsAvailable()and U.Commons.NonLethalPoison=="Atrophic Poison"then bB=g:BuffRemains(i(381637))if bB<bA and not g:IsCasting(i(381637))then if m.Cast(i(381637))then aa=381637;return"Atropic Poison Refresh"end end elseif i(5761):IsAvailable()and U.Commons.NonLethalPoison=="Numbing Poison"then bB=g:BuffRemains(i(5761))if bB<bA and not g:IsCasting(NumbingPoison)then if m.Cast(i(5761))then aa=204;return"Numbing Poison Refresh"end end elseif i(3408):IsAvailable()and U.Commons.NonLethalPoison=="Crippling Poison"then bB=g:BuffRemains(i(3408))if bB<bA and not g:IsCasting(NumbingPoison)then if m.Cast(i(3408))then aa=206;return"Crippling Poison Refresh"end end end;if not g:AffectingCombat()and not g:IsDeadOrGhost()then if not g:BuffUp(S.ShadowDanceBuff)and not g:BuffUp(R.VanishBuffSpell())then a9=R.Stealth(R.StealthSpell())if a9 then return a9 end end;if Q.TargetIsValid()and(h:IsSpellInRange(S.Shadowstrike)or a7)and(not g:AffectingCombat()or q)then if m.CDsON()then if S.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=R.CPMaxSpend()then if m.Cast(S.MarkedforDeath,nil)then aa=137619;return"Cast Marked for Death OOC"end end end;if g:StealthUp(true,true)and(g:AffectingCombat()or q)then a9=bg()if a9 then return a9 .." (OOC)"end elseif am>=5 then if g:AffectingCombat()or q then a9=ba()if a9 then return a9 .." (OOC)"end end elseif S.Backstab:IsCastable()then if m.Cast(S.Backstab)then aa=53;return"Cast Backstab (OOC)"end end end;return end;R.MfDSniping(S.MarkedforDeath)if Q.TargetIsValid()and(not h:DebuffUp(S.Sap)or(g:BuffUp(ag)or StealthSpell and StealthSpell:ID()==S.Vanish:ID()))then if a9 then return a9 end;a9=b5()if a9 then return"CDs: "..a9 end;local bC,bD,aG=GetSpellCooldown(57934)if U.Commons.AutoToT and g:AffectingCombat()then if bC+bD-GetTime()<=0 and S.TricksoftheTrade:IsAvailable()and S.TricksoftheTrade:CooldownRemains()<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if m.Cast(S.TricksoftheTrade)then aa=157934;return"ToT Focus"end end end;if S.SliceandDice:IsCastable()and a3<R.CPMaxSpend()and d.FilteredFightRemains(a2,">",6)and g:BuffRemains(S.SliceandDice)<g:GCD()and am>=4 then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then aa=5171;return"Cast Slice and Dice (Low Duration)"end end;if g:StealthUp(true,true)and(g:AffectingCombat()or q)then a9=bg()if a9 then return"Stealthed : "..a9 end end;if g:EnergyPredicted()>=StealthEnergyRequired then a9=bp()if a9 then return"Stealth CDs: "..a9 end end;if EffectiveComboPoints>=R.CPMaxSpend()or(an<=1+aK(g:BuffUp(S.TheRottenBuff))or d.BossFilteredFightRemains("<",2)and EffectiveComboPoints>=3)or a3>=4-aK(S.SealFate:IsAvailable())and EffectiveComboPoints>=4 then a9=ba()if a9 then return"Finish: "..a9 end else a9=bp()if a9 then return"Stealth CDs: "..a9 end;a9=b3()if a9 then return"Build: "..a9 end end;if m.CDsON()then if S.ArcaneTorrent:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if m.Cast(S.ArcaneTorrent,nil)then aa=155145;return"Cast Arcane Torrent"end end;if S.ArcanePulse:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.ArcanePulse,nil)then aa=260364;return"Cast Arcane Pulse"end end;if S.LightsJudgment:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.LightsJudgment,nil)then aa=255647;return"Cast Lights Judgment"end end;if S.BagofTricks:IsReady()and h:IsInMeleeRange(8)and U.Commons.Enabled.Racials then if m.Cast(S.BagofTricks,nil)then aa=312411;return"Cast Bag of Tricks"end end end end end;local function bE()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]m.ToggleIconFrame:UpdateButtonText(5)end;if HeroRotationCharDB.Toggles[171]then HeroRotationCharDB.Toggles[171]=not HeroRotationCharDB.Toggles[171]end;if HeroRotationCharDB.Toggles[172]then HeroRotationCharDB.Toggles[172]=not HeroRotationCharDB.Toggles[172]end;if HeroRotationCharDB.Toggles[29]then HeroRotationCharDB.Toggles[29]=not HeroRotationCharDB.Toggles[29]end end;function ReturnSpell()if aa==0 then return 0 else return aa end end;function ReturnSpellMO()if ab==0 then return 0 else return ab end end;m.SetAPL(261,br,bE)