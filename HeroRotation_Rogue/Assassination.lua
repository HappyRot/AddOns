local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=d.Utils.num;local m=d.Utils.BoolToInt;local n=d.Utils.IntToBool;local o=d.Utils.ValueIsInArray;local p=HeroRotation;local q=p.AoEON;local r=p.CDsON;local s=p.Cast;local t=p.CastPooling;local u=p.CastLeftNameplate;local v=HeroRotationCharDB.Toggles[4]local w=HeroRotationCharDB.Toggles[5]local x=HeroRotationCharDB.Toggles[12]local y=not HeroRotationCharDB.Toggles[15]local z=HeroRotationCharDB.Toggles[20]local A=HeroRotationCharDB.Toggles[21]local B=HeroRotationCharDB.Toggles[22]local C=HeroRotationCharDB.Toggles[23]local D=HeroRotationCharDB.Toggles[24]local E=HeroRotationCharDB.Toggles[25]local F=HeroRotationCharDB.Toggles[26]local G=HeroRotationCharDB.Toggles[27]local H=HeroRotationCharDB.Toggles[28]local I=HeroRotationCharDB.Toggles[29]local J=HeroRotationCharDB.Toggles[30]local K=HeroRotationCharDB.Toggles[54]local L=math.min;local pairs=pairs;local M=math.floor;local N=math.max;local O=p.Commons.Everyone;local P=p.Commons.Rogue;local Q={General=p.GUISettings.General,Commons=p.GUISettings.APL.Rogue.Commons,Assassination=p.GUISettings.APL.Rogue.Assassination}local R=i.Rogue.Assassination;local S=k.Rogue.Assassination;local T={}local U,V,W,X;local Y,Z,_,a0;local a1;local a2,a3=2*g:SpellHaste(),1*g:SpellHaste()local a4,a5;local a6,a7,a8,a9,aa,ab,ac;local ad;local ae,af,ag,ah,ai,aj,ak;local al=0;local am=P.ReturnSpell()local an=P.ReturnSpellMO()local ao=g:GetEquipment()local ap=ao[13]and k(ao[13])or k(0)local aq=ao[14]and k(ao[14])or k(0)local function ar()if ap:TrinketHasStatAnyDps()and(not aq:TrinketHasStatAnyDps()or ap:Cooldown()>=aq:Cooldown())then al=1 elseif aq:TrinketHasStatAnyDps()and(not ap:TrinketHasStatAnyDps()or aq:Cooldown()>ap:Cooldown())then al=2 else al=0 end end;ar()d:RegisterForEvent(function()ao=g:GetEquipment()ap=ao[13]and k(ao[13])or k(0)aq=ao[14]and k(ao[14])or k(0)ar()end,"PLAYER_EQUIPMENT_CHANGED")local function l(as)if as then return 1 else return 0 end end;R.Envenom:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*a4*0.22*1.0*(h:DebuffUp(R.ShivDebuff)and 1.3 or 1)*(R.DeeperStratagem:IsAvailable()and 1.05 or 1)*(1+g:MasteryPct()/100)*(1+g:VersatilityDmgPct()/100)end)R.Mutilate:RegisterDamageFormula(function()return(g:AttackPowerDamageMod()+g:AttackPowerDamageMod(true))*0.485*1.0*(1+g:VersatilityDmgPct()/100)end)local function at()if g:BuffRemains(R.MasterAssassinBuff)==9999 then return g:GCDRemains()+3 end;return g:BuffRemains(R.MasterAssassinBuff)end;local function au()if g:BuffUp(R.ImprovedGarroteAura)then return g:GCDRemains()+3 end;return g:BuffRemains(R.ImprovedGarroteBuff)end;local function av()if g:BuffUp(R.IndiscriminateCarnageAura)then return g:GCDRemains()+10 end;return g:BuffRemains(R.IndiscriminateCarnageBuff)end;local function aw()local ax=1;if R.Nightstalker:IsAvailable()and g:StealthUp(true,false)then ax=ax*(1+0.05*R.Nightstalker:TalentRank())end;return ax end;R.Rupture:RegisterPMultiplier(aw)local function ay()local ax=1;if R.ImprovedGarrote:IsAvailable()and(g:BuffUp(R.ImprovedGarroteAura,nil,true)or g:BuffUp(R.ImprovedGarroteBuff,nil,true)or g:BuffUp(R.SepsisBuff,nil,true))then ax=ax*1.5 end;if R.Nightstalker:IsAvailable()and g:StealthUp(true,false)then ax=ax*(1+0.05*R.Nightstalker:TalentRank())end;return ax end;R.Garrote:RegisterPMultiplier(ay)local function az()if _<2 then return false elseif Q.Commons.UsePriorityRotation=="Always"then return true elseif Q.Commons.UsePriorityRotation=="On Bosses"and h:IsInBossList()then return true elseif Q.Commons.UsePriorityRotation=="Auto"then if g:InstanceDifficulty()==16 and h:NPCID()==138967 then return true end end;return false end;local function aA()if h:DebuffUp(R.Deathmark)or h:DebuffUp(R.Kingsbane)or g:BuffUp(R.ShadowDanceBuff)or h:DebuffUp(R.ShivDebuff)or R.ThistleTea:FullRechargeTime()<20 or g:EnergyPercentage()>=80 or g:HasTier(31,4)and(g:BuffUp(R.Envenom)and g:BuffRemains(R.Envenom)<=2 or d.BossFilteredFightRemains("<=",90))then return true end;return false end;local function aB()if R.Deathmark:CooldownRemains()>R.Sepsis:CooldownRemains()and(d.BossFightRemainsIsNotValid()or d.BossFilteredFightRemains(">",R.Deathmark:CooldownRemains()))then return R.Deathmark:CooldownRemains()end;return R.Sepsis:CooldownRemains()end;local function aC()if not R.ScentOfBlood:IsAvailable()then return true end;return g:BuffStack(R.ScentOfBloodBuff)>=L(20,R.ScentOfBlood:TalentRank()*2*_)end;local function aD(aE,i,aF)local aF=aF or i:PandemicThreshold()return aE:DebuffRefreshable(i,aF)end;local function aG(aH,aI,aJ,aK)local aL,aM=nil,aJ;local aN=h:GUID()for aO,aP in pairs(aK)do if aP:GUID()~=aN and O.UnitIsCycleValid(aP,aM,-aP:DebuffRemains(aH))and aI(aP)then aL,aM=aP,aP:TimeToDie()end end;if aL then if aL:GUID()==f("mouseover"):GUID()and Q.Assassination.TargetSwap=="Mouseover"then if aH:ID()==703 then an=1703 elseif aH:ID()==1943 then an=11943 end elseif Q.Assassination.TargetSwap=="AutoSwap"and aL:GUID()~=h:GUID()and not x then an=9999 elseif aL:GUID()==h:GUID()then am=aH:ID()end;u(aL,aH)elseif Q.Commons.RangedMultiDoT then aL,aM=nil,aJ;for aO,aP in pairs(Z)do if aP:GUID()~=aN and O.UnitIsCycleValid(aP,aM,-aP:DebuffRemains(aH))and aI(aP)then aL,aM=aP,aP:TimeToDie()end end;if aL then if aL:GUID()==f("mouseover"):GUID()and Q.Assassination.TargetSwap=="Mouseover"then if aH:ID()==703 then an=1703 elseif aH:ID()==1943 then an=11943 end elseif Q.Assassination.TargetSwap=="AutoSwap"and aL:GUID()~=h:GUID()and not x then an=9999 elseif aL:GUID()==h:GUID()then am=aH:ID()end;u(aL,aH)end end end;local function aQ(aR,aS,aT)local aU=aS(h)if aR=="first"and aU~=0 then return h end;local aL,aV=nil,0;local function aW(aK)for aO,aP in pairs(aK)do local aX=aS(aP)if not aL and aR=="first"then if aX~=0 then aL,aV=aP,aX end elseif aR=="min"then if not aL or aX<aV then aL,aV=aP,aX end elseif aR=="max"then if not aL or aX>aV then aL,aV=aP,aX end end;if aL and aX==aV and aP:TimeToDie()>aL:TimeToDie()then aL,aV=aP,aX end end end;aW(a0)if Q.Commons.RangedMultiDoT then aW(Z)end;if aL and aV==aU and aT(h)then return h end;if aL and aT(aL)then return aL end;return nil end;local function aY(aZ,a_,b0)local b1=h:TimeToDie()if not d.BossFightRemainsIsNotValid()then b1=d.BossFightRemains()elseif b1<b0 then return false end;if M((b1-b0)/aZ)>M((b1-b0-a_)/aZ)then return true end;return false end;local function b2(aE)if aE:DebuffUp(R.SerratedBoneSpikeDebuff)then return 1000000 end;return aE:TimeToDie()end;local function b3(aE)if not aE:DebuffUp(R.SerratedBoneSpikeDebuff)and aE:IsInMeleeRange(10)and aE:GUID()==f("mouseover"):GUID()and Q.Assassination.TargetSwap=="Mouseover"then an=1328547;return true elseif not aE:DebuffUp(R.SerratedBoneSpikeDebuff)and aE:IsInMeleeRange(10)and Q.Assassination.TargetSwap=="AutoSwap"and aE:GUID()~=h:GUID()and not x then an=9999;return true elseif not aE:DebuffUp(R.SerratedBoneSpikeDebuff)and aE:IsInMeleeRange(10)and aE:GUID()==h:GUID()then am=328547;return true elseif not aE:DebuffUp(R.SerratedBoneSpikeDebuff)and aE:IsInMeleeRange(10)then return true end end;local function b4()if R.BloodFury:IsReady()and r()and Q.Commons.Enabled.Racials then if p.Cast(R.BloodFury,nil)then am=20572;return"Cast Blood Fury"end end;if R.Berserking:IsReady()and r()and Q.Commons.Enabled.Racials then if p.Cast(R.Berserking,nil)then am=26297;return"Cast Berserking"end end;if R.Fireblood:IsReady()and r()and Q.Commons.Enabled.Racials then if p.Cast(R.Fireblood,nil)then am=265221;return"Cast Fireblood"end end;if R.AncestralCall:IsReady()and r()and Q.Commons.Enabled.Racials then if p.Cast(R.AncestralCall,nil)then am=274738;return"Cast Ancestral Call"end end end;local function b5()if R.ShadowDance:IsCastable()and not R.Kingsbane:IsAvailable()and r()and not A and h:IsInMeleeRange(10)and not g:IsTanking(h)then if R.ImprovedGarrote:IsAvailable()and R.Garrote:CooldownUp()and(h:PMultiplier(R.Garrote)<=1 or aD(h,R.Garrote))and(R.Deathmark:AnyDebuffUp()or R.Deathmark:CooldownRemains()<12 or R.Deathmark:CooldownRemains()>60)and a5>=math.min(_,4)then if Q.Commons.ShowPooling and g:EnergyPredicted()<45 then if s(R.PoolEnergy)then am=999999;return"Pool for Shadow Dance (Garrote)"end end;if s(R.ShadowDance,nil)then am=185313;return"Cast Shadow Dance (Garrote)"end end;if not R.ImprovedGarrote:IsAvailable()and R.MasterAssassin:IsAvailable()and not aD(h,R.Rupture)and h:DebuffRemains(R.Garrote)>3 and(h:DebuffUp(R.Deathmark)or R.Deathmark:CooldownRemains()>60)and(h:DebuffUp(R.ShivDebuff)or h:DebuffRemains(R.Deathmark)<4 or h:DebuffUp(R.Sepsis))and h:DebuffRemains(R.Sepsis)<3 then if s(R.ShadowDance,nil)then am=185313;return"Cast Shadow Dance (Master Assassin)"end end end;if R.Vanish:IsCastable()and not g:IsTanking(h)then if R.ImprovedGarrote:IsAvailable()and not R.MasterAssassin:IsAvailable()and R.Garrote:CooldownUp()and not P.Exsanguinated(h,R.Garrote)and(h:PMultiplier(R.Garrote)<=1 or aD(h,R.Garrote))then if not R.IndiscriminateCarnage:IsAvailable()and(R.Deathmark:AnyDebuffUp()or R.Deathmark:CooldownRemains()<4)and a5>=L(_,4)then if Q.Commons.ShowPooling and g:EnergyPredicted()<45 then if s(R.PoolEnergy)then am=999999;return"Pool for Vanish (Garrote Deathmark)"end end;if s(R.Vanish,nil)then am=1856;return"Cast Vanish (Garrote Deathmark)"end end;if R.IndiscriminateCarnage:IsAvailable()and _>2 then if Q.Commons.ShowPooling and g:EnergyPredicted()<45 then if s(R.PoolEnergy)then return"Pool for Vanish (Garrote Deathmark)"end end;if s(R.Vanish,nil)then am=1856;return"Cast Vanish (Garrote Cleave)"end end end;if R.MasterAssassin:IsAvailable()and R.Kingsbane:IsAvailable()and h:DebuffUp(R.Kingsbane)and h:DebuffRemains(R.Kingsbane)<=3 and h:DebuffUp(R.Deathmark)and h:DebuffRemains(R.Deathmark)<=3 then if s(R.Vanish,nil)then am=1856;return"Cast Vanish (Kingsbane)"end end;if not R.ImprovedGarrote:IsAvailable()and R.MasterAssassin:IsAvailable()and not aD(h,R.Rupture)and h:DebuffRemains(R.Garrote)>3 and h:DebuffUp(R.Deathmark)and(h:DebuffUp(R.ShivDebuff)or h:DebuffRemains(R.Deathmark)<4 or h:DebuffUp(R.Sepsis))and h:DebuffRemains(R.Sepsis)<3 then if s(R.Vanish,nil)then am=1856;return"Cast Vanish (Master Assassin)"end end end end;local function b6()if not X then return end;if not p.CDsON()then return end;if R.Sepsis:IsReady()and h:DebuffRemains(R.Rupture)>20 and(not R.ImprovedGarrote:IsAvailable()and h:DebuffUp(R.Garrote)or R.ImprovedGarrote:IsAvailable()and R.Garrote:CooldownUp()and h:PMultiplier(R.Garrote)<=1)and(h:FilteredTimeToDie(">",10)or d.BossFilteredFightRemains("<=",10))then if s(R.Sepsis,nil,true)then am=328305;return"Cast Sepsis"end end;if not g:StealthUp(true,false)then if ap:IsReady()and not o(T,ap:ID())and(al==1 and(R.Deathmark:AnyDebuffUp()or d.BossFilteredFightRemains("<",20))or al==2 and(not aq:IsReady()or R.Deathmark:CooldownRemains()>20)or al==0)then if p.Cast(aq,nil,nil)then if ap:ID()==TopTrinketID and Q.Commons.Enabled.TopTrinket then am=24;return"Generic use_items for "..ap:Name()elseif ap:ID()==BotTrinketID and Q.Commons.Enabled.BottomTrinket then am=25;return"Generic use_items for "..ap:Name()end end elseif aq:IsReady()and not o(T,aq:ID())and(al==2 and(R.Deathmark:AnyDebuffUp()or d.BossFilteredFightRemains("<",20))or al==1 and(not ap:IsReady()or R.Deathmark:CooldownRemains()>20)or al==0)then if p.Cast(aq,nil,nil)then if aq:ID()==TopTrinketID and Q.Commons.Enabled.TopTrinket then am=24;return"Generic use_items for "..aq:Name()elseif aq:ID()==BotTrinketID and Q.Commons.Enabled.BottomTrinket then am=25;return"Generic use_items for "..aq:Name()end end end end;if R.Deathmark:IsCastable()then if h:DebuffUp(R.Rupture)and g:BuffUp(R.Envenom)and not R.Deathmark:AnyDebuffUp()and(not R.MasterAssassin:IsAvailable()or h:DebuffUp(R.Garrote))and(not R.Kingsbane:IsAvailable()or R.Kingsbane:CooldownRemains()<=2)or d.BossFilteredFightRemains("<=",20)then if s(R.Deathmark,nil)then am=360194;return"Cast Deathmark"end end end;if R.Shiv:IsReady()and not h:DebuffUp(R.ShivDebuff)and h:DebuffUp(R.Garrote)and h:DebuffUp(R.Rupture)then if d.BossFilteredFightRemains("<=",R.Shiv:Charges()*8)then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (End of Fight)"end end;if R.Kingsbane:IsAvailable()then if not R.LightweightShiv:IsAvailable()and(h:DebuffUp(R.Kingsbane)and h:DebuffRemains(R.Kingsbane)<8 or R.Kingsbane:CooldownRemains()>=24)and(not R.CrimsonTempest:IsAvailable()or ak or h:DebuffUp(R.CrimsonTempest))then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (Kingsbane)"end end;if R.LightweightShiv:IsAvailable()and(h:DebuffUp(R.Kingsbane)or R.Kingsbane:CooldownRemains()<=1)then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (Kingsbane Lightweight)"end end end;if R.ArterialPrecision:IsAvailable()and R.Deathmark:AnyDebuffUp()then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (Arterial Precision)"end end;if not R.Kingsbane:IsAvailable()and not R.ArterialPrecision:IsAvailable()then if R.Sepsis:IsAvailable()then if R.Shiv:ChargesFractional()>0.9+m(R.LightweightShiv:IsAvailable())and af>5 or h:DebuffUp(R.Sepsis)or h:DebuffUp(R.Deathmark)then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (Sepsis)"end end else if not R.CrimsonTempest:IsAvailable()or ak or h:DebuffUp(R.CrimsonTempest)then if s(R.Shiv,nil)then am=5938;return"Cast Shiv"end end end end end;if Q.Commons.Enabled.Potions and r()and y and((g:BloodlustUp()or d.BossFightRemains()<=30 or h:DebuffUp(R.Deathmark))and not p.GUISettings.General.HoldPotforBL or p.GUISettings.General.HoldPotforBL and g:BloodlustUp())then local b7=O.PotionSelected()if b7 and b7:IsReady()then if s(b7,nil,nil)then am=37;return"potion cooldowns 2"end end end;if R.ShadowDance:IsCastable()and R.Kingsbane:IsAvailable()and R.Kingsbane:CooldownRemains()<=2 and g:BuffUp(R.Envenom)then if s(R.ShadowDance,nil)then am=185313;return"Cast Shadow Dance (Kingsbane Sync)"end end;if R.Kingsbane:IsReady()and(h:DebuffUp(R.ShivDebuff)or R.Shiv:CooldownRemains()<6)and g:BuffUp(R.Envenom)and(R.Deathmark:CooldownRemains()>=50 or h:DebuffUp(R.Deathmark))then if s(R.Kingsbane,nil)then am=385627;return"Cast Kingsbane"end end;if R.ThistleTea:IsCastable()and not g:BuffUp(R.ThistleTea)and(g:EnergyDeficit()>=100+ah and(not R.Kingsbane:IsAvailable()or R.ThistleTea:Charges()>=2)or(h:DebuffUp(R.Kingsbane)and h:DebuffRemains(R.Kingsbane)<6 or not R.Kingsbane:IsAvailable()and R.Deathmark:AnyDebuffUp())or d.BossFilteredFightRemains("<",R.ThistleTea:Charges()*6))then if p.Cast(R.ThistleTea,nil)then am=381623;return"Cast Thistle Tea"end end;if R.Deathmark:AnyDebuffUp()and not a1 then if a1 then b4()else a1=b4()end end;if not g:StealthUp(true,true)and au()<=0 and at()<=0 then if a1 then b5()else a1=b5()end end;if R.ColdBlood:IsReady()and g:DebuffDown(R.ColdBlood)and a4>=4 and not a1 then if s(R.ColdBlood,nil)then am=382245;return"Cast Cold Blood"end end;return a1 end;local function b8()if R.Kingsbane:IsAvailable()and g:BuffUp(R.Envenom)then if R.Shiv:IsReady()and(h:DebuffUp(R.Kingsbane)or R.Kingsbane:CooldownUp())and h:DebuffDown(R.ShivDebuff)then if s(R.Shiv,nil)then am=5938;return"Cast Shiv (Stealth Kingsbane)"end end;if R.Kingsbane:IsReady()and g:BuffRemains(R.ShadowDanceBuff)>=2 then if s(R.Kingsbane,nil)then am=385627;return"Cast Kingsbane (Dance)"end end end;if a4>=4 then if h:DebuffUp(R.Kingsbane)and g:BuffRemains(R.Envenom)<=2 then if s(R.Envenom,nil,nil,not W)then am=32645;return"Cast Envenom (Stealth Kingsbane)"end end;if ak and at()>0 and g:BuffDown(R.ShadowDanceBuff)then if s(R.Envenom,nil,nil,not W)then am=32645;return"Cast Envenom (Master Assassin)"end end end;if R.Garrote:IsCastable()and au()>0 then local function b9(aE)return aE:DebuffRemains(R.Garrote)end;local function ba(aE)if(aE:PMultiplier(R.Garrote)<=1 or aE:DebuffRemains(R.Garrote)<12/P.ExsanguinatedRate(aE,R.Garrote)or av()>0 and R.Garrote:AuraActiveCount()<_)and not ak and(aE:FilteredTimeToDie(">",2,-aE:DebuffRemains(R.Garrote))or aE:TimeToDieIsNotValid())and P.CanDoTUnit(aE,a9)then if aE:GUID()==f("mouseover"):GUID()and Q.Assassination.TargetSwap=="Mouseover"then an=1703;return true elseif Q.Assassination.TargetSwap=="AutoSwap"and aE:GUID()~=h:GUID()and not x then an=9999;return true elseif aE:GUID()==h:GUID()then am=703;return true else return true end end end;if p.AoEON()then local bb=aQ("min",b9,ba)if bb and bb:GUID()~=h:GUID()then u(bb,R.Garrote)end end;if ba(h)then if s(R.Garrote,nil,nil,not W)then am=703;return"Cast Garrote (Improved Garrote)"end end;if a5>=1+2*l(R.ShroudedSuffocation:IsAvailable())then if g:BuffDown(R.ShadowDanceBuff)and(h:PMultiplier(R.Garrote)<=1 or h:DebuffUp(R.Deathmark)and at()<3)then if s(R.Garrote,nil,nil,not W)then am=703;return"Cast Garrote (Improved Garrote Low CP)"end end;if h:PMultiplier(R.Garrote)<=1 or h:DebuffRemains(R.Garrote)<12 then if s(R.Garrote,nil,nil,not W)then am=703;return"Cast Garrote (Improved Garrote Low CP 2)"end end end end;if a4>=4 and h:PMultiplier(R.Rupture)<=1 and(g:BuffUp(R.ShadowDanceBuff)or h:DebuffUp(R.Deathmark))then if s(R.Rupture,nil,nil,not W)then am=1943;return"Cast Rupture (Nightstalker)"end end end;local function bc()local ScentSaturated=R.ScentOfBlood:IsAvailable()and g:BuffStack(R.ScentOfBloodBuff)>=L(20,R.ScentOfBlood:TalentRank()*2*_)or false;if p.AoEON()and R.CrimsonTempest:IsReady()and _>=2 and a4>=4 and ah>25 and not R.Deathmark:IsReady()then for aO,aP in pairs(Z)do if aD(aP,R.CrimsonTempest,a7)and aP:PMultiplier(R.CrimsonTempest)<=1 and aP:FilteredTimeToDie(">",6,-aP:DebuffRemains(R.CrimsonTempest))then if s(R.CrimsonTempest)then am=121411;return"Cast Crimson Tempest (AoE High Energy)"end end end end;if R.Garrote:IsCastable()and a5>=1 then local function bd(aE)return aD(aE,R.Garrote)and aE:PMultiplier(R.Garrote)<=1 end;if bd(h)and P.CanDoTUnit(h,a9)and(h:FilteredTimeToDie(">",12,-h:DebuffRemains(R.Garrote))or h:TimeToDieIsNotValid())then if t(R.Garrote,nil,not W)then am=703;return"Pool for Garrote (ST)"end end;if p.AoEON()and not aj and _>=2 then aG(R.Garrote,bd,12,a0)end end;if R.Rupture:IsReady()and a4>=4 then aa=4+m(R.DashingScoundrel:IsAvailable())*5+m(R.Doomblade:IsAvailable())*5+m(aj)*6;local function be(aE)return aD(aE,R.Rupture,a6)and aE:PMultiplier(R.Rupture)<=1 and(aE:FilteredTimeToDie(">",aa,-aE:DebuffRemains(R.Rupture))or aE:TimeToDieIsNotValid())end;if be(h)and P.CanDoTUnit(h,a8)then if s(R.Rupture,nil,nil,not W)then am=1943;return"Cast Rupture (Refresh)"end end;if p.AoEON()and(not aj or not ScentSaturated)then aG(R.Rupture,be,aa,a0)end end;if R.Garrote:IsCastable()and a5>=1 and at()<=0 and(h:PMultiplier(R.Garrote)<=1 or h:DebuffRemains(R.Garrote)<a2 and _>=3)and(h:DebuffRemains(R.Garrote)<a2*2 and _>=3)and(h:FilteredTimeToDie(">",4,-h:DebuffRemains(R.Garrote))or h:TimeToDieIsNotValid())then if s(R.Garrote,nil,nil,not W)then am=703;return"Garrote (Fallback)"end end;return false end;local function bf()if R.Envenom:IsReady()and a4>=4 and(ae or h:DebuffStack(R.AmplifyingPoisonDebuff)>=20 or a4>P.CPMaxSpend()or not ak)then if s(R.Envenom,nil,nil,not W)then am=32645;return"Cast Envenom"end end;if not(a5>1 or ae or not ak)then return false end;if not ak and R.CausticSpatter:IsAvailable()and h:DebuffUp(R.Rupture)and h:DebuffRemains(R.CausticSpatterDebuff)<=2 then if R.Mutilate:IsCastable()then if s(R.Mutilate,nil,nil,not W)then am=1329;return"Cast Mutilate (Casutic)"end end;if(R.Ambush:IsCastable()or R.AmbushOverride:IsCastable())and(g:StealthUp(true,true)or g:BuffUp(R.BlindsideBuff))then if s(R.Ambush,nil,nil,not W)then am=8676;return"Cast Ambush (Caustic)"end end end;if R.SerratedBoneSpike:IsReady()then if not h:DebuffUp(R.SerratedBoneSpikeDebuff)then if s(R.SerratedBoneSpike,nil,Q.Commons.CovenantDisplayStyle,not X)then return"Cast Serrated Bone Spike"end else if p.AoEON()then if O.CastTargetIf(R.SerratedBoneSpike,Y,"min",b2,b3)then return"Cast Serrated Bone (AoE)"end end;if at()<0.8 then if d.BossFightRemains()<=5 or R.SerratedBoneSpike:MaxCharges()-R.SerratedBoneSpike:ChargesFractional()<=0.25 then if s(R.SerratedBoneSpike,nil,true,not X)then am=328547;return"Cast Serrated Bone Spike (Dump Charge)"end elseif not ak and h:DebuffUp(R.ShivDebuff)then if s(R.SerratedBoneSpike,nil,true,not X)then am=328547;return"Cast Serrated Bone Spike (Shiv)"end end end end end;if r()and R.EchoingReprimand:IsReady()then if s(R.EchoingReprimand,nil,nil,not W)then am=323547;return"Cast Echoing Reprimand"end end;if R.FanofKnives:IsCastable()then if p.AoEON()and _>=1 and(not ad and _>=2+m(g:StealthUp(true,false))+m(R.DragonTemperedBlades:IsAvailable()))then if t(R.FanofKnives)then am=51723;return"Cast Fan of Knives"end end;if p.AoEON()and g:BuffUp(R.DeadlyPoison)and _>=3 then for aO,aP in pairs(Z)do if not aP:DebuffUp(R.DeadlyPoisonDebuff,true)and(not ad or aP:DebuffUp(R.Garrote)or aP:DebuffUp(R.Rupture))then if t(R.FanofKnives)then am=5172;return"Cast Fan of Knives (DP Refresh)"end end end end end;if(R.Ambush:IsCastable()or R.AmbushOverride:IsCastable())and(g:StealthUp(true,true)or g:BuffUp(R.BlindsideBuff)or g:BuffUp(R.SepsisBuff))and(h:DebuffDown(R.Kingsbane)or h:DebuffDown(R.Deathmark)or g:BuffUp(R.BlindsideBuff))then if t(R.Ambush,nil,not W)then am=8676;return"Cast Ambush"end end;if R.Mutilate:IsCastable()and _==2 and h:DebuffDown(R.DeadlyPoisonDebuff,true)and h:DebuffDown(R.AmplifyingPoisonDebuff,true)then local aN=h:GUID()for aO,aP in pairs(a0)do if aP:GUID()~=aN and(aP:DebuffUp(R.Garrote)or aP:DebuffUp(R.Rupture))and not aP:DebuffUp(R.DeadlyPoisonDebuff,true)and not aP:DebuffUp(R.AmplifyingPoisonDebuff,true)then if aP:GUID()==f("mouseover"):GUID()and Q.Assassination.TargetSwap=="Mouseover"then an=11329 elseif Q.Assassination.TargetSwap=="AutoSwap"and aP:GUID()~=h:GUID()and not x then an=9999 elseif aP:GUID()==h:GUID()then am=1329 end;u(aP,R.Mutilate)break end end end;if R.Mutilate:IsCastable()then if t(R.Mutilate,nil,not W)then am=1329;return"Cast Mutilate"end end;return false end;local function bg()w=HeroRotationCharDB.Toggles[5]v=HeroRotationCharDB.Toggles[4]x=HeroRotationCharDB.Toggles[12]y=not HeroRotationCharDB.Toggles[15]z=HeroRotationCharDB.Toggles[20]A=HeroRotationCharDB.Toggles[21]B=HeroRotationCharDB.Toggles[22]C=HeroRotationCharDB.Toggles[23]D=HeroRotationCharDB.Toggles[24]E=HeroRotationCharDB.Toggles[25]F=HeroRotationCharDB.Toggles[26]G=HeroRotationCharDB.Toggles[27]H=HeroRotationCharDB.Toggles[28]I=HeroRotationCharDB.Toggles[29]J=HeroRotationCharDB.Toggles[30]K=HeroRotationCharDB.Toggles[54]TopTrinketID=GetInventoryItemID("player",13)BotTrinketID=GetInventoryItemID("player",14)if not Q.Commons.Enabled.TopTrinket and not Q.Commons.Enabled.BotTrinket then OnUseExcludes={TopTrinketID,BotTrinketID,S.CacheOfAcquiredTreasures:ID()}elseif not Q.Commons.Enabled.TopTrinket and Q.Commons.Enabled.BotTrinket then OnUseExcludes={TopTrinketID,S.CacheOfAcquiredTreasures:ID()}elseif not Q.Commons.Enabled.BotTrinket and Q.Commons.Enabled.TopTrinket then OnUseExcludes={BotTrinketID,S.CacheOfAcquiredTreasures:ID()}end end;local function bh()U=R.AcrobaticStrikes:IsAvailable()and 8 or 5;V=R.AcrobaticStrikes:IsAvailable()and 10 or 13;W=h:IsInMeleeRange(U)X=h:IsInMeleeRange(V)if q()then Y=g:GetEnemiesInRange(30)Z=g:GetEnemiesInMeleeRange(V)_=#Z;a0=g:GetEnemiesInMeleeRange(U)else Y={}Z={}_=1;a0={}end;a2,a3=2*g:SpellHaste(),1*g:SpellHaste()a4=P.EffectiveComboPoints(g:ComboPoints())a5=g:ComboPointsMax()-a4;a6=(4+a4*4)*0.3;a7=(4+a4*2)*0.3;a8=R.Envenom:Damage()*Q.Assassination.EnvenomDMGOffset;a9=R.Mutilate:Damage()*Q.Assassination.MutilateDMGOffset;ad=az()a1=bg()if a1 then return a1 end;if an>0 then an=0 end;if am>0 then am=0 end;am=P.ReturnSpell()an=P.ReturnSpellMO()a1=P.CrimsonVial()if a1 then return a1 end;a1=P.Feint()if a1 then return a1 end;local bi=g:AffectingCombat()and 180 or 900;local bj;if i(8679):IsAvailable()and(Q.Assassination.LethalPoison1=="Wound Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.LethalPoison2=="Wound Poison")then bj=g:BuffRemains(i(8679))if bj<bi and not g:IsCasting(i(8679))then if p.Cast(i(8679))then am=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and(Q.Assassination.LethalPoison1=="Deadly Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.LethalPoison2=="Deadly Poison")then bj=g:BuffRemains(i(2823))if bj<bi and not g:IsCasting(i(2823))then if p.Cast(i(2823))then am=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and(Q.Assassination.LethalPoison1=="Instant Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.LethalPoison2=="Instant Poison")then bj=g:BuffRemains(i(315584))if bj<bi and not g:IsCasting(i(315584))then if p.Cast(i(315584))then am=205;return"Instant Poison Refresh"end end elseif i(381664):IsAvailable()and(Q.Assassination.LethalPoison1=="Amplifying Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.LethalPoison2=="Amplifying Poison")then bj=g:BuffRemains(i(381664))if bj<bi and not g:IsCasting(i(381664))then if p.Cast(i(381664))then am=209;return"Amplifying Poison Refresh"end end end;if i(381637):IsAvailable()and(Q.Assassination.NonLethalPoison1=="Atrophic Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.NonLethalPoison2=="Atrophic Poison")then bj=g:BuffRemains(i(381637))if bj<bi and not g:IsCasting(i(381637))then if p.Cast(i(381637))then am=381637;return"Atropic Poison Refresh"end end elseif i(5761):IsAvailable()and(Q.Assassination.NonLethalPoison1=="Numbing Poison"or R.DragonTemperedBlades:IsAvailable()and Q.Assassination.NonLethalPoison2=="Numbing Poison")then bj=g:BuffRemains(i(5761))if bj<bi and not g:IsCasting(NumbingPoison)then if p.Cast(i(5761))then am=204;return"Numbing Poison Refresh"end end end;if not g:AffectingCombat()and not g:IsDeadOrGhost()then if not g:BuffUp(P.VanishBuffSpell())then a1=P.Stealth(P.StealthSpell())if a1 then return a1 end end;if not g:BuffUp(R.SliceandDice)then if R.SliceandDice:IsReady()and a4>=2 then if s(R.SliceandDice)then am=5171;return"Cast Slice and Dice"end end end end;P.MfDSniping(R.MarkedforDeath)if O.TargetIsValid()and(g:AffectingCombat()or w)then if a1 then return a1 end;ag=P.PoisonedBleeds()ah=g:EnergyRegen()+ag*6/(2*g:SpellHaste())ai=g:EnergyDeficit()/ah;aj=ah>35;ae=aA()af=aB()ScentSaturated=aC()ak=_<2;if g:StealthUp(true,false)or au()>0 then a1=b8()if a1 then return a1 .." (Stealthed)"end end;a1=b6()if a1 then return a1 end;if not g:BuffUp(R.SliceandDice)and h:IsInMeleeRange(10)then if R.SliceandDice:IsReady()and g:ComboPoints()>=2 and h:DebuffUp(R.Rupture)or not R.CutToTheChase:IsAvailable()and g:ComboPoints()>=4 and g:BuffRemains(R.SliceandDice)<(1+g:ComboPoints())*1.8 then if s(R.SliceandDice)then am=5171;return"Cast Slice and Dice"end end elseif X and R.CutToTheChase:IsAvailable()then if R.Envenom:IsReady()and h:IsInMeleeRange(10)and g:BuffRemains(R.SliceandDice)<5 and g:ComboPoints()>=4 then if s(R.Envenom,nil,nil,not W)then am=32645;return"Cast Envenom (CttC)"end end else if R.PoisonedKnife:IsCastable()and h:IsInRange(30)and not g:StealthUp(true,true)and g:AffectingCombat()and _==0 and g:EnergyTimeToMax()<=g:GCD()*1.5 then if s(R.PoisonedKnife)then am=185565;return"Cast Poisoned Knife"end end end;a1=bc()if a1 then return a1 end;a1=bf()if a1 then return a1 end;if r()and Q.Commons.Enabled.Racials then if R.ArcaneTorrent:IsCastable()and W and g:EnergyDeficit()>15 then if s(R.ArcaneTorrent,nil)then am=155145;return"Cast Arcane Torrent"end end;if R.ArcanePulse:IsCastable()and W then if s(R.ArcanePulse,nil)then am=260364;return"Cast Arcane Pulse"end end;if R.LightsJudgment:IsCastable()and W then if s(R.LightsJudgment,nil)then am=255647;return"Cast Lights Judgment"end end;if R.BagofTricks:IsCastable()and W then if s(R.BagofTricks,nil)then am=312411;return"Cast Bag of Tricks"end end end;if R.Mutilate:IsCastable()and X then if s(R.PoolEnergy)then am=99999;return"Normal Pooling"end end end end;local function bk()R.Deathmark:RegisterAuraTracking()R.Sepsis:RegisterAuraTracking()R.Garrote:RegisterAuraTracking()end;function ReturnSpellAss()if am==0 then return 0 else return am end end;function ReturnSpellMOAss()if an==0 then return 0 else return an end end;p.SetAPL(259,bh,bk)