local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[21]local u=HeroRotationCharDB.Toggles[52]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[27]local A=HeroRotationCharDB.Toggles[50]local B=HeroRotationCharDB.Toggles[51]local C=math.min;local D=math.abs;local E=nil;local F=nil;local G=GetInventoryItemID("player",13)local H=GetInventoryItemID("player",14)local I=l.Commons.Everyone;local J=l.Commons.Rogue;local K={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local L=i.Rogue.Outlaw;local M=k.Rogue.Outlaw;local N={M.ComputationDevice:ID(),M.VigorTrinket:ID(),M.FontOfPower:ID(),M.RazorCoral:ID(),M.MistcallerOcarina:ID()}L.Dispatch:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*J.CPSpend()*0.35*1.13*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(L.GhostlyStrike)and 1.1 or 1)*(h:DebuffUp(L.SinfulRevelationDebuff)and 1.06 or 1)end)local O,P,Q;local R;local S=J.ReturnSpell()local T=J.ReturnSpellMO()local U=6;local V;local W={{L.Blind,"Cast Blind (Interrupt)",function()return true end}}local X=g:HasLegendaryEquipped(116)local Y=g:HasLegendaryEquipped(117)d:RegisterForEvent(function()X=g:HasLegendaryEquipped(116)Y=g:HasLegendaryEquipped(117)end,"PLAYER_EQUIPMENT_CHANGED")local function Z(_)if _ then return 1 else return 0 end end;local a0,a1=0,0;local function a2()local a3=g:EnergyTimeToMaxPredicted()if D(a0-a3)>1 then a0=a3 end;return a0 end;local function a4()local a5=g:EnergyPredicted()if D(a1-a5)>9 then a1=a5 end;return a1 end;local function a6(a7)return a7:TimeToDie()end;local function a8(a7)if(a7:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=J.CPMaxSpend()-1)and a7:GUID()==f("mouseover"):GUID()and K.Outlaw.TargetSwap=="Mouseover"then T=1376195;return true elseif(a7:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=J.CPMaxSpend()-1)and K.Outlaw.TargetSwap=="AutoSwap"and a7:GUID()~=h:GUID()and not r then T=999;return true elseif(a7:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=J.CPMaxSpend()-1)and a7:GUID()==h:GUID()then S=137619;return true elseif a7:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=J.CPMaxSpend()-1 then return true end end;local a9={L.Broadside,L.BuriedTreasure,L.GrandMelee,L.RuthlessPrecision,L.SkullandCrossbones,L.TrueBearing}local function aa(ab,ac)if not e.APLVar.RtB_List then e.APLVar.RtB_List={}end;if not e.APLVar.RtB_List[ab]then e.APLVar.RtB_List[ab]={}end;local ad=table.concat(ac)if ab=="All"then if not e.APLVar.RtB_List[ab][ad]then local ae=0;for af=1,#ac do if g:BuffUp(a9[ac[af]])then ae=ae+1 end end;e.APLVar.RtB_List[ab][ad]=ae==#ac and true or false end else if not e.APLVar.RtB_List[ab][ad]then e.APLVar.RtB_List[ab][ad]=false;for af=1,#ac do if g:BuffUp(a9[ac[af]])then e.APLVar.RtB_List[ab][ad]=true;break end end end end;return e.APLVar.RtB_List[ab][ad]end;local function ag()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs=0;for af=1,#a9 do if g:BuffUp(a9[af])then e.APLVar.RtB_Buffs=e.APLVar.RtB_Buffs+1 end end end;return e.APLVar.RtB_Buffs end;local function ah()if not e.APLVar.RtB_Reroll then if K.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=ag()<=0 and true or false elseif K.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(L.Broadside)and true or false elseif K.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(L.BuriedTreasure)and true or false elseif K.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(L.GrandMelee)and true or false elseif K.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(L.SkullandCrossbones)and true or false elseif K.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(L.RuthlessPrecision)and true or false elseif K.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(L.TrueBearing)and true or false else e.APLVar.RtB_Reroll=ag()<2 and(not g:BuffUp(L.TrueBearing)and not g:BuffUp(L.Broadside))and true or false end;if I.IsSoloMode()then if g:BuffUp(L.GrandMelee)then if g:IsTanking(h)or g:HealthPercentage()<C(K.Outlaw.RolltheBonesLeechKeepHP,K.Outlaw.RolltheBonesLeechRerollHP)then e.APLVar.RtB_Reroll=false end elseif g:HealthPercentage()<K.Outlaw.RolltheBonesLeechRerollHP then e.APLVar.RtB_Reroll=true end end end;return e.APLVar.RtB_Reroll end;local function ai()return g:ComboPoints()>=J.CPMaxSpend()-Z(g:BuffUp(L.Broadside))-Z(g:BuffUp(L.Opportunity))*Z(L.QuickDraw:IsAvailable())or g:ComboPoints()==J.AnimachargedCP()end;local function aj()return g:ComboPointsDeficit()>=2+Z(g:BuffUp(L.Broadside))and a4()>50 and(not L.CountTheOdds:ConduitEnabled()or J.RtBRemains()>10)end;local function ak()return not m()or Q<2 or g:BuffRemains(L.BladeFlurry)>1+Z(L.KillingSpree:IsAvailable())end;local function al()return K.Commons.VanishOffensive and n()and not(I.IsSoloMode()and g:IsTanking(h))end;local function am()if L.BladeFlurry:IsReady()and m()and Q>=2 and not g:BuffUp(L.BladeFlurry)then if l.Cast(L.BladeFlurry)then S=13877;return"Cast Blade Flurry"end end;if h:IsSpellInRange(L.SinisterStrike)then if L.Vanish:IsCastable()and al()and not g:StealthUp(true,true)then if not Y then if aj()and not t and not g:BuffUp(L.DeathlyShadowsBuff)and(not K.Outlaw.Enabled.VanishEchoingReprimand or not L.EchoingReprimand:IsAvailable()or L.EchoingReprimand:CooldownUp()or L.EchoingReprimand:CooldownRemains()>=35)then if l.Cast(L.Vanish,nil)then S=1856;return"Cast Vanish"end end else if J.MasterAssassinsMarkRemains()<=0 and not t and ak()then if L.MarkedforDeath:IsAvailable()then if ai()then if l.Cast(L.Vanish,nil)then S=1856;return"Cast Vanish (MA+MfD)"end end else if not L.BetweentheEyes:CooldownUp()and ai()or L.BetweentheEyes:CooldownUp()and aj()then if l.Cast(L.Vanish,nil)then S=1856;return"Cast Vanish (MA)"end end end end end end;if n()and L.Flagellation:IsReady()and o and not h:DebuffUp(L.Flagellation)and(h:FilteredTimeToDie(">",12)or h:IsInBossList())then if l.Cast(L.Flagellation,nil,nil)then S=323654;return"Cast Flagellation"end end;if n()and L.AdrenalineRush:IsCastable()and not g:BuffUp(L.AdrenalineRush)then if l.Cast(L.AdrenalineRush,nil)then S=13750;return"Cast Adrenaline Rush"end end;if L.RolltheBones:IsReady()and J.MasterAssassinsMarkRemains()<=0 and(J.RtBRemains()<=3 or ah())then if l.Cast(L.RolltheBones)then S=315508;return"Cast Roll the Bones"end end end;if ak()then if n()and not u and L.KillingSpree:IsCastable()and not g:BuffUp(L.Flagellation)and h:IsSpellInRange(L.KillingSpree)and not g:StealthUp(true,false)and(not Y or L.Vanish:CooldownRemains()>10 or J.MasterAssassinsMarkRemains()>2 or not al())and(h:DebuffUp(L.BetweentheEyes)and g:EnergyDeficitPredicted()>g:EnergyRegen()*2+10 or Q>2-Z(g:BuffUp(L.DeathlyShadowsBuff))or J.MasterAssassinsMarkRemains()>0)then if l.Cast(L.KillingSpree,nil,nil)then S=51690;return"Cast Killing Spree"end end;if L.BladeRush:IsCastable()and h:IsSpellInRange(L.BladeRush)and(h:IsInRange(5)or not B)and(a2()>2 or Q>2)then if l.Cast(L.BladeRush,nil)then S=271877;return"Cast Blade Rush"end end end;if h:IsSpellInRange(L.SinisterStrike)then if n()then if K.Commons.VanishOffensive and L.Shadowmeld:IsCastable()and aj()then if l.Cast(L.Shadowmeld,nil)then S=58984;return"Cast Shadowmeld"end end;if L.Dreadblades:IsReady()and h:IsSpellInRange(L.Dreadblades)and not g:StealthUp(true,true)and g:ComboPoints()<2 then if l.Cast(L.Dreadblades,nil)then S=343142;return"Cast Dreadblades"end end;if K.Commons.Enabled.TopTrinket or K.Commons.Enabled.BottomTrinket then local an=g:GetUseableTrinkets(N)if an and(d.BossFilteredFightRemains("<",20)or J.MasterAssassinsMarkRemains()>0 or not Y and h:DebuffUp(L.BetweentheEyes)and(not L.GhostlyStrike:IsAvailable()or h:DebuffUp(L.GhostlyStrike)))then if an then if l.Cast(an,nil,nil)then if an:ID()==GetInventoryItemID("player",13)then S=24;return"Generic use_items for "..an:Name()elseif an:ID()==GetInventoryItemID("player",14)then S=25;return"Generic use_items for "..an:Name()end end end end end;if L.BloodFury:IsCastable()and K.Commons.Enabled.Racials then if l.Cast(L.BloodFury,nil)then S=20572;return"Cast Blood Fury"end end;if L.Berserking:IsCastable()and K.Commons.Enabled.Racials then if l.Cast(L.Berserking,nil)then S=26297;return"Cast Berserking"end end;if L.Fireblood:IsCastable()and K.Commons.Enabled.Racials then if l.Cast(L.Fireblood,nil)then S=265221;return"Cast Fireblood"end end;if L.AncestralCall:IsCastable()and K.Commons.Enabled.Racials then if l.Cast(L.AncestralCall,nil)then S=274738;return"Cast Ancestral Call"end end end end end;local function ao()if K.Outlaw.Enabled.VanishEchoingReprimand and n()and o and L.EchoingReprimand:IsReady()and h:IsSpellInRange(L.EchoingReprimand)then if l.Cast(L.EchoingReprimand,nil,nil)then S=323547;return"Cast Echoing Reprimand"end end;if L.Dispatch:IsCastable()and h:IsSpellInRange(L.Dispatch)and ai()then if l.CastPooling(L.Dispatch)then S=2098;return"Cast Dispatch"end end;if L.Ambush:IsCastable()and h:IsSpellInRange(L.Ambush)then if l.CastPooling(L.Ambush)then S=8676;return"Cast Ambush"end end end;local function ap()if L.SliceandDice:IsCastable()and(d.FilteredFightRemains(P,">",g:BuffRemains(L.SliceandDice),true)or g:BuffRemains(L.SliceandDice)==0)and g:BuffRemains(L.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(L.SliceandDice)then S=315496;return"Cast Slice and Dice"end end;if L.BetweentheEyes:IsCastable()and h:IsSpellInRange(L.BetweentheEyes)and(h:FilteredTimeToDie(">",4)or h:TimeToDieIsNotValid())and J.CanDoTUnit(h,V)then if l.CastPooling(L.BetweentheEyes)then S=315341;return"Cast Between the Eyes"end end;if L.Dispatch:IsCastable()and h:IsSpellInRange(L.Dispatch)then if l.CastPooling(L.Dispatch)then S=2098;return"Cast Dispatch"end end end;local function aq()if n()and L.Sepsis:IsReady()and o and h:IsSpellInRange(L.Sepsis)and J.MasterAssassinsMarkRemains()<=0 then if l.Cast(L.Sepsis,nil,nil)then S=328305;return"Cast Sepsis"end end;if L.GhostlyStrike:IsReady()and h:IsSpellInRange(L.GhostlyStrike)then if l.Cast(L.GhostlyStrike,nil)then S=196937;return"Cast Ghostly Strike"end end;if L.Shiv:IsReady()and X then if l.Cast(L.Shiv)then S=5938;return"Cast Shiv (TTB)"end end;if n()and L.EchoingReprimand:IsReady()and(not K.Outlaw.Enabled.VanishEchoingReprimand or not K.Commons.VanishOffensive or L.Vanish:CooldownRemains()>=100 or g:IsTanking(h))and h:IsSpellInRange(L.EchoingReprimand)then if l.Cast(L.EchoingReprimand,nil,nil)then S=323547;return"Cast Echoing Reprimand"end end;if L.SerratedBoneSpike:IsReady()and o then if g:BuffUp(L.SliceandDice)and not h:DebuffUp(L.SerratedBoneSpikeDebuff)or K.Outlaw.DumpSpikes and d.BossFilteredFightRemains("<",5)then if l.Cast(L.SerratedBoneSpike,nil,nil)then S=328547;return"Cast Serrated Bone Spike"end end;if m()then local ar,as=nil,4;local at=h:GUID()for au,av in pairs(O)do if av:GUID()~=at and I.UnitIsCycleValid(av,as,-av:DebuffRemains(L.SerratedBoneSpike))and not av:DebuffUp(L.SerratedBoneSpikeDebuff)then ar,as=av,av:TimeToDie()end end;if ar and o then l.CastLeftNameplate(ar,L.SerratedBoneSpike)if ar:GUID()==f("mouseover"):GUID()and K.Outlaw.TargetSwap=="Mouseover"then T=3285415 elseif K.Outlaw.TargetSwap=="AutoSwap"and ar:GUID()~=h:GUID()and not r then T=999 end end end;if L.SerratedBoneSpike:ChargesFractional()>2.75 and o then if l.Cast(L.SerratedBoneSpike,nil,nil)then S=328547;return"Cast Serrated Bone Spike Filler"end end end;if L.PistolShot:IsCastable()and h:IsSpellInRange(L.PistolShot)and g:BuffUp(L.Opportunity)then if g:EnergyDeficitPredicted()>g:EnergyRegen()+10 or g:ComboPointsDeficit()<=1+Z(g:BuffUp(L.Broadside))or L.QuickDraw:IsAvailable()then if l.CastPooling(L.PistolShot)then S=185763;return"Cast Pistol Shot"end end;if g:BuffUp(L.GreenskinsWickers)or g:BuffUp(L.ConcealedBlunderbuss)then if l.CastPooling(L.PistolShot)then S=185763;return"Cast Pistol Shot (Buffed)"end end end;if L.SinisterStrike:IsCastable()and h:IsSpellInRange(L.SinisterStrike)then if l.CastPooling(L.SinisterStrike)then S=193315;return"Cast Sinister Strike"end end end;local function aw()q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[27]A=HeroRotationCharDB.Toggles[50]B=HeroRotationCharDB.Toggles[51]u=HeroRotationCharDB.Toggles[52]if not K.Commons.Enabled.TopTrinket then G=GetInventoryItemID("player",13)else G=1 end;if not K.Commons.Enabled.BottomTrinket then H=GetInventoryItemID("player",14)else H=1 end;N={G,H}end;local function ax()U=L.AcrobaticStrikes:IsAvailable()and 9 or 6;V=L.Dispatch:Damage()*1.25;if m()then O=g:GetEnemiesInRange(30)P=g:GetEnemiesInRange(U)Q=#P else Q=1 end;R=aw()if R then return R end;if T>0 then T=0 end;if S>0 then S=0 end;S=J.ReturnSpell()T=J.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then E=GetTime()F=E+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and F~=nil and GetTime()>F and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if v and L.CheapShot:IsUsableP()and L.CheapShot:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(L.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(L.CheapShot)then T=18335;return"queue Cheap Shot MO"else S=1833;return"queue Cheap Shot"end end elseif(not L.CheapShot:IsUsableP()or L.CheapShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and L.KidneyShot:IsUsableP()and L.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(L.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(L.KidneyShot)then T=4085;return"queue Kidney Shot MO"else S=408;return"queue Kidney Shot"end end elseif(not L.KidneyShot:IsUsableP()or L.KidneyShot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and L.Blind:IsUsableP()and L.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(L.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(L.Blind)then T=20945;return"queue Blind MO"end end elseif(not L.Blind:IsUsableP()or L.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and L.Sap:IsUsableP()and L.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(L.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(L.Sap)then T=67705;return"queue Sap MO"else S=6770;return"queue Sap"end end elseif(not L.Sap:IsUsableP()or L.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and L.Feint:IsUsableP()and L.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(L.Feint,nil,nil,nil)then S=202;return"queue Shuriken Tornado"end elseif(not L.Feint:IsUsableP()or L.Feint:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and L.Gouge:IsUsableP()and L.Gouge:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(L.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(L.Gouge)then T=17765;return"queue Gouge MO"else S=1776;return"queue Gouge"end end elseif(not L.Gouge:IsUsableP()or L.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if g:IsChanneling(i(324631))then if l.Cast(L.PoolEnergy,nil,nil,nil)then S=99999;return"channeling Fleashcraft"end end;R=J.CrimsonVial()if R then return R end;R=J.Feint()if R then return R end;if g:HealthPercentage()<K.Commons.PhialHP and M.PhialofSerenity:IsReady()and M.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(M.PhialofSerenity,nil)then S=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<K.Commons.HealthstoneHP and M.Healthstone:IsReady()and M.Healthstone:CooldownRemains()<=0 then if l.Cast(M.Healthstone,nil)then S=40;return"Healthstone HP"end end;if g:HealthPercentage()<K.Commons.HealPotHP and M.HealPot:IsReady()and M.HealPot:CooldownRemains()<=0 then if l.Cast(M.HealPot,nil)then S=41;return"HealPot HP"end end;WhiteList={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}if UnitExists("target")and L.Shiv:IsReady()then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for af=0,40 do local au,au,ay,az,au,au,au,au,au,aA=UnitBuff("target",af)for au,aB in pairs(WhiteList)do if aB==aA then if l.Cast(L.Shiv,nil)then S=5938;return"Shiv Enrage"end end end end end end;local aC=g:AffectingCombat()and 180 or 900;local aD;if i(8679):IsAvailable()and K.Commons.LethalPoison=="Wound Poison"then aD=g:BuffRemains(i(8679))if aD<aC and not g:IsCasting(i(8679))then if l.Cast(i(8679))then S=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and K.Commons.LethalPoison=="Deadly Poison"then aD=g:BuffRemains(i(2823))if aD<aC and not g:IsCasting(i(2823))then if l.Cast(i(2823))then S=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and K.Commons.LethalPoison=="Instant Poison"then aD=g:BuffRemains(i(315584))if aD<aC and not g:IsCasting(i(315584))then if l.Cast(i(315584))then S=205;return"Instant Poison Refresh"end end end;aD=g:BuffRemains(i(3408))if i(3408):IsAvailable()and K.Commons.NonLethalPoison=="Crippling Poison"then if aD<aC and not g:IsCasting(i(3408))then if l.Cast(i(3408))then S=206;return"Crippling Poison Refresh"end end elseif i(5761):IsAvailable()and K.Commons.NonLethalPoison=="Numbing Poison"then aD=g:BuffRemains(i(5761))if aD<aC and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then S=204;return"Numbing Poison Refresh"end end end;if not g:BuffUp(L.VanishBuff)and(I.TargetIsValid()or g:IsInDungeonArea())and not g:AffectingCombat()and not g:StealthUp(true,true)then R=J.Stealth(L.Stealth)if R then return R end end;if not g:AffectingCombat()and q then if I.TargetIsValid()and(g:AffectingCombat()or q)then if n()and L.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=J.CPMaxSpend()-1 then if K.Commons.STMfDAsDPSCD then if l.Cast(L.MarkedforDeath,nil)then S=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(L.MarkedforDeath,nil)then S=137619;return"Cast Marked for Death (OOC)"end end end;if L.RolltheBones:IsReady()and(J.RtBRemains()<=3 or ah())then if l.Cast(L.RolltheBones)then S=315508;return"Cast Roll the Bones (Opener)"end end;if L.SliceandDice:IsReady()and g:BuffRemains(L.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(L.SliceandDice)then S=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,true)then R=ao()if R then return"Stealth (Opener): "..R end elseif ai()then R=ap()if R then return"Finish (Opener): "..R end elseif L.SinisterStrike:IsCastable()then if l.Cast(L.SinisterStrike)then S=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if L.MarkedforDeath:IsCastable()and(g:AffectingCombat()or q or g:BuffUp(L.VanishBuff))then if Q>1 and I.CastTargetIf(L.MarkedforDeath,O,"min",a6,a8,nil,nil)then return"Cast Marked for Death (Cycle)"elseif Q==1 and not g:StealthUp(true,false)and g:ComboPointsDeficit()>=J.CPMaxSpend()-1 then if K.Commons.STMfDAsDPSCD then if l.Cast(L.MarkedforDeath,nil)then S=137619;return"Cast Marked for Death (ST)"end else if l.Cast(L.MarkedforDeath,nil)then S=137619;return"Cast Marked for Death (ST)"end end end end;if I.TargetIsValid()and(g:AffectingCombat()or q or g:BuffUp(L.VanishBuff))then if g:StealthUp(true,true)then R=ao()if R then return"Stealth: "..R end end;local aE,aF,au=GetSpellCooldown(57934)if K.Commons.AutoToT then if aE+aF-GetTime()<=0 and L.TricksoftheTrade:IsAvailable()and L.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if l.Cast(L.TricksoftheTrade)then S=207;return"ToT Focus"end end end;R=am()if R then return"CDs: "..R end;if ai()then R=ap()if R then return"Finish: "..R end;l.Cast(L.PoolEnergy)return"Finish Pooling"end;R=aq()if R then return"Build: "..R end;if L.ArcaneTorrent:IsCastable()and K.Commons.Enabled.Racials and h:IsSpellInRange(L.SinisterStrike)and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if l.Cast(L.ArcaneTorrent,nil)then S=155145;return"Cast Arcane Torrent"end end;if L.ArcanePulse:IsCastable()and K.Commons.Enabled.Racials and h:IsSpellInRange(L.SinisterStrike)then if l.Cast(L.ArcanePulse)then S=260364;return"Cast Arcane Pulse"end end;if L.LightsJudgment:IsCastable()and K.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(L.LightsJudgment,nil)then S=255647;return"Cast Lights Judgment"end end;if L.BagofTricks:IsCastable()and K.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(L.BagofTricks,nil)then S=312411;return"Cast Bag of Tricks"end end;if L.PistolShot:IsCastable()and h:IsSpellInRange(L.PistolShot)and not h:IsInRange(U)and not g:StealthUp(true,true)and g:EnergyDeficitPredicted()<25 and(g:ComboPointsDeficit()>=1 or a2()<=1.2)then if l.Cast(L.PistolShot)then S=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aG()end;function ReturnSpellOut()if S==0 then return 0 else return S end end;function ReturnSpellMOOut()if T==0 then return 0 else return T end end;l.SetAPL(260,ax,aG)