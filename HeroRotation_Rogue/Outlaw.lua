local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[12]local r=not HeroRotationCharDB.Toggles[15]local s=HeroRotationCharDB.Toggles[21]local t=HeroRotationCharDB.Toggles[52]local u=HeroRotationCharDB.Toggles[22]local v=HeroRotationCharDB.Toggles[23]local w=HeroRotationCharDB.Toggles[24]local x=HeroRotationCharDB.Toggles[25]local y=HeroRotationCharDB.Toggles[27]local z=HeroRotationCharDB.Toggles[50]local A=HeroRotationCharDB.Toggles[51]local B=HeroRotationCharDB.Toggles[53]local C=HeroRotationCharDB.Toggles[30]local D=HeroRotationCharDB.Toggles[54]local E=0;local F={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,158337}local G=math.min;local H=math.max;local I=math.abs;local J=nil;local K=nil;local L=GetInventoryItemID("player",13)local M=GetInventoryItemID("player",14)local N=l.Commons.Everyone;local O=l.Commons.Rogue;local P={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local Q=i.Rogue.Outlaw;local R=k.Rogue.Outlaw;local S={}local T,U,V;local W;local X=6;local Y;local Z,_,a0;local a1,a2,a3,a4,a5;local a6={{Q.Blind,"Cast Blind (Interrupt)",function()return true end}}local a7=O.ReturnSpell()local a8=O.ReturnSpellMO()local a9=0;local function aa(ab)if ab then return 1 else return 0 end end;local function ac()return g:BuffUp(Q.SliceandDice)or g:BuffUp(Q.AdrenalineRush)end;local ad,ae=0,0;local function af(ag)local ah=g:EnergyTimeToMaxPredicted(nil,ag)if ah<ad or ah-ad>0.5 then ad=ah end;return ad end;local function ai()local aj=g:EnergyPredicted()if aj>ae or aj-ae>9 then ae=aj end;return ae end;local ak={Q.Broadside,Q.BuriedTreasure,Q.GrandMelee,Q.RuthlessPrecision,Q.SkullandCrossbones,Q.TrueBearing}local function al()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs={}e.APLVar.RtB_Buffs.Total=0;e.APLVar.RtB_Buffs.Normal=0;e.APLVar.RtB_Buffs.Shorter=0;e.APLVar.RtB_Buffs.Longer=0;local am=O.RtBRemains()for an=1,#ak do local ao=g:BuffRemains(ak[an])if ao>0 then e.APLVar.RtB_Buffs.Total=e.APLVar.RtB_Buffs.Total+1;if ao==am then e.APLVar.RtB_Buffs.Normal=e.APLVar.RtB_Buffs.Normal+1 elseif ao>am then e.APLVar.RtB_Buffs.Longer=e.APLVar.RtB_Buffs.Longer+1 else e.APLVar.RtB_Buffs.Shorter=e.APLVar.RtB_Buffs.Shorter+1 end end end end;return e.APLVar.RtB_Buffs.Total end;local function ap()if not e.APLVar.RtB_Reroll then if P.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=al()<=0 and true or false elseif P.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.Broadside)and true or false elseif P.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.BuriedTreasure)and true or false elseif P.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.GrandMelee)and true or false elseif P.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.SkullandCrossbones)and true or false elseif P.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.RuthlessPrecision)and true or false elseif P.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.TrueBearing)and true or false else e.APLVar.RtB_Reroll=false;al()if al()<=2 and g:BuffUp(Q.BuriedTreasure)and g:BuffDown(Q.GrandMelee)and V<2 then e.APLVar.RtB_Reroll=true end;if Q.Crackshot:IsAvailable()and Q.HiddenOpportunity:IsAvailable()and not g:HasTier(31,4)and(not g:BuffUp(Q.TrueBearing)and Q.HiddenOpportunity:IsAvailable()or not g:BuffUp(Q.Broadside)and not Q.HiddenOpportunity:IsAvailable())and al()<=1 then e.APLVar.RtB_Reroll=true end;if Q.Crackshot:IsAvailable()and g:HasTier(31,4)and al()<=1+aa(g:BuffUp(Q.LoadedDiceBuff))and(Q.HiddenOpportunity:IsAvailable()or g:BuffDown(Q.Broadside))then e.APLVar.RtB_Reroll=true end;if not Q.Crackshot:IsAvailable()and Q.HiddenOpportunity:IsAvailable()and not g:BuffUp(Q.SkullandCrossbones)and(al()<2+aa(g:BuffUp(Q.GrandMelee))and V<2)then e.APLVar.RtB_Reroll=true end;if e.APLVar.RtB_Reroll or e.APLVar.RtB_Buffs.Normal==0 and e.APLVar.RtB_Buffs.Longer>=1 and al()<5 and O.RtBRemains()<=39 then e.APLVar.RtB_Reroll=true end;if h:FilteredTimeToDie("<",12)or d.BossFilteredFightRemains("<",12)then e.APLVar.RtB_Reroll=false end end end;return e.APLVar.RtB_Reroll end;local function aq()return Z>=O.CPMaxSpend()-1-aa(g:StealthUp(true,true)and Q.Crackshot:IsAvailable())end;local function ar()return(Q.HiddenOpportunity:IsAvailable()or a0>=2+aa(Q.ImprovedAmbush:IsAvailable())+aa(g:BuffUp(Q.Broadside)))and a1>=50 end;local function as()return P.Commons.VanishOffensive and n()and not(N.IsSoloMode()and g:IsTanking(h))end;local function at()return not Q.ShadowDanceTalent:IsAvailable()and Q.FanTheHammer:TalentRank()+aa(Q.QuickDraw:IsAvailable())+aa(Q.Audacity:IsAvailable())<aa(Q.CountTheOdds:IsAvailable())+aa(Q.KeepItRolling:IsAvailable())end;local function au()return g:BuffUp(Q.BetweentheEyes)and(not Q.HiddenOpportunity:IsAvailable()or g:BuffDown(Q.AudacityBuff)and(Q.FanTheHammer:TalentRank()<2 or g:BuffDown(Q.Opportunity)))and not Q.Crackshot:IsAvailable()end;local function av()if not s and P.Commons.VanishOffensive and Q.Vanish:IsCastable()and as()and Q.HiddenOpportunity:IsAvailable()and not Q.Crackshot:IsAvailable()and not g:BuffUp(Q.Audacity)and(at()or g:BuffStack(Q.Opportunity)<6)and ar()then if l.Cast(Q.Vanish,nil)then a7=1856;return"Cast Vanish (HO)"end end;if Q.Vanish:IsCastable()and as()and(not Q.HiddenOpportunity:IsAvailable()or Q.Crackshot:IsAvailable())and aq()then if l.Cast(Q.Vanish,nil)then a7=1856;return"Cast Vanish (Finish)"end end;if Q.ShadowDance:IsAvailable()and Q.ShadowDance:IsCastable()and Q.Crackshot:IsAvailable()and aq()and Q.Vanish:CooldownRemains()>=6 and o then if l.Cast(Q.ShadowDance,nil)then a7=185313;return"Cast Shadow Dance"end end;if Q.ShadowDance:IsAvailable()and Q.ShadowDance:IsCastable()and not Q.KeepItRolling:IsAvailable()and au()and g:BuffUp(Q.SliceandDice)and(aq()or Q.HiddenOpportunity:IsAvailable())and(not Q.HiddenOpportunity:IsAvailable()or not Q.Vanish:IsReady())then if l.Cast(Q.ShadowDance,nil)then a7=185313;return"Cast Shadow Dance"end end;if Q.ShadowDance:IsAvailable()and Q.ShadowDance:IsCastable()and Q.KeepItRolling:IsAvailable()and au()and(Q.KeepItRolling:CooldownRemains()<=30 or Q.KeepItRolling:CooldownRemains()>=120 and(aq()or Q.HiddenOpportunity:IsAvailable()))then if l.Cast(Q.ShadowDance,nil)then a7=185313;return"Cast Shadow Dance"end end;if Q.Shadowmeld:IsAvailable()and Q.Shadowmeld:IsReady()and P.Commons.Racials then if Q.Crackshot:IsAvailable()and aq()or not Q.Crackshot:IsAvailable()and(Q.CountTheOdds:IsAvailable()and aq()or Q.HiddenOpportunity:IsAvailable())then if l.Cast(Q.Shadowmeld,nil)then a7=58984;return"Cast Shadowmeld"end end end end;local function aw()if n()and Q.AdrenalineRush:IsCastable()and(not g:BuffUp(Q.AdrenalineRush)or g:StealthUp(true,true)and Q.Crackshot:IsAvailable()and Q.ImprovedAdrenalineRush:IsAvailable())and(_<=2 or not Q.ImprovedAdrenalineRush:IsAvailable())then if l.Cast(Q.AdrenalineRush,nil)then a7=13750;return"Cast Adrenaline Rush"end end;if Q.BladeFlurry:IsReady()then local ax=V+aa(g:BuffUp(Q.Broadside))if V>=2-aa(Q.UnderhandedUpperhand:IsAvailable())and not g:StealthUp(true,false)and g:BuffRemains(Q.BladeFlurry)<g:GCDRemains()or Q.DeftManeuvers:IsAvailable()and V>=3 and ax>=a0 and not aq()then if l.Cast(Q.BladeFlurry)then a7=13877;return"Cast Blade Flurry"end end end;if Q.RolltheBones:IsReady()then local ay=not g:StealthUp(true,true)or not Q.Crackshot:IsAvailable()if ay and(ap()or O.RtBRemains()<=aa(g:HasTier(31,4))+aa(Q.ShadowDance:CooldownRemains()<=1 or Q.Vanish:CooldownRemains()<=1)*6)then if l.Cast(Q.RolltheBones)then a7=315508;return"Cast Roll the Bones"end end end;if Q.KeepItRolling:IsReady()and not ap()and al()>=3+aa(g:HasTier(31,4))and(g:BuffDown(Q.ShadowDance)or al()>=6)then if l.Cast(Q.KeepItRolling,nil)then a7=381989;return"Cast Keep it Rolling"end end;if Q.GhostlyStrike:IsAvailable()and Q.GhostlyStrike:IsReady()then if l.Cast(Q.GhostlyStrike,nil)then a7=196937;return"Cast Ghostly Strike"end end;if n()and Q.Sepsis:IsAvailable()and Q.Sepsis:IsReady()then if Q.Crackshot:IsAvailable()and Q.BetweentheEyes:IsReady()and aq()and not g:StealthUp(true,true)or not Q.Crackshot:IsAvailable()and h:FilteredTimeToDie(">",11)and g:BuffUp(Q.BetweentheEyes)or d.BossFilteredFightRemains("<",11)then if l.Cast(Q.Sepsis,nil)then a7=328305;return"Cast Sepsis"end end end;if Q.BladeRush:IsReady()and h:IsSpellInRange(Q.SinisterStrike)and a4>4 and not g:StealthUp(true,true)then if l.Cast(Q.BladeRush,nil)then a7=271877;return"Cast Blade Rush"end end;if not g:StealthUp(true,true,true)then W=av()if W then return W end end;if n()and Q.ThistleTea:IsCastable()and not g:BuffUp(Q.ThistleTea)and(a3>=100 or d.BossFilteredFightRemains("<",Q.ThistleTea:Charges()*6))then if l.Cast(Q.ThistleTea,nil)then a7=381623;return"Cast Thistle Tea"end end;if P.Commons.Enabled.Potions then local az=N.PotionSelected()if az then if az:IsReady()and n()and r and(g:BloodlustUp()and l.GUISettings.General.HoldPotforBL or(g:BloodlustUp()or d.BossFightRemains()<=60 or g:BuffUp(Q.AdrenalineRush))and not l.GUISettings.General.HoldPotforBL)then if l.Cast(az,nil)then a7=50;return"potion cooldowns 2"end end end end;if Q.BloodFury:IsCastable()then if l.Cast(Q.BloodFury,nil)then a7=20572;return"Cast Blood Fury"end end;if Q.Berserking:IsCastable()then if l.Cast(Q.Berserking,nil)then a7=26297;return"Cast Berserking"end end;if Q.Fireblood:IsCastable()then if l.Cast(Q.Fireblood,nil)then a7=265221;return"Cast Fireblood"end end;if Q.AncestralCall:IsCastable()then if l.Cast(Q.AncestralCall,nil)then a7=274738;return"Cast Ancestral Call"end end;local aA=g:GetUseableTrinkets(S)if aA and n()and not g:StealthUp(true,true)or d.BossFilteredFightRemains("<",10)then if aA then if l.Cast(aA,nil,nil)then if aA:ID()==GetInventoryItemID("player",13)and P.Commons.Enabled.TopTrinket then a7=24;return"Generic use_items for "..aA:Name()elseif aA:ID()==GetInventoryItemID("player",14)and P.Commons.Enabled.BottomTrinket then a7=25;return"Generic use_items for "..aA:Name()end end end end end;local function aB()if Q.BladeFlurry:IsReady()and Q.BladeFlurry:IsCastable()and m()and Q.Subterfuge:IsAvailable()and Q.HiddenOpportunity:IsAvailable()and V>=2 and g:BuffRemains(Q.BladeFlurry)<=g:GCDRemains()then if l.Cast(Q.BladeFlurry)then a7=13877;return"Cast Blade Flurry"end end;if Q.ColdBlood:IsCastable()and g:BuffDown(Q.ColdBlood)and h:IsSpellInRange(Q.Dispatch)and aq()then if l.Cast(Q.ColdBlood,nil)then a7=382245;return"Cast Cold Blood"end end;if Q.BetweentheEyes:IsCastable()and h:IsSpellInRange(Q.BetweentheEyes)and aq()and Q.Crackshot:IsAvailable()then if l.CastPooling(Q.BetweentheEyes)then a7=315341;return"Cast Between the Eyes"end end;if Q.Dispatch:IsCastable()and h:IsSpellInRange(Q.Dispatch)and aq()then if l.CastPooling(Q.Dispatch)then a7=2098;return"Cast Dispatch"end end;if Q.PistolShot:IsCastable()and h:IsSpellInRange(Q.PistolShot)and Q.Crackshot:IsAvailable()and Q.FanTheHammer:TalentRank()>=2 and g:BuffStack(Q.Opportunity)>=6 and(g:BuffUp(Q.Broadside)and _<=1 or g:BuffUp(Q.GreenskinsWickersBuff))then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot"end end;if Q.Ambush:IsCastable()and h:IsSpellInRange(Q.Ambush)and Q.HiddenOpportunity:IsAvailable()then if l.CastPooling(Q.Ambush)then a7=8676;return"Cast Ambush"end end end;local function aC()if Q.BetweentheEyes:IsCastable()and h:IsSpellInRange(Q.BetweentheEyes)and not Q.Crackshot:IsAvailable()and(g:BuffRemains(Q.BetweentheEyes)<4 or Q.ImprovedBetweenTheEyes:IsAvailable()or Q.GreenskinsWickers:IsAvailable()or g:HasTier(30,4))and g:BuffDown(Q.GreenskinsWickers)then if l.CastPooling(Q.BetweentheEyes)then a7=315341;return"Cast Between the Eyes"end end;if Q.BetweentheEyes:IsCastable()and h:IsSpellInRange(Q.BetweentheEyes)and Q.Crackshot:IsAvailable()and(Q.Vanish:CooldownRemains()>45 and Q.ShadowDance:CooldownRemains()>12)then if l.CastPooling(Q.BetweentheEyes)then a7=315341;return"Cast Between the Eyes"end end;if Q.SliceandDice:IsCastable()and(d.FilteredFightRemains(U,">",g:BuffRemains(Q.SliceandDice),true)or g:BuffRemains(Q.SliceandDice)==0)and g:BuffRemains(Q.SliceandDice)<(1+_)*1.8 then if l.CastPooling(Q.SliceandDice)then a7=315496;return"Cast Slice and Dice"end end;if Q.KillingSpree:IsCastable()and h:IsSpellInRange(Q.KillingSpree)and(h:DebuffUp(Q.GhostlyStrike)or not Q.GhostlyStrike:IsAvailable())then if l.Cast(Q.KillingSpree)then a7=51690;return"Cast Killing Spree"end end;if Q.ColdBlood:IsCastable()and g:BuffDown(Q.ColdBlood)and h:IsSpellInRange(Q.Dispatch)then if l.Cast(Q.ColdBlood,nil)then a7=382245;return"Cast Cold Blood"end end;if Q.Dispatch:IsCastable()and h:IsSpellInRange(Q.Dispatch)then if l.CastPooling(Q.Dispatch)then a7=2098;return"Cast Dispatch"end end end;local function aD()if n()and Q.EchoingReprimand:IsReady()then if l.Cast(Q.EchoingReprimand,nil,nil)then a7=323547;return"Cast Echoing Reprimand"end end;if Q.Ambush:IsCastable()and Q.HiddenOpportunity:IsAvailable()and g:BuffUp(Q.AudacityBuff)then if l.CastPooling(Q.Ambush)then a7=8676;return"Cast Ambush (High-Prio Buffed)"end end;if Q.FanTheHammer:IsAvailable()and Q.Audacity:IsAvailable()and Q.HiddenOpportunity:IsAvailable()and g:BuffUp(Q.Opportunity)and g:BuffDown(Q.AudacityBuff)then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot (Audacity)"end end;if g:BuffUp(Q.GreenskinsWickersBuff)and(not Q.FanTheHammer:IsAvailable()and g:BuffUp(Q.Opportunity)or g:BuffRemains(Q.GreenskinsWickersBuff)<1.5)then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot (GSW Dump)"end end;if Q.FanTheHammer:IsAvailable()and g:BuffUp(Q.Opportunity)and(g:BuffStack(Q.Opportunity)>=6 or g:BuffRemains(Q.Opportunity)<2)then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot (FtH Dump)"end end;if Q.FanTheHammer:IsAvailable()and g:BuffUp(Q.Opportunity)and a0>1+aa(Q.QuickDraw:IsAvailable())*Q.FanTheHammer:TalentRank()and(not Q.Vanish:IsReady()and not Q.ShadowDance:IsReady()or g:StealthUp(true,true)or not Q.Crackshot:IsAvailable()or Q.FanTheHammer:TalentRank()<=1)then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot"end end;if not Q.FanTheHammer:IsAvailable()and g:BuffUp(Q.Opportunity)and(a4>1.5 or a0<=1+aa(g:BuffUp(Q.Broadside))or Q.QuickDraw:IsAvailable()or Q.Audacity:IsAvailable()and g:BuffDown(Q.AudacityBuff))then if l.CastPooling(Q.PistolShot)then a7=185763;return"Cast Pistol Shot"end end;if Q.SinisterStrike:IsCastable()and h:IsSpellInRange(Q.SinisterStrike)then if l.CastPooling(Q.SinisterStrike)then a7=193315;return"Cast Sinister Strike"end end end;local function aE()p=HeroRotationCharDB.Toggles[5]o=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[12]r=not HeroRotationCharDB.Toggles[15]s=HeroRotationCharDB.Toggles[21]u=HeroRotationCharDB.Toggles[22]v=HeroRotationCharDB.Toggles[23]w=HeroRotationCharDB.Toggles[24]x=HeroRotationCharDB.Toggles[25]y=HeroRotationCharDB.Toggles[27]z=HeroRotationCharDB.Toggles[50]A=HeroRotationCharDB.Toggles[51]t=HeroRotationCharDB.Toggles[52]B=HeroRotationCharDB.Toggles[53]C=HeroRotationCharDB.Toggles[30]D=HeroRotationCharDB.Toggles[54]L=GetInventoryItemID("player",13)M=GetInventoryItemID("player",14)if not P.Commons.Enabled.TopTrinket and not P.Commons.Enabled.BottomTrinket then S={L,M}elseif not P.Commons.Enabled.TopTrinket and P.Commons.Enabled.BottomTrinket then S={L}elseif not P.Commons.Enabled.BottomTrinket and P.Commons.Enabled.TopTrinket then S={M}end;E=0;for an=1,20 do if select(10,UnitDebuff("player",an))==240447 then if select(6,UnitDebuff("player",an))~=nil then E=select(6,UnitDebuff("player",an))-GetTime()end end end end;U=g:GetEnemiesInRange(X,Q.SinisterStrike)local function aF()X=Q.AcrobaticStrikes:IsAvailable()and 10 or 6;_=g:ComboPoints()Z=O.EffectiveComboPoints(_)a0=g:ComboPointsDeficit()a5=g:BuffUp(Q.AdrenalineRush,nil,true)and-50 or 0;a1=ai()a2=g:EnergyRegen()a4=af(a5)a3=g:EnergyDeficitPredicted(nil,a5)if m()then T=g:GetEnemiesInRange(30)U=g:GetEnemiesInRange(X)V=#U else V=1 end;W=aE()if l.QueuedCast()then a7=l.QueuedCast()return"Custom Queue "..i(a7):ID()end;if W then return W end;if a8>0 then a8=0 end;if a7>0 then a7=0 end;a7=O.ReturnSpell()a8=O.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then J=GetTime()K=J+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and K~=nil and GetTime()>K and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if B and Q.GrapplingHook:IsUsableP()and Q.GrapplingHook:CooldownRemains(BypassRecovery)<=0 then if l.Cast(Q.GrapplingHook,nil,nil,nil)then a7=195457;return"queue Grappling Hook"end elseif(not Q.GrapplingHook:IsUsableP()or Q.GrapplingHook:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[53]=not HeroRotationCharDB.Toggles[53]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[53]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if u and Q.CheapShot:IsUsableP()and Q.CheapShot:CooldownRemains(BypassRecovery)<=0 and(g:StealthUp(true,true)or g:BuffUp(Q.VanishBuff))and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(Q.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.CheapShot)then a8=18335;return"queue Cheap Shot MO"else a7=1833;return"queue Cheap Shot"end end elseif(not Q.CheapShot:IsUsableP()or Q.CheapShot:CooldownRemains()>0)and u then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and Q.KidneyShot:IsUsableP()and Q.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(Q.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.KidneyShot)then a8=4085;return"queue Kidney Shot MO"else a7=408;return"queue Kidney Shot"end end elseif(not Q.KidneyShot:IsUsableP()or Q.KidneyShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and Q.Blind:IsUsableP()and Q.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(Q.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Blind)then a8=20945;return"queue Blind MO"end end elseif(not Q.Blind:IsUsableP()or Q.Blind:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and Q.Sap:IsUsableP()and Q.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(Q.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Sap)then a8=67705;return"queue Sap MO"else a7=6770;return"queue Sap"end end elseif(not Q.Sap:IsUsableP()or Q.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and x then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and Q.Feint:IsUsableP()and Q.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Feint,nil,nil,nil)then a7=202;return"queue Feint"end elseif(not Q.Feint:IsUsableP()or Q.Feint:CooldownRemains()>0 or not g:AffectingCombat())and y then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and Q.BladeRush:IsUsableP()and Q.BladeRush:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.BladeRush,nil,nil,nil)then a7=271877;return"queue BladeRush"end elseif(not Q.BladeRush:IsUsableP()or Q.BladeRush:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[51]=not HeroRotationCharDB.Toggles[51]l.Print("BladeRush que is now "..(HeroRotationCharDB.Toggles[51]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and Q.Gouge:IsUsableP()and Q.Gouge:CooldownRemains(BypassRecovery)<=0 then if l.Cast(Q.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Gouge)then a8=17765;return"queue Gouge MO"elseif f("target"):IsSpellInRange(Q.Gouge)then a7=1776;return"queue Gouge"end end elseif(not Q.Gouge:IsUsableP()or Q.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if C then if Q.ArcaneTorrent:IsAvailable()and Q.ArcaneTorrent:IsUsableP()and Q.ArcaneTorrent:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.ArcaneTorrent,nil,nil,nil)then a7=155145;return"queue ArcaneTorrent Queue"end elseif Q.LightsJudgment:IsAvailable()and Q.LightsJudgment:IsUsableP()and Q.LightsJudgment:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.LightsJudgment,nil,nil,nil)then a7=255647;return"queue LightsJudgment Queue"end elseif Q.BagofTricks:IsAvailable()and Q.BagofTricks:IsUsableP()and Q.BagofTricks:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.BagofTricks,nil,nil,nil)then a7=312411;return"queue BagofTricks Queue"end elseif Q.BloodFury:IsAvailable()and Q.BloodFury:IsUsableP()and Q.BloodFury:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.BloodFury,nil,nil,nil)then a7=20572;return"queue BloodFury Queue"end elseif Q.Berserking:IsAvailable()and Q.Berserking:IsUsableP()and Q.Berserking:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Berserking,nil,nil,nil)then a7=26297;return"queue Berserking Queue"end elseif Q.Fireblood:IsAvailable()and Q.Fireblood:IsUsableP()and Q.Fireblood:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Fireblood,nil,nil,nil)then a7=265221;return"queue Fireblood Queue"end elseif Q.AncestralCall:IsAvailable()and Q.AncestralCall:IsUsableP()and Q.AncestralCall:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.AncestralCall,nil,nil,nil)then a7=274738;return"queue AncestralCall Queue"end elseif(Q.ArcaneTorrent:IsAvailable()and(not Q.ArcaneTorrent:IsUsableP()or Q.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or Q.LightsJudgment:IsAvailable()and(not Q.LightsJudgment:IsUsableP()or Q.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or Q.BagofTricks:IsAvailable()and(not Q.BagofTricks:IsUsableP()or Q.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or Q.BloodFury:IsAvailable()and(not Q.BloodFury:IsUsableP()or Q.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or Q.Berserking:IsAvailable()and(not Q.Berserking:IsUsableP()or Q.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or Q.Fireblood:IsAvailable()and(not Q.Fireblood:IsUsableP()or Q.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or Q.AncestralCall:IsAvailable()and(not Q.AncestralCall:IsUsableP()or Q.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and C then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]l.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;if g:IsChanneling(i(324631))then if l.Cast(Q.PoolEnergy,nil,nil,nil)then a7=99999;return"channeling Fleashcraft"end end;W=O.CrimsonVial()if W then return W end;W=O.Feint()if W then return W end;W=O.Evasion()if W then return W end;if g:HealthPercentage()<P.Commons.PhialHP and R.PhialofSerenity:IsReady()and R.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(R.PhialofSerenity,nil)then a7=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<P.Commons.HealthstoneHP and R.Healthstone:IsReady()and R.Healthstone:CooldownRemains()<=0 then if l.Cast(R.Healthstone,nil)then a7=40;return"Healthstone HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.CosmicHealPot:IsReady()and R.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(R.CosmicHealPot,nil)then a7=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.HealPotL:IsReady()and R.HealPotL:CooldownRemains()<=0 then if l.Cast(R.HealPotL,nil)then a7=41;return"HealPot LOW HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.HealPotM:IsReady()and R.HealPotM:CooldownRemains()<=0 then if l.Cast(R.HealPotM,nil)then a7=41;return"HealPot MEDIUM HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.HealPotH:IsReady()and R.HealPotH:CooldownRemains()<=0 then if l.Cast(R.HealPotH,nil)then a7=41;return"HealPot HIGH HP"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if Q.PistolShot:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(Q.PistolShot,nil)then a8=1185763;return"explosive MO Pistol"end end end;if Q.PistolShot:IsCastable()and f("target"):IsInMeleeRange(40)and string.find(UnitGUID("target"),120651)then if l.Cast(Q.PistolShot,nil)then a7=185763;return"explosive Tar Pistol"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),408801)then if Q.Blind:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(Q.Blind,nil)then a8=20945;return"blind MO incorporeal affix"end end end;F={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,158337,412695,355782,333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,257260,322433,334324,317936,327332,328288,343470,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133,158337,164426,382555}if UnitExists("target")and Q.Shiv:IsReady()and not D then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for an=0,10 do local aG,aG,aH,aI,aJ,aK,aG,aG,aG,aL=UnitBuff("target",an)for aG,aM in pairs(F)do if aM==aL and aK-aJ+500/1000<=GetTime()then if l.Cast(Q.Shiv,nil)then a7=5938;return"Shiv Enrage"end end end end end end;local aN=g:AffectingCombat()and 180 or 900;local aO;if not g:AffectingCombat()then if i(8679):IsAvailable()and P.Commons.LethalPoison=="Wound Poison"then aO=g:BuffRemains(i(8679))if aO<aN and not g:IsCasting(i(8679))then if l.Cast(i(8679))then a7=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and P.Commons.LethalPoison=="Deadly Poison"then aO=g:BuffRemains(i(2823))if aO<aN and not g:IsCasting(i(2823))then if l.Cast(i(2823))then a7=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and P.Commons.LethalPoison=="Instant Poison"then aO=g:BuffRemains(i(315584))if aO<aN and not g:IsCasting(i(315584))then if l.Cast(i(315584))then a7=205;return"Instant Poison Refresh"end end end end;aO=g:BuffRemains(i(381637))if i(381637):IsAvailable()and P.Commons.NonLethalPoison=="Atrophic Poison"then if aO<aN and not g:IsCasting(i(381637))then if l.Cast(i(381637))then a7=381637;return"Antropic Poison Refresh"end end elseif i(5761):IsAvailable()and P.Commons.NonLethalPoison=="Numbing Poison"then aO=g:BuffRemains(i(5761))if aO<aN and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then a7=204;return"Numbing Poison Refresh"end end elseif i(3408):IsAvailable()and P.Commons.NonLethalPoison=="Crippling Poison"then aO=g:BuffRemains(i(3408))if aO<aN and not g:IsCasting(NumbingPoison)then if l.Cast(i(3408))then a7=206;return"Crippling Poison Refresh"end end end;if not g:BuffUp(Q.VanishBuff)and not g:AffectingCombat()and not g:StealthUp(true,true)then W=O.Stealth(Q.Stealth)if W then return W end end;if not g:AffectingCombat()and Q.Vanish:TimeSinceLastCast()>1 then if Q.BladeFlurry:IsReady()and g:BuffDown(Q.BladeFlurry)and Q.UnderhandedUpperhand:IsAvailable()and not g:StealthUp(true,true)and ac()then if l.Cast(Q.BladeFlurry)then a7=13877;return"Blade Flurry (Opener)"end end;if not g:StealthUp(true,false)then W=O.Stealth(O.StealthSpell())if W then return W end end;if N.TargetIsValid()and(not g:AffectingCombat()and p)then if n()and Q.MarkedforDeath:IsCastable()and a0>=O.CPMaxSpend()-1 and h:NPCID()~=170234 then if P.Commons.STMfDAsDPSCD then if l.Cast(Q.MarkedforDeath,nil)then a7=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(Q.MarkedforDeath,nil)then a7=137619;return"Cast Marked for Death (OOC)"end end end;if Q.AdrenalineRush:IsReady()and Q.ImprovedAdrenalineRush:IsAvailable()and _<=2 and not Q.LoadedDiceBuff:IsAvailable()then if l.Cast(Q.AdrenalineRush)then a7=13750;return"Cast Adrenaline Rush (Opener)"end end;if Q.RolltheBones:IsReady()and not g:DebuffUp(Q.Dreadblades)and(al()==0 or ap())then if l.Cast(Q.RolltheBones)then a7=315508;return"Cast Roll the Bones (Opener)"end end;if Q.AdrenalineRush:IsReady()and Q.ImprovedAdrenalineRush:IsAvailable()and _<=2 and Q.LoadedDiceBuff:IsAvailable()then if l.Cast(Q.AdrenalineRush)then a7=13750;return"Cast Adrenaline Rush (Opener)"end end;if Q.SliceandDice:IsReady()and g:BuffRemains(Q.SliceandDice)<(1+_)*1.8 then if l.CastPooling(Q.SliceandDice)then a7=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,false)or g:BuffUp(Q.VanishBuff)then W=aB()if W then return"Stealth (Opener): "..W end;if Q.KeepItRolling:IsAvailable()and Q.GhostlyStrike:IsAvailable()and Q.EchoingReprimand:IsAvailable()then if l.Cast(Q.GhostlyStrike)then a7=196937;return"Cast Ghostly Strike KiR (Opener)"end end;if Q.Ambush:IsCastable()then if l.Cast(Q.Ambush)then a7=8676;return"Cast Ambush (Opener)"end end elseif aq()then W=aC()if W then return"Finish (Opener): "..W end end;if Q.SinisterStrike:IsCastable()then if l.Cast(Q.SinisterStrike)then a7=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if Q.FanTheHammer:IsAvailable()and Q.PistolShot:TimeSinceLastCast()<g:GCDRemains()then _=H(_,O.FanTheHammerCP())end;if N.TargetIsValid()and(g:AffectingCombat()or p or g:BuffUp(Q.VanishBuff))and not h:DebuffUp(i(1776))and not h:DebuffUp(i(6770))then if g:BuffUp(Q.Stealth)or g:BuffUp(Q.VanishBuff)or g:BuffUp(Q.Shadowmeld)then W=aB()if W then return"Stealth: "..W end end;local aP,aQ,aG=GetSpellCooldown(57934)if P.Commons.AutoToT then if aP+aQ-GetTime()<=0 and Q.TricksoftheTrade:IsAvailable()and Q.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))then if l.Cast(Q.TricksoftheTrade)then a7=207;return"ToT Focus"end end end;W=aw()if W then return"CDs: "..W end;if g:StealthUp(true,true)then W=aB()if W then return"Stealth: "..W end end;if aq()then W=aC()if W then return"Finish: "..W end;l.Cast(Q.PoolEnergy)return"Finish Pooling"end;W=aD()if W then return"Build: "..W end;if Q.ArcaneTorrent:IsCastable()and P.Commons.Enabled.Racials and n()and h:IsSpellInRange(Q.SinisterStrike)and a3>15+a2 then if l.Cast(Q.ArcaneTorrent,nil)then a7=155145;return"Cast Arcane Torrent"end end;if Q.ArcanePulse:IsCastable()and P.Commons.Enabled.Racials and n()and h:IsSpellInRange(Q.SinisterStrike)then if l.Cast(Q.ArcanePulse)then a7=260364;return"Cast Arcane Pulse"end end;if Q.LightsJudgment:IsCastable()and P.Commons.Enabled.Racials and n()and h:IsInMeleeRange(5)then if l.Cast(Q.LightsJudgment,nil)then a7=255647;return"Cast Lights Judgment"end end;if Q.BagofTricks:IsCastable()and P.Commons.Enabled.Racials and n()and h:IsInMeleeRange(5)then if l.Cast(Q.BagofTricks,nil)then a7=312411;return"Cast Bag of Tricks"end end;if Q.PistolShot:IsCastable()and h:IsSpellInRange(Q.PistolShot)and not h:IsInRange(X)and not g:StealthUp(true,true)and a3<25 and(a0>=1 or a4<=1.2)then if l.Cast(Q.PistolShot)then a7=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aR()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpellOut()if a7==0 then return 0 else return a7 end end;function ReturnSpellMOOut()if a8==0 then return 0 else return a8 end end;l.SetAPL(260,aF,aR)