local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[21]local u=HeroRotationCharDB.Toggles[52]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[27]local A=HeroRotationCharDB.Toggles[50]local B=HeroRotationCharDB.Toggles[51]local C=HeroRotationCharDB.Toggles[53]local D=HeroRotationCharDB.Toggles[30]local E=HeroRotationCharDB.Toggles[54]local F=0;local G=math.min;local H=math.abs;local I=nil;local J=nil;local K=GetInventoryItemID("player",13)local L=GetInventoryItemID("player",14)local M=l.Commons.Everyone;local N=l.Commons.Rogue;local O={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local P=i.Rogue.Outlaw;local Q=k.Rogue.Outlaw;local R={Q.ComputationDevice:ID(),Q.VigorTrinket:ID(),Q.FontOfPower:ID(),Q.RazorCoral:ID(),Q.CacheOfAcquiredTreasures:ID(),Q.MistcallerOcarina:ID()}P.Dispatch:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*N.CPSpend()*0.35*1.13*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(P.GhostlyStrike)and 1.1 or 1)*(h:DebuffUp(P.SinfulRevelationDebuff)and 1.06 or 1)end)local S,T,U;local V;local W=N.ReturnSpell()local X=N.ReturnSpellMO()local Y=6;local Z;local _,a0,a1;local a2={{P.Blind,"Cast Blind (Interrupt)",function()return true end}}local a3=g:HasLegendaryEquipped(116)local a4=g:HasLegendaryEquipped(117)local a5=g:HasLegendaryEquipped(129)local a6=g:HasLegendaryEquipped(114)d:RegisterForEvent(function()a5=g:HasLegendaryEquipped(129)a3=g:HasLegendaryEquipped(116)a4=g:HasLegendaryEquipped(117)a6=g:HasLegendaryEquipped(114)end,"PLAYER_EQUIPMENT_CHANGED")local a7=g:Covenant()d:RegisterForEvent(function()a7=g:Covenant()end,"COVENANT_CHOSEN")local function a8(a9)if a9 then return 1 else return 0 end end;local aa,ab=0,0;local function ac()local ad=g:EnergyTimeToMaxPredicted()if H(aa-ad)>1 then aa=ad end;return aa end;local function ae()local af=g:EnergyPredicted()if H(ab-af)>9 then ab=af end;return ab end;local function ag(a0)_=a0;if a0==2 and g:BuffUp(P.EchoingReprimand2)or a0==3 and g:BuffUp(P.EchoingReprimand3)or a0==4 and g:BuffUp(P.EchoingReprimand4)or a0==5 and g:BuffUp(P.EchoingReprimand5)then _=7;return 7 else _=a0;return a0 end;local ah,ai=UnitAttackSpeed("unit")local aj=(ah+ai)/2;local ak=aj/2;local al=(4-meleeswings)*ak;local am=(5-meleeswings)*ak;if _>a0 and a1>2 and g:AffectingCombat()then if a0==2 and not g:BuffUp(P.EchoingReprimand3)or a0==3 and not g:BuffUp(P.EchoingReprimand4)or a0==4 and not g:BuffUp(P.EchoingReprimand5)then local an=al;if an==0 then an=am end;if an<mathmax(g:EnergyTimeToX(35),g:GCDRemains())+0.5 then _=a0 end end end end;local function ao(ap)return ap:TimeToDie()end;local function aq(ap)if(ap:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=N.CPMaxSpend()-1)and ap:GUID()==f("mouseover"):GUID()and O.Outlaw.TargetSwap=="Mouseover"then X=1376195;return true elseif(ap:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=N.CPMaxSpend()-1)and O.Outlaw.TargetSwap=="AutoSwap"and ap:GUID()~=h:GUID()and not r then X=999;return true elseif(ap:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=N.CPMaxSpend()-1)and ap:GUID()==h:GUID()then W=137619;return true elseif ap:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=N.CPMaxSpend()-1 then return true end end;local ar={P.Broadside,P.BuriedTreasure,P.GrandMelee,P.RuthlessPrecision,P.SkullandCrossbones,P.TrueBearing}local function as(at,au)if not e.APLVar.RtB_List then e.APLVar.RtB_List={}end;if not e.APLVar.RtB_List[at]then e.APLVar.RtB_List[at]={}end;local av=table.concat(au)if at=="All"then if not e.APLVar.RtB_List[at][av]then local aw=0;for ax=1,#au do if g:BuffUp(ar[au[ax]])then aw=aw+1 end end;e.APLVar.RtB_List[at][av]=aw==#au and true or false end else if not e.APLVar.RtB_List[at][av]then e.APLVar.RtB_List[at][av]=false;for ax=1,#au do if g:BuffUp(ar[au[ax]])then e.APLVar.RtB_List[at][av]=true;break end end end end;return e.APLVar.RtB_List[at][av]end;local function ay()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs=0;for ax=1,#ar do if g:BuffUp(ar[ax])then e.APLVar.RtB_Buffs=e.APLVar.RtB_Buffs+1 end end end;return e.APLVar.RtB_Buffs end;local function az()if not e.APLVar.RtB_Reroll then if O.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=ay()<=0 and true or false elseif O.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(P.Broadside)and true or false elseif O.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(P.BuriedTreasure)and true or false elseif O.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(P.GrandMelee)and true or false elseif O.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(P.SkullandCrossbones)and true or false elseif O.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(P.RuthlessPrecision)and true or false elseif O.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(P.TrueBearing)and true or false else e.APLVar.RtB_Reroll=ay()<2 and(not g:BuffUp(P.TrueBearing)and not g:BuffUp(P.Broadside))and true or false end;if M.IsSoloMode()then if g:BuffUp(P.GrandMelee)then if g:IsTanking(h)or g:HealthPercentage()<G(O.Outlaw.RolltheBonesLeechKeepHP,O.Outlaw.RolltheBonesLeechRerollHP)then e.APLVar.RtB_Reroll=false end elseif g:HealthPercentage()<O.Outlaw.RolltheBonesLeechRerollHP then e.APLVar.RtB_Reroll=true end end end;return e.APLVar.RtB_Reroll end;local function aA()if P.BetweentheEyes:CooldownUp()and _<5 then return false end;return a0>=N.CPMaxSpend()-a8(g:BuffUp(P.Broadside))-a8(g:BuffUp(P.Opportunity))*a8(P.QuickDraw:IsAvailable())or _>=N.CPMaxSpend()end;local function aB()return a1>=2+a8(g:BuffUp(P.Broadside))and _<N.CPMaxSpend()and ae()>50 and(not P.CountTheOdds:ConduitEnabled()or N.RtBRemains()>10)end;local function aC()return not m()or U<2 or g:BuffRemains(P.BladeFlurry)>1+a8(P.KillingSpree:IsAvailable())end;local function aD()return O.Commons.VanishOffensive and n()and not(M.IsSoloMode()and g:IsTanking(h))end;local function aE()if P.BladeFlurry:IsReady()and m()and U>=2 and not g:BuffUp(P.BladeFlurry)then if l.Cast(P.BladeFlurry)then W=13877;return"Cast Blade Flurry"end end;if h:IsSpellInRange(P.SinisterStrike)then if P.Vanish:IsCastable()and aD()and not g:StealthUp(true,true)then if not a4 then if aB()and not t and not a4 and not a6 and aB()and not g:StealthUp(true,true)and(not a5 or g:BuffDown(P.DeathlyShadowsBuff)and a0<=2)then if l.Cast(P.Vanish,nil)then W=1856;return"Cast Vanish"end end else if N.MasterAssassinsMarkRemains()<=0 and a4 and not t and O.Commons.VanishOffensive and aC()then if P.MarkedforDeath:IsAvailable()then if aA()then if l.Cast(P.Vanish,nil)then W=1856;return"Cast Vanish (MA+MfD)"end end else if not t and a4 and O.Commons.VanishOffensive(not P.BetweentheEyes:CooldownUp()and aA()or P.BetweentheEyes:CooldownUp()and aB())then if l.Cast(P.Vanish,nil)then W=1856;return"Cast Vanish (MA)"end end end end end end;if n()and P.AdrenalineRush:IsCastable()and not g:BuffUp(P.AdrenalineRush)then if l.Cast(P.AdrenalineRush,nil)then W=13750;return"Cast Adrenaline Rush"end end;if P.Fleshcraft:IsCastable()and(F==0 or F>P.Fleshcraft:ExecuteTime())and o and O.Outlaw.CastCancelFC and not g:StealthUp(true,true)and(P.PustuleEruption:SoulbindEnabled()or P.VolatileSolvent:SoulbindEnabled())and(not g:BuffUp(P.BladeFlurry)or U<2)and(not g:BuffUp(P.AdrenalineRush)or ac()>2)then if l.Cast(P.Fleshcraft,nil)then W=324631;return"Cast Fleashcraft"end end;if n()and P.Flagellation:IsReady()and o and not g:StealthUp(true,true)and not h:DebuffUp(P.Flagellation)and(aA()or(h:FilteredTimeToDie(">",12)or h:IsInBossList()))then if l.Cast(P.Flagellation,nil,nil)then W=323654;return"Cast Flagellation"end end;if P.Dreadblades:IsReady()and h:IsSpellInRange(P.Dreadblades)and not g:StealthUp(true,true)and a0<=2 and(a7~="Venthyr"or P.Flagellation:AnyDebuffUp())and(not P.MarkedforDeath:IsAvailable()or P.MarkedforDeath:CooldownRemains()>0)then if l.Cast(P.Dreadblades,nil)then W=343142;return"Cast Dreadblades"end end;if P.RolltheBones:IsReady()and N.MasterAssassinsMarkRemains()<=0 and not g:BuffUp(P.Dreadblades)and(N.RtBRemains()<=3 or az())then if l.Cast(P.RolltheBones)then W=315508;return"Cast Roll the Bones"end end end;if aC()then if n()and not u and P.KillingSpree:IsCastable()and h:IsSpellInRange(P.KillingSpree)and not g:StealthUp(true,false)and(not a4 or P.Vanish:CooldownRemains()>10 or N.MasterAssassinsMarkRemains()>2)and(h:DebuffUp(P.BetweentheEyes)and not g:BuffUp(P.Dreadblades)and g:EnergyDeficitPredicted()>g:EnergyRegen()*2+10 or U>2-a8(g:BuffUp(P.DeathlyShadowsBuff))or N.MasterAssassinsMarkRemains()>0)then if l.Cast(P.KillingSpree,nil,nil)then W=51690;return"Cast Killing Spree"end end;if P.BladeRush:IsCastable()and h:IsSpellInRange(P.BladeRush)and(h:IsInRange(5)or not B)and(ac()>2 and not g:BuffUp(P.Dreadblades)or ae()<=30 or U>2)then if l.Cast(P.BladeRush,nil)then W=271877;return"Cast Blade Rush"end end end;if h:IsSpellInRange(P.SinisterStrike)then if n()then if P.Vanish:IsCastable()and O.Commons.VanishOffensive and a6 and P.Flagellation:IsAvailable()and not g:StealthUp(true,true)and(P.Flagellation:CooldownRemains()>0 and(not P.Dreadblades:IsAvailable()or P.Dreadblades:CooldownRemains()>0 or not P.Flagellation:AnyDebuffUp()))then if l.Cast(P.Vanish,nil)then W=1856;return"Cast w/ InvigoratingShdowdustEquipped - Venth"end end;if P.Vanish:IsCastable()and O.Commons.VanishOffensive and a6 and not P.Flagellation:IsAvailable()and not g:StealthUp(true,true)and(P.EchoingReprimand:CooldownRemains()>6 or not P.Sepsis:CooldownUp()or P.SerratedBoneSpike:FullRechargeTime()>20)then if l.Cast(P.Vanish,nil)then W=1856;return"Cast w/ InvigoratingShdowdustEquipped- non venth"end end;if O.Commons.VanishOffensive and P.Shadowmeld:IsCastable()and aB()then if l.Cast(P.Shadowmeld,nil)then W=58984;return"Cast Shadowmeld"end end;if P.BloodFury:IsCastable()and O.Commons.Enabled.Racials then if l.Cast(P.BloodFury,nil)then W=20572;return"Cast Blood Fury"end end;if P.Berserking:IsCastable()and O.Commons.Enabled.Racials then if l.Cast(P.Berserking,nil)then W=26297;return"Cast Berserking"end end;if P.Fireblood:IsCastable()and O.Commons.Enabled.Racials then if l.Cast(P.Fireblood,nil)then W=265221;return"Cast Fireblood"end end;if P.AncestralCall:IsCastable()and O.Commons.Enabled.Racials then if l.Cast(P.AncestralCall,nil)then W=274738;return"Cast Ancestral Call"end end;if O.Commons.Enabled.TopTrinket or O.Commons.Enabled.BottomTrinket then if Q.CacheOfAcquiredTreasures:IsEquippedAndReady()then if g:BuffUp(P.AcquiredAxe)then if Q.CacheOfAcquiredTreasures:ID()==K and O.Commons.Enabled.TopTrinket then W=24;return"top trinket Cache Axe for AoE"elseif Q.CacheOfAcquiredTreasures:ID()==L and O.Commons.Enabled.BottomTrinket then W=30;return"bot trinket Cache Axe for AoE"end end end;local aF=g:GetUseableTrinkets(R)if aF and(h:DebuffUp(P.BetweentheEyes)or d.BossFilteredFightRemains("<",20)or aF:TrinketHasStatAnyDps())then if aF then if l.Cast(aF,nil,nil)then if aF:ID()==GetInventoryItemID("player",13)and O.Commons.Enabled.TopTrinket then W=24;return"Generic use_items for "..aF:Name()elseif aF:ID()==GetInventoryItemID("player",14)and O.Commons.Enabled.BottomTrinket then W=25;return"Generic use_items for "..aF:Name()end end end end end end end end;local function aG()if false and n()and o and P.EchoingReprimand:IsReady()and h:IsSpellInRange(P.EchoingReprimand)then if l.Cast(P.EchoingReprimand,nil,nil)then W=323547;return"Cast Echoing Reprimand"end end;if P.Dispatch:IsCastable()and h:IsSpellInRange(P.Dispatch)and aA()then if l.CastPooling(P.Dispatch)then W=2098;return"Cast Dispatch"end end;if P.Ambush:IsCastable()and h:IsSpellInRange(P.Ambush)then if l.CastPooling(P.Ambush)then W=8676;return"Cast Ambush"end end end;local function aH()if P.BetweentheEyes:IsCastable()and h:IsSpellInRange(P.BetweentheEyes)and(h:FilteredTimeToDie(">",4)or h:TimeToDieIsNotValid())and N.CanDoTUnit(h,Z)then if l.CastPooling(P.BetweentheEyes)then W=315341;return"Cast Between the Eyes"end end;if P.SliceandDice:IsCastable()and(d.FilteredFightRemains(T,">",g:BuffRemains(P.SliceandDice),true)or g:BuffRemains(P.SliceandDice)==0)and g:BuffRemains(P.SliceandDice)<(1+a0)*1.8 then if l.CastPooling(P.SliceandDice)then W=315496;return"Cast Slice and Dice"end end;if P.Dispatch:IsCastable()and h:IsSpellInRange(P.Dispatch)then if l.CastPooling(P.Dispatch)then W=2098;return"Cast Dispatch"end end end;local function aI()if P.Sepsis:IsReady()and o and h:IsSpellInRange(P.Sepsis)and N.MasterAssassinsMarkRemains()<=0 then if l.Cast(P.Sepsis,nil,nil)then W=328305;return"Cast Sepsis"end end;if P.GhostlyStrike:IsReady()and h:IsSpellInRange(P.GhostlyStrike)then if l.Cast(P.GhostlyStrike,nil)then W=196937;return"Cast Ghostly Strike"end end;if P.Shiv:IsReady()and a3 then if l.Cast(P.Shiv)then W=5938;return"Cast Shiv (TTB)"end end;if P.EchoingReprimand:IsReady()and o and h:IsSpellInRange(P.EchoingReprimand)and(not P.EffusiveAnimaAccelerator:SoulbindEnabled()or aC())then if l.Cast(P.EchoingReprimand,nil,nil)then W=323547;return"Cast Echoing Reprimand"end end;if P.SerratedBoneSpike:IsReady()and o then if g:BuffUp(P.SliceandDice)and not h:DebuffUp(P.SerratedBoneSpikeDebuff)or O.Outlaw.DumpSpikes and d.BossFilteredFightRemains("<",5)then if l.Cast(P.SerratedBoneSpike,nil,nil)then W=328547;return"Cast Serrated Bone Spike"end end;if m()then local aJ,aK=nil,4;local aL=h:GUID()for aM,aN in pairs(S)do if aN:GUID()~=aL and M.UnitIsCycleValid(aN,aK,-aN:DebuffRemains(P.SerratedBoneSpike))and not aN:DebuffUp(P.SerratedBoneSpikeDebuff)then aJ,aK=aN,aN:TimeToDie()end end;if aJ and o then l.CastLeftNameplate(aJ,P.SerratedBoneSpike)if aJ:GUID()==f("mouseover"):GUID()and O.Outlaw.TargetSwap=="Mouseover"then X=3285415 elseif O.Outlaw.TargetSwap=="AutoSwap"and aJ:GUID()~=h:GUID()and not r then X=999 end end end;if P.SerratedBoneSpike:ChargesFractional()>2.75 and o then if l.Cast(P.SerratedBoneSpike,nil,nil)then W=328547;return"Cast Serrated Bone Spike Filler"end end end;if P.PistolShot:IsCastable()and h:IsSpellInRange(P.PistolShot)and g:BuffUp(P.Opportunity)then if g:EnergyDeficitPredicted()>g:EnergyRegen()+10 or a1<=1+a8(g:BuffUp(P.Broadside))or P.QuickDraw:IsAvailable()then if l.CastPooling(P.PistolShot)then W=185763;return"Cast Pistol Shot"end end;if g:BuffUp(P.GreenskinsWickers)or g:BuffUp(P.ConcealedBlunderbuss)or g:BuffUp(P.TornadoTriggerBuff)then if l.CastPooling(P.PistolShot)then W=185763;return"Cast Pistol Shot (Buffed)"end end end;if P.SinisterStrike:IsCastable()and h:IsSpellInRange(P.SinisterStrike)then if l.CastPooling(P.SinisterStrike)then W=193315;return"Cast Sinister Strike"end end end;local function aO()q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[27]A=HeroRotationCharDB.Toggles[50]B=HeroRotationCharDB.Toggles[51]u=HeroRotationCharDB.Toggles[52]C=HeroRotationCharDB.Toggles[53]D=HeroRotationCharDB.Toggles[30]E=HeroRotationCharDB.Toggles[54]if O.Commons.Enabled.TopTrinket then K=GetInventoryItemID("player",13)else K=1 end;if O.Commons.Enabled.BottomTrinket then L=GetInventoryItemID("player",14)else L=1 end;F=0;for ax=1,20 do if select(10,UnitDebuff("player",ax))==240447 then if select(6,UnitDebuff("player",ax))~=nil then F=select(6,UnitDebuff("player",ax))-GetTime()end end end end;local function aP()Y=P.AcrobaticStrikes:IsAvailable()and 9 or 6;Z=P.Dispatch:Damage()*1.25;a0=g:ComboPoints()_=ag(a0)a1=g:ComboPointsDeficit()if m()then S=g:GetEnemiesInRange(30)T=g:GetEnemiesInRange(Y)U=#T else U=1 end;V=aO()if V then return V end;if X>0 then X=0 end;if W>0 then W=0 end;W=N.ReturnSpell()X=N.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then I=GetTime()J=I+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and J~=nil and GetTime()>J and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if C and P.GrapplingHook:IsUsableP()and P.GrapplingHook:CooldownRemains(BypassRecovery)<=0 then if l.Cast(P.GrapplingHook,nil,nil,nil)then W=195457;return"queue Grappling Hook"end elseif(not P.GrapplingHook:IsUsableP()or P.GrapplingHook:CooldownRemains()>0)and C then HeroRotationCharDB.Toggles[53]=not HeroRotationCharDB.Toggles[53]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[53]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and P.CheapShot:IsUsableP()and P.CheapShot:CooldownRemains(BypassRecovery)<=0 and(g:StealthUp(true,true)or g:BuffUp(P.VanishBuff))and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(P.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(P.CheapShot)then X=18335;return"queue Cheap Shot MO"else W=1833;return"queue Cheap Shot"end end elseif(not P.CheapShot:IsUsableP()or P.CheapShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and P.KidneyShot:IsUsableP()and P.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(P.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(P.KidneyShot)then X=4085;return"queue Kidney Shot MO"else W=408;return"queue Kidney Shot"end end elseif(not P.KidneyShot:IsUsableP()or P.KidneyShot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and P.Blind:IsUsableP()and P.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(P.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(P.Blind)then X=20945;return"queue Blind MO"end end elseif(not P.Blind:IsUsableP()or P.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and P.Sap:IsUsableP()and P.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(P.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(P.Sap)then X=67705;return"queue Sap MO"else W=6770;return"queue Sap"end end elseif(not P.Sap:IsUsableP()or P.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and P.Feint:IsUsableP()and P.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.Feint,nil,nil,nil)then W=202;return"queue Shuriken Tornado"end elseif(not P.Feint:IsUsableP()or P.Feint:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and P.Gouge:IsUsableP()and P.Gouge:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(P.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(P.Gouge)then X=17765;return"queue Gouge MO"else W=1776;return"queue Gouge"end end elseif(not P.Gouge:IsUsableP()or P.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if P.ArcaneTorrent:IsAvailable()and P.ArcaneTorrent:IsUsableP()and P.ArcaneTorrent:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.ArcaneTorrent,nil,nil,nil)then W=155145;return"queue ArcaneTorrent Queue"end elseif P.LightsJudgment:IsAvailable()and P.LightsJudgment:IsUsableP()and P.LightsJudgment:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.LightsJudgment,nil,nil,nil)then W=255647;return"queue ArcaneTorrent Queue"end elseif P.BagofTricks:IsAvailable()and P.BagofTricks:IsUsableP()and P.BagofTricks:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.BagofTricks,nil,nil,nil)then W=312411;return"queue ArcaneTorrent Queue"end elseif P.BloodFury:IsAvailable()and P.BloodFury:IsUsableP()and P.BloodFury:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.BloodFury,nil,nil,nil)then W=20572;return"queue ArcaneTorrent Queue"end elseif P.Berserking:IsAvailable()and P.Berserking:IsUsableP()and P.Berserking:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.Berserking,nil,nil,nil)then W=26297;return"queue ArcaneTorrent Queue"end elseif P.Fireblood:IsAvailable()and P.Fireblood:IsUsableP()and P.Fireblood:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.Fireblood,nil,nil,nil)then W=265221;return"queue ArcaneTorrent Queue"end elseif P.AncestralCall:IsAvailable()and P.AncestralCall:IsUsableP()and P.AncestralCall:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(P.AncestralCall,nil,nil,nil)then W=274738;return"queue ArcaneTorrent Queue"end elseif(P.ArcaneTorrent:IsAvailable()and(not P.ArcaneTorrent:IsUsableP()or P.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or P.LightsJudgment:IsAvailable()and(not P.LightsJudgment:IsUsableP()or P.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or P.BagofTricks:IsAvailable()and(not P.BagofTricks:IsUsableP()or P.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or P.BloodFury:IsAvailable()and(not P.BloodFury:IsUsableP()or P.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or P.Berserking:IsAvailable()and(not P.Berserking:IsUsableP()or P.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or P.Fireblood:IsAvailable()and(not P.Fireblood:IsUsableP()or P.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or P.AncestralCall:IsAvailable()and(not P.AncestralCall:IsUsableP()or P.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]l.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;if g:IsChanneling(i(324631))then if g:AffectingCombat()and O.Shadow.CastCancelFC then W=1999 elseif l.CastAnnotated(P.Pool,false,"WAIT")then W=99999;return"Pool During Fleshcraft"end end;if g:IsChanneling(i(324631))then if l.Cast(P.PoolEnergy,nil,nil,nil)then W=99999;return"channeling Fleashcraft"end end;V=N.CrimsonVial()if V then return V end;V=N.Feint()if V then return V end;V=N.Evasion()if V then return V end;if g:HealthPercentage()<O.Commons.PhialHP and Q.PhialofSerenity:IsReady()and Q.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(Q.PhialofSerenity,nil)then W=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<O.Commons.HealthstoneHP and Q.Healthstone:IsReady()and Q.Healthstone:CooldownRemains()<=0 then if l.Cast(Q.Healthstone,nil)then W=40;return"Healthstone HP"end end;if g:HealthPercentage()<O.Commons.HealPotHP and Q.HealPot:IsReady()and Q.HealPot:CooldownRemains()<=0 then if l.Cast(Q.HealPot,nil)then W=41;return"HealPot HP"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if P.PistolShot:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(P.PistolShot,nil)then X=1185763;return"explosive MO Pistol"end end end;if P.PistolShot:IsCastable()and f("target"):IsInMeleeRange(40)and string.find(UnitGUID("target"),120651)then if l.Cast(P.PistolShot,nil)then W=185763;return"explosive Tar Pistol"end end;WhiteList={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510,368477,368396,355057,356133}if UnitExists("target")and P.Shiv:IsReady()and not E then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for ax=0,40 do local aM,aM,aQ,aR,aM,aM,aM,aM,aM,aS=UnitBuff("target",ax)for aM,aT in pairs(WhiteList)do if aT==aS then if l.Cast(P.Shiv,nil)then W=5938;return"Shiv Enrage"end end end end end end;local aU=g:AffectingCombat()and 180 or 900;local aV;if i(8679):IsAvailable()and O.Commons.LethalPoison=="Wound Poison"then aV=g:BuffRemains(i(8679))if aV<aU and not g:IsCasting(i(8679))then if l.Cast(i(8679))then W=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and O.Commons.LethalPoison=="Deadly Poison"then aV=g:BuffRemains(i(2823))if aV<aU and not g:IsCasting(i(2823))then if l.Cast(i(2823))then W=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and O.Commons.LethalPoison=="Instant Poison"then aV=g:BuffRemains(i(315584))if aV<aU and not g:IsCasting(i(315584))then if l.Cast(i(315584))then W=205;return"Instant Poison Refresh"end end end;aV=g:BuffRemains(i(3408))if i(3408):IsAvailable()and O.Commons.NonLethalPoison=="Crippling Poison"then if aV<aU and not g:IsCasting(i(3408))then if l.Cast(i(3408))then W=206;return"Crippling Poison Refresh"end end elseif i(5761):IsAvailable()and O.Commons.NonLethalPoison=="Numbing Poison"then aV=g:BuffRemains(i(5761))if aV<aU and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then W=204;return"Numbing Poison Refresh"end end end;if not g:BuffUp(P.VanishBuff)and not g:AffectingCombat()and not g:StealthUp(true,true)then V=N.Stealth(P.Stealth)if V then return V end end;if not g:AffectingCombat()and q then if M.TargetIsValid()and(not g:AffectingCombat()and q)then if n()and P.MarkedforDeath:IsCastable()and a1>=N.CPMaxSpend()-1 then if O.Commons.STMfDAsDPSCD then if l.Cast(P.MarkedforDeath,nil)then W=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(P.MarkedforDeath,nil)then W=137619;return"Cast Marked for Death (OOC)"end end end;if P.RolltheBones:IsReady()and(N.RtBRemains()<=3 or az())then if l.Cast(P.RolltheBones)then W=315508;return"Cast Roll the Bones (Opener)"end end;if P.SliceandDice:IsReady()and g:BuffRemains(P.SliceandDice)<(1+a0)*1.8 then if l.CastPooling(P.SliceandDice)then W=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,true)or g:BuffUp(P.VanishBuff)then V=aG()if V then return"Stealth (Opener): "..V end elseif aA()then V=aH()if V then return"Finish (Opener): "..V end elseif P.SinisterStrike:IsCastable()then if l.Cast(P.SinisterStrike)then W=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if P.MarkedforDeath:IsCastable()and(g:AffectingCombat()or q or g:BuffUp(P.VanishBuff))then if U>1 and M.CastTargetIf(P.MarkedforDeath,S,"min",ao,aq,nil,nil)then return"Cast Marked for Death (Cycle)"elseif U==1 and not g:StealthUp(true,false)and a1>=N.CPMaxSpend()-1 then if O.Commons.STMfDAsDPSCD then if l.Cast(P.MarkedforDeath,nil)then W=137619;return"Cast Marked for Death (ST)"end else if l.Cast(P.MarkedforDeath,nil)then W=137619;return"Cast Marked for Death (ST)"end end end end;if M.TargetIsValid()and(g:AffectingCombat()or q or g:BuffUp(P.VanishBuff))then if g:StealthUp(true,true)or g:BuffUp(P.VanishBuff)then V=aG()if V then return"Stealth: "..V end end;local aW,aX,aM=GetSpellCooldown(57934)if O.Commons.AutoToT then if aW+aX-GetTime()<=0 and P.TricksoftheTrade:IsAvailable()and P.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if l.Cast(P.TricksoftheTrade)then W=207;return"ToT Focus"end end end;V=aE()if V then return"CDs: "..V end;if aA()then V=aH()if V then return"Finish: "..V end;l.Cast(P.PoolEnergy)return"Finish Pooling"end;V=aI()if V then return"Build: "..V end;if P.ArcaneTorrent:IsCastable()and O.Commons.Enabled.Racials and h:IsSpellInRange(P.SinisterStrike)and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if l.Cast(P.ArcaneTorrent,nil)then W=155145;return"Cast Arcane Torrent"end end;if P.ArcanePulse:IsCastable()and O.Commons.Enabled.Racials and h:IsSpellInRange(P.SinisterStrike)then if l.Cast(P.ArcanePulse)then W=260364;return"Cast Arcane Pulse"end end;if P.LightsJudgment:IsCastable()and O.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(P.LightsJudgment,nil)then W=255647;return"Cast Lights Judgment"end end;if P.BagofTricks:IsCastable()and O.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(P.BagofTricks,nil)then W=312411;return"Cast Bag of Tricks"end end;if P.PistolShot:IsCastable()and h:IsSpellInRange(P.PistolShot)and not h:IsInRange(Y)and not g:StealthUp(true,true)and g:EnergyDeficitPredicted()<25 and(a1>=1 or ac()<=1.2)then if l.Cast(P.PistolShot)then W=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aY()P.Flagellation:RegisterAuraTracking()end;function ReturnSpellOut()if W==0 then return 0 else return W end end;function ReturnSpellMOOut()if X==0 then return 0 else return X end end;l.SetAPL(260,aP,aY)