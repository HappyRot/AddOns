local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[12]local r=not HeroRotationCharDB.Toggles[15]local s=HeroRotationCharDB.Toggles[21]local t=HeroRotationCharDB.Toggles[52]local u=HeroRotationCharDB.Toggles[22]local v=HeroRotationCharDB.Toggles[23]local w=HeroRotationCharDB.Toggles[24]local x=HeroRotationCharDB.Toggles[25]local y=HeroRotationCharDB.Toggles[27]local z=HeroRotationCharDB.Toggles[50]local A=HeroRotationCharDB.Toggles[51]local B=HeroRotationCharDB.Toggles[53]local C=HeroRotationCharDB.Toggles[30]local D=HeroRotationCharDB.Toggles[54]local E=0;local F=g:GetEquipment()local G=k(0)local H=k(0)local I=GetInventoryItemID("player",13)local J=GetInventoryItemID("player",14)if F[13]then G=k(F[13])end;if F[14]then H=k(F[14])end;local K={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,158337}local L=math.min;local M=math.max;local N=math.abs;local O=nil;local P=nil;local I=GetInventoryItemID("player",13)local J=GetInventoryItemID("player",14)local Q;local R;local S;local T;local U=l.Commons.Everyone;local V=l.Commons.Rogue;local W={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local X=i.Rogue.Outlaw;local Y=k.Rogue.Outlaw;local Z={Y.ManicGrieftorch:ID(),Y.DragonfireBombDispenser:ID(),Y.BeaconToTheBeyond:ID()}local _,a0,a1;local a2;local a3=6;local a4;local a5,a6,a7;local a8,a9,aa,ab,ac;local ad={{X.Blind,"Cast Blind (Interrupt)",function()return true end}}local ae=V.ReturnSpell()local af=V.ReturnSpellMO()local ag=0;local function ah(ai)if ai then return 1 else return 0 end end;local function aj()return g:BuffUp(X.SliceandDice)or g:BuffUp(X.AdrenalineRush)end;local ak,al=0,0;local function am(an)local ao=g:EnergyTimeToMaxPredicted(nil,an)if ao<ak or ao-ak>0.5 then ak=ao end;return ak end;local function ap()local aq=g:EnergyPredicted()if aq>al or aq-al>9 then al=aq end;return al end;local ar={X.Broadside,X.BuriedTreasure,X.GrandMelee,X.RuthlessPrecision,X.SkullandCrossbones,X.TrueBearing}local function as()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs={}e.APLVar.RtB_Buffs.Total=0;e.APLVar.RtB_Buffs.Normal=0;e.APLVar.RtB_Buffs.Shorter=0;e.APLVar.RtB_Buffs.Longer=0;local at=V.RtBRemains()for au=1,#ar do local av=g:BuffRemains(ar[au])if av>0 then e.APLVar.RtB_Buffs.Total=e.APLVar.RtB_Buffs.Total+1;if av==at then e.APLVar.RtB_Buffs.Normal=e.APLVar.RtB_Buffs.Normal+1 elseif av>at then e.APLVar.RtB_Buffs.Longer=e.APLVar.RtB_Buffs.Longer+1 else e.APLVar.RtB_Buffs.Shorter=e.APLVar.RtB_Buffs.Shorter+1 end end end end;return e.APLVar.RtB_Buffs.Total end;local function aw()if not e.APLVar.RtB_Reroll then if W.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=as()<=0 and true or false elseif W.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(X.Broadside)and true or false elseif W.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(X.BuriedTreasure)and true or false elseif W.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(X.GrandMelee)and true or false elseif W.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(X.SkullandCrossbones)and true or false elseif W.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(X.RuthlessPrecision)and true or false elseif W.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(X.TrueBearing)and true or false else e.APLVar.RtB_Reroll=false;as()if as()<=2 and g:BuffUp(X.BuriedTreasure)and g:BuffDown(X.GrandMelee)and a1<2 then e.APLVar.RtB_Reroll=true end;if X.Crackshot:IsAvailable()and X.HiddenOpportunity:IsAvailable()and not g:HasTier(31,4)and(not g:BuffUp(X.TrueBearing)and X.HiddenOpportunity:IsAvailable()or not g:BuffUp(X.Broadside)and not X.HiddenOpportunity:IsAvailable())and as()<=1 then e.APLVar.RtB_Reroll=true end;if X.Crackshot:IsAvailable()and g:HasTier(31,4)and as()<=1+ah(g:BuffUp(X.LoadedDiceBuff))and(X.HiddenOpportunity:IsAvailable()or g:BuffDown(X.Broadside))then e.APLVar.RtB_Reroll=true end;if not X.Crackshot:IsAvailable()and X.HiddenOpportunity:IsAvailable()and not g:BuffUp(X.SkullandCrossbones)and(as()<2+ah(g:BuffUp(X.GrandMelee))and a1<2)then e.APLVar.RtB_Reroll=true end;if e.APLVar.RtB_Reroll or e.APLVar.RtB_Buffs.Normal==0 and e.APLVar.RtB_Buffs.Longer>=1 and as()<5 and V.RtBRemains()<=39 then e.APLVar.RtB_Reroll=true end;if h:FilteredTimeToDie("<",12)or d.BossFilteredFightRemains("<",12)then e.APLVar.RtB_Reroll=false end end end;return e.APLVar.RtB_Reroll end;local function ax()return a5>=V.CPMaxSpend()-1-ah(g:StealthUp(true,true)and X.Crackshot:IsAvailable())end;local function ay()return(X.HiddenOpportunity:IsAvailable()or a7>=2+ah(X.ImprovedAmbush:IsAvailable())+ah(g:BuffUp(X.Broadside)))and a8>=50 end;local function az()return W.Commons.VanishOffensive and n()and not(U.IsSoloMode()and g:IsTanking(h))end;local function aA()return not X.ShadowDanceTalent:IsAvailable()and X.FanTheHammer:TalentRank()+ah(X.QuickDraw:IsAvailable())+ah(X.Audacity:IsAvailable())<ah(X.CountTheOdds:IsAvailable())+ah(X.KeepItRolling:IsAvailable())end;local function aB()return g:BuffUp(X.BetweentheEyes)and(not X.HiddenOpportunity:IsAvailable()or g:BuffDown(X.AudacityBuff)and(X.FanTheHammer:TalentRank()<2 or g:BuffDown(X.Opportunity)))and not X.Crackshot:IsAvailable()end;local function aC()if not s and W.Commons.VanishOffensive and R and X.Vanish:IsCastable()and az()and X.HiddenOpportunity:IsAvailable()and not X.Crackshot:IsAvailable()and not g:BuffUp(X.Audacity)and(aA()or g:BuffStack(X.Opportunity)<6)and ay()then if l.Cast(X.Vanish,nil)then ae=1856;return"Cast Vanish (HO)"end end;if X.Vanish:IsCastable()and R and az()and(not X.HiddenOpportunity:IsAvailable()or X.Crackshot:IsAvailable())and ax()then if l.Cast(X.Vanish,nil)then ae=1856;return"Cast Vanish (Finish)"end end;if X.ShadowDance:IsAvailable()and X.ShadowDance:IsCastable()and X.Crackshot:IsAvailable()and ax()and X.Vanish:CooldownRemains()>=6 and T then if l.Cast(X.ShadowDance,nil)then ae=185313;return"Cast Shadow Dance"end end;if X.ShadowDance:IsAvailable()and X.ShadowDance:IsCastable()and not X.KeepItRolling:IsAvailable()and aB()and g:BuffUp(X.SliceandDice)and(ax()or X.HiddenOpportunity:IsAvailable())and(not X.HiddenOpportunity:IsAvailable()or not X.Vanish:IsReady())and T then if l.Cast(X.ShadowDance,nil)then ae=185313;return"Cast Shadow Dance"end end;if X.ShadowDance:IsAvailable()and X.ShadowDance:IsCastable()and X.KeepItRolling:IsAvailable()and aB()and(X.KeepItRolling:CooldownRemains()<=30 or X.KeepItRolling:CooldownRemains()>=120 and(ax()or X.HiddenOpportunity:IsAvailable()))and T then if l.Cast(X.ShadowDance,nil)then ae=185313;return"Cast Shadow Dance"end end;if X.Shadowmeld:IsAvailable()and X.Shadowmeld:IsReady()and W.Commons.Racials then if X.Crackshot:IsAvailable()and ax()or not X.Crackshot:IsAvailable()and(X.CountTheOdds:IsAvailable()and ax()or X.HiddenOpportunity:IsAvailable())then if l.Cast(X.Shadowmeld,nil)then ae=58984;return"Cast Shadowmeld"end end end end;local function aD()if Q and X.AdrenalineRush:IsCastable()and(not g:BuffUp(X.AdrenalineRush)or g:StealthUp(true,true)and X.Crackshot:IsAvailable()and X.ImprovedAdrenalineRush:IsAvailable())and(a6<=2 or not X.ImprovedAdrenalineRush:IsAvailable())then if l.Cast(X.AdrenalineRush,nil)then ae=13750;return"Cast Adrenaline Rush"end end;if X.BladeFlurry:IsReady()then local aE=a1+ah(g:BuffUp(X.Broadside))if a1>=2-ah(X.UnderhandedUpperhand:IsAvailable())and not g:StealthUp(true,false)and g:BuffRemains(X.BladeFlurry)<g:GCDRemains()or X.DeftManeuvers:IsAvailable()and a1>=3 and aE>=a7 and not ax()then if l.Cast(X.BladeFlurry)then ae=13877;return"Cast Blade Flurry"end end end;if X.RolltheBones:IsReady()then local aF=not g:StealthUp(true,true)or not X.Crackshot:IsAvailable()if aF and(aw()or V.RtBRemains()<=ah(g:HasTier(31,4))+ah(X.ShadowDance:CooldownRemains()<=1 or X.Vanish:CooldownRemains()<=1)*6)then if l.Cast(X.RolltheBones)then ae=315508;return"Cast Roll the Bones"end end end;if X.KeepItRolling:IsReady()and not aw()and as()>=3+ah(g:HasTier(31,4))and(g:BuffDown(X.ShadowDance)or as()>=6)then if l.Cast(X.KeepItRolling,nil)then ae=381989;return"Cast Keep it Rolling"end end;if X.GhostlyStrike:IsAvailable()and X.GhostlyStrike:IsReady()and S then if l.Cast(X.GhostlyStrike,nil)then ae=196937;return"Cast Ghostly Strike"end end;if n()and X.Sepsis:IsAvailable()and X.Sepsis:IsReady()then if X.Crackshot:IsAvailable()and X.BetweentheEyes:IsReady()and ax()and not g:StealthUp(true,true)or not X.Crackshot:IsAvailable()and h:FilteredTimeToDie(">",11)and g:BuffUp(X.BetweentheEyes)or d.BossFilteredFightRemains("<",11)then if l.Cast(X.Sepsis,nil)then ae=328305;return"Cast Sepsis"end end end;if X.BladeRush:IsReady()and ab>4 and not g:StealthUp(true,true)then if l.Cast(X.BladeRush,nil)then ae=271877;return"Cast Blade Rush"end end;if not g:StealthUp(true,true,true)then a2=aC()if a2 then return a2 end end;if n()and X.ThistleTea:IsCastable()and not g:BuffUp(X.ThistleTea)and(aa>=100 or d.BossFilteredFightRemains("<",X.ThistleTea:Charges()*6))then if l.Cast(X.ThistleTea,nil)then ae=381623;return"Cast Thistle Tea"end end;if W.Commons.Enabled.Potions then local aG=U.PotionSelected()if aG then if aG:IsReady()and n()and r and(g:BloodlustUp()and l.GUISettings.General.HoldPotforBL or(g:BloodlustUp()or d.BossFightRemains()<=60 or g:BuffUp(X.AdrenalineRush))and not l.GUISettings.General.HoldPotforBL)then if l.Cast(aG,nil)then ae=50;return"potion cooldowns 2"end end end end;if X.BloodFury:IsCastable()then if l.Cast(X.BloodFury,nil)then ae=20572;return"Cast Blood Fury"end end;if X.Berserking:IsCastable()then if l.Cast(X.Berserking,nil)then ae=26297;return"Cast Berserking"end end;if X.Fireblood:IsCastable()then if l.Cast(X.Fireblood,nil)then ae=265221;return"Cast Fireblood"end end;if X.AncestralCall:IsCastable()then if l.Cast(X.AncestralCall,nil)then ae=274738;return"Cast Ancestral Call"end end;if W.Commons.Enabled.BottomTrinket or W.Commons.Enabled.TopTrinket then if Y.ManicGrieftorch:IsEquippedAndReady()then if g:GCDRemains()>g:GCD()-0.1 and not g:StealthUp(true,true)and g:BuffUp(X.BetweentheEyes)or d.BossFilteredFightRemains("<=",5)then if l.Cast(Y.ManicGrieftorch,nil,nil)then if Y.BalefireBranch:ID()==I then ae=24;return"Manic Grieftorch top"elseif Y.ManicGrieftorch:ID()==J then ae=30;return"Manic Grieftorch bop"end end end end;if Y.DragonfireBombDispenser:IsEquippedAndReady()then if not G:ID()==Y.DragonfireBombDispenser:ID()and G:CooldownRemains()>10 or H:CooldownRemains()>10 or d.BossFilteredFightRemains("<",20)or not H:HasCooldown()or not G:HasCooldown()then if l.Cast(Y.DragonfireBombDispenser,nil,nil)then if Y.DragonfireBombDispenser:ID()==I then ae=24;return"Dragonfire Bomb Dispenser top"elseif Y.DragonfireBombDispenser:ID()==J then ae=30;return"Dragonfire Bomb Dispenser bop"end end end end;if Y.BeaconToTheBeyond:IsEquippedAndReady()then if not g:StealthUp(true,true)and g:BuffUp(X.BetweentheEyes)or d.BossFilteredFightRemains("<",5)then if l.Cast(Y.DragonfireBombDispenser,nil,nil)then if Y.DragonfireBombDispenser:ID()==I then ae=24;return"Beacon top"elseif Y.DragonfireBombDispenser:ID()==J then ae=30;return"Beacon bop"end end end end;local aH=g:GetUseableTrinkets(Z)if aH and n()and not g:StealthUp(true,true)or d.BossFilteredFightRemains("<",10)then if aH then if l.Cast(aH,nil,nil)then if aH:ID()==GetInventoryItemID("player",13)and W.Commons.Enabled.TopTrinket then ae=24;return"Generic use_items for "..aH:Name()elseif aH:ID()==GetInventoryItemID("player",14)and W.Commons.Enabled.BottomTrinket then ae=25;return"Generic use_items for "..aH:Name()end end end end end end;local function aI()if X.BladeFlurry:IsReady()and X.BladeFlurry:IsCastable()and m()and X.Subterfuge:IsAvailable()and X.HiddenOpportunity:IsAvailable()and a1>=2 and g:BuffRemains(X.BladeFlurry)<=g:GCDRemains()then if l.Cast(X.BladeFlurry)then ae=13877;return"Cast Blade Flurry"end end;if X.ColdBlood:IsCastable()and g:BuffDown(X.ColdBlood)and h:IsSpellInRange(X.Dispatch)and ax()then if l.Cast(X.ColdBlood,nil)then ae=382245;return"Cast Cold Blood"end end;if X.BetweentheEyes:IsCastable()and h:IsSpellInRange(X.BetweentheEyes)and ax()and X.Crackshot:IsAvailable()then if l.CastPooling(X.BetweentheEyes)then ae=315341;return"Cast Between the Eyes"end end;if X.Dispatch:IsCastable()and h:IsSpellInRange(X.Dispatch)and ax()then if l.CastPooling(X.Dispatch)then ae=2098;return"Cast Dispatch"end end;if X.PistolShot:IsCastable()and h:IsSpellInRange(X.PistolShot)and X.Crackshot:IsAvailable()and X.FanTheHammer:TalentRank()>=2 and g:BuffStack(X.Opportunity)>=6 and(g:BuffUp(X.Broadside)and a6<=1 or g:BuffUp(X.GreenskinsWickersBuff))then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot"end end;if X.Ambush:IsCastable()and h:IsSpellInRange(X.Ambush)and X.HiddenOpportunity:IsAvailable()then if l.CastPooling(X.Ambush)then ae=8676;return"Cast Ambush"end end end;local function aJ()if X.BetweentheEyes:IsCastable()and h:IsSpellInRange(X.BetweentheEyes)and not X.Crackshot:IsAvailable()and(g:BuffRemains(X.BetweentheEyes)<4 or X.ImprovedBetweenTheEyes:IsAvailable()or X.GreenskinsWickers:IsAvailable()or g:HasTier(30,4))and g:BuffDown(X.GreenskinsWickers)then if l.CastPooling(X.BetweentheEyes)then ae=315341;return"Cast Between the Eyes"end end;if X.BetweentheEyes:IsCastable()and h:IsSpellInRange(X.BetweentheEyes)and X.Crackshot:IsAvailable()and(X.Vanish:CooldownRemains()>45 and X.ShadowDance:CooldownRemains()>12)then if l.CastPooling(X.BetweentheEyes)then ae=315341;return"Cast Between the Eyes"end end;if X.SliceandDice:IsCastable()and(d.FilteredFightRemains(a0,">",g:BuffRemains(X.SliceandDice),true)or g:BuffRemains(X.SliceandDice)==0)and g:BuffRemains(X.SliceandDice)<(1+a6)*1.8 then if l.CastPooling(X.SliceandDice)then ae=315496;return"Cast Slice and Dice"end end;if X.KillingSpree:IsCastable()and h:IsSpellInRange(X.KillingSpree)and(h:DebuffUp(X.GhostlyStrike)or not X.GhostlyStrike:IsAvailable())then if l.Cast(X.KillingSpree)then ae=51690;return"Cast Killing Spree"end end;if X.ColdBlood:IsCastable()and g:BuffDown(X.ColdBlood)and h:IsSpellInRange(X.Dispatch)then if l.Cast(X.ColdBlood,nil)then ae=382245;return"Cast Cold Blood"end end;if X.Dispatch:IsCastable()and h:IsSpellInRange(X.Dispatch)then if l.CastPooling(X.Dispatch)then ae=2098;return"Cast Dispatch"end end end;local function aK()if n()and X.EchoingReprimand:IsReady()then if l.Cast(X.EchoingReprimand,nil,nil)then ae=323547;return"Cast Echoing Reprimand"end end;if X.Ambush:IsCastable()and X.HiddenOpportunity:IsAvailable()and g:BuffUp(X.AudacityBuff)then if l.CastPooling(X.Ambush)then ae=8676;return"Cast Ambush (High-Prio Buffed)"end end;if X.FanTheHammer:IsAvailable()and X.Audacity:IsAvailable()and X.HiddenOpportunity:IsAvailable()and g:BuffUp(X.Opportunity)and g:BuffDown(X.AudacityBuff)then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot (Audacity)"end end;if g:BuffUp(X.GreenskinsWickersBuff)and(not X.FanTheHammer:IsAvailable()and g:BuffUp(X.Opportunity)or g:BuffRemains(X.GreenskinsWickersBuff)<1.5)then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot (GSW Dump)"end end;if X.FanTheHammer:IsAvailable()and g:BuffUp(X.Opportunity)and(g:BuffStack(X.Opportunity)>=6 or g:BuffRemains(X.Opportunity)<2)then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot (FtH Dump)"end end;if X.FanTheHammer:IsAvailable()and g:BuffUp(X.Opportunity)and a7>1+ah(X.QuickDraw:IsAvailable())*X.FanTheHammer:TalentRank()and(not X.Vanish:IsReady()and not X.ShadowDance:IsReady()or g:StealthUp(true,true)or not X.Crackshot:IsAvailable()or X.FanTheHammer:TalentRank()<=1)then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot"end end;if not X.FanTheHammer:IsAvailable()and g:BuffUp(X.Opportunity)and(ab>1.5 or a7<=1+ah(g:BuffUp(X.Broadside))or X.QuickDraw:IsAvailable()or X.Audacity:IsAvailable()and g:BuffDown(X.AudacityBuff))then if l.CastPooling(X.PistolShot)then ae=185763;return"Cast Pistol Shot"end end;if X.SinisterStrike:IsCastable()and h:IsSpellInRange(X.SinisterStrike)then if l.CastPooling(X.SinisterStrike)then ae=193315;return"Cast Sinister Strike"end end end;local function aL()p=HeroRotationCharDB.Toggles[5]o=HeroRotationCharDB.Toggles[4]q=HeroRotationCharDB.Toggles[12]r=not HeroRotationCharDB.Toggles[15]s=HeroRotationCharDB.Toggles[21]u=HeroRotationCharDB.Toggles[22]v=HeroRotationCharDB.Toggles[23]w=HeroRotationCharDB.Toggles[24]x=HeroRotationCharDB.Toggles[25]y=HeroRotationCharDB.Toggles[27]z=HeroRotationCharDB.Toggles[50]A=HeroRotationCharDB.Toggles[51]t=HeroRotationCharDB.Toggles[52]B=HeroRotationCharDB.Toggles[53]C=HeroRotationCharDB.Toggles[30]D=HeroRotationCharDB.Toggles[54]I=GetInventoryItemID("player",13)J=GetInventoryItemID("player",14)if not W.Commons.Enabled.TopTrinket and not W.Commons.Enabled.BottomTrinket then Z={I,J}elseif not W.Commons.Enabled.TopTrinket and W.Commons.Enabled.BottomTrinket then Z={I}elseif not W.Commons.Enabled.BottomTrinket and W.Commons.Enabled.TopTrinket then Z={J}end;Q=false;R=false;S=false;T=false;if W.Outlaw.AdrenalineRushCD=="CDs"and n()or W.Outlaw.AdrenalineRushCD=="Small CDs"and o or W.Outlaw.AdrenalineRushCD=="Always"then Q=true end;if W.Outlaw.VanishCD=="CDs"and n()or W.Outlaw.VanishCD=="Small CDs"and o or W.Outlaw.VanishCD=="Always"then R=true end;if W.Outlaw.GhostlyStrikeCD=="CDs"and n()or W.Outlaw.GhostlyStrikeCD=="Small CDs"and o or W.Outlaw.GhostlyStrikeCD=="Always"then S=true end;if W.Outlaw.ShadowDanceCD=="CDs"and n()or W.Outlaw.ShadowDanceCD=="Small CDs"and o or W.Outlaw.ShadowDanceCD=="Always"then T=true end;E=0;for au=1,20 do if select(10,UnitDebuff("player",au))==240447 then if select(6,UnitDebuff("player",au))~=nil then E=select(6,UnitDebuff("player",au))-GetTime()end end end end;a0=g:GetEnemiesInRange(a3,X.SinisterStrike)local function aM()a3=X.AcrobaticStrikes:IsAvailable()and 10 or 6;a6=g:ComboPoints()a5=V.EffectiveComboPoints(a6)a7=g:ComboPointsDeficit()ac=g:BuffUp(X.AdrenalineRush,nil,true)and-50 or 0;a8=ap()a9=g:EnergyRegen()ab=am(ac)aa=g:EnergyDeficitPredicted(nil,ac)if m()then _=g:GetEnemiesInRange(30)a0=g:GetEnemiesInRange(a3)a1=#a0 else a1=1 end;a2=aL()if l.QueuedCast()then ae=l.QueuedCast()return"Custom Queue "..i(ae):ID()end;if a2 then return a2 end;if af>0 then af=0 end;if ae>0 then ae=0 end;ae=V.ReturnSpell()af=V.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[5]then O=GetTime()P=O+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and P~=nil and GetTime()>P and HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[5]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if B and X.GrapplingHook:IsUsableP()and X.GrapplingHook:CooldownRemains(BypassRecovery)<=0 then if l.Cast(X.GrapplingHook,nil,nil,nil)then ae=195457;return"queue Grappling Hook"end elseif(not X.GrapplingHook:IsUsableP()or X.GrapplingHook:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[53]=not HeroRotationCharDB.Toggles[53]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[53]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if u and X.CheapShot:IsUsableP()and X.CheapShot:CooldownRemains(BypassRecovery)<=0 and(g:StealthUp(true,true)or g:BuffUp(X.VanishBuff))and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(X.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(X.CheapShot)then af=18335;return"queue Cheap Shot MO"else ae=1833;return"queue Cheap Shot"end end elseif(not X.CheapShot:IsUsableP()or X.CheapShot:CooldownRemains()>0)and u then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and X.KidneyShot:IsUsableP()and X.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(X.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(X.KidneyShot)then af=4085;return"queue Kidney Shot MO"else ae=408;return"queue Kidney Shot"end end elseif(not X.KidneyShot:IsUsableP()or X.KidneyShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and X.Blind:IsUsableP()and X.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(X.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(X.Blind)then af=20945;return"queue Blind MO"end end elseif(not X.Blind:IsUsableP()or X.Blind:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and X.Sap:IsUsableP()and X.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(X.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(X.Sap)then af=67705;return"queue Sap MO"else ae=6770;return"queue Sap"end end elseif(not X.Sap:IsUsableP()or X.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and x then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and X.Feint:IsUsableP()and X.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()and not g:PrevGCD(1,X.Feint)then if l.Cast(X.Feint,nil,nil,nil)then ae=202;return"queue Feint"end elseif(not X.Feint:IsUsableP()or X.Feint:CooldownRemains()>0 or not g:AffectingCombat())and y then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and X.BladeRush:IsUsableP()and X.BladeRush:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.BladeRush,nil,nil,nil)then ae=271877;return"queue BladeRush"end elseif(not X.BladeRush:IsUsableP()or X.BladeRush:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[51]=not HeroRotationCharDB.Toggles[51]l.Print("BladeRush que is now "..(HeroRotationCharDB.Toggles[51]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and X.Gouge:IsUsableP()and X.Gouge:CooldownRemains(BypassRecovery)<=0 then if l.Cast(X.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(X.Gouge)then af=17765;return"queue Gouge MO"elseif f("target"):IsSpellInRange(X.Gouge)then ae=1776;return"queue Gouge"end end elseif(not X.Gouge:IsUsableP()or X.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if C then if X.ArcaneTorrent:IsAvailable()and X.ArcaneTorrent:IsUsableP()and X.ArcaneTorrent:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.ArcaneTorrent,nil,nil,nil)then ae=155145;return"queue ArcaneTorrent Queue"end elseif X.LightsJudgment:IsAvailable()and X.LightsJudgment:IsUsableP()and X.LightsJudgment:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.LightsJudgment,nil,nil,nil)then ae=255647;return"queue LightsJudgment Queue"end elseif X.BagofTricks:IsAvailable()and X.BagofTricks:IsUsableP()and X.BagofTricks:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.BagofTricks,nil,nil,nil)then ae=312411;return"queue BagofTricks Queue"end elseif X.BloodFury:IsAvailable()and X.BloodFury:IsUsableP()and X.BloodFury:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.BloodFury,nil,nil,nil)then ae=20572;return"queue BloodFury Queue"end elseif X.Berserking:IsAvailable()and X.Berserking:IsUsableP()and X.Berserking:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.Berserking,nil,nil,nil)then ae=26297;return"queue Berserking Queue"end elseif X.Fireblood:IsAvailable()and X.Fireblood:IsUsableP()and X.Fireblood:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.Fireblood,nil,nil,nil)then ae=265221;return"queue Fireblood Queue"end elseif X.AncestralCall:IsAvailable()and X.AncestralCall:IsUsableP()and X.AncestralCall:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(X.AncestralCall,nil,nil,nil)then ae=274738;return"queue AncestralCall Queue"end elseif(X.ArcaneTorrent:IsAvailable()and(not X.ArcaneTorrent:IsUsableP()or X.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or X.LightsJudgment:IsAvailable()and(not X.LightsJudgment:IsUsableP()or X.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or X.BagofTricks:IsAvailable()and(not X.BagofTricks:IsUsableP()or X.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or X.BloodFury:IsAvailable()and(not X.BloodFury:IsUsableP()or X.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or X.Berserking:IsAvailable()and(not X.Berserking:IsUsableP()or X.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or X.Fireblood:IsAvailable()and(not X.Fireblood:IsUsableP()or X.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or X.AncestralCall:IsAvailable()and(not X.AncestralCall:IsUsableP()or X.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and C then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]l.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;if g:IsChanneling(i(324631))then if l.Cast(X.PoolEnergy,nil,nil,nil)then ae=99999;return"channeling Fleashcraft"end end;a2=V.CrimsonVial()if a2 then return a2 end;a2=V.Feint()if a2 then return a2 end;a2=V.Evasion()if a2 then return a2 end;if g:HealthPercentage()<W.Commons.PhialHP and Y.PhialofSerenity:IsReady()and Y.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(Y.PhialofSerenity,nil)then ae=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<W.Commons.HealthstoneHP and Y.Healthstone:IsReady()and Y.Healthstone:CooldownRemains()<=0 then if l.Cast(Y.Healthstone,nil)then ae=40;return"Healthstone HP"end end;if g:HealthPercentage()<W.Commons.HealPotHP and Y.CosmicHealPot:IsReady()and Y.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(Y.CosmicHealPot,nil)then ae=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<W.Commons.HealPotHP and Y.HealPotL:IsReady()and Y.HealPotL:CooldownRemains()<=0 then if l.Cast(Y.HealPotL,nil)then ae=41;return"HealPot LOW HP"end end;if g:HealthPercentage()<W.Commons.HealPotHP and Y.HealPotM:IsReady()and Y.HealPotM:CooldownRemains()<=0 then if l.Cast(Y.HealPotM,nil)then ae=41;return"HealPot MEDIUM HP"end end;if g:HealthPercentage()<W.Commons.HealPotHP and Y.HealPotH:IsReady()and Y.HealPotH:CooldownRemains()<=0 then if l.Cast(Y.HealPotH,nil)then ae=41;return"HealPot HIGH HP"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if X.PistolShot:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(X.PistolShot,nil)then af=1185763;return"explosive MO Pistol"end end end;if X.PistolShot:IsCastable()and f("target"):IsInMeleeRange(40)and string.find(UnitGUID("target"),120651)then if l.Cast(X.PistolShot,nil)then ae=185763;return"explosive Tar Pistol"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),408801)then if X.Blind:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(X.Blind,nil)then af=20945;return"blind MO incorporeal affix"end end end;K={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,158337,412695,355782,333875,344739,228318,332158,321764,324914,326046,324776,340544,324736,328015,257260,322433,334324,317936,327332,328288,343470,333293,320272,342139,355888,349933,356549,355934,353706,347775,357284,335141,327155,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,344739,368477,368396,355057,356133,158337,164426,382555}if UnitExists("target")and X.Shiv:IsReady()and not D then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for au=0,10 do local aN,aN,aO,aP,aQ,aR,aN,aN,aN,aS=UnitBuff("target",au)for aN,aT in pairs(K)do if aT==aS and aR-aQ+500/1000<=GetTime()then if l.Cast(X.Shiv,nil)then ae=5938;return"Shiv Enrage"end end end end end end;local aU=g:AffectingCombat()and 180 or 900;local aV;if not g:AffectingCombat()then if i(8679):IsAvailable()and W.Commons.LethalPoison=="Wound Poison"then aV=g:BuffRemains(i(8679))if aV<aU and not g:IsCasting(i(8679))then if l.Cast(i(8679))then ae=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and W.Commons.LethalPoison=="Deadly Poison"then aV=g:BuffRemains(i(2823))if aV<aU and not g:IsCasting(i(2823))then if l.Cast(i(2823))then ae=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and W.Commons.LethalPoison=="Instant Poison"then aV=g:BuffRemains(i(315584))if aV<aU and not g:IsCasting(i(315584))then if l.Cast(i(315584))then ae=205;return"Instant Poison Refresh"end end end end;aV=g:BuffRemains(i(381637))if i(381637):IsAvailable()and W.Commons.NonLethalPoison=="Atrophic Poison"then if aV<aU and not g:IsCasting(i(381637))then if l.Cast(i(381637))then ae=381637;return"Antropic Poison Refresh"end end elseif i(5761):IsAvailable()and W.Commons.NonLethalPoison=="Numbing Poison"then aV=g:BuffRemains(i(5761))if aV<aU and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then ae=204;return"Numbing Poison Refresh"end end elseif i(3408):IsAvailable()and W.Commons.NonLethalPoison=="Crippling Poison"then aV=g:BuffRemains(i(3408))if aV<aU and not g:IsCasting(NumbingPoison)then if l.Cast(i(3408))then ae=206;return"Crippling Poison Refresh"end end end;if not g:BuffUp(X.VanishBuff)and not g:AffectingCombat()and not g:StealthUp(true,true)then a2=V.Stealth(X.Stealth)if a2 then return a2 end end;if not g:AffectingCombat()and X.Vanish:TimeSinceLastCast()>1 then if X.BladeFlurry:IsReady()and g:BuffDown(X.BladeFlurry)and X.UnderhandedUpperhand:IsAvailable()and not g:StealthUp(true,true)and aj()then if l.Cast(X.BladeFlurry)then ae=13877;return"Blade Flurry (Opener)"end end;if not g:StealthUp(true,false)then a2=V.Stealth(V.StealthSpell())if a2 then return a2 end end;if U.TargetIsValid()and(not g:AffectingCombat()and p)then if n()and X.MarkedforDeath:IsCastable()and a7>=V.CPMaxSpend()-1 and h:NPCID()~=170234 then if W.Commons.STMfDAsDPSCD then if l.Cast(X.MarkedforDeath,nil)then ae=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(X.MarkedforDeath,nil)then ae=137619;return"Cast Marked for Death (OOC)"end end end;if X.AdrenalineRush:IsReady()and Q and X.ImprovedAdrenalineRush:IsAvailable()and a6<=2 and not X.LoadedDiceBuff:IsAvailable()then if l.Cast(X.AdrenalineRush)then ae=13750;return"Cast Adrenaline Rush (Opener)"end end;if X.RolltheBones:IsReady()and not g:DebuffUp(X.Dreadblades)and(as()==0 or aw())then if l.Cast(X.RolltheBones)then ae=315508;return"Cast Roll the Bones (Opener)"end end;if X.AdrenalineRush:IsReady()and Q and X.ImprovedAdrenalineRush:IsAvailable()and a6<=2 and X.LoadedDiceBuff:IsAvailable()then if l.Cast(X.AdrenalineRush)then ae=13750;return"Cast Adrenaline Rush (Opener)"end end;if X.SliceandDice:IsReady()and g:BuffRemains(X.SliceandDice)<(1+a6)*1.8 then if l.CastPooling(X.SliceandDice)then ae=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,false)or g:BuffUp(X.VanishBuff)then a2=aI()if a2 then return"Stealth (Opener): "..a2 end;if X.KeepItRolling:IsAvailable()and X.GhostlyStrike:IsReady()and X.EchoingReprimand:IsAvailable()and S then if l.Cast(X.GhostlyStrike)then ae=196937;return"Cast Ghostly Strike KiR (Opener)"end end;if X.Ambush:IsCastable()then if l.Cast(X.Ambush)then ae=8676;return"Cast Ambush (Opener)"end end elseif ax()then a2=aJ()if a2 then return"Finish (Opener): "..a2 end end;if X.SinisterStrike:IsCastable()then if l.Cast(X.SinisterStrike)then ae=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if X.FanTheHammer:IsAvailable()and X.PistolShot:TimeSinceLastCast()<g:GCDRemains()then a6=M(a6,V.FanTheHammerCP())a5=V.EffectiveComboPoints(a6)a7=g:ComboPointsDeficit()end;if U.TargetIsValid()and(g:AffectingCombat()or p or g:BuffUp(X.VanishBuff)or g:BuffUp(X.VanishBuff1)or g:BuffUp(X.VanishBuff2))and not h:DebuffUp(i(1776))and not h:DebuffUp(i(6770))then if g:BuffUp(X.Stealth)or g:BuffUp(X.VanishBuff)or g:BuffUp(X.Shadowmeld)then a2=aI()if a2 then return"Stealth: "..a2 end end;local aW,aX,aN=GetSpellCooldown(57934)if W.Commons.AutoToT then if aW+aX-GetTime()<=0 and X.TricksoftheTrade:IsAvailable()and X.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))then if l.Cast(X.TricksoftheTrade)then ae=207;return"ToT Focus"end end end;a2=aD()if a2 then return"CDs: "..a2 end;if g:StealthUp(true,true)then a2=aI()if a2 then return"Stealth: "..a2 end end;if ax()then a2=aJ()if a2 then return"Finish: "..a2 end;l.Cast(X.PoolEnergy)return"Finish Pooling"end;a2=aK()if a2 then return"Build: "..a2 end;if X.ArcaneTorrent:IsCastable()and W.Commons.Enabled.Racials and n()and h:IsSpellInRange(X.SinisterStrike)and aa>15+a9 then if l.Cast(X.ArcaneTorrent,nil)then ae=155145;return"Cast Arcane Torrent"end end;if X.ArcanePulse:IsCastable()and W.Commons.Enabled.Racials and n()and h:IsSpellInRange(X.SinisterStrike)then if l.Cast(X.ArcanePulse)then ae=260364;return"Cast Arcane Pulse"end end;if X.LightsJudgment:IsCastable()and W.Commons.Enabled.Racials and n()and h:IsInMeleeRange(5)then if l.Cast(X.LightsJudgment,nil)then ae=255647;return"Cast Lights Judgment"end end;if X.BagofTricks:IsCastable()and W.Commons.Enabled.Racials and n()and h:IsInMeleeRange(5)then if l.Cast(X.BagofTricks,nil)then ae=312411;return"Cast Bag of Tricks"end end;if X.PistolShot:IsCastable()and h:IsSpellInRange(X.PistolShot)and not h:IsInRange(a3)and not g:StealthUp(true,true)and aa<25 and(a7>=1 or ab<=1.2)then if l.Cast(X.PistolShot)then ae=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aY()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpellOut()if ae==0 then return 0 else return ae end end;function ReturnSpellMOOut()if af==0 then return 0 else return af end end;l.SetAPL(260,aM,aY)