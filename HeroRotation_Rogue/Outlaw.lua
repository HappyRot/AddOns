local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[21]local u=HeroRotationCharDB.Toggles[52]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[27]local A=HeroRotationCharDB.Toggles[50]local B=HeroRotationCharDB.Toggles[51]local C=HeroRotationCharDB.Toggles[53]local D=HeroRotationCharDB.Toggles[30]local E=math.min;local F=math.abs;local G=nil;local H=nil;local I=GetInventoryItemID("player",13)local J=GetInventoryItemID("player",14)local K=l.Commons.Everyone;local L=l.Commons.Rogue;local M={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local N=i.Rogue.Outlaw;local O=k.Rogue.Outlaw;local P={O.ComputationDevice:ID(),O.VigorTrinket:ID(),O.FontOfPower:ID(),O.RazorCoral:ID(),O.MistcallerOcarina:ID()}N.Dispatch:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*L.CPSpend()*0.35*1.13*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(N.GhostlyStrike)and 1.1 or 1)*(h:DebuffUp(N.SinfulRevelationDebuff)and 1.06 or 1)end)local Q,R,S;local T;local U=L.ReturnSpell()local V=L.ReturnSpellMO()local W=6;local X;local Y={{N.Blind,"Cast Blind (Interrupt)",function()return true end}}local Z=g:HasLegendaryEquipped(116)local _=g:HasLegendaryEquipped(117)d:RegisterForEvent(function()Z=g:HasLegendaryEquipped(116)_=g:HasLegendaryEquipped(117)end,"PLAYER_EQUIPMENT_CHANGED")local function a0(a1)if a1 then return 1 else return 0 end end;local a2,a3=0,0;local function a4()local a5=g:EnergyTimeToMaxPredicted()if F(a2-a5)>1 then a2=a5 end;return a2 end;local function a6()local a7=g:EnergyPredicted()if F(a3-a7)>9 then a3=a7 end;return a3 end;local function a8(a9)return a9:TimeToDie()end;local function aa(a9)if(a9:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=L.CPMaxSpend()-1)and a9:GUID()==f("mouseover"):GUID()and M.Outlaw.TargetSwap=="Mouseover"then V=1376195;return true elseif(a9:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=L.CPMaxSpend()-1)and M.Outlaw.TargetSwap=="AutoSwap"and a9:GUID()~=h:GUID()and not r then V=999;return true elseif(a9:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=L.CPMaxSpend()-1)and a9:GUID()==h:GUID()then U=137619;return true elseif a9:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=L.CPMaxSpend()-1 then return true end end;local ab={N.Broadside,N.BuriedTreasure,N.GrandMelee,N.RuthlessPrecision,N.SkullandCrossbones,N.TrueBearing}local function ac(ad,ae)if not e.APLVar.RtB_List then e.APLVar.RtB_List={}end;if not e.APLVar.RtB_List[ad]then e.APLVar.RtB_List[ad]={}end;local af=table.concat(ae)if ad=="All"then if not e.APLVar.RtB_List[ad][af]then local ag=0;for ah=1,#ae do if g:BuffUp(ab[ae[ah]])then ag=ag+1 end end;e.APLVar.RtB_List[ad][af]=ag==#ae and true or false end else if not e.APLVar.RtB_List[ad][af]then e.APLVar.RtB_List[ad][af]=false;for ah=1,#ae do if g:BuffUp(ab[ae[ah]])then e.APLVar.RtB_List[ad][af]=true;break end end end end;return e.APLVar.RtB_List[ad][af]end;local function ai()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs=0;for ah=1,#ab do if g:BuffUp(ab[ah])then e.APLVar.RtB_Buffs=e.APLVar.RtB_Buffs+1 end end end;return e.APLVar.RtB_Buffs end;local function aj()if not e.APLVar.RtB_Reroll then if M.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=ai()<=0 and true or false elseif M.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(N.Broadside)and true or false elseif M.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(N.BuriedTreasure)and true or false elseif M.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(N.GrandMelee)and true or false elseif M.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(N.SkullandCrossbones)and true or false elseif M.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(N.RuthlessPrecision)and true or false elseif M.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(N.TrueBearing)and true or false else e.APLVar.RtB_Reroll=ai()<2 and(not g:BuffUp(N.TrueBearing)and not g:BuffUp(N.Broadside))and true or false end;if K.IsSoloMode()then if g:BuffUp(N.GrandMelee)then if g:IsTanking(h)or g:HealthPercentage()<E(M.Outlaw.RolltheBonesLeechKeepHP,M.Outlaw.RolltheBonesLeechRerollHP)then e.APLVar.RtB_Reroll=false end elseif g:HealthPercentage()<M.Outlaw.RolltheBonesLeechRerollHP then e.APLVar.RtB_Reroll=true end end end;return e.APLVar.RtB_Reroll end;local function ak()return g:ComboPoints()>=L.CPMaxSpend()-a0(g:BuffUp(N.Broadside))-a0(g:BuffUp(N.Opportunity))*a0(N.QuickDraw:IsAvailable())or g:ComboPoints()==L.AnimachargedCP()end;local function al()return g:ComboPointsDeficit()>=2+a0(g:BuffUp(N.Broadside))and a6()>50 and(not N.CountTheOdds:ConduitEnabled()or L.RtBRemains()>10)end;local function am()return not m()or S<2 or g:BuffRemains(N.BladeFlurry)>1+a0(N.KillingSpree:IsAvailable())end;local function an()return M.Commons.VanishOffensive and n()and not(K.IsSoloMode()and g:IsTanking(h))end;local function ao()if N.BladeFlurry:IsReady()and m()and S>=2 and not g:BuffUp(N.BladeFlurry)then if l.Cast(N.BladeFlurry)then U=13877;return"Cast Blade Flurry"end end;if h:IsSpellInRange(N.SinisterStrike)then if N.Vanish:IsCastable()and an()and not g:StealthUp(true,true)then if not _ then if al()and not t and not g:BuffUp(N.DeathlyShadowsBuff)and(not M.Outlaw.Enabled.VanishEchoingReprimand or not N.EchoingReprimand:IsAvailable()or N.EchoingReprimand:CooldownUp()or N.EchoingReprimand:CooldownRemains()>=35)then if l.Cast(N.Vanish,nil)then U=1856;return"Cast Vanish"end end else if L.MasterAssassinsMarkRemains()<=0 and not t and am()then if N.MarkedforDeath:IsAvailable()then if ak()then if l.Cast(N.Vanish,nil)then U=1856;return"Cast Vanish (MA+MfD)"end end else if not N.BetweentheEyes:CooldownUp()and ak()or N.BetweentheEyes:CooldownUp()and al()then if l.Cast(N.Vanish,nil)then U=1856;return"Cast Vanish (MA)"end end end end end end;if n()and N.Flagellation:IsReady()and o and not h:DebuffUp(N.Flagellation)and(h:FilteredTimeToDie(">",12)or h:IsInBossList())then if l.Cast(N.Flagellation,nil,nil)then U=323654;return"Cast Flagellation"end end;if n()and N.AdrenalineRush:IsCastable()and not g:BuffUp(N.AdrenalineRush)then if l.Cast(N.AdrenalineRush,nil)then U=13750;return"Cast Adrenaline Rush"end end;if N.RolltheBones:IsReady()and L.MasterAssassinsMarkRemains()<=0 and(L.RtBRemains()<=3 or aj())then if l.Cast(N.RolltheBones)then U=315508;return"Cast Roll the Bones"end end end;if am()then if n()and not u and N.KillingSpree:IsCastable()and not g:BuffUp(N.Flagellation)and h:IsSpellInRange(N.KillingSpree)and not g:StealthUp(true,false)and(not _ or N.Vanish:CooldownRemains()>10 or L.MasterAssassinsMarkRemains()>2 or not an())and(h:DebuffUp(N.BetweentheEyes)and g:EnergyDeficitPredicted()>g:EnergyRegen()*2+10 or S>2-a0(g:BuffUp(N.DeathlyShadowsBuff))or L.MasterAssassinsMarkRemains()>0)then if l.Cast(N.KillingSpree,nil,nil)then U=51690;return"Cast Killing Spree"end end;if N.BladeRush:IsCastable()and h:IsSpellInRange(N.BladeRush)and(h:IsInRange(5)or not B)and(a4()>2 or S>2)then if l.Cast(N.BladeRush,nil)then U=271877;return"Cast Blade Rush"end end end;if h:IsSpellInRange(N.SinisterStrike)then if n()then if M.Commons.VanishOffensive and N.Shadowmeld:IsCastable()and al()then if l.Cast(N.Shadowmeld,nil)then U=58984;return"Cast Shadowmeld"end end;if N.Dreadblades:IsReady()and h:IsSpellInRange(N.Dreadblades)and not g:StealthUp(true,true)and g:ComboPoints()<2 then if l.Cast(N.Dreadblades,nil)then U=343142;return"Cast Dreadblades"end end;if M.Commons.Enabled.TopTrinket or M.Commons.Enabled.BottomTrinket then local ap=g:GetUseableTrinkets(P)if ap and(d.BossFilteredFightRemains("<",20)or L.MasterAssassinsMarkRemains()>0 or not _ and h:DebuffUp(N.BetweentheEyes)and(not N.GhostlyStrike:IsAvailable()or h:DebuffUp(N.GhostlyStrike)))then if ap then if l.Cast(ap,nil,nil)then if ap:ID()==GetInventoryItemID("player",13)then U=24;return"Generic use_items for "..ap:Name()elseif ap:ID()==GetInventoryItemID("player",14)then U=25;return"Generic use_items for "..ap:Name()end end end end end;if N.BloodFury:IsCastable()and M.Commons.Enabled.Racials then if l.Cast(N.BloodFury,nil)then U=20572;return"Cast Blood Fury"end end;if N.Berserking:IsCastable()and M.Commons.Enabled.Racials then if l.Cast(N.Berserking,nil)then U=26297;return"Cast Berserking"end end;if N.Fireblood:IsCastable()and M.Commons.Enabled.Racials then if l.Cast(N.Fireblood,nil)then U=265221;return"Cast Fireblood"end end;if N.AncestralCall:IsCastable()and M.Commons.Enabled.Racials then if l.Cast(N.AncestralCall,nil)then U=274738;return"Cast Ancestral Call"end end end end end;local function aq()if M.Outlaw.Enabled.VanishEchoingReprimand and n()and o and N.EchoingReprimand:IsReady()and h:IsSpellInRange(N.EchoingReprimand)then if l.Cast(N.EchoingReprimand,nil,nil)then U=323547;return"Cast Echoing Reprimand"end end;if N.Dispatch:IsCastable()and h:IsSpellInRange(N.Dispatch)and ak()then if l.CastPooling(N.Dispatch)then U=2098;return"Cast Dispatch"end end;if N.Ambush:IsCastable()and h:IsSpellInRange(N.Ambush)then if l.CastPooling(N.Ambush)then U=8676;return"Cast Ambush"end end end;local function ar()if N.SliceandDice:IsCastable()and(d.FilteredFightRemains(R,">",g:BuffRemains(N.SliceandDice),true)or g:BuffRemains(N.SliceandDice)==0)and g:BuffRemains(N.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(N.SliceandDice)then U=315496;return"Cast Slice and Dice"end end;if N.BetweentheEyes:IsCastable()and h:IsSpellInRange(N.BetweentheEyes)and(h:FilteredTimeToDie(">",4)or h:TimeToDieIsNotValid())and L.CanDoTUnit(h,X)then if l.CastPooling(N.BetweentheEyes)then U=315341;return"Cast Between the Eyes"end end;if N.Dispatch:IsCastable()and h:IsSpellInRange(N.Dispatch)then if l.CastPooling(N.Dispatch)then U=2098;return"Cast Dispatch"end end end;local function as()if n()and N.Sepsis:IsReady()and o and h:IsSpellInRange(N.Sepsis)and L.MasterAssassinsMarkRemains()<=0 then if l.Cast(N.Sepsis,nil,nil)then U=328305;return"Cast Sepsis"end end;if N.GhostlyStrike:IsReady()and h:IsSpellInRange(N.GhostlyStrike)then if l.Cast(N.GhostlyStrike,nil)then U=196937;return"Cast Ghostly Strike"end end;if N.Shiv:IsReady()and Z then if l.Cast(N.Shiv)then U=5938;return"Cast Shiv (TTB)"end end;if n()and N.EchoingReprimand:IsReady()and(not M.Outlaw.Enabled.VanishEchoingReprimand or not M.Commons.VanishOffensive or N.Vanish:CooldownRemains()>=100 or g:IsTanking(h))and h:IsSpellInRange(N.EchoingReprimand)then if l.Cast(N.EchoingReprimand,nil,nil)then U=323547;return"Cast Echoing Reprimand"end end;if N.SerratedBoneSpike:IsReady()and o then if g:BuffUp(N.SliceandDice)and not h:DebuffUp(N.SerratedBoneSpikeDebuff)or M.Outlaw.DumpSpikes and d.BossFilteredFightRemains("<",5)then if l.Cast(N.SerratedBoneSpike,nil,nil)then U=328547;return"Cast Serrated Bone Spike"end end;if m()then local at,au=nil,4;local av=h:GUID()for aw,ax in pairs(Q)do if ax:GUID()~=av and K.UnitIsCycleValid(ax,au,-ax:DebuffRemains(N.SerratedBoneSpike))and not ax:DebuffUp(N.SerratedBoneSpikeDebuff)then at,au=ax,ax:TimeToDie()end end;if at and o then l.CastLeftNameplate(at,N.SerratedBoneSpike)if at:GUID()==f("mouseover"):GUID()and M.Outlaw.TargetSwap=="Mouseover"then V=3285415 elseif M.Outlaw.TargetSwap=="AutoSwap"and at:GUID()~=h:GUID()and not r then V=999 end end end;if N.SerratedBoneSpike:ChargesFractional()>2.75 and o then if l.Cast(N.SerratedBoneSpike,nil,nil)then U=328547;return"Cast Serrated Bone Spike Filler"end end end;if N.PistolShot:IsCastable()and h:IsSpellInRange(N.PistolShot)and g:BuffUp(N.Opportunity)then if g:EnergyDeficitPredicted()>g:EnergyRegen()+10 or g:ComboPointsDeficit()<=1+a0(g:BuffUp(N.Broadside))or N.QuickDraw:IsAvailable()then if l.CastPooling(N.PistolShot)then U=185763;return"Cast Pistol Shot"end end;if g:BuffUp(N.GreenskinsWickers)or g:BuffUp(N.ConcealedBlunderbuss)then if l.CastPooling(N.PistolShot)then U=185763;return"Cast Pistol Shot (Buffed)"end end end;if N.SinisterStrike:IsCastable()and h:IsSpellInRange(N.SinisterStrike)then if l.CastPooling(N.SinisterStrike)then U=193315;return"Cast Sinister Strike"end end end;local function ay()q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[27]A=HeroRotationCharDB.Toggles[50]B=HeroRotationCharDB.Toggles[51]u=HeroRotationCharDB.Toggles[52]C=HeroRotationCharDB.Toggles[53]D=HeroRotationCharDB.Toggles[30]if not M.Commons.Enabled.TopTrinket then I=GetInventoryItemID("player",13)else I=1 end;if not M.Commons.Enabled.BottomTrinket then J=GetInventoryItemID("player",14)else J=1 end;P={I,J}end;local function az()W=N.AcrobaticStrikes:IsAvailable()and 9 or 6;X=N.Dispatch:Damage()*1.25;if m()then Q=g:GetEnemiesInRange(30)R=g:GetEnemiesInRange(W)S=#R else S=1 end;T=ay()if T then return T end;if V>0 then V=0 end;if U>0 then U=0 end;U=L.ReturnSpell()V=L.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then G=GetTime()H=G+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and H~=nil and GetTime()>H and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if C and N.GrapplingHook:IsUsableP()and N.GrapplingHook:CooldownRemains(BypassRecovery)<=0 then if l.Cast(N.GrapplingHook,nil,nil,nil)then U=195457;return"queue Grappling Hook"end elseif(not N.GrapplingHook:IsUsableP()or N.GrapplingHook:CooldownRemains()>0)and C then HeroRotationCharDB.Toggles[53]=not HeroRotationCharDB.Toggles[53]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[53]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and N.CheapShot:IsUsableP()and N.CheapShot:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(N.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(N.CheapShot)then V=18335;return"queue Cheap Shot MO"else U=1833;return"queue Cheap Shot"end end elseif(not N.CheapShot:IsUsableP()or N.CheapShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and N.KidneyShot:IsUsableP()and N.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(N.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(N.KidneyShot)then V=4085;return"queue Kidney Shot MO"else U=408;return"queue Kidney Shot"end end elseif(not N.KidneyShot:IsUsableP()or N.KidneyShot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and N.Blind:IsUsableP()and N.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(N.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(N.Blind)then V=20945;return"queue Blind MO"end end elseif(not N.Blind:IsUsableP()or N.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and N.Sap:IsUsableP()and N.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(N.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(N.Sap)then V=67705;return"queue Sap MO"else U=6770;return"queue Sap"end end elseif(not N.Sap:IsUsableP()or N.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and N.Feint:IsUsableP()and N.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.Feint,nil,nil,nil)then U=202;return"queue Shuriken Tornado"end elseif(not N.Feint:IsUsableP()or N.Feint:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and N.Gouge:IsUsableP()and N.Gouge:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(N.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(N.Gouge)then V=17765;return"queue Gouge MO"else U=1776;return"queue Gouge"end end elseif(not N.Gouge:IsUsableP()or N.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if N.ArcaneTorrent:IsAvailable()and N.ArcaneTorrent:IsUsableP()and N.ArcaneTorrent:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.ArcaneTorrent,nil,nil,nil)then U=155145;return"queue ArcaneTorrent Queue"end elseif N.LightsJudgment:IsAvailable()and N.LightsJudgment:IsUsableP()and N.LightsJudgment:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.LightsJudgment,nil,nil,nil)then U=255647;return"queue ArcaneTorrent Queue"end elseif N.BagofTricks:IsAvailable()and N.BagofTricks:IsUsableP()and N.BagofTricks:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.BagofTricks,nil,nil,nil)then U=312411;return"queue ArcaneTorrent Queue"end elseif N.BloodFury:IsAvailable()and N.BloodFury:IsUsableP()and N.BloodFury:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.BloodFury,nil,nil,nil)then U=20572;return"queue ArcaneTorrent Queue"end elseif N.Berserking:IsAvailable()and N.Berserking:IsUsableP()and N.Berserking:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.Berserking,nil,nil,nil)then U=26297;return"queue ArcaneTorrent Queue"end elseif N.Fireblood:IsAvailable()and N.Fireblood:IsUsableP()and N.Fireblood:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.Fireblood,nil,nil,nil)then U=265221;return"queue ArcaneTorrent Queue"end elseif N.AncestralCall:IsAvailable()and N.AncestralCall:IsUsableP()and N.AncestralCall:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(N.AncestralCall,nil,nil,nil)then U=274738;return"queue ArcaneTorrent Queue"end elseif(N.ArcaneTorrent:IsAvailable()and(not N.ArcaneTorrent:IsUsableP()or N.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or N.LightsJudgment:IsAvailable()and(not N.LightsJudgment:IsUsableP()or N.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or N.BagofTricks:IsAvailable()and(not N.BagofTricks:IsUsableP()or N.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or N.BloodFury:IsAvailable()and(not N.BloodFury:IsUsableP()or N.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or N.Berserking:IsAvailable()and(not N.Berserking:IsUsableP()or N.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or N.Fireblood:IsAvailable()and(not N.Fireblood:IsUsableP()or N.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or N.AncestralCall:IsAvailable()and(not N.AncestralCall:IsUsableP()or N.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]l.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;if g:IsChanneling(i(324631))then if l.Cast(N.PoolEnergy,nil,nil,nil)then U=99999;return"channeling Fleashcraft"end end;T=L.CrimsonVial()if T then return T end;T=L.Feint()if T then return T end;if g:HealthPercentage()<M.Commons.PhialHP and O.PhialofSerenity:IsReady()and O.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(O.PhialofSerenity,nil)then U=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<M.Commons.HealthstoneHP and O.Healthstone:IsReady()and O.Healthstone:CooldownRemains()<=0 then if l.Cast(O.Healthstone,nil)then U=40;return"Healthstone HP"end end;if g:HealthPercentage()<M.Commons.HealPotHP and O.HealPot:IsReady()and O.HealPot:CooldownRemains()<=0 then if l.Cast(O.HealPot,nil)then U=41;return"HealPot HP"end end;WhiteList={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}if UnitExists("target")and N.Shiv:IsReady()then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for ah=0,40 do local aw,aw,aA,aB,aw,aw,aw,aw,aw,aC=UnitBuff("target",ah)for aw,aD in pairs(WhiteList)do if aD==aC then if l.Cast(N.Shiv,nil)then U=5938;return"Shiv Enrage"end end end end end end;local aE=g:AffectingCombat()and 180 or 900;local aF;if i(8679):IsAvailable()and M.Commons.LethalPoison=="Wound Poison"then aF=g:BuffRemains(i(8679))if aF<aE and not g:IsCasting(i(8679))then if l.Cast(i(8679))then U=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and M.Commons.LethalPoison=="Deadly Poison"then aF=g:BuffRemains(i(2823))if aF<aE and not g:IsCasting(i(2823))then if l.Cast(i(2823))then U=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and M.Commons.LethalPoison=="Instant Poison"then aF=g:BuffRemains(i(315584))if aF<aE and not g:IsCasting(i(315584))then if l.Cast(i(315584))then U=205;return"Instant Poison Refresh"end end end;aF=g:BuffRemains(i(3408))if i(3408):IsAvailable()and M.Commons.NonLethalPoison=="Crippling Poison"then if aF<aE and not g:IsCasting(i(3408))then if l.Cast(i(3408))then U=206;return"Crippling Poison Refresh"end end elseif i(5761):IsAvailable()and M.Commons.NonLethalPoison=="Numbing Poison"then aF=g:BuffRemains(i(5761))if aF<aE and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then U=204;return"Numbing Poison Refresh"end end end;if not g:BuffUp(N.VanishBuff)and not g:AffectingCombat()and not g:StealthUp(true,true)then T=L.Stealth(N.Stealth)if T then return T end end;if not g:AffectingCombat()and q then if K.TargetIsValid()and(g:AffectingCombat()or q)then if n()and N.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=L.CPMaxSpend()-1 then if M.Commons.STMfDAsDPSCD then if l.Cast(N.MarkedforDeath,nil)then U=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(N.MarkedforDeath,nil)then U=137619;return"Cast Marked for Death (OOC)"end end end;if N.RolltheBones:IsReady()and(L.RtBRemains()<=3 or aj())then if l.Cast(N.RolltheBones)then U=315508;return"Cast Roll the Bones (Opener)"end end;if N.SliceandDice:IsReady()and g:BuffRemains(N.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(N.SliceandDice)then U=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,true)then T=aq()if T then return"Stealth (Opener): "..T end elseif ak()then T=ar()if T then return"Finish (Opener): "..T end elseif N.SinisterStrike:IsCastable()then if l.Cast(N.SinisterStrike)then U=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if N.MarkedforDeath:IsCastable()and(g:AffectingCombat()or q or g:BuffUp(N.VanishBuff))then if S>1 and K.CastTargetIf(N.MarkedforDeath,Q,"min",a8,aa,nil,nil)then return"Cast Marked for Death (Cycle)"elseif S==1 and not g:StealthUp(true,false)and g:ComboPointsDeficit()>=L.CPMaxSpend()-1 then if M.Commons.STMfDAsDPSCD then if l.Cast(N.MarkedforDeath,nil)then U=137619;return"Cast Marked for Death (ST)"end else if l.Cast(N.MarkedforDeath,nil)then U=137619;return"Cast Marked for Death (ST)"end end end end;if K.TargetIsValid()and(g:AffectingCombat()or q or g:BuffUp(N.VanishBuff))then if g:StealthUp(true,true)then T=aq()if T then return"Stealth: "..T end end;local aG,aH,aw=GetSpellCooldown(57934)if M.Commons.AutoToT then if aG+aH-GetTime()<=0 and N.TricksoftheTrade:IsAvailable()and N.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if l.Cast(N.TricksoftheTrade)then U=207;return"ToT Focus"end end end;T=ao()if T then return"CDs: "..T end;if ak()then T=ar()if T then return"Finish: "..T end;l.Cast(N.PoolEnergy)return"Finish Pooling"end;T=as()if T then return"Build: "..T end;if N.ArcaneTorrent:IsCastable()and M.Commons.Enabled.Racials and h:IsSpellInRange(N.SinisterStrike)and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if l.Cast(N.ArcaneTorrent,nil)then U=155145;return"Cast Arcane Torrent"end end;if N.ArcanePulse:IsCastable()and M.Commons.Enabled.Racials and h:IsSpellInRange(N.SinisterStrike)then if l.Cast(N.ArcanePulse)then U=260364;return"Cast Arcane Pulse"end end;if N.LightsJudgment:IsCastable()and M.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(N.LightsJudgment,nil)then U=255647;return"Cast Lights Judgment"end end;if N.BagofTricks:IsCastable()and M.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(N.BagofTricks,nil)then U=312411;return"Cast Bag of Tricks"end end;if N.PistolShot:IsCastable()and h:IsSpellInRange(N.PistolShot)and not h:IsInRange(W)and not g:StealthUp(true,true)and g:EnergyDeficitPredicted()<25 and(g:ComboPointsDeficit()>=1 or a4()<=1.2)then if l.Cast(N.PistolShot)then U=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aI()end;function ReturnSpellOut()if U==0 then return 0 else return U end end;function ReturnSpellMOOut()if V==0 then return 0 else return V end end;l.SetAPL(260,az,aI)