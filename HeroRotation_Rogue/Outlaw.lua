local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[21]local u=HeroRotationCharDB.Toggles[22]local v=HeroRotationCharDB.Toggles[23]local w=HeroRotationCharDB.Toggles[24]local x=HeroRotationCharDB.Toggles[25]local y=HeroRotationCharDB.Toggles[27]local z=HeroRotationCharDB.Toggles[50]local A=HeroRotationCharDB.Toggles[51]local B=math.min;local C=math.abs;local D=nil;local E=nil;local F=GetInventoryItemID("player",13)local G=GetInventoryItemID("player",14)local H=l.Commons.Everyone;local I=l.Commons.Rogue;local J={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local K=i.Rogue.Outlaw;local L=k.Rogue.Outlaw;local M={L.ComputationDevice:ID(),L.VigorTrinket:ID(),L.FontOfPower:ID(),L.RazorCoral:ID()}K.Dispatch:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*I.CPSpend()*0.35*1.13*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(K.GhostlyStrike)and 1.1 or 1)*(h:DebuffUp(K.SinfulRevelationDebuff)and 1.06 or 1)end)local N,O,P;local Q;local R=I.ReturnSpell()local S=I.ReturnSpellMO()local T=6;local U;local V={{K.Blind,"Cast Blind (Interrupt)",function()return true end}}local W=g:HasLegendaryEquipped(116)local X=g:HasLegendaryEquipped(117)d:RegisterForEvent(function()W=g:HasLegendaryEquipped(116)X=g:HasLegendaryEquipped(117)end,"PLAYER_EQUIPMENT_CHANGED")local function Y(Z)if Z then return 1 else return 0 end end;local _,a0=0,0;local function a1()local a2=g:EnergyTimeToMaxPredicted()if C(_-a2)>1 then _=a2 end;return _ end;local function a3()local a4=g:EnergyPredicted()if C(a0-a4)>9 then a0=a4 end;return a0 end;local function a5(a6)return a6:TimeToDie()end;local function a7(a6)if(a6:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=I.CPMaxSpend()-1)and a6:GUID()==f("mouseover"):GUID()and J.Outlaw.TargetSwap=="Mouseover"then S=1376195;return true elseif(a6:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=I.CPMaxSpend()-1)and J.Outlaw.TargetSwap=="AutoSwap"and a6:GUID()~=h:GUID()and not r then S=999;return true elseif(a6:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=I.CPMaxSpend()-1)and a6:GUID()==h:GUID()then R=137619;return true elseif a6:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=I.CPMaxSpend()-1 then return true end end;local a8={K.Broadside,K.BuriedTreasure,K.GrandMelee,K.RuthlessPrecision,K.SkullandCrossbones,K.TrueBearing}local function a9(aa,ab)if not e.APLVar.RtB_List then e.APLVar.RtB_List={}end;if not e.APLVar.RtB_List[aa]then e.APLVar.RtB_List[aa]={}end;local ac=table.concat(ab)if aa=="All"then if not e.APLVar.RtB_List[aa][ac]then local ad=0;for ae=1,#ab do if g:BuffUp(a8[ab[ae]])then ad=ad+1 end end;e.APLVar.RtB_List[aa][ac]=ad==#ab and true or false end else if not e.APLVar.RtB_List[aa][ac]then e.APLVar.RtB_List[aa][ac]=false;for ae=1,#ab do if g:BuffUp(a8[ab[ae]])then e.APLVar.RtB_List[aa][ac]=true;break end end end end;return e.APLVar.RtB_List[aa][ac]end;local function af()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs=0;for ae=1,#a8 do if g:BuffUp(a8[ae])then e.APLVar.RtB_Buffs=e.APLVar.RtB_Buffs+1 end end end;return e.APLVar.RtB_Buffs end;local function ag()if not e.APLVar.RtB_Reroll then if J.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=af()<=0 and true or false elseif J.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(K.Broadside)and true or false elseif J.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(K.BuriedTreasure)and true or false elseif J.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(K.GrandMelee)and true or false elseif J.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(K.SkullandCrossbones)and true or false elseif J.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(K.RuthlessPrecision)and true or false elseif J.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(K.TrueBearing)and true or false else e.APLVar.RtB_Reroll=af()<2 and(not g:BuffUp(K.TrueBearing)and not g:BuffUp(K.Broadside))and true or false end;if H.IsSoloMode()then if g:BuffUp(K.GrandMelee)then if g:IsTanking(h)or g:HealthPercentage()<B(J.Outlaw.RolltheBonesLeechKeepHP,J.Outlaw.RolltheBonesLeechRerollHP)then e.APLVar.RtB_Reroll=false end elseif g:HealthPercentage()<J.Outlaw.RolltheBonesLeechRerollHP then e.APLVar.RtB_Reroll=true end end end;return e.APLVar.RtB_Reroll end;local function ah()return g:ComboPoints()>=I.CPMaxSpend()-Y(g:BuffUp(K.Broadside))-Y(g:BuffUp(K.Opportunity))*Y(K.QuickDraw:IsAvailable())or g:ComboPoints()==I.AnimachargedCP()end;local function ai()return g:ComboPointsDeficit()>=2+Y(g:BuffUp(K.Broadside))and a3()>50 and(not K.CountTheOdds:ConduitEnabled()or I.RtBRemains()>10)end;local function aj()return not m()or P<2 or g:BuffRemains(K.BladeFlurry)>1+Y(K.KillingSpree:IsAvailable())end;local function ak()return J.Commons.VanishOffensive and n()and not(H.IsSoloMode()and g:IsTanking(h))end;local function al()if K.BladeFlurry:IsReady()and m()and P>=2 and not g:BuffUp(K.BladeFlurry)then if l.Cast(K.BladeFlurry)then R=13877;return"Cast Blade Flurry"end end;if h:IsSpellInRange(K.SinisterStrike)then if K.Vanish:IsCastable()and ak()and not g:StealthUp(true,true)then if not X then if ai()and not t and not g:BuffUp(K.DeathlyShadowsBuff)and(not J.Outlaw.Enabled.VanishEchoingReprimand or not K.EchoingReprimand:IsAvailable()or K.EchoingReprimand:CooldownUp()or K.EchoingReprimand:CooldownRemains()>=35)then if l.Cast(K.Vanish,nil)then R=1856;return"Cast Vanish"end end else if I.MasterAssassinsMarkRemains()<=0 and not t and aj()then if K.MarkedforDeath:IsAvailable()then if ah()then if l.Cast(K.Vanish,nil)then R=1856;return"Cast Vanish (MA+MfD)"end end else if not K.BetweentheEyes:CooldownUp()and ah()or K.BetweentheEyes:CooldownUp()and ai()then if l.Cast(K.Vanish,nil)then R=1856;return"Cast Vanish (MA)"end end end end end end;if n()and K.Flagellation:IsReady()and o and not h:DebuffUp(K.Flagellation)and(h:FilteredTimeToDie(">",12)or h:IsInBossList())then if l.Cast(K.Flagellation,nil,nil)then R=323654;return"Cast Flagellation"end end;if n()and K.AdrenalineRush:IsCastable()and not g:BuffUp(K.AdrenalineRush)then if l.Cast(K.AdrenalineRush,nil)then R=13750;return"Cast Adrenaline Rush"end end;if K.RolltheBones:IsReady()and I.MasterAssassinsMarkRemains()<=0 and(I.RtBRemains()<=3 or ag())then if l.Cast(K.RolltheBones)then R=315508;return"Cast Roll the Bones"end end end;if aj()then if n()and K.KillingSpree:IsCastable()and not g:BuffUp(K.Flagellation)and h:IsSpellInRange(K.KillingSpree)and not g:StealthUp(true,false)and(not X or K.Vanish:CooldownRemains()>10 or I.MasterAssassinsMarkRemains()>2 or not ak())and(h:DebuffUp(K.BetweentheEyes)and g:EnergyDeficitPredicted()>g:EnergyRegen()*2+10 or P>2-Y(g:BuffUp(K.DeathlyShadowsBuff))or I.MasterAssassinsMarkRemains()>0)then if l.Cast(K.KillingSpree,nil,nil)then R=51690;return"Cast Killing Spree"end end;if K.BladeRush:IsCastable()and h:IsSpellInRange(K.BladeRush)and(h:IsInMeleeRange(8)or not A)and(a1()>2 or P>2)then if l.Cast(K.BladeRush,nil)then R=271877;return"Cast Blade Rush"end end end;if h:IsSpellInRange(K.SinisterStrike)then if n()then if J.Commons.VanishOffensive and K.Shadowmeld:IsCastable()and ai()then if l.Cast(K.Shadowmeld,nil)then R=58984;return"Cast Shadowmeld"end end;if K.Dreadblades:IsReady()and h:IsSpellInRange(K.Dreadblades)and not g:StealthUp(true,true)and g:ComboPoints()<2 then if l.Cast(K.Dreadblades,nil)then R=343142;return"Cast Dreadblades"end end;if J.Commons.Enabled.TopTrinket or J.Commons.Enabled.BottomTrinket then local am=g:GetUseableTrinkets(M)if am and(d.BossFilteredFightRemains("<",20)or I.MasterAssassinsMarkRemains()>0 or not X and h:DebuffUp(K.BetweentheEyes)and(not K.GhostlyStrike:IsAvailable()or h:DebuffUp(K.GhostlyStrike)))then if am then if l.Cast(am,nil,nil)then if am:ID()==GetInventoryItemID("player",13)then R=24;return"Generic use_items for "..am:Name()elseif am:ID()==GetInventoryItemID("player",14)then R=25;return"Generic use_items for "..am:Name()end end end end end;if K.BloodFury:IsCastable()and J.Commons.Enabled.Racials then if l.Cast(K.BloodFury,nil)then R=20572;return"Cast Blood Fury"end end;if K.Berserking:IsCastable()and J.Commons.Enabled.Racials then if l.Cast(K.Berserking,nil)then R=26297;return"Cast Berserking"end end;if K.Fireblood:IsCastable()and J.Commons.Enabled.Racials then if l.Cast(K.Fireblood,nil)then R=265221;return"Cast Fireblood"end end;if K.AncestralCall:IsCastable()and J.Commons.Enabled.Racials then if l.Cast(K.AncestralCall,nil)then R=274738;return"Cast Ancestral Call"end end end end end;local function an()if J.Outlaw.Enabled.VanishEchoingReprimand and n()and o and K.EchoingReprimand:IsReady()and h:IsSpellInRange(K.EchoingReprimand)then if l.Cast(K.EchoingReprimand,nil,nil)then R=323547;return"Cast Echoing Reprimand"end end;if K.Dispatch:IsCastable()and h:IsSpellInRange(K.Dispatch)and ah()then if l.CastPooling(K.Dispatch)then R=2098;return"Cast Dispatch"end end;if K.Ambush:IsCastable()and h:IsSpellInRange(K.Ambush)then if l.CastPooling(K.Ambush)then R=8676;return"Cast Ambush"end end end;local function ao()if K.SliceandDice:IsCastable()and(d.FilteredFightRemains(O,">",g:BuffRemains(K.SliceandDice),true)or g:BuffRemains(K.SliceandDice)==0)and g:BuffRemains(K.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(K.SliceandDice)then R=315496;return"Cast Slice and Dice"end end;if K.BetweentheEyes:IsCastable()and h:IsSpellInRange(K.BetweentheEyes)and(h:FilteredTimeToDie(">",4)or h:TimeToDieIsNotValid())and I.CanDoTUnit(h,U)then if l.CastPooling(K.BetweentheEyes)then R=315341;return"Cast Between the Eyes"end end;if K.Dispatch:IsCastable()and h:IsSpellInRange(K.Dispatch)then if l.CastPooling(K.Dispatch)then R=2098;return"Cast Dispatch"end end end;local function ap()if n()and K.Sepsis:IsReady()and o and h:IsSpellInRange(K.Sepsis)and I.MasterAssassinsMarkRemains()<=0 then if l.Cast(K.Sepsis,nil,nil)then R=328305;return"Cast Sepsis"end end;if K.GhostlyStrike:IsReady()and h:IsSpellInRange(K.GhostlyStrike)then if l.Cast(K.GhostlyStrike,nil)then R=196937;return"Cast Ghostly Strike"end end;if K.Shiv:IsReady()and W then if l.Cast(K.Shiv)then R=5938;return"Cast Shiv (TTB)"end end;if n()and K.EchoingReprimand:IsReady()and(not J.Outlaw.Enabled.VanishEchoingReprimand or not J.Commons.VanishOffensive or K.Vanish:CooldownRemains()>=100 or g:IsTanking(h))and h:IsSpellInRange(K.EchoingReprimand)then if l.Cast(K.EchoingReprimand,nil,nil)then R=323547;return"Cast Echoing Reprimand"end end;if K.SerratedBoneSpike:IsReady()and o then if g:BuffUp(K.SliceandDice)and not h:DebuffUp(K.SerratedBoneSpikeDebuff)or J.Outlaw.DumpSpikes and d.BossFilteredFightRemains("<",5)then if l.Cast(K.SerratedBoneSpike,nil,nil)then R=328547;return"Cast Serrated Bone Spike"end end;if m()then local aq,ar=nil,4;local as=h:GUID()for at,au in pairs(N)do if au:GUID()~=as and H.UnitIsCycleValid(au,ar,-au:DebuffRemains(K.SerratedBoneSpike))and not au:DebuffUp(K.SerratedBoneSpikeDebuff)then aq,ar=au,au:TimeToDie()end end;if aq and o then l.CastLeftNameplate(aq,K.SerratedBoneSpike)if aq:GUID()==f("mouseover"):GUID()and J.Outlaw.TargetSwap=="Mouseover"then S=3285415 elseif J.Outlaw.TargetSwap=="AutoSwap"and aq:GUID()~=h:GUID()and not r then S=999 end end end;if K.SerratedBoneSpike:ChargesFractional()>2.75 and o then if l.Cast(K.SerratedBoneSpike,nil,nil)then R=328547;return"Cast Serrated Bone Spike Filler"end end end;if K.PistolShot:IsCastable()and h:IsSpellInRange(K.PistolShot)and g:BuffUp(K.Opportunity)then if g:EnergyDeficitPredicted()>g:EnergyRegen()+10 or g:ComboPointsDeficit()<=1+Y(g:BuffUp(K.Broadside))or K.QuickDraw:IsAvailable()then if l.CastPooling(K.PistolShot)then R=185763;return"Cast Pistol Shot"end end;if g:BuffUp(K.GreenskinsWickers)or g:BuffUp(K.ConcealedBlunderbuss)then if l.CastPooling(K.PistolShot)then R=185763;return"Cast Pistol Shot (Buffed)"end end end;if K.SinisterStrike:IsCastable()and h:IsSpellInRange(K.SinisterStrike)then if l.CastPooling(K.SinisterStrike)then R=193315;return"Cast Sinister Strike"end end end;local function av()q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[21]u=HeroRotationCharDB.Toggles[22]v=HeroRotationCharDB.Toggles[23]w=HeroRotationCharDB.Toggles[24]x=HeroRotationCharDB.Toggles[25]y=HeroRotationCharDB.Toggles[27]z=HeroRotationCharDB.Toggles[50]A=HeroRotationCharDB.Toggles[51]if not J.Commons.Enabled.TopTrinket then F=GetInventoryItemID("player",13)else F=1 end;if not J.Commons.Enabled.BottomTrinket then G=GetInventoryItemID("player",14)else G=1 end;M={F,G}end;local function aw()T=K.AcrobaticStrikes:IsAvailable()and 9 or 6;U=K.Dispatch:Damage()*1.25;if m()then N=g:GetEnemiesInRange(30)O=g:GetEnemiesInRange(T)P=#O else P=1 end;Q=av()if Q then return Q end;if S>0 then S=0 end;if R>0 then R=0 end;R=I.ReturnSpell()S=I.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then D=GetTime()E=D+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and E~=nil and GetTime()>E and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if u and K.CheapShot:IsUsableP()and K.CheapShot:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(K.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(K.CheapShot)then S=18335;return"queue Cheap Shot MO"else R=1833;return"queue Cheap Shot"end end elseif(not K.CheapShot:IsUsableP()or K.CheapShot:CooldownRemains()>0)and u then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and K.KidneyShot:IsUsableP()and K.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(K.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(K.KidneyShot)then S=4085;return"queue Kidney Shot MO"else R=408;return"queue Kidney Shot"end end elseif(not K.KidneyShot:IsUsableP()or K.KidneyShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and K.Blind:IsUsableP()and K.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(K.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(K.Blind)then S=20945;return"queue Blind MO"end end elseif(not K.Blind:IsUsableP()or K.Blind:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and K.Sap:IsUsableP()and K.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(K.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(K.Sap)then S=67705;return"queue Sap MO"else R=6770;return"queue Sap"end end elseif(not K.Sap:IsUsableP()or K.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and x then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and K.Feint:IsUsableP()and K.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(K.Feint,nil,nil,nil)then R=202;return"queue Shuriken Tornado"end elseif(not K.Feint:IsUsableP()or K.Feint:CooldownRemains()>0 or not g:AffectingCombat())and y then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and K.Gouge:IsUsableP()and K.Gouge:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(K.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(K.Gouge)then S=17765;return"queue Gouge MO"else R=1776;return"queue Gouge"end end elseif(not K.Gouge:IsUsableP()or K.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if g:IsChanneling(i(324631))then if l.Cast(K.PoolEnergy,nil,nil,nil)then R=99999;return"channeling Fleashcraft"end end;Q=I.CrimsonVial()if Q then return Q end;Q=I.Feint()if Q then return Q end;if g:HealthPercentage()<J.Commons.PhialHP and L.PhialofSerenity:IsReady()and L.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(L.PhialofSerenity,nil)then R=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<J.Commons.HealthstoneHP and L.Healthstone:IsReady()and L.Healthstone:CooldownRemains()<=0 then if l.Cast(L.Healthstone,nil)then R=40;return"Healthstone HP"end end;if g:HealthPercentage()<J.Commons.HealPotHP and L.HealPot:IsReady()and L.HealPot:CooldownRemains()<=0 then if l.Cast(L.HealPot,nil)then R=41;return"HealPot HP"end end;WhiteList={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}if UnitExists("target")and K.Shiv:IsReady()then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for ae=0,40 do local at,at,ax,ay,at,at,at,at,at,az=UnitBuff("target",ae)for at,aA in pairs(WhiteList)do if aA==az then if l.Cast(K.Shiv,nil)then R=5938;return"Shiv Enrage"end end end end end end;local aB=g:AffectingCombat()and 180 or 900;local aC;if i(8679):IsAvailable()and J.Commons.LethalPoison=="Wound Poison"then aC=g:BuffRemains(i(8679))if aC<aB and not g:IsCasting(i(8679))then if l.Cast(i(8679))then R=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and J.Commons.LethalPoison=="Deadly Poison"then aC=g:BuffRemains(i(2823))if aC<aB and not g:IsCasting(i(2823))then if l.Cast(i(2823))then R=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and J.Commons.LethalPoison=="Instant Poison"then aC=g:BuffRemains(i(315584))if aC<aB and not g:IsCasting(i(315584))then if l.Cast(i(315584))then R=205;return"Instant Poison Refresh"end end end;aC=g:BuffRemains(i(3408))if i(3408):IsAvailable()and J.Commons.NonLethalPoison=="Crippling Poison"then if aC<aB and not g:IsCasting(i(3408))then if l.Cast(i(3408))then R=206;return"Crippling Poison Refresh"end end elseif i(5761):IsAvailable()and J.Commons.NonLethalPoison=="Numbing Poison"then aC=g:BuffRemains(i(5761))if aC<aB and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then R=204;return"Numbing Poison Refresh"end end end;if not g:BuffUp(K.VanishBuff)and(H.TargetIsValid()or g:IsInDungeonArea())and not g:AffectingCombat()and not g:StealthUp(true,true)then Q=I.Stealth(K.Stealth)if Q then return Q end end;if not g:AffectingCombat()and q then if H.TargetIsValid()and(g:AffectingCombat()or q)then if n()and K.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=I.CPMaxSpend()-1 then if J.Commons.STMfDAsDPSCD then if l.Cast(K.MarkedforDeath,nil)then R=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(K.MarkedforDeath,nil)then R=137619;return"Cast Marked for Death (OOC)"end end end;if K.RolltheBones:IsReady()and(I.RtBRemains()<=3 or ag())then if l.Cast(K.RolltheBones)then R=315508;return"Cast Roll the Bones (Opener)"end end;if K.SliceandDice:IsReady()and g:BuffRemains(K.SliceandDice)<(1+g:ComboPoints())*1.8 then if l.CastPooling(K.SliceandDice)then R=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,true)then Q=an()if Q then return"Stealth (Opener): "..Q end elseif ah()then Q=ao()if Q then return"Finish (Opener): "..Q end elseif K.SinisterStrike:IsCastable()then if l.Cast(K.SinisterStrike)then R=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if K.MarkedforDeath:IsCastable()and(g:AffectingCombat()or q or g:BuffUp(K.VanishBuff))then if P>1 and H.CastTargetIf(K.MarkedforDeath,N,"min",a5,a7,nil,nil)then return"Cast Marked for Death (Cycle)"elseif P==1 and not g:StealthUp(true,false)and g:ComboPointsDeficit()>=I.CPMaxSpend()-1 then if J.Commons.STMfDAsDPSCD then if l.Cast(K.MarkedforDeath,nil)then R=137619;return"Cast Marked for Death (ST)"end else if l.Cast(K.MarkedforDeath,nil)then R=137619;return"Cast Marked for Death (ST)"end end end end;if H.TargetIsValid()and(g:AffectingCombat()or q or g:BuffUp(K.VanishBuff))then if g:StealthUp(true,true)then Q=an()if Q then return"Stealth: "..Q end end;local aD,aE,at=GetSpellCooldown(57934)if J.Commons.AutoToT then if aD+aE-GetTime()<=0 and K.TricksoftheTrade:IsAvailable()and K.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if l.Cast(K.TricksoftheTrade)then R=207;return"ToT Focus"end end end;Q=al()if Q then return"CDs: "..Q end;if ah()then Q=ao()if Q then return"Finish: "..Q end;l.Cast(K.PoolEnergy)return"Finish Pooling"end;Q=ap()if Q then return"Build: "..Q end;if K.ArcaneTorrent:IsCastable()and J.Commons.Enabled.Racials and h:IsSpellInRange(K.SinisterStrike)and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if l.Cast(K.ArcaneTorrent,nil)then R=155145;return"Cast Arcane Torrent"end end;if K.ArcanePulse:IsCastable()and J.Commons.Enabled.Racials and h:IsSpellInRange(K.SinisterStrike)then if l.Cast(K.ArcanePulse)then R=260364;return"Cast Arcane Pulse"end end;if K.LightsJudgment:IsCastable()and J.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(K.LightsJudgment,nil)then R=255647;return"Cast Lights Judgment"end end;if K.BagofTricks:IsCastable()and J.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(K.BagofTricks,nil)then R=312411;return"Cast Bag of Tricks"end end;if K.PistolShot:IsCastable()and h:IsSpellInRange(K.PistolShot)and not h:IsInRange(T)and not g:StealthUp(true,true)and g:EnergyDeficitPredicted()<25 and(g:ComboPointsDeficit()>=1 or a1()<=1.2)then if l.Cast(K.PistolShot)then R=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aF()end;function ReturnSpellOut()if R==0 then return 0 else return R end end;function ReturnSpellMOOut()if S==0 then return 0 else return S end end;l.SetAPL(260,aw,aF)