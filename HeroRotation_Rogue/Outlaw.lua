local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=HeroRotationCharDB.Toggles[4]local p=HeroRotationCharDB.Toggles[5]local q=HeroRotationCharDB.Toggles[6]local r=HeroRotationCharDB.Toggles[12]local s=HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[21]local u=HeroRotationCharDB.Toggles[52]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[27]local A=HeroRotationCharDB.Toggles[50]local B=HeroRotationCharDB.Toggles[51]local C=HeroRotationCharDB.Toggles[53]local D=HeroRotationCharDB.Toggles[30]local E=HeroRotationCharDB.Toggles[54]local F=0;local G={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668}local H=math.min;local I=math.abs;local J=nil;local K=nil;local L=GetInventoryItemID("player",13)local M=GetInventoryItemID("player",14)local N=l.Commons.Everyone;local O=l.Commons.Rogue;local P={General=l.GUISettings.General,Commons=l.GUISettings.APL.Rogue.Commons,Commons2=l.GUISettings.APL.Rogue.Commons2,Outlaw=l.GUISettings.APL.Rogue.Outlaw}local Q=i.Rogue.Outlaw;local R=k.Rogue.Outlaw;local S={R.ComputationDevice:ID(),R.VigorTrinket:ID(),R.FontOfPower:ID(),R.RazorCoral:ID(),R.CacheOfAcquiredTreasures:ID(),R.MistcallerOcarina:ID()}Q.Dispatch:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*O.CPSpend()*0.35*1.13*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(Q.GhostlyStrike)and 1.1 or 1)*(h:DebuffUp(Q.SinfulRevelationDebuff)and 1.06 or 1)end)local T,U,V;local W;local X=O.ReturnSpell()local Y=O.ReturnSpellMO()local Z=6;local _;local a0,a1,a2;local a3={{Q.Blind,"Cast Blind (Interrupt)",function()return true end}}local a4=g:HasLegendaryEquipped(116)local a5=g:HasLegendaryEquipped(117)local a6=g:HasLegendaryEquipped(129)local a7=g:HasLegendaryEquipped(114)d:RegisterForEvent(function()a6=g:HasLegendaryEquipped(129)a4=g:HasLegendaryEquipped(116)a5=g:HasLegendaryEquipped(117)a7=g:HasLegendaryEquipped(114)end,"PLAYER_EQUIPMENT_CHANGED")local a8=g:Covenant()d:RegisterForEvent(function()a8=g:Covenant()end,"COVENANT_CHOSEN")local function a9(aa)if aa then return 1 else return 0 end end;local ab,ac=0,0;local function ad()local ae=g:EnergyTimeToMaxPredicted()if I(ab-ae)>1 then ab=ae end;return ab end;local function af()local ag=g:EnergyPredicted()if I(ac-ag)>9 then ac=ag end;return ac end;local function ah(a1)a0=a1;if a1==2 and g:BuffUp(Q.EchoingReprimand2)or a1==3 and g:BuffUp(Q.EchoingReprimand3)or a1==4 and g:BuffUp(Q.EchoingReprimand4)or a1==5 and g:BuffUp(Q.EchoingReprimand5)then a0=7;return 7 else a0=a1;return a1 end;local ai,aj=UnitAttackSpeed("unit")local ak=(ai+aj)/2;local al=ak/2;local am=(4-meleeswings)*al;local an=(5-meleeswings)*al;if a0>a1 and a2>2 and g:AffectingCombat()then if a1==2 and not g:BuffUp(Q.EchoingReprimand3)or a1==3 and not g:BuffUp(Q.EchoingReprimand4)or a1==4 and not g:BuffUp(Q.EchoingReprimand5)then local ao=am;if ao==0 then ao=an end;if ao<mathmax(g:EnergyTimeToX(35),g:GCDRemains())+0.5 then a0=a1 end end end end;local function ap(aq)return aq:TimeToDie()end;local function ar(aq)if(aq:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=O.CPMaxSpend()-1)and aq:GUID()==f("mouseover"):GUID()and aq:NPCID()~=170234 and P.Outlaw.TargetSwap=="Mouseover"then Y=1376195;return true elseif(aq:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=O.CPMaxSpend()-1)and P.Outlaw.TargetSwap=="AutoSwap"and aq:GUID()~=h:GUID()and aq:NPCID()~=170234 and not r then Y=999;return true elseif(aq:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=O.CPMaxSpend()-1)and aq:GUID()==h:GUID()and aq:NPCID()~=170234 then X=137619;return true elseif(aq:FilteredTimeToDie("<",g:ComboPointsDeficit()*1.5)or not g:StealthUp(true,false)and g:ComboPointsDeficit()>=O.CPMaxSpend()-1)and aq:NPCID()~=170234 then return true end end;local as={Q.Broadside,Q.BuriedTreasure,Q.GrandMelee,Q.RuthlessPrecision,Q.SkullandCrossbones,Q.TrueBearing}local function at(au,av)if not e.APLVar.RtB_List then e.APLVar.RtB_List={}end;if not e.APLVar.RtB_List[au]then e.APLVar.RtB_List[au]={}end;local aw=table.concat(av)if au=="All"then if not e.APLVar.RtB_List[au][aw]then local ax=0;for ay=1,#av do if g:BuffUp(as[av[ay]])then ax=ax+1 end end;e.APLVar.RtB_List[au][aw]=ax==#av and true or false end else if not e.APLVar.RtB_List[au][aw]then e.APLVar.RtB_List[au][aw]=false;for ay=1,#av do if g:BuffUp(as[av[ay]])then e.APLVar.RtB_List[au][aw]=true;break end end end end;return e.APLVar.RtB_List[au][aw]end;local function az()if not e.APLVar.RtB_Buffs then e.APLVar.RtB_Buffs=0;for ay=1,#as do if g:BuffUp(as[ay])then e.APLVar.RtB_Buffs=e.APLVar.RtB_Buffs+1 end end end;return e.APLVar.RtB_Buffs end;local function aA()if not e.APLVar.RtB_Reroll then if P.Outlaw.RolltheBonesLogic=="1+ Buff"then e.APLVar.RtB_Reroll=az()<=0 and true or false elseif P.Outlaw.RolltheBonesLogic=="Broadside"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.Broadside)and true or false elseif P.Outlaw.RolltheBonesLogic=="Buried Treasure"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.BuriedTreasure)and true or false elseif P.Outlaw.RolltheBonesLogic=="Grand Melee"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.GrandMelee)and true or false elseif P.Outlaw.RolltheBonesLogic=="Skull and Crossbones"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.SkullandCrossbones)and true or false elseif P.Outlaw.RolltheBonesLogic=="Ruthless Precision"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.RuthlessPrecision)and true or false elseif P.Outlaw.RolltheBonesLogic=="True Bearing"then e.APLVar.RtB_Reroll=not g:BuffUp(Q.TrueBearing)and true or false else e.APLVar.RtB_Reroll=az()<2 and(not g:BuffUp(Q.TrueBearing)and not g:BuffUp(Q.Broadside))and true or false end;if N.IsSoloMode()then if g:BuffUp(Q.GrandMelee)then if g:IsTanking(h)or g:HealthPercentage()<H(P.Outlaw.RolltheBonesLeechKeepHP,P.Outlaw.RolltheBonesLeechRerollHP)then e.APLVar.RtB_Reroll=false end elseif g:HealthPercentage()<P.Outlaw.RolltheBonesLeechRerollHP then e.APLVar.RtB_Reroll=true end end end;return e.APLVar.RtB_Reroll end;local function aB()if Q.BetweentheEyes:CooldownUp()and a0<5 then return false end;return a1>=O.CPMaxSpend()-a9(g:BuffUp(Q.Broadside))-a9(g:BuffUp(Q.Opportunity))*a9(Q.QuickDraw:IsAvailable())or a0>=O.CPMaxSpend()end;local function aC()return a2>=2+a9(g:BuffUp(Q.Broadside))and a0<O.CPMaxSpend()and af()>50 and(not Q.CountTheOdds:ConduitEnabled()or O.RtBRemains()>10)end;local function aD()return not m()or V<2 or g:BuffRemains(Q.BladeFlurry)>1+a9(Q.KillingSpree:IsAvailable())end;local function aE()return P.Commons.VanishOffensive and n()and not(N.IsSoloMode()and g:IsTanking(h))end;local function aF()if Q.BladeFlurry:IsReady()and m()and V>=2 and not g:BuffUp(Q.BladeFlurry)then if l.Cast(Q.BladeFlurry)then X=13877;return"Cast Blade Flurry"end end;if h:IsSpellInRange(Q.SinisterStrike)then if Q.Vanish:IsCastable()and aE()and not g:StealthUp(true,true)then if not a5 then if aC()and not t and not a5 and not a7 and aC()and not g:StealthUp(true,true)and(not a6 or g:BuffDown(Q.DeathlyShadowsBuff)and a1<=2)then if l.Cast(Q.Vanish,nil)then X=1856;return"Cast Vanish"end end else if O.MasterAssassinsMarkRemains()<=0 and a5 and not t and P.Commons.VanishOffensive and aD()then if Q.MarkedforDeath:IsAvailable()then if aB()then if l.Cast(Q.Vanish,nil)then X=1856;return"Cast Vanish (MA+MfD)"end end else if not t and a5 and P.Commons.VanishOffensive(not Q.BetweentheEyes:CooldownUp()and aB()or Q.BetweentheEyes:CooldownUp()and aC())then if l.Cast(Q.Vanish,nil)then X=1856;return"Cast Vanish (MA)"end end end end end end;if n()and Q.AdrenalineRush:IsCastable()and not g:BuffUp(Q.AdrenalineRush)then if l.Cast(Q.AdrenalineRush,nil)then X=13750;return"Cast Adrenaline Rush"end end;if Q.Fleshcraft:IsCastable()and(F==0 or F>Q.Fleshcraft:ExecuteTime())and o and P.Outlaw.CastCancelFC and not g:StealthUp(true,true)and(Q.PustuleEruption:SoulbindEnabled()or Q.VolatileSolvent:SoulbindEnabled())and(not g:BuffUp(Q.BladeFlurry)or V<2)and(not g:BuffUp(Q.AdrenalineRush)or ad()>2)then if l.Cast(Q.Fleshcraft,nil)then X=324631;return"Cast Fleashcraft"end end;if n()and Q.Flagellation:IsReady()and o and not g:StealthUp(true,true)and not h:DebuffUp(Q.Flagellation)and(aB()or(h:FilteredTimeToDie(">",12)or h:IsInBossList()))then if l.Cast(Q.Flagellation,nil,nil)then X=323654;return"Cast Flagellation"end end;if Q.Dreadblades:IsReady()and h:IsSpellInRange(Q.Dreadblades)and not g:StealthUp(true,true)and a1<=2 and(a8~="Venthyr"or Q.Flagellation:AnyDebuffUp())and(not Q.MarkedforDeath:IsAvailable()or Q.MarkedforDeath:CooldownRemains()>0)then if l.Cast(Q.Dreadblades,nil)then X=343142;return"Cast Dreadblades"end end;if Q.RolltheBones:IsReady()and O.MasterAssassinsMarkRemains()<=0 and not g:BuffUp(Q.Dreadblades)and(O.RtBRemains()<=3 or aA())then if l.Cast(Q.RolltheBones)then X=315508;return"Cast Roll the Bones"end end end;if aD()then if n()and not u and Q.KillingSpree:IsCastable()and h:IsSpellInRange(Q.KillingSpree)and not g:StealthUp(true,false)and(not a5 or Q.Vanish:CooldownRemains()>10 or O.MasterAssassinsMarkRemains()>2)and(h:DebuffUp(Q.BetweentheEyes)and not g:BuffUp(Q.Dreadblades)and g:EnergyDeficitPredicted()>g:EnergyRegen()*2+10 or V>2-a9(g:BuffUp(Q.DeathlyShadowsBuff))or O.MasterAssassinsMarkRemains()>0)then if l.Cast(Q.KillingSpree,nil,nil)then X=51690;return"Cast Killing Spree"end end;if Q.BladeRush:IsCastable()and h:IsSpellInRange(Q.BladeRush)and(h:IsInRange(5)or not B)and(ad()>2 and not g:BuffUp(Q.Dreadblades)or af()<=30 or V>2)then if l.Cast(Q.BladeRush,nil)then X=271877;return"Cast Blade Rush"end end end;if h:IsSpellInRange(Q.SinisterStrike)then if n()then if Q.Vanish:IsCastable()and P.Commons.VanishOffensive and a7 and Q.Flagellation:IsAvailable()and not g:StealthUp(true,true)and(Q.Flagellation:CooldownRemains()>0 and(not Q.Dreadblades:IsAvailable()or Q.Dreadblades:CooldownRemains()>0 or not Q.Flagellation:AnyDebuffUp()))then if l.Cast(Q.Vanish,nil)then X=1856;return"Cast w/ InvigoratingShdowdustEquipped - Venth"end end;if Q.Vanish:IsCastable()and P.Commons.VanishOffensive and a7 and not Q.Flagellation:IsAvailable()and not g:StealthUp(true,true)and(Q.EchoingReprimand:CooldownRemains()>6 or not Q.Sepsis:CooldownUp()or Q.SerratedBoneSpike:FullRechargeTime()>20)then if l.Cast(Q.Vanish,nil)then X=1856;return"Cast w/ InvigoratingShdowdustEquipped- non venth"end end;if P.Commons.VanishOffensive and Q.Shadowmeld:IsCastable()and aC()then if l.Cast(Q.Shadowmeld,nil)then X=58984;return"Cast Shadowmeld"end end;if Q.BloodFury:IsCastable()and P.Commons.Enabled.Racials then if l.Cast(Q.BloodFury,nil)then X=20572;return"Cast Blood Fury"end end;if Q.Berserking:IsCastable()and P.Commons.Enabled.Racials then if l.Cast(Q.Berserking,nil)then X=26297;return"Cast Berserking"end end;if Q.Fireblood:IsCastable()and P.Commons.Enabled.Racials then if l.Cast(Q.Fireblood,nil)then X=265221;return"Cast Fireblood"end end;if Q.AncestralCall:IsCastable()and P.Commons.Enabled.Racials then if l.Cast(Q.AncestralCall,nil)then X=274738;return"Cast Ancestral Call"end end;if P.Commons.Enabled.TopTrinket or P.Commons.Enabled.BottomTrinket then if R.CacheOfAcquiredTreasures:IsEquippedAndReady()then if g:BuffUp(Q.AcquiredAxe)then if R.CacheOfAcquiredTreasures:ID()==L and P.Commons.Enabled.TopTrinket then X=24;return"top trinket Cache Axe for AoE"elseif R.CacheOfAcquiredTreasures:ID()==M and P.Commons.Enabled.BottomTrinket then X=30;return"bot trinket Cache Axe for AoE"end end end;local aG=g:GetUseableTrinkets(S)if aG and(h:DebuffUp(Q.BetweentheEyes)or d.BossFilteredFightRemains("<",20)or aG:TrinketHasStatAnyDps())then if aG then if l.Cast(aG,nil,nil)then if aG:ID()==GetInventoryItemID("player",13)and P.Commons.Enabled.TopTrinket then X=24;return"Generic use_items for "..aG:Name()elseif aG:ID()==GetInventoryItemID("player",14)and P.Commons.Enabled.BottomTrinket then X=25;return"Generic use_items for "..aG:Name()end end end end end end end end;local function aH()if false and n()and o and Q.EchoingReprimand:IsReady()and h:IsSpellInRange(Q.EchoingReprimand)then if l.Cast(Q.EchoingReprimand,nil,nil)then X=323547;return"Cast Echoing Reprimand"end end;if Q.Dispatch:IsCastable()and h:IsSpellInRange(Q.Dispatch)and aB()then if l.CastPooling(Q.Dispatch)then X=2098;return"Cast Dispatch"end end;if Q.Ambush:IsCastable()and h:IsSpellInRange(Q.Ambush)then if l.CastPooling(Q.Ambush)then X=8676;return"Cast Ambush"end end end;local function aI()if Q.BetweentheEyes:IsCastable()and h:IsSpellInRange(Q.BetweentheEyes)and(h:FilteredTimeToDie(">",4)or h:TimeToDieIsNotValid())and O.CanDoTUnit(h,_)then if l.CastPooling(Q.BetweentheEyes)then X=315341;return"Cast Between the Eyes"end end;if Q.SliceandDice:IsCastable()and(d.FilteredFightRemains(U,">",g:BuffRemains(Q.SliceandDice),true)or g:BuffRemains(Q.SliceandDice)==0)and g:BuffRemains(Q.SliceandDice)<(1+a1)*1.8 then if l.CastPooling(Q.SliceandDice)then X=315496;return"Cast Slice and Dice"end end;if Q.Dispatch:IsCastable()and h:IsSpellInRange(Q.Dispatch)then if l.CastPooling(Q.Dispatch)then X=2098;return"Cast Dispatch"end end end;local function aJ()if Q.Sepsis:IsReady()and o and h:IsSpellInRange(Q.Sepsis)and O.MasterAssassinsMarkRemains()<=0 then if l.Cast(Q.Sepsis,nil,nil)then X=328305;return"Cast Sepsis"end end;if Q.GhostlyStrike:IsReady()and h:IsSpellInRange(Q.GhostlyStrike)then if l.Cast(Q.GhostlyStrike,nil)then X=196937;return"Cast Ghostly Strike"end end;if Q.Shiv:IsReady()and a4 then if l.Cast(Q.Shiv)then X=5938;return"Cast Shiv (TTB)"end end;if Q.EchoingReprimand:IsReady()and o and h:IsSpellInRange(Q.EchoingReprimand)and(not Q.EffusiveAnimaAccelerator:SoulbindEnabled()or aD())then if l.Cast(Q.EchoingReprimand,nil,nil)then X=323547;return"Cast Echoing Reprimand"end end;if Q.SerratedBoneSpike:IsReady()and o then if g:BuffUp(Q.SliceandDice)and not h:DebuffUp(Q.SerratedBoneSpikeDebuff)or P.Outlaw.DumpSpikes and d.BossFilteredFightRemains("<",5)then if l.Cast(Q.SerratedBoneSpike,nil,nil)then X=328547;return"Cast Serrated Bone Spike"end end;if m()then local aK,aL=nil,4;local aM=h:GUID()for aN,aO in pairs(T)do if aO:GUID()~=aM and N.UnitIsCycleValid(aO,aL,-aO:DebuffRemains(Q.SerratedBoneSpike))and not aO:DebuffUp(Q.SerratedBoneSpikeDebuff)then aK,aL=aO,aO:TimeToDie()end end;if aK and o then l.CastLeftNameplate(aK,Q.SerratedBoneSpike)if aK:GUID()==f("mouseover"):GUID()and P.Outlaw.TargetSwap=="Mouseover"then Y=3285415 elseif P.Outlaw.TargetSwap=="AutoSwap"and aK:GUID()~=h:GUID()and not r then Y=999 end end end;if Q.SerratedBoneSpike:ChargesFractional()>2.75 and o then if l.Cast(Q.SerratedBoneSpike,nil,nil)then X=328547;return"Cast Serrated Bone Spike Filler"end end end;if Q.PistolShot:IsCastable()and h:IsSpellInRange(Q.PistolShot)and g:BuffUp(Q.Opportunity)then if g:EnergyDeficitPredicted()>g:EnergyRegen()+10 or a2<=1+a9(g:BuffUp(Q.Broadside))or Q.QuickDraw:IsAvailable()then if l.CastPooling(Q.PistolShot)then X=185763;return"Cast Pistol Shot"end end;if g:BuffUp(Q.GreenskinsWickers)or g:BuffUp(Q.ConcealedBlunderbuss)or g:BuffUp(Q.TornadoTriggerBuff)then if l.CastPooling(Q.PistolShot)then X=185763;return"Cast Pistol Shot (Buffed)"end end end;if Q.SinisterStrike:IsCastable()and h:IsSpellInRange(Q.SinisterStrike)then if l.CastPooling(Q.SinisterStrike)then X=193315;return"Cast Sinister Strike"end end end;local function aP()q=HeroRotationCharDB.Toggles[6]o=HeroRotationCharDB.Toggles[4]p=HeroRotationCharDB.Toggles[5]r=HeroRotationCharDB.Toggles[12]s=HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[27]A=HeroRotationCharDB.Toggles[50]B=HeroRotationCharDB.Toggles[51]u=HeroRotationCharDB.Toggles[52]C=HeroRotationCharDB.Toggles[53]D=HeroRotationCharDB.Toggles[30]E=HeroRotationCharDB.Toggles[54]if P.Commons.Enabled.TopTrinket then L=GetInventoryItemID("player",13)else L=1 end;if P.Commons.Enabled.BottomTrinket then M=GetInventoryItemID("player",14)else M=1 end;F=0;for ay=1,20 do if select(10,UnitDebuff("player",ay))==240447 then if select(6,UnitDebuff("player",ay))~=nil then F=select(6,UnitDebuff("player",ay))-GetTime()end end end end;local function aQ()Z=Q.AcrobaticStrikes:IsAvailable()and 9 or 6;_=Q.Dispatch:Damage()*1.25;a1=g:ComboPoints()a0=ah(a1)a2=g:ComboPointsDeficit()if m()then T=g:GetEnemiesInRange(30)U=g:GetEnemiesInRange(Z)V=#U else V=1 end;W=aP()if W then return W end;if Y>0 then Y=0 end;if X>0 then X=0 end;X=O.ReturnSpell()Y=O.ReturnSpellMO()if l.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then J=GetTime()K=J+l.GUISettings.General.OpenerReset elseif l.GUISettings.General.OpenerReset>0 and K~=nil and GetTime()>K and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]l.ToggleIconFrame:UpdateButtonText(6)l.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if C and Q.GrapplingHook:IsUsableP()and Q.GrapplingHook:CooldownRemains(BypassRecovery)<=0 then if l.Cast(Q.GrapplingHook,nil,nil,nil)then X=195457;return"queue Grappling Hook"end elseif(not Q.GrapplingHook:IsUsableP()or Q.GrapplingHook:CooldownRemains()>0)and C then HeroRotationCharDB.Toggles[53]=not HeroRotationCharDB.Toggles[53]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[53]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if v and Q.CheapShot:IsUsableP()and Q.CheapShot:CooldownRemains(BypassRecovery)<=0 and(g:StealthUp(true,true)or g:BuffUp(Q.VanishBuff))and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(Q.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.CheapShot)then Y=18335;return"queue Cheap Shot MO"else X=1833;return"queue Cheap Shot"end end elseif(not Q.CheapShot:IsUsableP()or Q.CheapShot:CooldownRemains()>0)and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]l.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and Q.KidneyShot:IsUsableP()and Q.KidneyShot:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(Q.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.KidneyShot)then Y=4085;return"queue Kidney Shot MO"else X=408;return"queue Kidney Shot"end end elseif(not Q.KidneyShot:IsUsableP()or Q.KidneyShot:CooldownRemains()>0)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]l.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and Q.Blind:IsUsableP()and Q.Blind:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(15)or f("mouseover"):IsInRange(15))then if l.Cast(Q.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Blind)then Y=20945;return"queue Blind MO"end end elseif(not Q.Blind:IsUsableP()or Q.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]l.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and Q.Sap:IsUsableP()and Q.Sap:CooldownRemains(BypassRecovery)<=0 and g:StealthUp(true,true)and(h:IsInRange(10)or f("mouseover"):IsInRange(10))then if l.Cast(Q.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Sap)then Y=67705;return"queue Sap MO"else X=6770;return"queue Sap"end end elseif(not Q.Sap:IsUsableP()or Q.Sap:CooldownRemains()>0 or not g:StealthUp(true,true))and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]l.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and Q.Feint:IsUsableP()and Q.Feint:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Feint,nil,nil,nil)then X=202;return"queue Shuriken Tornado"end elseif(not Q.Feint:IsUsableP()or Q.Feint:CooldownRemains()>0 or not g:AffectingCombat())and z then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]l.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and Q.Gouge:IsUsableP()and Q.Gouge:CooldownRemains(BypassRecovery)<=0 and(h:IsInRange(8)or f("mouseover"):IsInRange(8))then if l.Cast(Q.Gouge,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(Q.Gouge)then Y=17765;return"queue Gouge MO"else X=1776;return"queue Gouge"end end elseif(not Q.Gouge:IsUsableP()or Q.Gouge:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[50]=not HeroRotationCharDB.Toggles[50]l.Print("Gouge Queue is now "..(HeroRotationCharDB.Toggles[50]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if Q.ArcaneTorrent:IsAvailable()and Q.ArcaneTorrent:IsUsableP()and Q.ArcaneTorrent:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.ArcaneTorrent,nil,nil,nil)then X=155145;return"queue ArcaneTorrent Queue"end elseif Q.LightsJudgment:IsAvailable()and Q.LightsJudgment:IsUsableP()and Q.LightsJudgment:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.LightsJudgment,nil,nil,nil)then X=255647;return"queue ArcaneTorrent Queue"end elseif Q.BagofTricks:IsAvailable()and Q.BagofTricks:IsUsableP()and Q.BagofTricks:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.BagofTricks,nil,nil,nil)then X=312411;return"queue ArcaneTorrent Queue"end elseif Q.BloodFury:IsAvailable()and Q.BloodFury:IsUsableP()and Q.BloodFury:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.BloodFury,nil,nil,nil)then X=20572;return"queue ArcaneTorrent Queue"end elseif Q.Berserking:IsAvailable()and Q.Berserking:IsUsableP()and Q.Berserking:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Berserking,nil,nil,nil)then X=26297;return"queue ArcaneTorrent Queue"end elseif Q.Fireblood:IsAvailable()and Q.Fireblood:IsUsableP()and Q.Fireblood:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.Fireblood,nil,nil,nil)then X=265221;return"queue ArcaneTorrent Queue"end elseif Q.AncestralCall:IsAvailable()and Q.AncestralCall:IsUsableP()and Q.AncestralCall:CooldownRemains(BypassRecovery)<=0 and g:AffectingCombat()then if l.Cast(Q.AncestralCall,nil,nil,nil)then X=274738;return"queue ArcaneTorrent Queue"end elseif(Q.ArcaneTorrent:IsAvailable()and(not Q.ArcaneTorrent:IsUsableP()or Q.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or Q.LightsJudgment:IsAvailable()and(not Q.LightsJudgment:IsUsableP()or Q.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or Q.BagofTricks:IsAvailable()and(not Q.BagofTricks:IsUsableP()or Q.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or Q.BloodFury:IsAvailable()and(not Q.BloodFury:IsUsableP()or Q.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or Q.Berserking:IsAvailable()and(not Q.Berserking:IsUsableP()or Q.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or Q.Fireblood:IsAvailable()and(not Q.Fireblood:IsUsableP()or Q.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or Q.AncestralCall:IsAvailable()and(not Q.AncestralCall:IsUsableP()or Q.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]l.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;if g:IsChanneling(i(324631))then if g:AffectingCombat()and P.Outlaw.CastCancelFC then X=1999 elseif l.CastAnnotated(Q.PoolEnergy,false,"WAIT")then X=99999;return"Pool During Fleshcraft"end end;if g:IsChanneling(i(324631))then if l.Cast(Q.PoolEnergy,nil,nil,nil)then X=99999;return"channeling Fleashcraft"end end;W=O.CrimsonVial()if W then return W end;W=O.Feint()if W then return W end;W=O.Evasion()if W then return W end;if g:HealthPercentage()<P.Commons.PhialHP and R.PhialofSerenity:IsReady()and R.PhialofSerenity:CooldownRemains()<=0 then if l.Cast(R.PhialofSerenity,nil)then X=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<P.Commons.HealthstoneHP and R.Healthstone:IsReady()and R.Healthstone:CooldownRemains()<=0 then if l.Cast(R.Healthstone,nil)then X=40;return"Healthstone HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.CosmicHealPot:IsReady()and R.CosmicHealPot:CooldownRemains()<=0 then if l.Cast(R.CosmicHealPot,nil)then X=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<P.Commons.HealPotHP and R.HealPot:IsReady()and R.HealPot:CooldownRemains()<=0 then if l.Cast(R.HealPot,nil)then X=41;return"HealPot HP"end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if Q.PistolShot:IsCastable()and f("mouseover"):IsInMeleeRange(20)then if l.Cast(Q.PistolShot,nil)then Y=1185763;return"explosive MO Pistol"end end end;if Q.PistolShot:IsCastable()and f("target"):IsInMeleeRange(40)and string.find(UnitGUID("target"),120651)then if l.Cast(Q.PistolShot,nil)then X=185763;return"explosive Tar Pistol"end end;G={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668}if UnitExists("target")and Q.Shiv:IsReady()and not E then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for ay=0,40 do local aN,aN,aR,aS,aN,aN,aN,aN,aN,aT=UnitBuff("target",ay)for aN,aU in pairs(G)do if aU==aT then if l.Cast(Q.Shiv,nil)then X=5938;return"Shiv Enrage"end end end end end end;local aV=g:AffectingCombat()and 180 or 900;local aW;if i(8679):IsAvailable()and P.Commons.LethalPoison=="Wound Poison"then aW=g:BuffRemains(i(8679))if aW<aV and not g:IsCasting(i(8679))then if l.Cast(i(8679))then X=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and P.Commons.LethalPoison=="Deadly Poison"then aW=g:BuffRemains(i(2823))if aW<aV and not g:IsCasting(i(2823))then if l.Cast(i(2823))then X=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and P.Commons.LethalPoison=="Instant Poison"then aW=g:BuffRemains(i(315584))if aW<aV and not g:IsCasting(i(315584))then if l.Cast(i(315584))then X=205;return"Instant Poison Refresh"end end end;aW=g:BuffRemains(i(3408))if i(3408):IsAvailable()and P.Commons.NonLethalPoison=="Crippling Poison"then if aW<aV and not g:IsCasting(i(3408))then if l.Cast(i(3408))then X=206;return"Crippling Poison Refresh"end end elseif i(5761):IsAvailable()and P.Commons.NonLethalPoison=="Numbing Poison"then aW=g:BuffRemains(i(5761))if aW<aV and not g:IsCasting(NumbingPoison)then if l.Cast(i(5761))then X=204;return"Numbing Poison Refresh"end end end;if not g:BuffUp(Q.VanishBuff)and not g:AffectingCombat()and not g:StealthUp(true,true)then W=O.Stealth(Q.Stealth)if W then return W end end;if not g:AffectingCombat()and q then if N.TargetIsValid()and(not g:AffectingCombat()and q)then if n()and Q.MarkedforDeath:IsCastable()and a2>=O.CPMaxSpend()-1 and h:NPCID()~=170234 then if P.Commons.STMfDAsDPSCD then if l.Cast(Q.MarkedforDeath,nil)then X=137619;return"Cast Marked for Death (OOC)"end else if l.Cast(Q.MarkedforDeath,nil)then X=137619;return"Cast Marked for Death (OOC)"end end end;if Q.RolltheBones:IsReady()and(O.RtBRemains()<=3 or aA())then if l.Cast(Q.RolltheBones)then X=315508;return"Cast Roll the Bones (Opener)"end end;if Q.SliceandDice:IsReady()and g:BuffRemains(Q.SliceandDice)<(1+a1)*1.8 then if l.CastPooling(Q.SliceandDice)then X=315496;return"Cast Slice and Dice (Opener)"end end;if g:StealthUp(true,true)or g:BuffUp(Q.VanishBuff)then W=aH()if W then return"Stealth (Opener): "..W end elseif aB()then W=aI()if W then return"Finish (Opener): "..W end elseif Q.SinisterStrike:IsCastable()then if l.Cast(Q.SinisterStrike)then X=193315;return"Cast Sinister Strike (Opener)"end end end;return end;if Q.MarkedforDeath:IsCastable()and(g:AffectingCombat()or q or g:BuffUp(Q.VanishBuff))then if V>1 and N.CastTargetIf(Q.MarkedforDeath,T,"min",ap,ar,nil,nil)then return"Cast Marked for Death (Cycle)"elseif V==1 and not g:StealthUp(true,false)and a2>=O.CPMaxSpend()-1 and h:NPCID()~=170234 then if P.Commons.STMfDAsDPSCD then if l.Cast(Q.MarkedforDeath,nil)then X=137619;return"Cast Marked for Death (ST)"end else if l.Cast(Q.MarkedforDeath,nil)then X=137619;return"Cast Marked for Death (ST)"end end end end;if N.TargetIsValid()and(g:AffectingCombat()or q or g:BuffUp(Q.VanishBuff))then if g:StealthUp(true,true)or g:BuffUp(Q.VanishBuff)then W=aH()if W then return"Stealth: "..W end end;local aX,aY,aN=GetSpellCooldown(57934)if P.Commons.AutoToT then if aX+aY-GetTime()<=0 and Q.TricksoftheTrade:IsAvailable()and Q.TricksoftheTrade:CooldownRemains(BypassRecovery)<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if l.Cast(Q.TricksoftheTrade)then X=207;return"ToT Focus"end end end;W=aF()if W then return"CDs: "..W end;if aB()then W=aI()if W then return"Finish: "..W end;l.Cast(Q.PoolEnergy)return"Finish Pooling"end;W=aJ()if W then return"Build: "..W end;if Q.ArcaneTorrent:IsCastable()and P.Commons.Enabled.Racials and h:IsSpellInRange(Q.SinisterStrike)and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if l.Cast(Q.ArcaneTorrent,nil)then X=155145;return"Cast Arcane Torrent"end end;if Q.ArcanePulse:IsCastable()and P.Commons.Enabled.Racials and h:IsSpellInRange(Q.SinisterStrike)then if l.Cast(Q.ArcanePulse)then X=260364;return"Cast Arcane Pulse"end end;if Q.LightsJudgment:IsCastable()and P.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(Q.LightsJudgment,nil)then X=255647;return"Cast Lights Judgment"end end;if Q.BagofTricks:IsCastable()and P.Commons.Enabled.Racials and h:IsInMeleeRange(5)then if l.Cast(Q.BagofTricks,nil)then X=312411;return"Cast Bag of Tricks"end end;if Q.PistolShot:IsCastable()and h:IsSpellInRange(Q.PistolShot)and not h:IsInRange(Z)and not g:StealthUp(true,true)and g:EnergyDeficitPredicted()<25 and(a2>=1 or ad()<=1.2)then if l.Cast(Q.PistolShot)then X=185763;return"Cast Pistol Shot (OOR)"end end end end;local function aZ()Q.Flagellation:RegisterAuraTracking()end;function ReturnSpellOut()if X==0 then return 0 else return X end end;function ReturnSpellMOOut()if Y==0 then return 0 else return Y end end;l.SetAPL(260,aQ,aZ)