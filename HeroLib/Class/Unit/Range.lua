local a,b=...local c=HeroDBC.DBC;local d,e=HeroCache,b.Utils;local f=b.Unit;local g,h,i=f.Player,f.Pet,f.Target;local j,k=f.Focus,f.MouseOver;local l,m,n=f.Arena,f.Boss,f.Nameplate;local o,p=f.Party,f.Raid;local q=b.Spell;local r=b.Item;local s=math.ceil;local t=math.floor;local u=math.random;local pairs=pairs;local v=table.insert;local w=table.sort;local type=type;local unpack=unpack;local BOOKTYPE_SPELL=BOOKTYPE_SPELL;local IsActionInRange=IsActionInRange;local IsSpellInRange=IsSpellInRange;local x={}local function y()wipe(x)local z=d.Persistent.Player.Class[3]if z==1 then elseif z==2 then local A=q(403042):IsAvailable()and 3 or 0;v(x,35395,5+A)v(x,96231,5+A)v(x,407480,5+A)elseif z==3 then elseif z==4 then local B=q(196924):IsAvailable()and 3 or 0;v(x,703,5+B)v(x,1329,5+B)v(x,1766,5+B)v(x,5938,5+B)v(x,193315,5+B)v(x,196937,5+B)v(x,200758,5+B)v(x,360194,5+B)v(x,385627,5+B)v(x,426591,5+B)elseif z==5 then elseif z==6 then elseif z==7 then elseif z==8 then elseif z==9 then elseif z==10 then elseif z==11 then local C=d.Persistent.Player.Spec[1]if C==102 then local D=s(2.5*q(197524):TalentRank())v(x,339,35+D)v(x,2908,40+D)v(x,8921,40+D)v(x,78675,40+D)v(x,93402,40+D)v(x,190984,40+D)v(x,194153,40+D)v(x,202770,40+D)elseif C==103 or C==104 then local D=math.floor(1.5*q(197524):TalentRank())v(x,339,35+D)v(x,1822,5+D)v(x,2908,40+D)v(x,5211,5+D)v(x,5221,5+D)v(x,6795,30+D)v(x,8921,40+D)v(x,16979,25+D)v(x,33917,5+D)v(x,49376,25+D)v(x,77758,8+D)v(x,93402,40+D)v(x,102793,30+D)v(x,106830,8+D)v(x,106839,13+D)v(x,202028,8+D)v(x,213771,8+D)v(x,274837,5+D)end elseif z==12 then v(x,183752,q(320361):IsAvailable()and 10 or 5)elseif z==13 then end end;local function E()local F=BOOKTYPE_SPELL;local G=0;for H=2,3 do local I,I,J,K,I,L=GetSpellTabInfo(H)if L==0 then G=J+K end end;if type(d.Persistent.RangeSpells)=="table"then wipe(d.Persistent.RangeSpells)else d.Persistent.RangeSpells={}end;d.Persistent.RangeSpells.RangeIndex={}d.Persistent.RangeSpells.SpellRange={}d.Persistent.RangeSpells.MinRangeSpells={}for M=1,G do local N,O=GetSpellBookItemInfo(M,F)if N=="SPELL"or type=="PETACTION"then local P=GetSpellBookItemName(M,F)local I,Q=GetSpellLink(P)if SpellHasRange(M,F)then local R=c.SpellMeleeRange[Q]if R then local S=R[1]local T=R[2]local U=x[Q]and x[Q]or R[3]if U and(q(Q):IsReady()or q(Q):CooldownDown()or Q==921)then if not d.Persistent.RangeSpells.SpellRange[U]then d.Persistent.RangeSpells.SpellRange[U]={}v(d.Persistent.RangeSpells.RangeIndex,U)v(d.Persistent.RangeSpells.SpellRange[U],Q)if T and T>0 then d.Persistent.RangeSpells.MinRangeSpells[Q]=T end else v(d.Persistent.RangeSpells.SpellRange[U],Q)if T and T>0 then d.Persistent.RangeSpells.MinRangeSpells[Q]=T end end end end end end end;w(d.Persistent.RangeSpells.RangeIndex)end;b.RangeSpellFrame=CreateFrame("Frame","HeroLib_MainFrame",UIParent)b.RangeSpellFrame:RegisterEvent("ADDON_LOADED")b.RangeSpellFrame:SetScript("OnEvent",function(self,V,W)if V=="ADDON_LOADED"then if W=="HeroLib"then y()E()b:RegisterForEvent(function()y()E()end,"SPELLS_CHANGED")C_Timer.After(2,function()b.RangeSpellFrame:UnregisterEvent("ADDON_LOADED")end)end end end)function f:IsInRange(X)assert(type(X)=="number","Distance must be a number.")assert(X>=5 and X<=100,"Distance must be between 5 and 100.")local Y=self:GUID()if not Y then return false end;local Z=d.UnitInfo[Y]if not Z then Z={}d.UnitInfo[Y]=Z end;local _=Z.IsInRange;if not _ then _={}Z.IsInRange=_ end;local a0=X;local a1=_[a0]if a1==nil then local a2=d.Persistent.RangeSpells;local a3=a2.SpellRange;local a4=nil;local a5=a2.RangeIndex;for H=#a5,1,-1 do local a6=a5[H]if a6==nil then H=H-1;if H<=0 then return false else a6=a5[H]end end;if a6 and a6<=X then for a7,Q in pairs(a3[a6])do local T=d.Persistent.RangeSpells.MinRangeSpells[Q]if T and T<X and not self:IsInRange(T)or not T then local a8=q(Q):BookIndex()local F=q(Q):BookType()local a9=IsSpellInRange(a8,F,self:ID())if a9==nil then a3[a6][a7]=nil;local aa=0;for I in pairs(a3[a6])do aa=aa+1 end;if aa==0 then a5[H]=nil;a3[a6]=nil end else a4=q(Q)break end end end;X=a6-1 end;if a4 then break end end;if not a4 then return false end;a1=self:IsSpellInRange(a4)_[a0]=a1 end;return a1 end;function f:IsInMeleeRange(X)assert(type(X)=="number","Distance must be a number.")assert(X>=5 and X<=100,"Distance must be between 5 and 100.")if X~=5 then return self:IsInRange(X-1.5)end;local Y=self:GUID()if not Y then return false end;return self:IsInRange(5)end;function f:IsSpellInRange(ab)local Y=self:GUID()if not Y then return false end;if ab:BookIndex()==nil then return false end;return IsSpellInRange(ab:BookIndex(),ab:BookType(),self:ID())==1 end;function f:IsActionInRange(ac)return IsActionInRange(ac,self:ID())end;local function ad(ae,af)local a2=d.Persistent.RangeSpells;local a5=a2.RangeIndex;if not a5 then return nil end;for H=#a5-(af and 1 or 0),1,-1 do if a5[H]and not ae:IsInRange(a5[H])then return af and a5[H+1]or a5[H]end end end;function f:MinDistance()return ad(self)end;function f:MaxDistance()return ad(self,true)end