local a,b=...local c,d=HeroCache,b.Utils;local e=b.Unit;local f,g,h=e.Player,e.Pet,e.Target;local i,j=e.Focus,e.MouseOver;local k,l,m=e.Arena,e.Boss,e.Nameplate;local n,o=e.Party,e.Raid;local p=b.Spell;local q=b.Item;local r=C_LegendaryCrafting.GetRuneforgeLegendaryComponentInfo;local s=C_LegendaryCrafting.IsRuneforgeLegendary;local GetInventoryItemID=GetInventoryItemID;local ItemLocation=ItemLocation;local select=select;local wipe=wipe;local t={}local u={}local v={}function f:GetEquipment()return t end;function f:UpdateEquipment()wipe(t)wipe(u)for w=1,19 do local x=select(1,GetInventoryItemID("player",w))if x~=nil then t[w]=x;if w==13 or w==14 then local y=q(x,{w})if y:IsUsable()then table.insert(u,y)end end end end end;do local z={FlayedwingToxin=q(178742,{13,14}),MistcallerOcarina=q(178715,{13,14}),SoulIgniter=q(184019,{13,14}),DarkmoonDeckIndomitable=q(173096,{13,14}),ShardofAnnhyldesAegis=q(186424,{13,14}),TomeofMonstruousConstructions=q(186422,{13,14}),SoleahsSecretTechnique=q(185818,{13,14}),SoleahsSecretTechnique2=q(190958,{13,14}),PrimalRitualShell=q(200563,{13,14}),RubyWhelpShell=q(193757,{13,14})}local A={FlayedwingToxinBuff=p(345545),MistcallerVers=p(330067),MistcallerCrit=p(332299),MistcallerHaste=p(332300),MistcallerMastery=p(332301),SoulIgniterBuff=p(345211),IndomitableFive=p(311496),IndomitableSix=p(311497),IndomitableSeven=p(311498),IndomitableEight=p(311499),TomeofMonstruousConstructionsBuff=p(357163),SoleahsSecretTechniqueBuff=p(351952),SoleahsSecretTechnique2Buff=p(368512)}local function B(y)if not y then return false end;local C=y:ID()if b.GUISettings.General.Blacklist.TrinketUserDefined[C]then if type(b.GUISettings.General.Blacklist.TrinketUserDefined[C])=="boolean"then return true else return b.GUISettings.General.Blacklist.TrinketUserDefined[C](y)end end;return false end;function f:GetUseableTrinkets(D,E)for F,y in ipairs(u)do local C=y:ID()local G=false;if E and t[E]~=C then G=true elseif y:IsReady()and not B(y)then for w=1,#D do if D[w]==C then G=true;break end end;if not G then if C==z.FlayedwingToxin:ID()then if not f:AuraInfo(A.FlayedwingToxinBuff)then return y end elseif C==z.MistcallerOcarina:ID()then if not(f:BuffUp(A.MistcallerCrit)or f:BuffUp(A.MistcallerHaste)or f:BuffUp(A.MistcallerMastery)or f:BuffUp(A.MistcallerVers))then return y end elseif C==z.SoulIgniter:ID()then if f:BuffDown(A.SoulIgniterBuff)and h:IsInRange(40)then return y end elseif C==z.DarkmoonDeckIndomitable:ID()then if(f:BuffUp(A.IndomitableFive)or f:BuffUp(A.IndomitableSix)or f:BuffUp(A.IndomitableSeven)or f:BuffUp(A.IndomitableEight))and(f:IsTankingAoE(8)or f:IsTanking(h))then return y end elseif C==z.ShardofAnnhyldesAegis:ID()then if f:IsTankingAoE(8)or f:IsTanking(h)then return y end elseif C==z.TomeofMonstruousConstructions:ID()then if not f:AuraInfo(A.TomeofMonstruousConstructionsBuff)then return y end elseif C==z.SoleahsSecretTechnique:ID()or C==z.SoleahsSecretTechnique2:ID()then if not(f:BuffUp(A.SoleahsSecretTechniqueBuff)or f:BuffUp(A.SoleahsSecretTechnique2Buff))then return y end elseif C==z.RubyWhelpShell:ID()or C==z.PrimalRitualShell:ID()then return nil else return y end end end end;return nil end end;function f:UpdateActiveLegendaryEffects()wipe(v)for w=1,15,1 do if w~=13 and w~=14 then local H=ItemLocation:CreateFromEquipmentSlot(w)if H:IsValid()and s(H)then local I=r(H)v[I.powerID]=true end end end end;function f:HasLegendaryEquipped(J)return v[J]~=nil end;local K={264,267,268,269,270,271,272,273,274,275,276,277}local L={190464,190465,190466,190467,190468,190469,190470,190471,190472,190473,190474,190475}function f:HasUnity()for F,J in pairs(K)do if f:HasLegendaryEquipped(J)then return true end end;local M=t[6]for F,N in pairs(L)do if M and M==N then return true end end;return false end;local O={[28]={[1]={[1]=188942,[3]=188941,[5]=188938,[7]=188940,[10]=188937},[2]={[1]=188933,[3]=188932,[5]=188929,[7]=188931,[10]=188928},[3]={[1]=188859,[3]=188856,[5]=188858,[7]=188860,[10]=188861},[4]={[1]=188901,[3]=188905,[5]=188903,[7]=188902,[10]=188907},[5]={[1]=188880,[3]=188879,[5]=188875,[7]=188878,[10]=188881},[6]={[1]=188868,[3]=188867,[5]=188864,[7]=188866,[10]=188863},[7]={[1]=188923,[3]=188920,[5]=188922,[7]=188924,[10]=188925},[8]={[1]=188844,[3]=188843,[5]=188839,[7]=188842,[10]=188845},[9]={[1]=188889,[3]=188888,[5]=188884,[7]=188887,[10]=188890},[10]={[1]=188910,[3]=188914,[5]=188912,[7]=188911,[10]=188916},[11]={[1]=188847,[3]=188851,[5]=188849,[7]=188848,[10]=188853},[12]={[1]=188892,[3]=188896,[5]=188894,[7]=188893,[10]=188898},[13]={[1]=nil,[3]=nil,[5]=nil,[7]=nil,[10]=nil}},[29]={[1]={[1]=200426,[3]=200428,[5]=200423,[7]=200427,[10]=200425},[2]={[1]=200417,[3]=200419,[5]=200414,[7]=200418,[10]=200416},[3]={[1]=200390,[3]=200392,[5]=200387,[7]=200391,[10]=200389},[4]={[1]=200372,[3]=200374,[5]=200369,[7]=200373,[10]=200371},[5]={[1]=200327,[3]=200329,[5]=200324,[7]=200328,[10]=200326},[6]={[1]=200408,[3]=200410,[5]=200405,[7]=200409,[10]=200407},[7]={[1]=200399,[3]=200401,[5]=200396,[7]=200400,[10]=200398},[8]={[1]=200318,[3]=200320,[5]=200315,[7]=200319,[10]=200317},[9]={[1]=200336,[3]=200338,[5]=200333,[7]=200337,[10]=200335},[10]={[1]=200363,[3]=200365,[5]=200360,[7]=200364,[10]=200362},[11]={[1]=200354,[3]=200356,[5]=200351,[7]=200355,[10]=200353},[12]={[1]=200345,[3]=200347,[5]=200342,[7]=200346,[10]=200344},[13]={[1]=200381,[3]=200383,[5]=200378,[7]=200382,[10]=200380}},[30]={[1]={[1]=202443,[3]=202441,[5]=202446,[7]=202442,[10]=202444},[2]={[1]=202452,[3]=202450,[5]=202455,[7]=202451,[10]=202453},[3]={[1]=202479,[3]=202477,[5]=202482,[7]=202478,[10]=202480},[4]={[1]=202497,[3]=202495,[5]=202500,[7]=202496,[10]=202498},[5]={[1]=202542,[3]=202540,[5]=202545,[7]=202541,[10]=202543},[6]={[1]=202461,[3]=202459,[5]=202464,[7]=202460,[10]=202462},[7]={[1]=202470,[3]=202468,[5]=202473,[7]=202469,[10]=202471},[8]={[1]=202551,[3]=202549,[5]=202554,[7]=202550,[10]=202552},[9]={[1]=202533,[3]=202531,[5]=202536,[7]=202532,[10]=202534},[10]={[1]=202506,[3]=202504,[5]=202509,[7]=202505,[10]=202507},[11]={[1]=202515,[3]=202513,[5]=202518,[7]=202514,[10]=202516},[12]={[1]=202524,[3]=202522,[5]=202527,[7]=202523,[10]=202525},[13]={[1]=202488,[3]=202486,[5]=202491,[7]=202487,[10]=202489}},[31]={[1]={[1]=207182,[3]=207180,[5]=207185,[7]=207181,[10]=207183},[2]={[1]=207191,[3]=207189,[5]=207194,[7]=207190,[10]=207192},[3]={[1]=207218,[3]=207216,[5]=207221,[7]=207217,[10]=207219},[4]={[1]=207236,[3]=207234,[5]=207239,[7]=207235,[10]=207237},[5]={[1]=207281,[3]=207279,[5]=207284,[7]=207280,[10]=207282},[6]={[1]=207200,[3]=207198,[5]=207203,[7]=207199,[10]=207201},[7]={[1]=207209,[3]=207207,[5]=207212,[7]=207208,[10]=207210},[8]={[1]=207290,[3]=207288,[5]=207293,[7]=207289,[10]=207291},[9]={[1]=207272,[3]=207270,[5]=207275,[7]=207271,[10]=207273},[10]={[1]=207245,[3]=207243,[5]=207248,[7]=207244,[10]=207246},[11]={[1]=207254,[3]=207252,[5]=207257,[7]=207253,[10]=207255},[12]={[1]=207263,[3]=207261,[5]=207266,[7]=207262,[10]=207264},[13]={[1]=207227,[3]=207225,[5]=207230,[7]=207226,[10]=207228}}}function f:HasTier(P,Q)if O[P][c.Persistent.Player.Class[3]]then local R=0;local q;for S,x in pairs(O[P][c.Persistent.Player.Class[3]])do q=t[S]if q and q==x then R=R+1 end end;return R>=Q else return false end end