local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Pet;local i=f.Target;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.Commons.Everyone.num;local q=l.Commons.Everyone.bool;local r=l.Commons.Everyone;local s={General=l.GUISettings.General,Commons=l.GUISettings.APL.Warlock.Commons,Affliction=l.GUISettings.APL.Warlock.Affliction}local t=j.Warlock.Affliction;local u=k.Warlock.Affliction;local v={u.BelorrelostheSuncaller:ID()}local w=g:GetEquipment()local x=w[13]and k(w[13])or k(0)local y=w[14]and k(w[14])or k(0)local z,A,B;local C,D,E,F,G,H,I;local J;local K=0;local L=11111;local M=11111;d:RegisterForEvent(function()t.SeedofCorruption:RegisterInFlight()t.ShadowBolt:RegisterInFlight()t.Haunt:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")t.SeedofCorruption:RegisterInFlight()t.ShadowBolt:RegisterInFlight()t.Haunt:RegisterInFlight()d:RegisterForEvent(function()w=g:GetEquipment()x=w[13]and k(w[13])or k(0)y=w[14]and k(w[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()L=11111;M=11111 end,"PLAYER_REGEN_ENABLED")local function N(O)local P;for Q,R in pairs(O)do local S=R:DebuffRemains(t.AgonyDebuff)+99*p(R:DebuffDown(t.AgonyDebuff))if P==nil or S<P then P=S end end;return P or 0 end;local function T(O)if t.SeedofCorruption:InFlight()or g:PrevGCDP(1,t.SeedofCorruption)then return false end;local U=0;local V=0;for Q,R in pairs(O)do U=U+1;if R:DebuffUp(t.SeedofCorruptionDebuff)then V=V+1 end end;return U==V end;local function W(X)return X:DebuffRemains(t.AgonyDebuff)end;local function Y(X)return X:DebuffRemains(t.CorruptionDebuff)end;local function Z(X)return X:DebuffRemains(t.SiphonLifeDebuff)end;local function _(X)return X:DebuffRemains(t.AgonyDebuff)<X:DebuffRemains(t.VileTaintDebuff)+t.VileTaint:CastTime()and X:DebuffRemains(t.AgonyDebuff)<5 end;local function a0(X)return X:DebuffRemains(t.AgonyDebuff)<5 end;local function a1(X)return X:DebuffRemains(t.CorruptionDebuff)<5 end;local function a2(X)return X:DebuffRefreshable(t.SiphonLifeDebuff)end;local function a3(X)return X:DebuffRemains(t.AgonyDebuff)<5 end;local function a4(X)return X:DebuffRefreshable(t.AgonyDebuff)end;local function a5(X)return X:DebuffRemains(t.CorruptionDebuff)<5 end;local function a6(X)return X:DebuffRefreshable(t.CorruptionDebuff)end;local function a7(X)return X:DebuffStack(t.ShadowEmbraceDebuff)<3 or X:DebuffRemains(t.ShadowEmbraceDebuff)<3 end;local function a8(X)return X:DebuffRemains(t.SiphonLifeDebuff)<5 end;local function a9()if t.GrimoireofSacrifice:IsCastable()then if o(t.GrimoireofSacrifice,s.Affliction.GCDasOffGCD.GrimoireOfSacrifice)then return"grimoire_of_sacrifice precombat 2"end end;if t.Haunt:IsReady()then if o(t.Haunt,nil,nil,not i:IsSpellInRange(t.Haunt))then return"haunt precombat 6"end end;if t.UnstableAffliction:IsReady()and not t.SoulSwap:IsAvailable()then if o(t.UnstableAffliction,nil,nil,not i:IsSpellInRange(t.UnstableAffliction))then return"unstable_affliction precombat 8"end end;if t.ShadowBolt:IsReady()then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt precombat 10"end end end;local function aa()C=i:DebuffUp(t.PhantomSingularityDebuff)or not t.PhantomSingularity:IsAvailable()D=i:DebuffUp(t.VileTaintDebuff)or not t.VileTaint:IsAvailable()E=i:DebuffUp(t.VileTaintDebuff)or i:DebuffUp(t.PhantomSingularityDebuff)or not t.VileTaint:IsAvailable()and not t.PhantomSingularity:IsAvailable()F=i:DebuffUp(t.SoulRotDebuff)or not t.SoulRot:IsAvailable()G=C and D and F;H=t.PhantomSingularity:IsAvailable()or t.VileTaint:IsAvailable()or t.SoulRot:IsAvailable()or t.SummonDarkglare:IsAvailable()I=not H or(d.GuardiansTable.DarkglareDuration>0 or G and t.SummonDarkglare:CooldownRemains()>20 or g:PowerInfusionUp())end;local function ab()if s.Commons.Enabled.Trinkets and u.BelorrelostheSuncaller:IsEquippedAndReady()and(d.CombatTime()>20 and t.SummonDarkglare:CooldownRemains()>20 or x:ID()==u.BelorrelostheSuncaller:ID()and(y:CooldownDown()or y:Cooldown()==0 or x:ID()==u.TimeThiefsGambit:ID())or y:ID()==u.BelorrelostheSuncaller:ID()and(x:CooldownDown()or x:Cooldown()==0 or y:ID()==u.TimeThiefsGambit:ID())or M<20)then if o(u.BelorrelostheSuncaller,nil,s.Commons.DisplayStyle.Trinkets,not i:IsInRange(10))then return"belorrelos_the_suncaller items 2"end end;if s.Commons.Enabled.Items then local ac,Q,ad=g:GetUseableItems(v,16)if ac and ac:IsReady()then if o(ac,nil,s.Commons.DisplayStyle.Items,not i:IsInRange(ad))then return"Generic use_item for MH "..ac:Name()end end end;if I then local ae,af,ag=g:GetUseableItems(v)if ae then local ah=s.Commons.DisplayStyle.Trinkets;if af~=13 and af~=14 then ah=s.Commons.DisplayStyle.Items end;if(af==13 or af==14)and s.Commons.Enabled.Trinkets or af~=13 and af~=14 and s.Commons.Enabled.Items then if o(ae,nil,ah,not i:IsInRange(ag))then return"Generic use_items for "..ae:Name()end end end end end;local function ai()if I then if s.Commons.Enabled.Potions then local aj=r.PotionSelected()if aj and aj:IsReady()then if o(aj,nil,s.Commons.DisplayStyle.Potions)then return"potion ogcd 2"end end end;if t.Berserking:IsCastable()then if o(t.Berserking,s.Commons.OffGCDasOffGCD.Racials)then return"berserking ogcd 4"end end;if t.BloodFury:IsCastable()then if o(t.BloodFury,s.Commons.OffGCDasOffGCD.Racials)then return"blood_fury ogcd 6"end end;if t.Fireblood:IsCastable()then if o(t.Fireblood,s.Commons.OffGCDasOffGCD.Racials)then return"fireblood ogcd 8"end end;if t.AncestralCall:IsCastable()then if o(t.AncestralCall,s.Commons.OffGCDasOffGCD.Racials)then return"ancestral_call ogcd 10"end end end end;local function ak()if n()then local al=ai()if al then return al end end;if s.Commons.Enabled.Trinkets or s.Commons.Enabled.Items then local al=ab()if al then return al end end;J=N(A)if t.Haunt:IsReady()and i:DebuffRemains(t.HauntDebuff)<3 then if o(t.Haunt,nil,nil,not i:IsSpellInRange(t.Haunt))then return"haunt aoe 2"end end;if t.VileTaint:IsReady()and(t.SouleatersGluttony:TalentRank()==2 and(J<1.5 or t.SoulRot:CooldownRemains()<=t.VileTaint:ExecuteTime())or t.SouleatersGluttony:TalentRank()==1 and t.SoulRot:CooldownRemains()<=t.VileTaint:ExecuteTime()or not t.SouleatersGluttony:IsAvailable()and(t.SoulRot:CooldownRemains()<=t.VileTaint:ExecuteTime()or t.VileTaint:CooldownRemains()>25))then if o(t.VileTaint,nil,nil,not i:IsInRange(40))then return"vile_taint aoe 4"end end;if t.PhantomSingularity:IsCastable()then if o(t.PhantomSingularity,s.Affliction.GCDasOffGCD.PhantomSingularity,nil,not i:IsSpellInRange(t.PhantomSingularity))then return"phantom_singularity aoe 6"end end;if t.UnstableAffliction:IsReady()and i:DebuffRemains(t.UnstableAfflictionDebuff)<5 then if o(t.UnstableAffliction,nil,nil,not i:IsSpellInRange(t.UnstableAffliction))then return"unstable_affliction aoe 8"end end;if t.SiphonLife:IsReady()and(t.SiphonLifeDebuff:AuraActiveCount()<6 and t.SummonDarkglare:CooldownUp())then if r.CastCycle(t.SiphonLife,z,a8,not i:IsSpellInRange(t.SiphonLife))then return"siphon_life aoe 10"end end;if t.SoulRot:IsReady()and(D and C)then if o(t.SoulRot,nil,nil,not i:IsSpellInRange(t.SoulRot))then return"soul_rot aoe 12"end end;if t.SeedofCorruption:IsReady()and(i:DebuffRemains(t.CorruptionDebuff)<5 and not(t.SeedofCorruption:InFlight()or i:DebuffUp(t.SeedofCorruptionDebuff)))then if o(t.SeedofCorruption,nil,nil,not i:IsSpellInRange(t.SeedofCorruption))then return"seed_of_corruption aoe 14"end end;if t.Agony:IsReady()and t.AgonyDebuff:AuraActiveCount()<8 then if r.CastTargetIf(t.Agony,z,"min",W,_,not i:IsSpellInRange(t.Agony))then return"agony aoe 16"end end;if n()and t.SummonDarkglare:IsCastable()and(C and D and F)then if o(t.SummonDarkglare,s.Affliction.GCDasOffGCD.SummonDarkglare)then return"summon_darkglare aoe 18"end end;if t.MaleficRapture:IsReady()and(g:BuffUp(t.UmbrafireKindlingBuff)and(d.GuardiansTable.DarkglareDuration>0 or not t.DoomBlossom:IsAvailable()))then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture aoe 20"end end;if t.SeedofCorruption:IsReady()and t.SowTheSeeds:IsAvailable()then if o(t.SeedofCorruption,nil,nil,not i:IsSpellInRange(t.SeedofCorruption))then return"seed_of_corruption aoe 22"end end;if t.MaleficRapture:IsReady()and((t.SummonDarkglare:CooldownRemains()>15 or K>3)and not t.SowTheSeeds:IsAvailable()or g:BuffUp(t.TormentedCrescendoBuff))then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture aoe 24"end end;if t.DrainLife:IsReady()and(i:DebuffUp(t.SoulRotDebuff)or not t.SoulRot:IsAvailable())and g:BuffStack(t.InevitableDemiseBuff)>10 then if o(t.DrainLife,nil,nil,not i:IsSpellInRange(t.DrainLife))then return"drain_life aoe 26"end end;if t.DrainSoul:IsReady()and(g:BuffUp(t.NightfallBuff)and t.ShadowEmbrace:IsAvailable())then if r.CastCycle(t.DrainSoul,z,a7,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul aoe 28"end end;if t.DrainSoul:IsReady()and g:BuffUp(t.NightfallBuff)then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul aoe 30"end end;if t.SummonSoulkeeper:IsReady()and(t.SummonSoulkeeper:Count()==10 or t.SummonSoulkeeper:Count()>3 and M<10)then if o(t.SummonSoulkeeper)then return"soul_strike aoe 32"end end;if t.SiphonLife:IsReady()and t.SiphonLifeDebuff:AuraActiveCount()<5 then if r.CastCycle(t.SiphonLife,z,a8,not i:IsSpellInRange(t.SiphonLife))then return"siphon_life aoe 34"end end;if t.DrainSoul:IsReady()then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul aoe 36"end end;if t.ShadowBolt:IsReady()then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt aoe 38"end end end;local function am()if n()then local al=ai()if al then return al end end;if s.Commons.Enabled.Trinkets or s.Commons.Enabled.Items then local al=ab()if al then return al end end;if n()and t.SummonDarkglare:IsCastable()and(C and D and F)then if o(t.SummonDarkglare,s.Affliction.GCDasOffGCD.SummonDarkglare)then return"summon_darkglare cleave 2"end end;if t.MaleficRapture:IsReady()and(t.DreadTouch:IsAvailable()and i:DebuffRemains(t.DreadTouchDebuff)<2 and(i:DebuffUp(t.AgonyDebuff)and i:DebuffUp(t.CorruptionDebuff)and(not t.SiphonLife:IsAvailable()or i:DebuffUp(t.SiphonLifeDebuff)))and(not t.PhantomSingularity:IsAvailable()or t.PhantomSingularity:CooldownDown())and(not t.VileTaint:IsAvailable()or t.VileTaint:CooldownDown())and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownDown())or K>4 or g:BuffUp(t.UmbrafireKindlingBuff))then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 4"end end;if t.Agony:IsReady()then if r.CastTargetIf(t.Agony,z,"min",W,a0,not i:IsSpellInRange(t.Agony))then return"agony cleave 6"end end;if t.SoulRot:IsReady()and(D and C)then if o(t.SoulRot,nil,nil,not i:IsSpellInRange(t.SoulRot))then return"soul_rot cleave 8"end end;if t.VileTaint:IsReady()and(t.AgonyDebuff:AuraActiveCount()==2 and t.CorruptionDebuff:AuraActiveCount()==2 and(not t.SiphonLife:IsAvailable()or t.SiphonLifeDebuff:AuraActiveCount()==2)and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownRemains()<=t.VileTaint:ExecuteTime()or not t.SouleatersGluttony:IsAvailable()and t.SoulRot:CooldownRemains()>=12))then if o(t.VileTaint,nil,nil,not i:IsSpellInRange(t.VileTaint))then return"vile_taint cleave 10"end end;if t.PhantomSingularity:IsReady()and(t.AgonyDebuff:AuraActiveCount()==2 and t.CorruptionDebuff:AuraActiveCount()==2 and(not t.SiphonLife:IsAvailable()or t.SiphonLifeDebuff:AuraActiveCount()==2)and(t.SoulRot:IsAvailable()or t.SoulRot:CooldownRemains()<=t.PhantomSingularity:ExecuteTime()or t.SoulRot:CooldownRemains()>=25))then if o(t.PhantomSingularity,s.Affliction.GCDasOffGCD.PhantomSingularity,nil,not i:IsSpellInRange(t.PhantomSingularity))then return"phantom_singularity cleave 12"end end;if t.UnstableAffliction:IsReady()and i:DebuffRemains(t.UnstableAfflictionDebuff)<5 then if o(t.UnstableAffliction,nil,nil,not i:IsSpellInRange(t.UnstableAffliction))then return"unstable_affliction cleave 14"end end;if t.SeedofCorruption:IsReady()and(not t.AbsoluteCorruption:IsAvailable()and i:DebuffRemains(t.CorruptionDebuff)<5 and t.SowTheSeeds:IsAvailable()and T())then if o(t.SeedofCorruption,nil,nil,not i:IsSpellInRange(t.SeedofCorruption))then return"seed_of_corruption cleave 16"end end;if t.Corruption:IsReady()then if r.CastTargetIf(t.Corruption,z,"min",Y,a1,not i:IsSpellInRange(t.Corruption))then return"corruption cleave 18"end end;if t.SiphonLife:IsReady()then if r.CastTargetIf(t.SiphonLife,z,"min",Z,a2,not i:IsSpellInRange(t.SiphonLife))then return"siphon_life cleave 20"end end;if t.Haunt:IsReady()and i:DebuffRemains(t.HauntDebuff)<3 then if o(t.Haunt,nil,nil,not i:IsSpellInRange(t.Haunt))then return"haunt cleave 22"end end;if t.PhantomSingularity:IsReady()and(t.SoulRot:CooldownRemains()<=t.PhantomSingularity:ExecuteTime()or not t.SouleatersGluttony:IsAvailable()and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownRemains()<=t.PhantomSingularity:ExecuteTime()or t.SoulRot:CooldownRemains()>=25))then if o(t.PhantomSingularity,s.Affliction.GCDasOffGCD.PhantomSingularity,nil,not i:IsSpellInRange(t.PhantomSingularity))then return"phantom_singularity cleave 24"end end;if t.SoulRot:IsReady()then if o(t.SoulRot,nil,nil,not i:IsSpellInRange(t.SoulRot))then return"soul_rot cleave 26"end end;if t.MaleficRapture:IsReady()and(K>4 or t.TormentedCrescendo:IsAvailable()and g:BuffStack(t.TormentedCrescendoBuff)==1 and K>3)then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 28"end end;if t.MaleficRapture:IsReady()and t.DreadTouch:IsAvailable()and i:DebuffRemains(t.DreadTouchDebuff)<g:GCD()then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 30"end end;if t.MaleficRapture:IsReady()and not t.DreadTouch:IsAvailable()and g:BuffUp(t.TormentedCrescendoBuff)then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 32"end end;if t.MaleficRapture:IsReady()and(G or E)then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 34"end end;if t.DrainSoul:IsReady()and(g:BuffUp(t.NightfallBuff)and t.ShadowEmbrace:IsAvailable())then if r.CastCycle(t.DrainSoul,z,EvaluatecycleDrainSoul,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul cleave 36"end end;if t.DrainSoul:IsReady()and g:BuffUp(t.NightfallBuff)then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul cleave 38"end end;if t.ShadowBolt:IsReady()and g:BuffUp(t.NightfallBuff)then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt cleave 40"end end;if t.MaleficRapture:IsReady()and K>3 then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 42"end end;if t.DrainLife:IsReady()and(g:BuffStack(t.InevitableDemiseBuff)>48 or g:BuffStack(t.InevitableDemiseBuff)>20 and M<4)then if o(t.DrainLife,nil,nil,not i:IsSpellInRange(t.DrainLife))then return"drain_life cleave 44"end end;if t.DrainLife:IsReady()and i:DebuffUp(t.SoulRotDebuff)and g:BuffStack(t.InevitableDemiseBuff)>10 then if o(t.DrainLife,nil,nil,not i:IsSpellInRange(t.DrainLife))then return"drain_life cleave 46"end end;if t.Agony:IsReady()then if r.CastCycle(t.Agony,z,a4,not i:IsSpellInRange(t.Agony))then return"agony cleave 48"end end;if t.Corruption:IsCastable()then if r.CastCycle(t.Corruption,z,a6,not i:IsSpellInRange(t.Corruption))then return"corruption cleave 50"end end;if t.MaleficRapture:IsReady()and K>1 then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture cleave 52"end end;if t.DrainSoul:IsReady()then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul cleave 54"end end;if t.ShadowBolt:IsReady()then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt cleave 56"end end end;local function an()z=g:GetEnemiesInRange(40)A=i:GetEnemiesInSplashRange(10)if m()then B=i:GetEnemiesInSplashRangeCount(10)else B=1 end;if r.TargetIsValid()or g:AffectingCombat()then L=d.BossFightRemains()M=L;if M==11111 then M=d.FightRemains(A,false)end;K=g:SoulShardsP()end;if t.SummonPet:IsCastable()then if o(t.SummonPet,s.Affliction.GCDasOffGCD.SummonPet)then return"summon_pet ooc"end end;if r.TargetIsValid()then if not g:AffectingCombat()then local al=a9()if al then return al end end;aa()if B>1 and B<3 then local al=am()if al then return al end end;if B>2 then local al=ak()if al then return al end end;if n()then local al=ai()if al then return al end end;if s.Commons.Enabled.Trinkets or s.Commons.Enabled.Items then local al=ab()if al then return al end end;if t.MaleficRapture:IsReady()and(t.DreadTouch:IsAvailable()and i:DebuffRemains(t.DreadTouchDebuff)<2 and(i:DebuffUp(t.AgonyDebuff)and i:DebuffUp(t.CorruptionDebuff)and(not t.SiphonLife:IsAvailable()or i:DebuffUp(t.SiphonLifeDebuff)))and(not t.PhantomSingularity:IsAvailable()or t.PhantomSingularity:CooldownDown())and(not t.VileTaint:IsAvailable()or t.VileTaint:CooldownDown())and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownDown()))then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture main 2"end end;if t.SummonDarkglare:IsReady()and(C and D and F)then if o(t.SummonDarkglare,s.Affliction.GCDasOffGCD.SummonDarkglare)then return"summon_darkglare main 4"end end;if t.Agony:IsCastable()and i:DebuffRemains(t.AgonyDebuff)<5 then if o(t.Agony,nil,nil,not i:IsSpellInRange(t.Agony))then return"agony main 6"end end;if t.UnstableAffliction:IsReady()and i:DebuffRemains(t.UnstableAfflictionDebuff)<5 then if o(t.UnstableAffliction,nil,nil,not i:IsSpellInRange(t.UnstableAffliction))then return"unstable_affliction main 8"end end;if t.Corruption:IsCastable()and i:DebuffRefreshable(t.CorruptionDebuff)then if o(t.Corruption,nil,nil,not i:IsSpellInRange(t.Corruption))then return"corruption main 10"end end;if t.SiphonLife:IsCastable()and i:DebuffRefreshable(t.SiphonLifeDebuff)then if o(t.SiphonLife,nil,nil,not i:IsSpellInRange(t.SiphonLife))then return"siphon_life main 12"end end;if t.Haunt:IsReady()and i:DebuffRemains(t.HauntDebuff)<3 then if o(t.Haunt,nil,nil,not i:IsSpellInRange(t.Haunt))then return"haunt main 14"end end;if t.DrainSoul:IsReady()and(t.ShadowEmbrace:IsAvailable()and(i:DebuffStack(t.ShadowEmbraceDebuff)<3 or i:DebuffRemains(t.ShadowEmbraceDebuff)<3))then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul main 16"end end;if t.ShadowBolt:IsReady()and(t.ShadowEmbrace:IsAvailable()and(i:DebuffStack(t.ShadowEmbraceDebuff)<3 or i:DebuffRemains(t.ShadowEmbraceDebuff)<3))then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt main 18"end end;if t.PhantomSingularity:IsCastable()and(t.SoulRot:CooldownRemains()<=t.PhantomSingularity:ExecuteTime()or not t.SouleatersGluttony:IsAvailable()and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownRemains()<=t.PhantomSingularity:ExecuteTime()or t.SoulRot:CooldownRemains()>=25))then if o(t.PhantomSingularity,s.Affliction.GCDasOffGCD.PhantomSingularity,nil,not i:IsSpellInRange(t.PhantomSingularity))then return"phantom_singularity main 20"end end;if t.VileTaint:IsReady()and(not t.SoulRot:IsAvailable()or t.SoulRot:CooldownRemains()<=t.VileTaint:ExecuteTime()or not t.SouleatersGluttony:IsAvailable()and t.SoulRot:CooldownRemains()>=12)then if o(t.VileTaint,nil,nil,not i:IsInRange(40))then return"vile_taint main 22"end end;if t.SoulRot:IsReady()and(D and(C or t.SouleatersGluttony:TalentRank()~=1))then if o(t.SoulRot,nil,nil,not i:IsSpellInRange(t.SoulRot))then return"soul_rot main 24"end end;if t.MaleficRapture:IsReady()and(K>4 or t.TormentedCrescendo:IsAvailable()and g:BuffStack(t.TormentedCrescendoBuff)==1 and K>3 or t.TormentedCrescendo:IsAvailable()and g:BuffUp(t.TormentedCrescendoBuff)and i:DebuffDown(t.DreadTouchDebuff)or t.TormentedCrescendo:IsAvailable()and g:BuffStack(t.TormentedCrescendoBuff)==2 or(G or E and K>1)or t.TormentedCrescendo:IsAvailable()and t.Nightfall:IsAvailable()and g:BuffUp(t.TormentedCrescendoBuff)and g:BuffUp(t.NightfallBuff))then if o(t.MaleficRapture,nil,nil,not i:IsInRange(100))then return"malefic_rapture main 26"end end;if t.DrainLife:IsReady()and(g:BuffStack(t.InevitableDemiseBuff)>48 or g:BuffStack(t.InevitableDemiseBuff)>20 and M<4)then if o(t.DrainLife,nil,nil,not i:IsSpellInRange(t.DrainLife))then return"drain_life main 28"end end;if t.DrainSoul:IsReady()and g:BuffUp(t.NightfallBuff)then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul main 30"end end;if t.ShadowBolt:IsReady()and g:BuffUp(t.NightfallBuff)then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt main 32"end end;if t.Agony:IsCastable()and i:DebuffRefreshable(t.AgonyDebuff)then if o(t.Agony,nil,nil,not i:IsSpellInRange(t.Agony))then return"agony main 34"end end;if t.Corruption:IsCastable()and i:DebuffRefreshable(t.CorruptionDebuff)then if o(t.Corruption,nil,nil,not i:IsSpellInRange(t.Corruption))then return"corruption main 36"end end;if t.DrainSoul:IsReady()then if o(t.DrainSoul,nil,nil,not i:IsSpellInRange(t.DrainSoul))then return"drain_soul main 40"end end;if t.ShadowBolt:IsReady()then if o(t.ShadowBolt,nil,nil,not i:IsSpellInRange(t.ShadowBolt))then return"shadow_bolt main 42"end end end end;local function ao()t.AgonyDebuff:RegisterAuraTracking()t.CorruptionDebuff:RegisterAuraTracking()t.SiphonLifeDebuff:RegisterAuraTracking()t.UnstableAfflictionDebuff:RegisterAuraTracking()l.Print("Affliction Warlock rotation has been updated for patch 10.2.0.")end;l.SetAPL(265,an,ao)