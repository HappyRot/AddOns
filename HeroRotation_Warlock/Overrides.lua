local a=HeroLib;local b=HeroCache;local c=a.Unit;local d=c.Player;local e=c.Pet;local f=c.Target;local g=a.Spell;local h=a.Item;local i=HeroRotation;local j=g.Warlock.Affliction;local k=g.Warlock.Demonology;local l=g.Warlock.Destruction;local m=math.min;local n=math.max;local o=math.floor;a.AddCoreOverride("Player.SoulShardsP",function()local p=d:SoulShards()if not d:IsCasting()then return p else if d:IsCasting(j.MaleficRapture)or d:IsCasting(j.SeedofCorruption)or d:IsCasting(j.VileTaint)or d:IsCasting(j.SummonPet)then return p-1 else return p end end end,265)local q;q=a.AddCoreOverride("Spell.IsCastable",function(self,r,s,t,u,v)local w=true;if r then local x=t or f;w=x:IsInRange(r,s)end;local y=q(self,r,s,t,u,v)if self==j.SummonPet then return y and d:SoulShardsP()>0 and not(e:IsActive()or d:BuffUp(j.GrimoireofSacrificeBuff))else return y end end,265)local z;z=a.AddCoreOverride("Spell.IsReady",function(self,r,s,t,u,v)local w=true;if r then local x=t or f;w=x:IsInRange(r,s)end;local y=z(self,r,s,t,u,v)if self==j.VileTaint or self==j.ScouringTithe or self==j.UnstableAffliction or self==j.SoulRot then return y and not d:IsCasting(self)elseif self==j.SeedofCorruption or self==j.Haunt then return y and not d:IsCasting(self)and not self:InFlight()else return y end end,265)a.AddCoreOverride("Player.SoulShardsP",function()local p=d:SoulShards()p=o(p)if not d:IsCasting()then return p else if d:IsCasting(k.SummonDemonicTyrant)and d:Level()>=58 then return 5 elseif d:IsCasting(k.Demonbolt)then return m(p+2,5)elseif d:IsCasting(k.ShadowBolt)or d:IsCasting(k.SoulStrike)then return m(p+1,5)elseif d:IsCasting(k.HandofGuldan)then return n(p-3,0)elseif d:IsCasting(k.CallDreadstalkers)or d:IsCasting(k.BilescourgeBombers)then return p-2 elseif d:IsCasting(k.SummonVilefiend)or d:IsCasting(k.SummonPet)or d:IsCasting(k.NetherPortal)then return p-1 else return p end end end,266)local A;A=a.AddCoreOverride("Spell.IsCastable",function(self,r,s,t,u,v)local w=true;if r then local x=t or f;w=x:IsInRange(r,s)end;local y=A(self,r,s,t,u,v)if self==k.SummonPet then return y and not e:IsActive()and d:SoulShardsP()>0 elseif self==k.SummonDemonicTyrant then return y and not d:IsCasting(self)else return y end end,266)local B;B=a.AddCoreOverride("Spell.IsReady",function(self,r,s,t,u,v)local w=true;if r then local x=t or f;w=x:IsInRange(r,s)end;local y=B(self,r,s,t,u,v)if self==k.SummonVilefiend or self==k.CallDreadstalkers or self==k.NetherPortal or self==k.DecimatingBolt or self==k.ScouringTithe then return y and not d:IsCasting(self)else return y end end,266)a.AddCoreOverride("Player.SoulShardsP",function()local p=d:SoulShards()if not d:IsCasting()then return p else if d:IsCasting(l.ChaosBolt)then return p-2 else return p end end end,267)local C;C=a.AddCoreOverride("Spell.IsCastable",function(self,r,s,t,u,v)local w=true;if r then local x=t or f;w=x:IsInRange(r,s)end;local y=C(self,r,s,t,u,v)if self==l.SummonPet then return y and not e:IsActive()elseif self==l.Cataclysm then return y and not d:IsCasting(l.Cataclysm)elseif self==l.ChannelDemonfire then return y and not d:IsCasting(l.ChannelDemonfire)elseif self==l.ScourgeStrike then return y and not d:IsCasting(l.ScourgeStrike)elseif self==l.DecimatingBolt then return y and not d:IsCasting(l.DecimatingBolt)elseif self==l.SoulRot then return y and not d:IsCasting(l.SoulRot)elseif self==l.ImpendingCatastrophe then return y and not d:IsCasting(l.ImpendingCatastrophe)else return y end end,267)local D;D=a.AddCoreOverride("Player.AffectingCombat",function(self)return l.Incinerate:InFlight()or D(self)end,267)