local a,b=...local c=HeroLib;local d=HeroRotation;local e=HeroCache;local f=c.Unit;local g=f.Player;local h=f.Target;local i=c.Spell;local j=c.Item;local k=string.find;local GetTime=GetTime;local UnitGUID=UnitGUID;d.Commons.Warlock={}local l=d.Commons.Warlock;c.ImmolationTable={Destruction={ImmolationDebuff={}}}c.GuardiansTable={Pets={},ImpCount=0,FelguardDuration=0,DreadstalkerDuration=0,DemonicTyrantDuration=0,VilefiendDuration=0,PitLordDuration=0,Infernal=0,Blasphemy=0,DarkglareDuration=0,InnerDemonsNextCast=0,ImpsSpawnedFromHoG=0}local m={[98035]={name="Dreadstalker",duration=12.25},[55659]={name="Wild Imp",duration=20},[143622]={name="Wild Imp",duration=20},[17252]={name="Felguard",duration=17},[135002]={name="Demonic Tyrant",duration=15},[135816]={name="Vilefiend",duration=15},[196111]={name="Pit Lord",duration=10},[89]={name="Infernal",duration=30},[185584]={name="Blasphemy",duration=8},[103673]={name="Darkglare",duration=25}}c:RegisterForSelfCombatEvent(function(...)DestGUID,_,_,_,SpellID=select(8,...)if SpellID==157736 then c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]=0 end end,"SPELL_AURA_APPLIED","SPELL_AURA_REFRESH")c:RegisterForSelfCombatEvent(function(...)DestGUID,_,_,_,SpellID=select(8,...)if SpellID==157736 then if c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]then c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]=nil end end end,"SPELL_AURA_REMOVED")c:RegisterForCombatEvent(function(...)DestGUID=select(8,...)if c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]then c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]=nil end end,"UNIT_DIED","UNIT_DESTROYED")c:RegisterForSelfCombatEvent(function(...)DestGUID,_,_,_,SpellID=select(8,...)if SpellID==17962 then if c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]then c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]=c.ImmolationTable.Destruction.ImmolationDebuff[DestGUID]+1 end end end,"SPELL_CAST_SUCCESS")function l.UpdatePetTable()for n,o in pairs(c.GuardiansTable.Pets)do if o then if GetTime()>=o.despawnTime then if o.name=="Wild Imp"then c.GuardiansTable.ImpCount=c.GuardiansTable.ImpCount-1 end;if o.name=="Felguard"then c.GuardiansTable.FelguardDuration=0 elseif o.name=="Dreadstalker"then c.GuardiansTable.DreadstalkerDuration=0 elseif o.name=="Demonic Tyrant"then c.GuardiansTable.DemonicTyrantDuration=0 elseif o.name=="Vilefiend"then c.GuardiansTable.VilefiendDuration=0 elseif o.name=="Pit Lord"then c.GuardiansTable.PitLordDuration=0 elseif o.name=="Infernal"then c.GuardiansTable.InfernalDuration=0 elseif o.name=="Blasphemy"then c.GuardiansTable.BlasphemyDuration=0 elseif o.name=="Darkglare"then c.GuardiansTable.DarkglareDuration=0 end;c.GuardiansTable.Pets[n]=nil end end;if o.ImpCasts<=0 then c.GuardiansTable.ImpCount=c.GuardiansTable.ImpCount-1;c.GuardiansTable.Pets[n]=nil end;if GetTime()<=o.despawnTime then o.Duration=o.despawnTime-GetTime()if o.name=="Felguard"then c.GuardiansTable.FelguardDuration=o.Duration elseif o.name=="Dreadstalker"then c.GuardiansTable.DreadstalkerDuration=o.Duration elseif o.name=="Demonic Tyrant"then c.GuardiansTable.DemonicTyrantDuration=o.Duration elseif o.name=="Vilefiend"then c.GuardiansTable.VilefiendDuration=o.Duration elseif o.name=="Pit Lord"then c.GuardiansTable.PitLordDuration=o.Duration elseif o.name=="Infernal"then c.GuardiansTable.InfernalDuration=o.Duration elseif o.name=="Blasphy"then c.GuardiansTable.BlasphemyDuration=o.Duration elseif o.name=="Darkglare"then c.GuardiansTable.DarkglareDuration=o.Duration end end end end;c:RegisterForSelfCombatEvent(function(...)local p,q,_,r,_,_,_,s,_,_,_,SpellID=select(1,...)local _,_,_,_,_,_,_,t=k(s,"(%S+)-(%d+)-(%d+)-(%d+)-(%d+)-(%d+)-(%S+)")t=tonumber(t)if s~=UnitGUID("pet")and q=="SPELL_SUMMON"and m[t]then local u=m[t]local v;if u.name=="Wild Imp"then c.GuardiansTable.ImpCount=c.GuardiansTable.ImpCount+1;v=u.duration elseif u.name=="Felguard"then c.GuardiansTable.FelguardDuration=u.duration;v=u.duration elseif u.name=="Dreadstalker"then c.GuardiansTable.DreadstalkerDuration=u.duration;v=u.duration elseif u.name=="Demonic Tyrant"then if SpellID==265187 then c.GuardiansTable.DemonicTyrantDuration=u.duration;v=u.duration end elseif u.name=="Vilefiend"then c.GuardiansTable.VilefiendDuration=u.duration;v=u.duration elseif u.name=="Pit Lord"then c.GuardiansTable.PitLordDuration=u.duration;v=u.duration elseif u.name=="Infernal"then c.GuardiansTable.InfernalDuration=u.duration;v=u.duration elseif u.name=="Blasphemy"then c.GuardiansTable.BlasphemyDuration=u.duration;v=u.duration elseif u.name=="Darkglare"then c.GuardiansTable.DarkglareDuration=u.duration;v=u.duration end;local o={ID=s,name=u.name,spawnTime=GetTime(),ImpCasts=5,Duration=v,despawnTime=GetTime()+tonumber(v)}table.insert(c.GuardiansTable.Pets,o)end;if m[t]and m[t].name=="Demonic Tyrant"then for n,o in pairs(c.GuardiansTable.Pets)do if o and o.name~="Demonic Tyrant"and o.name~="Pit Lord"then o.despawnTime=o.despawnTime+15;o.ImpCasts=o.ImpCasts+7 end end end;if t==143622 then c.GuardiansTable.InnerDemonsNextCast=GetTime()+12 end;if t==55659 and c.GuardiansTable.ImpsSpawnedFromHoG>0 then c.GuardiansTable.ImpsSpawnedFromHoG=c.GuardiansTable.ImpsSpawnedFromHoG-1 end;l.UpdatePetTable()end,"SPELL_SUMMON","SPELL_CAST_SUCCESS")c:RegisterForCombatEvent(function(...)local r,_,_,_,s,_,_,_,SpellID=select(4,...)if SpellID==104318 then for n,o in pairs(c.GuardiansTable.Pets)do if r==o.ID then o.ImpCasts=o.ImpCasts-1 end end end;if r==g:GUID()and SpellID==196277 then for n,o in pairs(c.GuardiansTable.Pets)do if o.name=="Wild Imp"then c.GuardiansTable.Pets[n]=nil end end;c.GuardiansTable.ImpCount=0 end;l.UpdatePetTable()end,"SPELL_CAST_SUCCESS")l.LastPI=0;c:RegisterForCombatEvent(function(...)DestGUID,_,_,_,SpellID=select(8,...)if SpellID==10060 and DestGUID==g:GUID()then l.LastPI=GetTime()end end,"SPELL_AURA_APPLIED","SPELL_AURA_REFRESH")l.SoulShards=0;function l.UpdateSoulShards()l.SoulShards=g:SoulShards()end;c:RegisterForSelfCombatEvent(function(_,w,_,_,_,_,_,_,_,_,_,SpellID)if SpellID==105174 then c.GuardiansTable.ImpsSpawnedFromHoG=c.GuardiansTable.ImpsSpawnedFromHoG+(l.SoulShards>=3 and 3 or l.SoulShards)end end,"SPELL_CAST_SUCCESS")