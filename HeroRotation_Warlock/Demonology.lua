local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.Cast;local n=l.AoEON;local o=l.CDsON;local p=l.Commons.Warlock;local q=l.Commons.Everyone.num;local r=l.Commons.Everyone.bool;local s=math.max;local t=j.Warlock.Demonology;local u=k.Warlock.Demonology;local function q(v)if v then return 1 else return 0 end end;local w={u.NymuesUnravelingSpindle:ID()}local x=g:GetEquipment()local y=x[13]and k(x[13])or k(0)local z=x[14]and k(x[14])or k(0)local A=11111;local B=11111;local C=0;local D=0;local E=false;local F=false;local G=false;local H=0;local I=0;local J=0;local K=120;local L=0;local M=0;local N=0;local O=0;local P=HeroRotationCharDB.Toggles[5]local Q=HeroRotationCharDB.Toggles[4]local R=HeroRotationCharDB.Toggles[12]local S=HeroRotationCharDB.Toggles[15]local T;local U,V;d:RegisterForEvent(function()A=11111;B=11111 end,"PLAYER_REGEN_ENABLED")local W=l.Commons.Everyone;local X={General=l.GUISettings.General,Commons=l.GUISettings.APL.Warlock.Commons,Demonology=l.GUISettings.APL.Warlock.Demonology}local Y={{t.AxeToss,"Cast Axe Toss (Interrupt)",function()return true end}}local Z=0;local _=0;d:RegisterForEvent(function()x=g:GetEquipment()y=x[13]and k(x[13])or k(0)z=x[14]and k(x[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()t.HandofGuldan:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")t.HandofGuldan:RegisterInFlight()local function a0()return d.GuardiansTable.ImpCount or 0 end;local function a1(a2)local a3=0;for a4,i in pairs(d.GuardiansTable.Pets)do if i.ImpCasts<=a2 then a3=a3+1 end end;return a3 end;local function a5()return d.GuardiansTable.FelGuardDuration or 0 end;local function a6()return a5()>0 end;local function a7()return d.GuardiansTable.DemonicTyrantDuration or 0 end;local function a8()return a7()>0 end;local function a9()return d.GuardiansTable.DreadstalkerDuration or 0 end;local function aa()return a9()>0 end;local function ab()return d.GuardiansTable.VilefiendDuration or 0 end;local function ac()return ab()>0 end;local function ad()return d.GuardiansTable.PitLordDuration or 0 end;local function ae()return ad()>0 end;local function af(ag)return ag:DebuffDown(t.DoomBrandDebuff)or t.HandofGuldan:InFlight()and h:DebuffRemains(t.DoomBrandDebuff)<=3 end;local function ah(ag)return ag:DebuffDown(t.DoomBrandDebuff)or t.HandofGuldan:InFlight()and ag:DebuffRemains(t.DoomBrandDebuff)<=3 or V<4 end;local function ai(ag)return ag:DebuffRefreshable(t.Doom)end;local function aj(ag)return ag:DebuffRemains(t.DoomBrandDebuff)>10 end;local function ak()L=12;C=14+q(t.GrimoireFelguard:IsAvailable())+q(t.SummonVilefiend:IsAvailable())H=0;I=0;if X.Demonology.PISource=="Shadow"then H=1 end;if t.PowerSiphon:IsReady()then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon precombat 2"end end;if t.Demonbolt:IsReady()and g:BuffDown(t.DemonicCoreBuff)then if m(t.Demonbolt,nil,nil,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt precombat 4"end end;if t.ShadowBolt:IsReady()then if m(t.ShadowBolt,nil,nil,not h:IsSpellInRange(t.ShadowBolt))then Z=686;return"shadow_bolt precombat 6"end end end;local function al()if(g:BuffUp(t.NetherPortalBuff)and g:BuffRemains(t.NetherPortalBuff)<3 and t.NetherPortal:IsAvailable()or B<20 or a8()and B<100 or B<25 or(a8()or not t.SummonDemonicTyrant:IsAvailable()and aa()))and J<=0 then I=120+N end;J=I-N;if((B+N)%120<=85 and(B+N)%120>=25 or N>=210)and J>0 and not t.GrandWarlocksDesign:IsAvailable()then K=J else K=t.SummonDemonicTyrant:CooldownRemains()end;if ac()and aa()then D=s(ab(),a9())-g:GCD()*0.5 end;if not t.SummonVilefiend:IsAvailable()and t.GrimoireFelguard:IsAvailable()and aa()then D=s(a9(),a5())-g:GCD()*0.5 end;if not t.SummonVilefiend:IsAvailable()and(not t.GrimoireFelguard:IsAvailable()or not g:HasTier(30,2))and aa()then D=a9()-g:GCD()*0.5 end;if not ac()and t.SummonVilefiend:IsAvailable()or not aa()then D=0 end;E=not t.NetherPortal:IsAvailable()or t.NetherPortal:CooldownRemains()>30 or g:BuffUp(t.NetherPortalBuff)local am=q(t.SacrificedSouls:IsAvailable())if V>1+am then F=not a8()end;if V>2+am and V<5+am then F=a7()<6 end;if V>4+am then F=a7()<8 end;G=t.SummonDemonicTyrant:CooldownRemains()<20 and K<20 and(g:BuffStack(t.DemonicCoreBuff)<=2 or g:BuffDown(t.DemonicCoreBuff))and t.SummonVilefiend:CooldownRemains()<O*5 and t.CallDreadstalkers:CooldownRemains()<O*5 end;local function an()if t.Berserking:IsCastable()then if m(t.Berserking,nil)then Z=26279;return"berserking racials 2"end end;if t.BloodFury:IsCastable()then if m(t.BloodFury,nil)then Z=20572;return"blood_fury racials 4"end end;if t.Fireblood:IsCastable()then if m(t.Fireblood,nil)then Z=265221;return"fireblood racials 6"end end;if t.AncestralCall:IsCastable()then if m(t.AncestralCall,nil)then Z=274738;return"ancestral_call racials 8"end end end;local function ao()end;local function ap()if D>0 and D<t.SummonDemonicTyrant:ExecuteTime()+q(g:BuffDown(t.DemonicCoreBuff))*t.ShadowBolt:ExecuteTime()+q(g:BuffUp(t.DemonicCoreBuff))*O+O and I<=0 then I=120+N end;if t.HandofGuldan:IsReady()and M>0 and(D>O+t.SummonDemonicTyrant:CastTime()and D<O*4)then if m(t.HandofGuldan,nil,nil,not h:IsSpellInRange(t.HandofGuldan))then Z=105174;return"hand_of_guldan tyrant 2"end end;if D>0 and D<t.SummonDemonicTyrant:ExecuteTime()+q(g:BuffDown(t.DemonicCoreBuff))*t.ShadowBolt:ExecuteTime()+q(g:BuffUp(t.DemonicCoreBuff))*O+O then if X.Commons.Enabled.Trinkets or X.Commons.Enabled.Items then local aq=ao()if aq then return aq end end;local aq=an()if aq then return aq end;if X.Commons.Enabled.Potions then local ar=W.PotionSelected()if ar and ar:IsReady()then if m(ar,nil,X.Commons.DisplayStyle.Potions)then return"potion tyrant 4"end end end end;if t.SummonDemonicTyrant:IsCastable()and(D>0 and D<t.SummonDemonicTyrant:ExecuteTime()+q(g:BuffDown(t.DemonicCoreBuff))*t.ShadowBolt:ExecuteTime()+q(g:BuffUp(t.DemonicCoreBuff))*O+O)then if m(t.SummonDemonicTyrant,nil)then Z=265187;return"summon_demonic_tyrant tyrant 6"end end;if t.Implosion:IsReady()and(a0()>2 and(not aa()and not a6()and not ac())and(V>3 or V>2 and t.GrandWarlocksDesign:IsAvailable())and not g:PrevGCDP(1,t.Implosion))then if m(t.Implosion,nil,nil,not h:IsInRange(40))then Z=196277;return"implosion tyrant 8"end end;if t.ShadowBolt:IsReady()and(g:PrevGCDP(1,t.GrimoireFelguard)and N>30 and g:BuffDown(t.NetherPortalBuff)and g:BuffDown(t.DemonicCoreBuff))then if m(t.ShadowBolt,nil,nil,not h:IsSpellInRange(t.ShadowBolt))then Z=686;return"shadow_bolt tyrant 10"end end;if t.PowerSiphon:IsReady()and(g:BuffStack(t.DemonicCoreBuff)<4 and(not ac()or not t.SummonVilefiend:IsAvailable()and a9())and g:BuffDown(t.NetherPortalBuff))then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon tyrant 12"end end;if t.ShadowBolt:IsReady()and(not ac()and g:BuffDown(t.NetherPortalBuff)and not aa()and M<5-g:BuffStack(t.DemonicCoreBuff))then if m(t.ShadowBolt,nil,nil,not h:IsSpellInRange(t.ShadowBolt))then Z=686;return"shadow_bolt tyrant 14"end end;if t.NetherPortal:IsReady()and M==5 and o()then if m(t.NetherPortal,nil)then Z=267217;return"nether_portal tyrant 16"end end;if t.SummonVilefiend:IsReady()and Q and((M==5 or g:BuffUp(t.NetherPortalBuff))and t.SummonDemonicTyrant:CooldownRemains()<13 and E)then if m(t.SummonVilefiend)then Z=264119;return"summon_vilefiend tyrant 18"end end;if t.CallDreadstalkers:IsReady()and((ac()or not t.SummonVilefiend:IsAvailable()and(not t.NetherPortal:IsAvailable()or g:BuffUp(t.NetherPortalBuff)or t.NetherPortal:CooldownRemains()>30)and(g:BuffUp(t.NetherPortalBuff)or a6()or M==5))and t.SummonDemonicTyrant:CooldownRemains()<11 and E)then if m(t.CallDreadstalkers,nil,nil,not h:IsSpellInRange(t.CallDreadstalkers))then Z=104316;return"call_dreadstalkers tyrant 20"end end;if t.GrimoireFelguard:IsReady()and o()and(ac()or not t.SummonVilefiend:IsAvailable()and(not t.NetherPortal:IsAvailable()or g:BuffUp(t.NetherPortalBuff)or t.NetherPortal:CooldownRemains()>30)and(g:BuffUp(t.NetherPortalBuff)or aa()or M==5)and E)then if m(t.GrimoireFelguard,nil,nil,not h:IsSpellInRange(t.GrimoireFelguard))then Z=111898;return"grimoire_felguard tyrant 22"end end;if t.HandofGuldan:IsReady()and(M>2 and(ac()or not t.SummonVilefiend:IsAvailable()and aa())and(M>2 or ab()<O*2+2/g:SpellHaste()))then if m(t.HandofGuldan,nil,nil,not h:IsSpellInRange(t.HandofGuldan))then Z=105174;return"hand_of_guldan tyrant 24"end end;if t.Demonbolt:IsReady()and(M<4 and g:BuffStack(t.DemonicCoreBuff)>1 and(ac()or not t.SummonVilefiend:IsAvailable()and aa()))then if m(t.Demonbolt,nil,nil,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt tyrant 26"end end;if t.PowerSiphon:IsReady()and(g:BuffStack(t.DemonicCoreBuff)<3 and D>t.SummonDemonicTyrant:ExecuteTime()+O*3 or D==0)then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon tyrant 28"end end;if t.ShadowBolt:IsCastable()then if m(t.ShadowBolt,nil,nil,not h:IsSpellInRange(t.ShadowBolt))then Z=686;return"shadow_bolt tyrant 30"end end end;local function as()if B<20 then if t.GrimoireFelguard:IsReady()and o()then if m(t.GrimoireFelguard,nil)then Z=111898;return"grimoire_felguard fight_end 2"end end;if t.CallDreadstalkers:IsReady()then if m(t.CallDreadstalkers,nil,nil,not h:IsSpellInRange(t.CallDreadstalkers))then Z=104316;return"call_dreadstalkers fight_end 4"end end;if t.SummonVilefiend:IsReady()and Q then if m(t.SummonVilefiend)then Z=264119;return"summon_vilefiend fight_end 6"end end end;if t.NetherPortal:IsReady()and o()and B<30 then if m(t.NetherPortal,nil)then Z=267217;return"nether_portal fight_end 8"end end;if t.SummonDemonicTyrant:IsCastable()and o()and B<20 then if m(t.SummonDemonicTyrant,nil)then Z=265187;return"summon_demonic_tyrant fight_end 10"end end;if t.DemonicStrength:IsCastable()and Q and B<10 then if m(t.DemonicStrength,nil)then Z=267171;return"demonic_strength fight_end 12"end end;if t.PowerSiphon:IsReady()and(g:BuffStack(t.DemonicCoreBuff)<3 and B<20)then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon fight_end 14"end end;if t.Implosion:IsReady()and B<2*O then if m(t.Implosion,nil,nil,not h:IsInRange(40))then Z=196277;return"implosion fight_end 16"end end end;local function at()P=HeroRotationCharDB.Toggles[5]Q=HeroRotationCharDB.Toggles[4]R=HeroRotationCharDB.Toggles[12]S=HeroRotationCharDB.Toggles[15]end;local function au()if _>0 then _=0 end;if Z>0 then Z=0 end;if n()then U=h:GetEnemiesInSplashRange(8)V=h:GetEnemiesInSplashRangeCount(8)T=g:GetEnemiesInRange(40)else U={}V=1;T={}end;if W.TargetIsValid()or g:AffectingCombat()then A=d.BossFightRemains()B=A;if B==11111 then B=d.FightRemains(U,false)end;p.UpdatePetTable()p.UpdateSoulShards()N=d.CombatTime()M=g:SoulShardsP()O=g:GCD()+0.25 end;at()if W.TargetIsValid()and(g:AffectingCombat()or P)then if not g:AffectingCombat()and not g:IsCasting(t.Demonbolt)then local aq=ak()if aq then return aq end end;if t.SpellLock:IsAvailable()then local aq=W.Interrupt(40,t.SpellLock,X.Commons.OffGCDasOffGCD.SpellLock,Y)if aq then return aq end end;if t.UnendingResolve:IsReady()and g:HealthPercentage()<X.Demonology.UnendingResolveHP then if m(t.UnendingResolve,nil)then Z=104773;return"bilescourge_bombers defensive"end end;al()if a8()or B<22 then local aq=an()if aq then return aq end end;if X.Commons.Enabled.Trinkets or X.Commons.Enabled.Items then local aq=ao()if aq then return aq end end;if B<30 then local aq=as()if aq then return aq end end;if t.HandofGuldan:IsReady()and(N<0.5 and(B%95>40 or B%95<15)and(t.ReignofTyranny:IsAvailable()or V>2))then if m(t.HandofGuldan,nil,nil,not h:IsSpellInRange(t.HandofGuldan))then Z=105174;return"hand_of_guldan main 2"end end;if t.SummonDemonicTyrant:CooldownRemains()<15 and t.SummonVilefiend:CooldownRemains()<O*5 and t.CallDreadstalkers:CooldownRemains()<O*5 and(t.GrimoireFelguard:CooldownRemains()<10 or not g:HasTier(30,2))and(K<15 or B<40 or g:PowerInfusionUp())or t.SummonVilefiend:IsAvailable()and t.SummonDemonicTyrant:CooldownRemains()<15 and t.SummonVilefiend:CooldownRemains()<O*5 and t.CallDreadstalkers:CooldownRemains()<O*5 and(t.GrimoireFelguard:CooldownRemains()<10 or not g:HasTier(30,2))and(not H or K<15 or B<40 or g:PowerInfusionUp())then local aq=ap()if aq then return aq end end;if t.SummonDemonicTyrant:CooldownRemains()<15 and(ac()or not t.SummonVilefiend:IsAvailable()and(a6()or t.GrimoireFelguard:CooldownUp()or not g:HasTier(30,2)))and(K<15 or a6()or B<40 or g:PowerInfusionUp())then local aq=ap()if aq then return aq end end;if t.SummonDemonicTyrant:IsCastable()and(ac()or a6()or t.GrimoireFelguard:CooldownRemains()>90)then if m(t.SummonDemonicTyrant,nil)then Z=265187;return"summon_demonic_tyrant main 4"end end;if t.SummonVilefiend:IsReady()and Q and t.SummonDemonicTyrant:CooldownRemains()>45 then if m(t.SummonVilefiend)then Z=264119;return"summon_vilefiend main 6"end end;if t.Demonbolt:IsReady()and(g:BuffUp(t.DemonicCoreBuff)and((not t.SoulStrike:IsAvailable()or t.SoulStrike:CooldownRemains()>O*2)and M<4 or M<4-q(V>2))and not g:PrevGCDP(1,t.Demonbolt)and g:HasTier(31,2))then if W.CastCycle(t.Demonbolt,U,af,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt main 8"end end;if t.PowerSiphon:IsReady()and(g:BuffDown(t.DemonicCoreBuff)and(h:DebuffDown(t.DoomBrandDebuff)or not t.HandofGuldan:InFlight()and h:DebuffRemains(t.DoomBrandDebuff)<O+t.Demonbolt:TravelTime()or t.HandofGuldan:InFlight()and h:DebuffRemains(t.DoomBrandDebuff)<O+t.Demonbolt:TravelTime()+3)and g:HasTier(31,2))then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon main 10"end end;if t.DemonicStrength:IsCastable()and Q and(g:BuffRemains(t.NetherPortalBuff)<O and(B>63 and not(B>t.SummonDemonicTyrant:CooldownRemains()+69)or t.SummonDemonicTyrant:CooldownRemains()>30 or g:BuffUp(t.RiteofRuvaraadBuff)or not t.SummonDemonicTyrant:IsAvailable()or not t.GrimoireFelguard:IsAvailable()or not g:HasTier(30,2)))then if m(t.DemonicStrength,nil)then Z=267171;return"demonic_strength main 12"end end;if t.BilescourgeBombers:IsReady()then if m(t.BilescourgeBombers,nil,nil,not h:IsInRange(40))then Z=267211;return"bilescourge_bombers main 14"end end;if t.Guillotine:IsCastable()and Q and(g:BuffRemains(t.NetherPortalBuff)<O and(t.DemonicStrength:CooldownDown()or not t.DemonicStrength:IsAvailable()))then if m(t.Guillotine,nil,nil,not h:IsInRange(40))then Z=386833;return"guillotine main 16"end end;if t.CallDreadstalkers:IsReady()and(t.SummonDemonicTyrant:CooldownRemains()>25 or K>25 or g:BuffUp(t.NetherPortalBuff))then if m(t.CallDreadstalkers,nil,nil,not h:IsSpellInRange(t.CallDreadstalkers))then Z=104316;return"call_dreadstalkers main 18"end end;if t.Implosion:IsReady()and(a1(2)>0 and F and not g:PrevGCDP(1,t.Implosion))then if m(t.Implosion,nil,nil,not h:IsInRange(40))then Z=196277;return"implosion main 20"end end;if t.SummonSoulkeeper:IsReady()and(t.SummonSoulkeeper:Count()==10 and V>1)then if m(t.SummonSoulkeeper)then Z=264057;return"soul_strike main 22"end end;if t.DemonicStrength:IsCastable()and Q and(B>63 and not(B>t.SummonDemonicTyrant:CooldownRemains()+69)or t.SummonDemonicTyrant:CooldownRemains()>30 or g:BuffUp(t.RiteofRuvaraadBuff)or not t.SummonDemonicTyrant:IsAvailable()or not t.GrimoireFelguard:IsAvailable()or not g:HasTier(30,2))then if m(t.DemonicStrength,nil)then Z=267171;return"demonic_strength main 24"end end;if t.HandofGuldan:IsReady()and((M>2 and t.CallDreadstalkers:CooldownRemains()>O*4 and t.SummonDemonicTyrant:CooldownRemains()>17 or M==5 or M==4 and t.SoulStrike:IsAvailable()and t.SoulStrike:CooldownRemains()<O*2)and(V==1 and t.GrandWarlocksDesign:IsAvailable()))then if m(t.HandofGuldan,nil,nil,not h:IsSpellInRange(t.HandofGuldan))then Z=105174;return"hand_of_guldan main 26"end end;if t.HandofGuldan:IsReady()and(M>2 and not(V==1 and t.GrandWarlocksDesign:IsAvailable()))then if m(t.HandofGuldan,nil,nil,not h:IsSpellInRange(t.HandofGuldan))then Z=105174;return"hand_of_guldan main 28"end end;if t.Demonbolt:IsReady()and(g:BuffStack(t.DemonicCoreBuff)>1 and(M<4 and not t.SoulStrike:IsAvailable()or t.SoulStrike:CooldownRemains()>O*2 or M<2)and not G)then if W.CastCycle(t.Demonbolt,U,ah,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt main 30"end end;if t.Demonbolt:IsReady()and(g:HasTier(31,2)and g:BuffUp(t.DemonicCoreBuff)and M<4 and not G)then if W.CastTargetIf(t.Demonbolt,U,"==",ah,aj,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt main 32"end end;if t.Demonbolt:IsReady()and B<g:BuffStack(t.DemonicCoreBuff)*O then if m(t.Demonbolt,nil,nil,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt main 34"end end;if t.Demonbolt:IsReady()and(g:BuffUp(t.DemonicCoreBuff)and t.PowerSiphon:CooldownRemains()<4 and M<4 and not G)then if W.CastCycle(t.Demonbolt,U,ah,not h:IsSpellInRange(t.Demonbolt))then Z=264178;return"demonbolt main 36"end end;if t.PowerSiphon:IsReady()and g:BuffDown(t.DemonicCoreBuff)then if m(t.PowerSiphon,nil)then Z=264130;return"power_siphon main 38"end end;if t.SummonVilefiend:IsReady()and Q and B<t.SummonDemonicTyrant:CooldownRemains()+5 then if m(t.SummonVilefiend)then Z=264119;return"summon_vilefiend main 40"end end;if t.Doom:IsReady()then if W.CastCycle(t.Doom,T,ai,not h:IsSpellInRange(t.Doom))then Z=603;return"doom main 42"end end;if t.ShadowBolt:IsCastable()then if m(t.ShadowBolt,nil,nil,not h:IsSpellInRange(t.ShadowBolt))then Z=686;return"shadow_bolt main 44"end end end;if(i:IsDeadOrGhost()or not UnitExists("pet"))and t.SummonPet:IsCastable()and not g:IsMoving()then if m(t.SummonPet,nil)then Z=30146;return"Revive Pet"end end end;local function av()l.Print("Demonology Warlock rotation has been updated for patch 10.2.0.")end;function ReturnSpellDemo()if Z==0 then return 0 else return Z end end;function ReturnSpellMODemo()if _==0 then return 0 else return _ end end;l.SetAPL(266,au,av)