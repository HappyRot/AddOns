local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=d.Utils;local f=HeroCache;local g=d.Unit;local h=g.Player;local i=g.Pet;local j=g.Target;local k=d.Spell;local l=d.Item;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=m.Commons.Everyone.num;local r=m.Commons.Everyone.bool;local s=math.max;local t=math.floor;local u=m.Commons.Everyone;local v={General=m.GUISettings.General,Commons=m.GUISettings.APL.Warlock.Commons,Destruction=m.GUISettings.APL.Warlock.Destruction}local w=k.Warlock.Destruction;local x=l.Warlock.Destruction;local y={x.BelorrelostheSuncaller:ID(),x.NymuesUnravelingSpindle:ID(),x.TimeThiefsGambit:ID()}local z=h:GetEquipment()local A=z[13]and l(z[13])or l(0)local B=z[14]and l(z[14])or l(0)local C,D;local E=h:GCD()local F=false;local G=false;local H=false;local I=0;local J=0;local K=false;local L=false;local M=0;local N=0;local O=11111;local P=11111;d:RegisterForEvent(function()z=h:GetEquipment()A=z[13]and l(z[13])or l(0)B=z[14]and l(z[14])or l(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()E=h:GCD()F=false;G=false;H=false;I=0;J=0;M=0;O=11111;P=11111 end,"PLAYER_REGEN_ENABLED")w.SummonInfernal:RegisterInFlight()w.ChaosBolt:RegisterInFlight()w.Incinerate:RegisterInFlight()local function Q(R)for S in pairs(R)do local T=R[S]if T:DebuffUp(w.Havoc)then return true,T:DebuffRemains(w.HavocDebuff),T:DebuffRemains(w.ImmolateDebuff)end end;return false,0,0 end;local function U()return d.GuardiansTable.InfernalDuration or w.SummonInfernal:InFlight()and 30 or 0 end;local function V()return d.GuardiansTable.BlasphemyDuration or 0 end;local function W()return 3*h:SpellHaste()end;local function X(Y)return s(Y:TimeToDie()*-1,-15)+Y:DebuffRemains(w.ImmolateDebuff)+99*q(Y:GUID()==j:GUID())end;local function Z(Y)return Y:TimeToDie()>8 end;local function _(Y)return Y:DebuffRemains(w.ImmolateDebuff)+99*Y:DebuffRemains(w.HavocDebuff)end;local function a0(Y)return Y:DebuffRefreshable(w.ImmolateDebuff)and(not w.Cataclysm:IsAvailable()or w.Cataclysm:CooldownRemains()>Y:DebuffRemains(w.ImmolateDebuff))and(not w.RagingDemonfire:IsAvailable()or w.ChannelDemonfire:CooldownRemains()>Y:DebuffRemains(w.ImmolateDebuff)or d.CombatTime()<5)and Y:TimeToDie()>18 end;local function a1(Y)return(Y:DebuffRefreshable(w.ImmolateDebuff)and(not w.Cataclysm:IsAvailable()or w.Cataclysm:CooldownRemains()>Y:DebuffRemains(w.ImmolateDebuff))or D>w.ImmolateDebuff:AuraActiveCount())and Y:TimeToDie()>10 and not H end;local function a2(Y)return(Y:DebuffRefreshable(w.ImmolateDebuff)and J<5.4 or Y:DebuffRemains(w.ImmolateDebuff)<2 and Y:DebuffRemains(w.ImmolateDebuff)<I or Y:DebuffDown(w.ImmolateDebuff)or r(q(J<2)*q(H)))and(not w.Cataclysm:IsAvailable()or w.Cataclysm:CooldownRemains()>Y:DebuffRemains(w.ImmolateDebuff))and Y:TimeToDie()>11 end;local function a3(Y)return Y:DebuffRefreshable(w.ImmolateDebuff)and(Y:DebuffRemains(w.ImmolateDebuff)<w.Havoc:CooldownRemains()or Y:DebuffDown(w.ImmolateDebuff))and(not w.Cataclysm:IsAvailable()or w.Cataclysm:CooldownRemains()>Y:DebuffRemains(w.ImmolateDebuff))and(not w.SoulFire:IsAvailable()or w.SoulFire:CooldownRemains()+q(not w.Mayhem:IsAvailable())*w.SoulFire:CastTime()>Y:DebuffRemains(w.ImmolateDebuff))and Y:TimeToDie()>15 end;local function a4(Y)return Y:DebuffRefreshable(w.ImmolateDebuff)and J<5.4 and Y:TimeToDie()>5 or(Y:DebuffRemains(w.ImmolateDebuff)<2 and Y:DebuffRemains(w.ImmolateDebuff)<I or Y:DebuffDown(w.ImmolateDebuff)or J<2)and Y:TimeToDie()>11 end;local function a5()G=false;if w.GrimoireofSacrifice:IsReady()then if p(w.GrimoireofSacrifice,v.Destruction.GCDasOffGCD.GrimoireOfSacrifice)then return"grimoire_of_sacrifice precombat 2"end end;if w.SoulFire:IsReady()and not h:IsCasting(w.SoulFire)then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire precombat 4"end end;if w.Cataclysm:IsCastable()then if p(w.Cataclysm,v.Destruction.GCDasOffGCD.Cataclysm,nil,not j:IsInRange(40))then return"cataclysm precombat 6"end end;if w.Incinerate:IsCastable()and not h:IsCasting(w.Incinerate)then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate precombat 8"end end end;local function a6()if v.Commons.Enabled.Trinkets then if x.BelorrelostheSuncaller:IsEquippedAndReady()and(d.CombatTime()>20 and w.SummonInfernal:CooldownRemains()>20 or A:ID()==x.BelorrelostheSuncaller:ID()and(B:CooldownDown()or B:Cooldown()==0)or B:ID()==x.BelorrelostheSuncaller:ID()and(A:CooldownDown()or A:Cooldown()==0)or P<20)then if p(x.BelorrelostheSuncaller,nil,v.Commons.DisplayStyle.Trinkets,not j:IsInRange(10))then return"belorrelos_the_suncaller items 2"end end;if x.NymuesUnravelingSpindle:IsEquippedAndReady()and(M or not w.SummonInfernal:IsAvailable()or K and A:ID()==x.NymuesUnravelingSpindle:ID()or L and B:ID()==x.NymuesUnravelingSpindle:ID()or P<20)then if p(x.NymuesUnravelingSpindle,nil,v.Commons.DisplayStyle.Trinkets,not j:IsInRange(45))then return"nymues_unraveling_spindle items 4"end end;if x.TimeThiefsGambit:IsEquippedAndReady()and(M or not w.SummonInfernal:IsAvailable()or P<15 or A:Cooldown()<w.SummonInfernal:CooldownRemains()+5 and D==1 or D>1 and H)then if p(x.TimeThiefsGambit,nil,v.Commons.DisplayStyle.Trinkets)then return"time_thiefs_gambit items 6"end end end;if v.Commons.Enabled.Items then local a7,a8,a9=h:GetUseableItems(y,16)if a7 and a7:IsReady()then if p(a7,nil,v.Commons.DisplayStyle.Items,not j:IsInRange(a9))then return"main_hand ("..a7:Name()..") items 8"end end end;if U()>0 or not w.SummonInfernal:IsAvailable()or P<21 then local aa,ab,ac=h:GetUseableItems(y)if aa then local ad=v.Commons.DisplayStyle.Trinkets;if ab~=13 and ab~=14 then ad=v.Commons.DisplayStyle.Items end;if(ab==13 or ab==14)and v.Commons.Enabled.Trinkets or ab~=13 and ab~=14 and v.Commons.Enabled.Items then if p(aa,nil,ad,not j:IsInRange(ac))then return"Generic use_items for "..aa:Name()end end end end end;local function ae()if v.Commons.Enabled.Potions and(M or not w.SummonInfernal:IsAvailable())then local af=u.PotionSelected()if af and af:IsReady()then if p(af,nil,v.Commons.DisplayStyle.Potions)then return"potion ogcd 2"end end end;if w.Berserking:IsCastable()and(M or not w.SummonInfernal:IsAvailable()or P<w.SummonInfernal:CooldownRemains()+12 and P>12 or P<w.SummonInfernal:CooldownRemains())then if p(w.Berserking,v.Commons.OffGCDasOffGCD.Racials)then return"berserking ogcd 4"end end;if w.BloodFury:IsCastable()and(M or not w.SummonInfernal:IsAvailable()or P<w.SummonInfernal:CooldownRemains()+10+15 and P>15 or P<w.SummonInfernal:CooldownRemains())then if p(w.BloodFury,v.Commons.OffGCDasOffGCD.Racials)then return"blood_fury ogcd 6"end end;if w.Fireblood:IsCastable()and(M or not w.SummonInfernal:IsAvailable()or P<w.SummonInfernal:CooldownRemains()+10+8 and P>8 or P<w.SummonInfernal:CooldownRemains())then if p(w.Fireblood,v.Commons.OffGCDasOffGCD.Racials)then return"fireblood ogcd 8"end end;if w.AncestralCall:IsCastable()and(M or not w.SummonInfernal:IsAvailable()or P<w.SummonInfernal:CooldownRemains()+15 and P>15 or P<w.SummonInfernal:CooldownRemains())then if p(w.AncestralCall,v.Commons.OffGCDasOffGCD.Racials)then return"ancestral_call ogcd 10"end end end;local function ag()if w.Conflagrate:IsCastable()and(w.Backdraft:IsAvailable()and h:BuffDown(w.BackdraftBuff)and N>=1 and N<=4)then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate havoc 2"end end;if w.SoulFire:IsCastable()and(w.SoulFire:CastTime()<I and N<2.5)then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire havoc 4"end end;if w.ChannelDemonfire:IsReady()and(N<4.5 and w.RagingDemonfire:TalentRank()==2)then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire havoc 6"end end;if w.Immolate:IsCastable()and N<4.5 then if u.CastTargetIf(w.Immolate,C,"min",_,a4,not j:IsSpellInRange(w.Immolate))then return"immolate havoc 8"end end;if w.ChaosBolt:IsReady()and((w.CryHavoc:IsAvailable()and not w.Inferno:IsAvailable()or not w.RainofFire:IsAvailable())and w.ChaosBolt:CastTime()<I)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt havoc 10"end end;if w.ChaosBolt:IsReady()and(w.ChaosBolt:CastTime()<I and D<=3-q(w.Inferno:IsAvailable())+q(w.Chaosbringer:IsAvailable()and not w.Inferno:IsAvailable()))then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt havoc 12"end end;if w.RainofFire:IsReady()and(D>=3 and w.Inferno:IsAvailable())then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire havoc 14"end end;if w.RainofFire:IsReady()and D>=4-q(w.Inferno:IsAvailable())+q(w.Chaosbringer:IsAvailable())then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire havoc 16"end end;if w.RainofFire:IsReady()and(D>2 and(w.AvatarofDestruction:IsAvailable()or w.RainofChaos:IsAvailable()and h:BuffUp(w.RainofChaosBuff))and w.Inferno:IsAvailable())then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire havoc 18"end end;if w.ChannelDemonfire:IsReady()and N<4.5 then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire havoc 20"end end;if w.Conflagrate:IsCastable()and not w.Backdraft:IsAvailable()then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate havoc 22"end end;if o()and w.DimensionalRift:IsCastable()and(N<4.7 and(w.DimensionalRift:Charges()>2 or P<w.DimensionalRift:Cooldown()))then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift havoc 24"end end;if w.Incinerate:IsCastable()and w.Incinerate:CastTime()<I then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate havoc 26"end end end;local function ah()if o()then local ai=ae()if ai then return ai end end;if v.Commons.Enabled.Trinkets or v.Commons.Enabled.Trinkets then local ai=a6()if ai then return ai end end;if H and I>E and D<5+q(w.CryHavoc:IsAvailable()and not w.Inferno:IsAvailable())and(w.SummonInfernal:CooldownDown()or not w.SummonInfernal:IsAvailable())then local ai=ag()if ai then return ai end end;if o()and w.DimensionalRift:IsCastable()and(N<4.7 and(w.DimensionalRift:Charges()>2 or P<w.DimensionalRift:Cooldown()))then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift aoe 2"end end;if w.RainofFire:IsReady()and(U()>0 or V()>0)then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire aoe 4"end end;if w.RainofFire:IsReady()and P<12 then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire aoe 6"end end;if w.RainofFire:IsReady()and(N>=4.5-0.1*w.ImmolateDebuff:AuraActiveCount()and d.CombatTime()>5)then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire aoe 8"end end;if w.ChaosBolt:IsReady()and(N>3.5-0.1*D and not w.RainofFire:IsAvailable())then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt aoe 10"end end;if o()and w.Cataclysm:IsCastable()then if p(w.Cataclysm,v.Destruction.GCDasOffGCD.Cataclysm,nil,not j:IsSpellInRange(w.Cataclysm))then return"cataclysm aoe 12"end end;if w.Havoc:IsReady()and(w.SummonInfernal:CooldownDown()or not w.SummonInfernal:IsAvailable()or w.Inferno:IsAvailable()and D>4)then if u.CastTargetIf(w.Havoc,C,"min",X,Z,not j:IsSpellInRange(w.Havoc))then return"havoc aoe 14"end end;if w.Immolate:IsCastable()and w.ImmolateDebuff:AuraActiveCount()<=4 then if u.CastTargetIf(w.Immolate,C,"min",_,a0,not j:IsSpellInRange(w.Immolate))then return"immolate aoe 16"end end;if w.ChannelDemonfire:IsReady()and(j:DebuffRemains(w.ImmolateDebuff)>W()and w.RagingDemonfire:IsAvailable())then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire aoe 18"end end;if w.SummonSoulkeeper:IsCastable()and(w.SummonSoulkeeper:Count()==10 or w.SummonSoulkeeper:Count()>3 and P<10)then if p(w.SummonSoulkeeper,v.Destruction.GCDasOffGCD.SummonSoulkeeper)then return"summon_soulkeeper aoe 20"end end;if o()then local ai=ae()if ai then return ai end end;if o()and w.SummonInfernal:IsCastable()then if p(w.SummonInfernal,v.Destruction.GCDasOffGCD.SummonInfernal)then return"summon_infernal aoe 22"end end;if w.RainofFire:IsReady()and(j:DebuffDown(w.PyrogenicsDebuff)and D<=4)then if p(w.RainofFire,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"rain_of_fire aoe 24"end end;if w.ChannelDemonfire:IsReady()and j:DebuffRemains(w.ImmolateDebuff)>W()then if p(w.ChannelDemonfire,nil,nil,not j:IsSpellInRange(w.ChannelDemonfire))then return"channel_demonfire aoe 26"end end;if w.Immolate:IsCastable()then if u.CastTargetIf(w.Immolate,C,"min",_,a1,not j:IsSpellInRange(w.Immolate))then return"immolate aoe 28"end end;if w.Immolate:IsCastable()then if u.CastTargetIf(w.Immolate,C,"min",_,a2,not j:IsSpellInRange(w.Immolate))then return"immolate aoe 30"end end;if o()and w.DimensionalRift:IsCastable()then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift aoe 32"end end;if w.SoulFire:IsCastable()and h:BuffUp(w.BackdraftBuff)then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire aoe 34"end end;if w.Incinerate:IsCastable()and(w.FireandBrimstone:IsAvailable()and h:BuffUp(w.BackdraftBuff))then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate aoe 36"end end;if w.Conflagrate:IsCastable()and(h:BuffStack(w.BackdraftBuff)<2 or not w.Backdraft:IsAvailable())then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate aoe 38"end end;if w.Incinerate:IsCastable()then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate aoe 40"end end end;local function aj()if v.Commons.Enabled.Trinkets or v.Commons.Enabled.Items then local ai=a6()if ai then return ai end end;if o()then local ai=ae()if ai then return ai end end;if H and I>E then local ai=ag()if ai then return ai end end;F=w.Havoc:CooldownRemains()<=10 or w.Mayhem:IsAvailable()if w.Conflagrate:IsCastable()and(w.RoaringBlaze:IsAvailable()and j:DebuffRemains(w.RoaringBlazeDebuff)<1.5 or w.Conflagrate:Charges()==w.Conflagrate:MaxCharges()and not F)then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate cleave 2"end end;if o()and w.DimensionalRift:IsCastable()and(N<4.7 and(w.DimensionalRift:Charges()>2 or P<w.DimensionalRift:Cooldown()))then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift cleave 4"end end;if o()and w.Cataclysm:IsCastable()then if p(w.Cataclysm,v.Destruction.GCDasOffGCD.Cataclysm,nil,not j:IsSpellInRange(w.Cataclysm))then return"cataclysm cleave 6"end end;if w.ChannelDemonfire:IsReady()and(w.RagingDemonfire:IsAvailable()and w.ImmolateDebuff:AuraActiveCount()==2)then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire cleave 8"end end;if w.SoulFire:IsCastable()and(N<=3.5 and(j:DebuffRemains(w.RoaringBlazeDebuff)>w.SoulFire:CastTime()+w.SoulFire:TravelTime()or not w.RoaringBlaze:IsAvailable()and h:BuffUp(w.BackdraftBuff))and not F)then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire cleave 10"end end;if w.Immolate:IsCastable()then if u.CastTargetIf(w.Immolate,C,"min",_,a3,not j:IsSpellInRange(w.Immolate))then return"immolate cleave 12"end end;if w.Havoc:IsCastable()and(w.SummonInfernal:CooldownDown()or not w.SummonInfernal:IsAvailable())then local ak,al,am=nil,nil,nil;for a8,T in pairs(C)do if T:GUID()~=j:GUID()then if al then am=X(T)end;if not T:IsFacingBlacklisted()and not T:IsUserCycleBlacklisted()and(T:AffectingCombat()or T:IsDummy())and(not al or e.CompareThis("min",am,al))then ak,al=T,am end end end;if ak and Z(ak)then m.CastLeftNameplate(ak,w.Havoc)end end;if o()and w.DimensionalRift:IsCastable()and(N<4.5 and F)then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift cleave 14"end end;if w.ChaosBolt:IsReady()and(U()>0 or V()>0 or N>=4)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 16"end end;if o()and w.SummonInfernal:IsCastable()then if p(w.SummonInfernal,v.Destruction.GCDasOffGCD.SummonInfernal)then return"summon_infernal cleave 18"end end;if w.ChannelDemonfire:IsReady()and(w.Ruin:TalentRank()>1 and not(w.DiabolicEmbers:IsAvailable()and w.AvatarofDestruction:IsAvailable()and(w.BurntoAshes:IsAvailable()or w.ChaosIncarnate:IsAvailable())))then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire cleave 20"end end;if w.ChaosBolt:IsReady()and N>3.5 then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 22"end end;if w.ChaosBolt:IsReady()and h:BuffRemains(w.RainofChaosBuff)>w.ChaosBolt:CastTime()then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 24"end end;if w.ChaosBolt:IsReady()and h:BuffUp(w.BackdraftBuff)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 26"end end;if w.SoulFire:IsCastable()and(N<=4 and w.Mayhem:IsAvailable())then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire cleave 28"end end;if w.ChaosBolt:IsReady()and(w.Eradication:IsAvailable()and j:DebuffRemains(w.EradicationDebuff)<w.ChaosBolt:CastTime()+w.ChaosBolt:TravelTime()+1 and not w.ChaosBolt:InFlight())then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 30"end end;if w.ChannelDemonfire:IsReady()and not(w.DiabolicEmbers:IsAvailable()and w.AvatarofDestruction:IsAvailable()and(w.BurntoAshes:IsAvailable()or w.ChaosIncarnate:IsAvailable()))then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire cleave 32"end end;if o()and w.DimensionalRift:IsCastable()then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift cleave 34"end end;if w.ChaosBolt:IsReady()and(N>3.5 and not F)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 36"end end;if w.ChaosBolt:IsReady()and(P<5.25 and j:TimeToDie()>w.ChaosBolt:CastTime()+w.ChaosBolt:TravelTime()+0.25)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt cleave 38"end end;if w.SummonSoulkeeper:IsCastable()and(w.SummonSoulkeeper:Count()==10 or w.SummonSoulkeeper:Count()>3 and P<10)then if p(w.SummonSoulkeeper,v.Destruction.GCDasOffGCD.SummonSoulkeeper)then return"summon_soulkeeper cleave 40"end end;if w.Conflagrate:IsCastable()and(w.Conflagrate:Charges()>w.Conflagrate:MaxCharges()-1 or P<E*w.Conflagrate:Charges())then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate cleave 42"end end;if w.Incinerate:IsCastable()then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate cleave 44"end end end;local function an()M=U()>0 or w.SummonInfernal:Cooldown()-w.SummonInfernal:CooldownRemains()<20;local ao=A:Cooldown()>0 and A:Cooldown()or 1;K=(t(P/ao+1)~=t((P+w.SummonInfernal:Cooldown()-w.SummonInfernal:CooldownRemains())/w.SummonInfernal:Cooldown())and t(P/ao+1)~=t((P-w.SummonInfernal:CooldownRemains())/ao+1)or t(P/ao+1)==t((P+w.SummonInfernal:Cooldown()-w.SummonInfernal:CooldownRemains())/w.SummonInfernal:Cooldown())and P-w.SummonInfernal:CooldownRemains()%ao-w.SummonInfernal:CooldownRemains()-A:BuffDuration()>0)and w.SummonInfernal:CooldownRemains()>20;local ap=B:Cooldown()>0 and B:Cooldown()or 1;L=(t(P/ap+1)~=t((P+w.SummonInfernal:Cooldown()-w.SummonInfernal:CooldownRemains())/w.SummonInfernal:Cooldown())and t(P/ap+1)~=t((P-w.SummonInfernal:CooldownRemains())/ap+1)or t(P/ap+1)==t((P+w.SummonInfernal:Cooldown()-w.SummonInfernal:CooldownRemains())/w.SummonInfernal:Cooldown())and P-w.SummonInfernal:CooldownRemains()%ap-w.SummonInfernal:CooldownRemains()-B:BuffDuration()>0)and w.SummonInfernal:CooldownRemains()>20 end;local function aq()C=h:GetEnemiesInRange(40)Enemies8ySplash=j:GetEnemiesInSplashRange(12)if n()then D=j:GetEnemiesInSplashRangeCount(12)else D=1 end;if u.TargetIsValid()or h:AffectingCombat()then E=h:GCD()+0.25;H,I,J=Q(C)O=d.BossFightRemains()P=O;if P==11111 then P=d.FightRemains(Enemies8ySplash,false)end;N=h:SoulShardsP()end;if w.SummonPet:IsCastable()then if p(w.SummonPet,v.Destruction.GCDasOffGCD.SummonPet)then return"summon_pet ooc"end end;if u.TargetIsValid()then if not h:AffectingCombat()then local ai=a5()if ai then return ai end end;if w.SpellLock:IsAvailable()then local ai=u.Interrupt(40,w.SpellLock,v.Commons.OffGCDasOffGCD.SpellLock)if ai then return ai end end;an()if D>=3-q(w.Inferno:IsAvailable()and not w.MadnessoftheAzjAqir:IsAvailable())and not(not w.Inferno:IsAvailable()and w.Chaosbringer:IsAvailable()and w.ChaosIncarnate:IsAvailable()and D<4)and not G then local ai=ah()if ai then return ai end end;if D>1 or G then local ai=aj()if ai then return ai end end;if o()then local ai=ae()if ai then return ai end end;if v.Commons.Enabled.Trinkets or v.Commons.Enabled.Trinkets then local ai=a6()if ai then return ai end end;if w.Conflagrate:IsReady()and(w.RoaringBlaze:IsAvailable()and j:DebuffRemains(w.RoaringBlazeDebuff)<1.5 and N>1.5 or w.Conflagrate:Charges()==w.Conflagrate:MaxCharges())then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate main 2"end end;if o()and w.DimensionalRift:IsCastable()and(N<4.7 and(w.DimensionalRift:Charges()>2 or P<w.DimensionalRift:Cooldown()))then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift main 4"end end;if o()and w.Cataclysm:IsReady()then if p(w.Cataclysm,v.Destruction.GCDasOffGCD.Cataclysm,nil,not j:IsInRange(40))then return"cataclysm main 6"end end;if w.ChannelDemonfire:IsReady()and(w.RagingDemonfire:IsAvailable()and j:DebuffRemains(w.ImmolateDebuff)-5*q(w.ChaosBolt:InFlight()and w.InternalCombustion:IsAvailable())>W()and(j:DebuffRemains(w.ConflagrateDebuff)>W()or not w.RoaringBlaze:IsAvailable()))then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire main 8"end end;if w.SoulFire:IsCastable()and(N<=3.5 and(j:DebuffRemains(w.RoaringBlazeDebuff)>w.SoulFire:CastTime()+w.SoulFire:TravelTime()or not w.RoaringBlaze:IsAvailable()and h:BuffUp(w.BackdraftBuff)))then if p(w.SoulFire,nil,nil,not j:IsSpellInRange(w.SoulFire))then return"soul_fire main 10"end end;if w.Immolate:IsCastable()and((j:DebuffRemains(w.ImmolateDebuff)-5*q(w.ChaosBolt:InFlight()and w.InternalCombustion:IsAvailable())<w.ImmolateDebuff:PandemicThreshold()or j:DebuffRemains(w.ImmolateDebuff)<3 or j:DebuffRemains(w.ImmolateDebuff)-w.ChaosBolt:ExecuteTime()<5 and w.InternalCombustion:IsAvailable()and w.ChaosBolt:IsReady())and(not w.Cataclysm:IsAvailable()or w.Cataclysm:CooldownRemains()>j:DebuffRemains(w.ImmolateDebuff))and(not w.SoulFire:IsAvailable()or w.SoulFire:CooldownRemains()+w.SoulFire:CastTime()>j:DebuffRemains(w.ImmolateDebuff)-5*q(w.InternalCombustion:IsAvailable()))and j:TimeToDie()>8)then if p(w.Immolate,nil,nil,not j:IsSpellInRange(w.Immolate))then return"immolate main 12"end end;if w.ChannelDemonfire:IsReady()and(j:DebuffRemains(w.ImmolateDebuff)>W()and h:HasTier(30,4))then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire main 14"end end;if w.ChaosBolt:IsReady()and(w.SummonInfernal:CooldownUp()and N>4 and w.CrashingChaos:IsAvailable())then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt main 16"end end;if o()and w.SummonInfernal:IsCastable()then if p(w.SummonInfernal,v.Destruction.GCDasOffGCD.SummonInfernal)then return"summon_infernal main 18"end end;if w.ChaosBolt:IsReady()and(U()>0 or V()>0 or N>=4)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt main 20"end end;if w.ChannelDemonfire:IsReady()and(w.Ruin:TalentRank()>1 and not(w.DiabolicEmbers:IsAvailable()and w.AvatarofDestruction:IsAvailable()and(w.BurntoAshes:IsAvailable()or w.ChaosIncarnate:IsAvailable()))and j:DebuffRemains(w.ImmolateDebuff)>W())then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire main 22"end end;if w.ChaosBolt:IsReady()and h:BuffRemains(w.RainofChaosBuff)>w.ChaosBolt:CastTime()then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt main 24"end end;if w.ChaosBolt:IsReady()and h:BuffUp(w.BackdraftBuff)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt main 26"end end;if w.ChannelDemonfire:IsReady()and(not(w.DiabolicEmbers:IsAvailable()and w.AvatarofDestruction:IsAvailable()and(w.BurntoAshes:IsAvailable()or w.ChaosIncarnate:IsAvailable()))and j:DebuffRemains(w.ImmolateDebuff)>W())then if p(w.ChannelDemonfire,nil,nil,not j:IsInRange(40))then return"channel_demonfire main 28"end end;if o()and w.DimensionalRift:IsCastable()then if p(w.DimensionalRift,v.Destruction.GCDasOffGCD.DimensionalRift,nil,not j:IsSpellInRange(w.DimensionalRift))then return"dimensional_rift main 30"end end;if w.ChaosBolt:IsReady()and(P<5.5 and P>w.ChaosBolt:CastTime()+w.ChaosBolt:TravelTime()+0.5)then if p(w.ChaosBolt,nil,nil,not j:IsSpellInRange(w.ChaosBolt))then return"chaos_bolt main 32"end end;if w.Conflagrate:IsCastable()and(w.Conflagrate:Charges()>w.Conflagrate:MaxCharges()-1 or P<E*w.Conflagrate:Charges())then if p(w.Conflagrate,nil,nil,not j:IsSpellInRange(w.Conflagrate))then return"conflagrate main 34"end end;if w.Incinerate:IsCastable()then if p(w.Incinerate,nil,nil,not j:IsSpellInRange(w.Incinerate))then return"incinerate main 36"end end end end;local function ar()w.ImmolateDebuff:RegisterAuraTracking()m.Print("Destruction Warlock rotation has been updated for patch 10.2.0.")end;m.SetAPL(267,aq,ar)